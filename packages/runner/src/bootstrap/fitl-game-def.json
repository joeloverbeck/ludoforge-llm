{
  "metadata": {
    "id": "fire-in-the-lake",
    "players": {
      "min": 4,
      "max": 4
    },
    "name": "Fire in the Lake",
    "description": "A 4-faction COIN-series wargame set in the Vietnam War"
  },
  "constants": {},
  "globalVars": [
    {
      "name": "coinResources",
      "type": "int",
      "init": 10,
      "min": 0,
      "max": 50
    },
    {
      "name": "trainCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "patrolCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "sweepCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "assaultCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "rallyCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "marchCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "attackCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "usResources",
      "type": "int",
      "init": 7,
      "min": 0,
      "max": 50
    },
    {
      "name": "adviseCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "airLiftCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "airStrikeCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "airLiftRemaining",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 6
    },
    {
      "name": "airStrikeRemaining",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 6
    },
    {
      "name": "governCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "transportCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "raidCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "infiltrateCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "bombardCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "nvaAmbushCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "taxCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "subvertCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "vcAmbushCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 20
    },
    {
      "name": "usOpCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 50
    },
    {
      "name": "arvnOpCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 50
    },
    {
      "name": "mom_wildWeasels",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_adsid",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_rollingThunder",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_medevacUnshaded",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_medevacShaded",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_blowtorchKomer",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_claymores",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_daNang",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_mcnamaraLine",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_oriskany",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_bombingPause",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_559thTransportGrp",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_bodyCount",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_generalLansdale",
      "type": "boolean",
      "init": false
    },
    {
      "name": "mom_typhoonKate",
      "type": "boolean",
      "init": false
    },
    {
      "name": "fitl_acesAirStrikeWindow",
      "type": "boolean",
      "init": false
    },
    {
      "name": "linebacker11Allowed",
      "type": "boolean",
      "init": false
    },
    {
      "name": "linebacker11SupportAvailable",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 200
    },
    {
      "name": "nvaResources",
      "type": "int",
      "init": 10,
      "min": 0,
      "max": 75
    },
    {
      "name": "vcResources",
      "type": "int",
      "init": 5,
      "min": 0,
      "max": 75
    },
    {
      "name": "arvnResources",
      "type": "int",
      "init": 30,
      "min": 0,
      "max": 75
    },
    {
      "name": "aid",
      "type": "int",
      "init": 15,
      "min": 0,
      "max": 75
    },
    {
      "name": "patronage",
      "type": "int",
      "init": 15,
      "min": 0,
      "max": 75
    },
    {
      "name": "trail",
      "type": "int",
      "init": 1,
      "min": 0,
      "max": 4
    },
    {
      "name": "totalEcon",
      "type": "int",
      "init": 15,
      "min": 0,
      "max": 75
    },
    {
      "name": "terrorSabotageMarkersPlaced",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 15
    },
    {
      "name": "leaderBoxCardCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 8
    }
  ],
  "perPlayerVars": [
    {
      "name": "resources",
      "type": "int",
      "init": 20,
      "min": 0,
      "max": 50
    }
  ],
  "zoneVars": [
    {
      "name": "terrorCount",
      "type": "int",
      "init": 0,
      "min": 0,
      "max": 15
    }
  ],
  "zones": [
    {
      "id": "hue:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "loc-hue-da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-khe-sanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "da-nang:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "kontum:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "qui-nhon:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-qui-nhon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "cam-ranh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-qui-nhon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-cam-ranh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "an-loc:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "phuoc-long:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "saigon:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 6,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "can-tho:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "ba-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-bac-lieu:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-chau-doc:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-long-phu:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-can-tho:none",
          "direction": "bidirectional"
        }
      ],
      "category": "city",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "central-laos:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "loc-hue-khe-sanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "north-vietnam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "laos",
        "coastal": false
      }
    },
    {
      "id": "southern-laos:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "central-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "northeast-cambodia:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "laos",
        "coastal": false
      }
    },
    {
      "id": "northeast-cambodia:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "cambodia",
        "coastal": false
      }
    },
    {
      "id": "the-fishhook:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "an-loc:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "northeast-cambodia:none",
          "direction": "bidirectional"
        },
        {
          "to": "phuoc-long:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "cambodia",
        "coastal": false
      }
    },
    {
      "id": "the-parrots-beak:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-chau-doc:none",
          "direction": "bidirectional"
        },
        {
          "to": "sihanoukville:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "cambodia",
        "coastal": false
      }
    },
    {
      "id": "sihanoukville:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "cambodia",
        "coastal": true
      }
    },
    {
      "id": "north-vietnam:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "central-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-khe-sanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "northVietnam",
        "coastal": true
      }
    },
    {
      "id": "quang-tri-thua-thien:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "central-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "hue:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-khe-sanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "north-vietnam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "quang-nam:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "central-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-hue-da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "quang-tin-quang-ngai:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "binh-dinh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        },
        {
          "to": "qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "pleiku-darlac:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "northeast-cambodia:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "phu-bon-phu-yen:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-qui-nhon:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-qui-nhon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "qui-nhon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "khanh-hoa:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-qui-nhon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "highland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "phuoc-long:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "an-loc:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "quang-duc-long-khanh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "phuoc-long:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "binh-tuy-binh-thuan:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "tay-ninh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "an-loc:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "phuoc-long:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "jungle"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "kien-phong:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-chau-doc:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "kien-hoa-vinh-binh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "ba-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-long-phu:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "ba-xuyen:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-bac-lieu:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-long-phu:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 1,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "kien-giang-an-xuyen:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "ba-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-bac-lieu:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-can-tho-chau-doc:none",
          "direction": "bidirectional"
        },
        {
          "to": "sihanoukville:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "province",
      "attributes": {
        "population": 2,
        "econ": 0,
        "terrainTags": [
          "lowland"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-hue-khe-sanh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "central-laos:none",
          "direction": "bidirectional"
        },
        {
          "to": "hue:none",
          "direction": "bidirectional"
        },
        {
          "to": "north-vietnam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-hue-da-nang:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "hue:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tri-thua-thien:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-da-nang-dak-to:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-nam:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-da-nang-qui-nhon:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "da-nang:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-tin-quang-ngai:none",
          "direction": "bidirectional"
        },
        {
          "to": "qui-nhon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-kontum-dak-to:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-da-nang-dak-to:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "southern-laos:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-kontum-qui-nhon:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-dinh:none",
          "direction": "bidirectional"
        },
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "qui-nhon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-kontum-ban-me-thuot:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "kontum:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-qui-nhon-cam-ranh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "phu-bon-phu-yen:none",
          "direction": "bidirectional"
        },
        {
          "to": "qui-nhon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-cam-ranh-da-lat:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-ban-me-thuot-da-lat:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-an-loc-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-saigon-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-saigon-cam-ranh:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "cam-ranh:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-saigon-da-lat:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "binh-tuy-binh-thuan:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-cam-ranh-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-saigon-an-loc-ban-me-thuot:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "an-loc:none",
          "direction": "bidirectional"
        },
        {
          "to": "khanh-hoa:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-ban-me-thuot-da-lat:none",
          "direction": "bidirectional"
        },
        {
          "to": "loc-kontum-ban-me-thuot:none",
          "direction": "bidirectional"
        },
        {
          "to": "phuoc-long:none",
          "direction": "bidirectional"
        },
        {
          "to": "pleiku-darlac:none",
          "direction": "bidirectional"
        },
        {
          "to": "quang-duc-long-khanh:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        },
        {
          "to": "tay-ninh:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-fishhook:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "highway"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-saigon-can-tho:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "saigon:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 2,
        "terrainTags": [
          "mekong"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-can-tho-chau-doc:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-phong:none",
          "direction": "bidirectional"
        },
        {
          "to": "the-parrots-beak:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "mekong"
        ],
        "country": "southVietnam",
        "coastal": false
      }
    },
    {
      "id": "loc-can-tho-bac-lieu:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "ba-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-giang-an-xuyen:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 0,
        "terrainTags": [
          "mekong"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "loc-can-tho-long-phu:none",
      "zoneKind": "board",
      "owner": "none",
      "visibility": "public",
      "ordering": "set",
      "adjacentTo": [
        {
          "to": "ba-xuyen:none",
          "direction": "bidirectional"
        },
        {
          "to": "can-tho:none",
          "direction": "bidirectional"
        },
        {
          "to": "kien-hoa-vinh-binh:none",
          "direction": "bidirectional"
        }
      ],
      "category": "loc",
      "attributes": {
        "population": 0,
        "econ": 1,
        "terrainTags": [
          "mekong"
        ],
        "country": "southVietnam",
        "coastal": true
      }
    },
    {
      "id": "deck:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "hidden",
      "ordering": "stack"
    },
    {
      "id": "available-US:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "out-of-play-US:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "available-ARVN:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "out-of-play-ARVN:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "available-NVA:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "available-VC:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "casualties-US:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "set"
    },
    {
      "id": "leader:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "stack"
    },
    {
      "id": "lookahead:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "stack"
    },
    {
      "id": "played:none",
      "zoneKind": "aux",
      "owner": "none",
      "visibility": "public",
      "ordering": "stack"
    },
    {
      "id": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
      "zoneKind": "aux",
      "isInternal": true,
      "owner": "none",
      "visibility": "hidden",
      "ordering": "set"
    },
    {
      "id": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
      "zoneKind": "aux",
      "isInternal": true,
      "owner": "none",
      "visibility": "hidden",
      "ordering": "set"
    },
    {
      "id": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
      "zoneKind": "aux",
      "isInternal": true,
      "owner": "none",
      "visibility": "hidden",
      "ordering": "set"
    },
    {
      "id": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
      "zoneKind": "aux",
      "isInternal": true,
      "owner": "none",
      "visibility": "hidden",
      "ordering": "set"
    },
    {
      "id": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
      "zoneKind": "aux",
      "isInternal": true,
      "owner": "none",
      "visibility": "hidden",
      "ordering": "set"
    }
  ],
  "seats": [
    {
      "id": "us"
    },
    {
      "id": "arvn"
    },
    {
      "id": "nva"
    },
    {
      "id": "vc"
    }
  ],
  "tracks": [
    {
      "id": "nvaResources",
      "scope": "seat",
      "seat": "nva",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "vcResources",
      "scope": "seat",
      "seat": "vc",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "arvnResources",
      "scope": "seat",
      "seat": "arvn",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "aid",
      "scope": "global",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "patronage",
      "scope": "global",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "trail",
      "scope": "global",
      "min": 0,
      "max": 4,
      "initial": 0
    },
    {
      "id": "totalEcon",
      "scope": "global",
      "min": 0,
      "max": 75,
      "initial": 0
    },
    {
      "id": "terrorSabotageMarkersPlaced",
      "scope": "global",
      "min": 0,
      "max": 15,
      "initial": 0
    },
    {
      "id": "leaderBoxCardCount",
      "scope": "global",
      "min": 0,
      "max": 8,
      "initial": 0
    }
  ],
  "markerLattices": [
    {
      "id": "supportOpposition",
      "states": [
        "activeOpposition",
        "passiveOpposition",
        "neutral",
        "passiveSupport",
        "activeSupport"
      ],
      "defaultState": "neutral",
      "constraints": [
        {
          "category": [
            "loc"
          ],
          "allowedStates": [
            "neutral"
          ]
        },
        {
          "attributeEquals": {
            "population": 0
          },
          "allowedStates": [
            "neutral"
          ]
        }
      ]
    },
    {
      "id": "sabotage",
      "states": [
        "none",
        "sabotage"
      ],
      "defaultState": "none",
      "constraints": [
        {
          "category": [
            "city",
            "province"
          ],
          "allowedStates": [
            "none"
          ]
        }
      ]
    },
    {
      "id": "coupPacifySpaceUsage",
      "states": [
        "open",
        "used"
      ],
      "defaultState": "open"
    },
    {
      "id": "coupAgitateSpaceUsage",
      "states": [
        "open",
        "used"
      ],
      "defaultState": "open"
    },
    {
      "id": "coupSupportShiftCount",
      "states": [
        "zero",
        "one",
        "two"
      ],
      "defaultState": "zero"
    }
  ],
  "stackingConstraints": [
    {
      "id": "max-2-bases-per-space",
      "description": "No more than 2 Bases of any Factions may occupy a single Province or City",
      "spaceFilter": {
        "category": [
          "province",
          "city"
        ]
      },
      "pieceFilter": {
        "pieceTypeIds": [
          "us-bases",
          "arvn-bases",
          "nva-bases",
          "vc-bases"
        ]
      },
      "rule": "maxCount",
      "maxCount": 2
    },
    {
      "id": "no-bases-on-locs",
      "description": "Bases may not occupy LoCs",
      "spaceFilter": {
        "category": [
          "loc"
        ]
      },
      "pieceFilter": {
        "pieceTypeIds": [
          "us-bases",
          "arvn-bases",
          "nva-bases",
          "vc-bases"
        ]
      },
      "rule": "prohibit"
    },
    {
      "id": "north-vietnam-insurgent-only",
      "description": "Only NVA and VC forces may occupy North Vietnam",
      "spaceFilter": {
        "attributeEquals": {
          "country": "northVietnam"
        }
      },
      "pieceFilter": {
        "pieceTypeIds": [
          "us-troops",
          "us-bases",
          "us-irregulars",
          "arvn-troops",
          "arvn-police",
          "arvn-rangers",
          "arvn-bases"
        ]
      },
      "rule": "prohibit"
    }
  ],
  "globalMarkerLattices": [
    {
      "id": "cap_topGun",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_arcLight",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_abrams",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_cobras",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_m48Patton",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_caps",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_cords",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_lgbs",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_searchAndDestroy",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_aaa",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_longRangeGuns",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_migs",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_sa2s",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_pt76",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_armoredCavalry",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_mandateOfHeaven",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_boobyTraps",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_mainForceBns",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "cap_cadres",
      "states": [
        "inactive",
        "unshaded",
        "shaded"
      ],
      "defaultState": "inactive"
    },
    {
      "id": "activeLeader",
      "states": [
        "minh",
        "khanh",
        "youngTurks",
        "ky",
        "thieu"
      ],
      "defaultState": "minh"
    },
    {
      "id": "leaderFlipped",
      "states": [
        "normal",
        "flipped"
      ],
      "defaultState": "normal"
    }
  ],
  "runtimeDataAssets": [
    {
      "id": "fitl-map-production",
      "kind": "map",
      "payload": {
        "spaces": [
          {
            "id": "hue:none",
            "category": "city",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "quang-tri-thua-thien:none"
              },
              {
                "to": "loc-hue-khe-sanh:none"
              },
              {
                "to": "loc-hue-da-nang:none"
              }
            ]
          },
          {
            "id": "da-nang:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "quang-nam:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "loc-hue-da-nang:none"
              },
              {
                "to": "loc-da-nang-qui-nhon:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              }
            ]
          },
          {
            "id": "kontum:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "loc-kontum-dak-to:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-kontum-qui-nhon:none"
              }
            ]
          },
          {
            "id": "qui-nhon:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "loc-da-nang-qui-nhon:none"
              },
              {
                "to": "loc-kontum-qui-nhon:none"
              },
              {
                "to": "loc-qui-nhon-cam-ranh:none"
              }
            ]
          },
          {
            "id": "cam-ranh:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "loc-qui-nhon-cam-ranh:none"
              },
              {
                "to": "loc-saigon-cam-ranh:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              }
            ]
          },
          {
            "id": "an-loc:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "phuoc-long:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "saigon:none",
            "category": "city",
            "attributes": {
              "population": 6,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              },
              {
                "to": "loc-saigon-cam-ranh:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              },
              {
                "to": "loc-saigon-can-tho:none"
              }
            ]
          },
          {
            "id": "can-tho:none",
            "category": "city",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "kien-phong:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              },
              {
                "to": "ba-xuyen:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              },
              {
                "to": "loc-saigon-can-tho:none"
              },
              {
                "to": "loc-can-tho-chau-doc:none"
              },
              {
                "to": "loc-can-tho-bac-lieu:none"
              },
              {
                "to": "loc-can-tho-long-phu:none"
              }
            ]
          },
          {
            "id": "central-laos:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "laos",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "north-vietnam:none"
              },
              {
                "to": "quang-tri-thua-thien:none"
              },
              {
                "to": "quang-nam:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "loc-hue-khe-sanh:none"
              }
            ]
          },
          {
            "id": "southern-laos:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "laos",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "central-laos:none"
              },
              {
                "to": "quang-nam:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "northeast-cambodia:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              },
              {
                "to": "loc-kontum-dak-to:none"
              }
            ]
          },
          {
            "id": "northeast-cambodia:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "cambodia",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "southern-laos:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "pleiku-darlac:none"
              }
            ]
          },
          {
            "id": "the-fishhook:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "cambodia",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "an-loc:none"
              },
              {
                "to": "northeast-cambodia:none"
              },
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "phuoc-long:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "the-parrots-beak:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "cambodia",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "sihanoukville:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              },
              {
                "to": "loc-can-tho-chau-doc:none"
              }
            ]
          },
          {
            "id": "sihanoukville:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "cambodia",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              }
            ]
          },
          {
            "id": "north-vietnam:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "northVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "central-laos:none"
              },
              {
                "to": "quang-tri-thua-thien:none"
              },
              {
                "to": "loc-hue-khe-sanh:none"
              }
            ]
          },
          {
            "id": "quang-tri-thua-thien:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "hue:none"
              },
              {
                "to": "central-laos:none"
              },
              {
                "to": "north-vietnam:none"
              },
              {
                "to": "quang-nam:none"
              },
              {
                "to": "loc-hue-khe-sanh:none"
              },
              {
                "to": "loc-hue-da-nang:none"
              }
            ]
          },
          {
            "id": "quang-nam:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "da-nang:none"
              },
              {
                "to": "central-laos:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "quang-tri-thua-thien:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "loc-hue-da-nang:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              }
            ]
          },
          {
            "id": "quang-tin-quang-ngai:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "da-nang:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "quang-nam:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              },
              {
                "to": "loc-da-nang-qui-nhon:none"
              }
            ]
          },
          {
            "id": "binh-dinh:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "qui-nhon:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              },
              {
                "to": "loc-da-nang-qui-nhon:none"
              },
              {
                "to": "loc-kontum-dak-to:none"
              },
              {
                "to": "loc-kontum-qui-nhon:none"
              }
            ]
          },
          {
            "id": "pleiku-darlac:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "northeast-cambodia:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "loc-kontum-dak-to:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "phu-bon-phu-yen:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "qui-nhon:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "loc-kontum-qui-nhon:none"
              },
              {
                "to": "loc-qui-nhon-cam-ranh:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "khanh-hoa:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "highland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "cam-ranh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "loc-qui-nhon-cam-ranh:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "phuoc-long:none",
            "category": "province",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "an-loc:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "quang-duc-long-khanh:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "saigon:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "phuoc-long:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              }
            ]
          },
          {
            "id": "binh-tuy-binh-thuan:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "cam-ranh:none"
              },
              {
                "to": "saigon:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              },
              {
                "to": "loc-saigon-cam-ranh:none"
              }
            ]
          },
          {
            "id": "tay-ninh:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "jungle"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "an-loc:none"
              },
              {
                "to": "saigon:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "phuoc-long:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              }
            ]
          },
          {
            "id": "kien-phong:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "saigon:none"
              },
              {
                "to": "can-tho:none"
              },
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              },
              {
                "to": "loc-can-tho-chau-doc:none"
              },
              {
                "to": "loc-saigon-can-tho:none"
              }
            ]
          },
          {
            "id": "kien-hoa-vinh-binh:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "saigon:none"
              },
              {
                "to": "can-tho:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "ba-xuyen:none"
              },
              {
                "to": "loc-saigon-can-tho:none"
              },
              {
                "to": "loc-can-tho-long-phu:none"
              }
            ]
          },
          {
            "id": "ba-xuyen:none",
            "category": "province",
            "attributes": {
              "population": 1,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "can-tho:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              },
              {
                "to": "loc-can-tho-bac-lieu:none"
              },
              {
                "to": "loc-can-tho-long-phu:none"
              }
            ]
          },
          {
            "id": "kien-giang-an-xuyen:none",
            "category": "province",
            "attributes": {
              "population": 2,
              "econ": 0,
              "terrainTags": [
                "lowland"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "can-tho:none"
              },
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "sihanoukville:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "ba-xuyen:none"
              },
              {
                "to": "loc-can-tho-chau-doc:none"
              },
              {
                "to": "loc-can-tho-bac-lieu:none"
              }
            ]
          },
          {
            "id": "loc-hue-khe-sanh:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "hue:none"
              },
              {
                "to": "central-laos:none"
              },
              {
                "to": "north-vietnam:none"
              },
              {
                "to": "quang-tri-thua-thien:none"
              }
            ]
          },
          {
            "id": "loc-hue-da-nang:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "hue:none"
              },
              {
                "to": "da-nang:none"
              },
              {
                "to": "quang-tri-thua-thien:none"
              },
              {
                "to": "quang-nam:none"
              }
            ]
          },
          {
            "id": "loc-da-nang-dak-to:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "da-nang:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "quang-nam:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "loc-kontum-dak-to:none"
              }
            ]
          },
          {
            "id": "loc-da-nang-qui-nhon:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "da-nang:none"
              },
              {
                "to": "qui-nhon:none"
              },
              {
                "to": "quang-tin-quang-ngai:none"
              },
              {
                "to": "binh-dinh:none"
              }
            ]
          },
          {
            "id": "loc-kontum-dak-to:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "southern-laos:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "loc-da-nang-dak-to:none"
              }
            ]
          },
          {
            "id": "loc-kontum-qui-nhon:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "qui-nhon:none"
              },
              {
                "to": "binh-dinh:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              }
            ]
          },
          {
            "id": "loc-kontum-ban-me-thuot:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "kontum:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              }
            ]
          },
          {
            "id": "loc-qui-nhon-cam-ranh:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "qui-nhon:none"
              },
              {
                "to": "cam-ranh:none"
              },
              {
                "to": "phu-bon-phu-yen:none"
              },
              {
                "to": "khanh-hoa:none"
              }
            ]
          },
          {
            "id": "loc-cam-ranh-da-lat:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "cam-ranh:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              }
            ]
          },
          {
            "id": "loc-ban-me-thuot-da-lat:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              },
              {
                "to": "loc-saigon-an-loc-ban-me-thuot:none"
              },
              {
                "to": "loc-saigon-da-lat:none"
              }
            ]
          },
          {
            "id": "loc-saigon-cam-ranh:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "cam-ranh:none"
              },
              {
                "to": "saigon:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              }
            ]
          },
          {
            "id": "loc-saigon-da-lat:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "saigon:none"
              },
              {
                "to": "khanh-hoa:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "binh-tuy-binh-thuan:none"
              },
              {
                "to": "loc-cam-ranh-da-lat:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              }
            ]
          },
          {
            "id": "loc-saigon-an-loc-ban-me-thuot:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "highway"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "an-loc:none"
              },
              {
                "to": "saigon:none"
              },
              {
                "to": "the-fishhook:none"
              },
              {
                "to": "pleiku-darlac:none"
              },
              {
                "to": "phuoc-long:none"
              },
              {
                "to": "quang-duc-long-khanh:none"
              },
              {
                "to": "tay-ninh:none"
              },
              {
                "to": "loc-kontum-ban-me-thuot:none"
              },
              {
                "to": "loc-ban-me-thuot-da-lat:none"
              },
              {
                "to": "khanh-hoa:none"
              }
            ]
          },
          {
            "id": "loc-saigon-can-tho:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 2,
              "terrainTags": [
                "mekong"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "saigon:none"
              },
              {
                "to": "can-tho:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              }
            ]
          },
          {
            "id": "loc-can-tho-chau-doc:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "mekong"
              ],
              "country": "southVietnam",
              "coastal": false
            },
            "adjacentTo": [
              {
                "to": "can-tho:none"
              },
              {
                "to": "the-parrots-beak:none"
              },
              {
                "to": "kien-phong:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              }
            ]
          },
          {
            "id": "loc-can-tho-bac-lieu:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 0,
              "terrainTags": [
                "mekong"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "can-tho:none"
              },
              {
                "to": "ba-xuyen:none"
              },
              {
                "to": "kien-giang-an-xuyen:none"
              }
            ]
          },
          {
            "id": "loc-can-tho-long-phu:none",
            "category": "loc",
            "attributes": {
              "population": 0,
              "econ": 1,
              "terrainTags": [
                "mekong"
              ],
              "country": "southVietnam",
              "coastal": true
            },
            "adjacentTo": [
              {
                "to": "can-tho:none"
              },
              {
                "to": "kien-hoa-vinh-binh:none"
              },
              {
                "to": "ba-xuyen:none"
              }
            ]
          }
        ],
        "tracks": [
          {
            "id": "nvaResources",
            "scope": "seat",
            "seat": "nva",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "vcResources",
            "scope": "seat",
            "seat": "vc",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "arvnResources",
            "scope": "seat",
            "seat": "arvn",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "aid",
            "scope": "global",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "patronage",
            "scope": "global",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "trail",
            "scope": "global",
            "min": 0,
            "max": 4,
            "initial": 0
          },
          {
            "id": "totalEcon",
            "scope": "global",
            "min": 0,
            "max": 75,
            "initial": 0
          },
          {
            "id": "terrorSabotageMarkersPlaced",
            "scope": "global",
            "min": 0,
            "max": 15,
            "initial": 0
          },
          {
            "id": "leaderBoxCardCount",
            "scope": "global",
            "min": 0,
            "max": 8,
            "initial": 0
          }
        ],
        "markerLattices": [
          {
            "id": "supportOpposition",
            "states": [
              "activeOpposition",
              "passiveOpposition",
              "neutral",
              "passiveSupport",
              "activeSupport"
            ],
            "defaultState": "neutral",
            "constraints": [
              {
                "category": [
                  "loc"
                ],
                "allowedStates": [
                  "neutral"
                ]
              },
              {
                "attributeEquals": {
                  "population": 0
                },
                "allowedStates": [
                  "neutral"
                ]
              }
            ]
          },
          {
            "id": "sabotage",
            "states": [
              "none",
              "sabotage"
            ],
            "defaultState": "none",
            "constraints": [
              {
                "category": [
                  "city",
                  "province"
                ],
                "allowedStates": [
                  "none"
                ]
              }
            ]
          },
          {
            "id": "coupPacifySpaceUsage",
            "states": [
              "open",
              "used"
            ],
            "defaultState": "open"
          },
          {
            "id": "coupAgitateSpaceUsage",
            "states": [
              "open",
              "used"
            ],
            "defaultState": "open"
          },
          {
            "id": "coupSupportShiftCount",
            "states": [
              "zero",
              "one",
              "two"
            ],
            "defaultState": "zero"
          }
        ],
        "stackingConstraints": [
          {
            "id": "max-2-bases-per-space",
            "description": "No more than 2 Bases of any Factions may occupy a single Province or City",
            "spaceFilter": {
              "category": [
                "province",
                "city"
              ]
            },
            "pieceFilter": {
              "pieceTypeIds": [
                "us-bases",
                "arvn-bases",
                "nva-bases",
                "vc-bases"
              ]
            },
            "rule": "maxCount",
            "maxCount": 2
          },
          {
            "id": "no-bases-on-locs",
            "description": "Bases may not occupy LoCs",
            "spaceFilter": {
              "category": [
                "loc"
              ]
            },
            "pieceFilter": {
              "pieceTypeIds": [
                "us-bases",
                "arvn-bases",
                "nva-bases",
                "vc-bases"
              ]
            },
            "rule": "prohibit"
          },
          {
            "id": "north-vietnam-insurgent-only",
            "description": "Only NVA and VC forces may occupy North Vietnam",
            "spaceFilter": {
              "attributeEquals": {
                "country": "northVietnam"
              }
            },
            "pieceFilter": {
              "pieceTypeIds": [
                "us-troops",
                "us-bases",
                "us-irregulars",
                "arvn-troops",
                "arvn-police",
                "arvn-rangers",
                "arvn-bases"
              ]
            },
            "rule": "prohibit"
          }
        ]
      }
    },
    {
      "id": "fitl-piece-catalog-production",
      "kind": "pieceCatalog",
      "payload": {
        "seats": [
          {
            "id": "us"
          },
          {
            "id": "arvn"
          },
          {
            "id": "nva"
          },
          {
            "id": "vc"
          }
        ],
        "pieceTypes": [
          {
            "id": "us-troops",
            "seat": "us",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "US",
              "type": "troops"
            }
          },
          {
            "id": "us-bases",
            "seat": "us",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "US",
              "type": "base"
            }
          },
          {
            "id": "us-irregulars",
            "seat": "us",
            "statusDimensions": [
              "activity"
            ],
            "transitions": [
              {
                "dimension": "activity",
                "from": "underground",
                "to": "active"
              },
              {
                "dimension": "activity",
                "from": "active",
                "to": "underground"
              }
            ],
            "runtimeProps": {
              "faction": "US",
              "type": "irregular",
              "activity": "underground"
            }
          },
          {
            "id": "arvn-troops",
            "seat": "arvn",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "ARVN",
              "type": "troops"
            }
          },
          {
            "id": "arvn-police",
            "seat": "arvn",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "ARVN",
              "type": "police"
            }
          },
          {
            "id": "arvn-rangers",
            "seat": "arvn",
            "statusDimensions": [
              "activity"
            ],
            "transitions": [
              {
                "dimension": "activity",
                "from": "underground",
                "to": "active"
              },
              {
                "dimension": "activity",
                "from": "active",
                "to": "underground"
              }
            ],
            "runtimeProps": {
              "faction": "ARVN",
              "type": "ranger",
              "activity": "underground"
            }
          },
          {
            "id": "arvn-bases",
            "seat": "arvn",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "ARVN",
              "type": "base"
            }
          },
          {
            "id": "nva-troops",
            "seat": "nva",
            "statusDimensions": [],
            "transitions": [],
            "runtimeProps": {
              "faction": "NVA",
              "type": "troops"
            }
          },
          {
            "id": "nva-guerrillas",
            "seat": "nva",
            "statusDimensions": [
              "activity"
            ],
            "transitions": [
              {
                "dimension": "activity",
                "from": "underground",
                "to": "active"
              },
              {
                "dimension": "activity",
                "from": "active",
                "to": "underground"
              }
            ],
            "runtimeProps": {
              "faction": "NVA",
              "type": "guerrilla",
              "activity": "underground"
            }
          },
          {
            "id": "nva-bases",
            "seat": "nva",
            "statusDimensions": [
              "tunnel"
            ],
            "transitions": [
              {
                "dimension": "tunnel",
                "from": "untunneled",
                "to": "tunneled"
              },
              {
                "dimension": "tunnel",
                "from": "tunneled",
                "to": "untunneled"
              }
            ],
            "runtimeProps": {
              "faction": "NVA",
              "type": "base",
              "tunnel": "untunneled"
            }
          },
          {
            "id": "vc-guerrillas",
            "seat": "vc",
            "statusDimensions": [
              "activity"
            ],
            "transitions": [
              {
                "dimension": "activity",
                "from": "underground",
                "to": "active"
              },
              {
                "dimension": "activity",
                "from": "active",
                "to": "underground"
              }
            ],
            "runtimeProps": {
              "faction": "VC",
              "type": "guerrilla",
              "activity": "underground"
            }
          },
          {
            "id": "vc-bases",
            "seat": "vc",
            "statusDimensions": [
              "tunnel"
            ],
            "transitions": [
              {
                "dimension": "tunnel",
                "from": "untunneled",
                "to": "tunneled"
              },
              {
                "dimension": "tunnel",
                "from": "tunneled",
                "to": "untunneled"
              }
            ],
            "runtimeProps": {
              "faction": "VC",
              "type": "base",
              "tunnel": "untunneled"
            }
          }
        ],
        "inventory": [
          {
            "pieceTypeId": "us-troops",
            "seat": "us",
            "total": 40
          },
          {
            "pieceTypeId": "us-bases",
            "seat": "us",
            "total": 6
          },
          {
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "total": 6
          },
          {
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "total": 30
          },
          {
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "total": 30
          },
          {
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "total": 6
          },
          {
            "pieceTypeId": "arvn-bases",
            "seat": "arvn",
            "total": 3
          },
          {
            "pieceTypeId": "nva-troops",
            "seat": "nva",
            "total": 40
          },
          {
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "total": 20
          },
          {
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "total": 9
          },
          {
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "total": 30
          },
          {
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "total": 9
          }
        ]
      }
    },
    {
      "id": "fitl-scenario-full",
      "kind": "scenario",
      "payload": {
        "mapAssetId": "fitl-map-production",
        "pieceCatalogAssetId": "fitl-piece-catalog-production",
        "scenarioName": "Full",
        "yearRange": "1964-1972",
        "deckComposition": {
          "materializationStrategy": "pile-coup-mix-v1",
          "pileCount": 6,
          "eventsPerPile": 12,
          "coupsPerPile": 1,
          "excludedCardTags": [
            "pivotal"
          ],
          "pileFilters": [
            {
              "piles": [
                1
              ],
              "metadataEquals": {
                "period": "1964"
              }
            },
            {
              "piles": [
                2,
                3
              ],
              "metadataEquals": {
                "period": "1965"
              }
            },
            {
              "piles": [
                4,
                5,
                6
              ],
              "metadataEquals": {
                "period": "1968"
              }
            }
          ]
        },
        "cardPlacements": [
          {
            "cardId": "card-121",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-122",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-123",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-124",
            "zoneId": "leader:none"
          }
        ],
        "outOfPlay": [
          {
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 2
          },
          {
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 10
          },
          {
            "pieceTypeId": "arvn-bases",
            "seat": "arvn",
            "count": 2
          },
          {
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 10
          },
          {
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 3
          }
        ],
        "seatPools": [
          {
            "seat": "us",
            "availableZoneId": "available-US:none",
            "outOfPlayZoneId": "out-of-play-US:none"
          },
          {
            "seat": "arvn",
            "availableZoneId": "available-ARVN:none",
            "outOfPlayZoneId": "out-of-play-ARVN:none"
          },
          {
            "seat": "nva",
            "availableZoneId": "available-NVA:none"
          },
          {
            "seat": "vc",
            "availableZoneId": "available-VC:none"
          }
        ],
        "initializations": [
          {
            "markerId": "activeLeader",
            "state": "minh"
          },
          {
            "trackId": "aid",
            "value": 15
          },
          {
            "trackId": "patronage",
            "value": 15
          },
          {
            "trackId": "trail",
            "value": 1
          },
          {
            "trackId": "totalEcon",
            "value": 15
          },
          {
            "trackId": "vcResources",
            "value": 5
          },
          {
            "trackId": "nvaResources",
            "value": 10
          },
          {
            "trackId": "arvnResources",
            "value": 30
          },
          {
            "spaceId": "saigon:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "qui-nhon:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "cam-ranh:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "an-loc:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "can-tho:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "khanh-hoa:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "ba-xuyen:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "tay-ninh:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-phong:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          }
        ],
        "initialPlacements": [
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 3
          },
          {
            "spaceId": "hue:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "hue:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "qui-nhon:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "qui-nhon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "cam-ranh:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "cam-ranh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "an-loc:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "an-loc:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1,
            "status": {
              "tunnel": "tunneled"
            }
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "ba-xuyen:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-phong:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 3
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 3
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 3
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 3
          }
        ]
      }
    },
    {
      "id": "fitl-scenario-short",
      "kind": "scenario",
      "payload": {
        "mapAssetId": "fitl-map-production",
        "pieceCatalogAssetId": "fitl-piece-catalog-production",
        "scenarioName": "Short",
        "yearRange": "1965-1967",
        "deckComposition": {
          "materializationStrategy": "pile-coup-mix-v1",
          "pileCount": 3,
          "eventsPerPile": 8,
          "coupsPerPile": 1,
          "excludedCardTags": [
            "pivotal"
          ],
          "excludedCardIds": [
            "card-129"
          ],
          "pileFilters": [
            {
              "piles": [
                1,
                2,
                3
              ],
              "metadataEquals": {
                "period": "1965"
              }
            }
          ]
        },
        "outOfPlay": [
          {
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 6
          },
          {
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 10
          },
          {
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 3
          }
        ],
        "seatPools": [
          {
            "seat": "us",
            "availableZoneId": "available-US:none",
            "outOfPlayZoneId": "out-of-play-US:none"
          },
          {
            "seat": "arvn",
            "availableZoneId": "available-ARVN:none",
            "outOfPlayZoneId": "out-of-play-ARVN:none"
          },
          {
            "seat": "nva",
            "availableZoneId": "available-NVA:none"
          },
          {
            "seat": "vc",
            "availableZoneId": "available-VC:none"
          }
        ],
        "initializations": [
          {
            "markerId": "activeLeader",
            "state": "youngTurks"
          },
          {
            "markerId": "cap_aaa",
            "state": "shaded"
          },
          {
            "trackId": "aid",
            "value": 15
          },
          {
            "trackId": "patronage",
            "value": 18
          },
          {
            "trackId": "trail",
            "value": 2
          },
          {
            "trackId": "totalEcon",
            "value": 15
          },
          {
            "trackId": "vcResources",
            "value": 10
          },
          {
            "trackId": "nvaResources",
            "value": 15
          },
          {
            "trackId": "arvnResources",
            "value": 30
          },
          {
            "trackId": "leaderBoxCardCount",
            "value": 2
          },
          {
            "spaceId": "da-nang:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "kontum:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "saigon:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "can-tho:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "binh-dinh:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "an-loc:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "qui-nhon:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "cam-ranh:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "tay-ninh:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-phong:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          }
        ],
        "initialPlacements": [
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 4
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 4
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "arvn-bases",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 4
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 4
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "hue:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "ba-xuyen:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "an-loc:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "qui-nhon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "cam-ranh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1,
            "status": {
              "tunnel": "tunneled"
            }
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "kien-phong:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-troops",
            "seat": "nva",
            "count": 6
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-troops",
            "seat": "nva",
            "count": 6
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "the-fishhook:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "the-fishhook:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          }
        ]
      }
    },
    {
      "id": "fitl-scenario-medium",
      "kind": "scenario",
      "payload": {
        "mapAssetId": "fitl-map-production",
        "pieceCatalogAssetId": "fitl-piece-catalog-production",
        "scenarioName": "Medium",
        "yearRange": "1968-1972",
        "deckComposition": {
          "materializationStrategy": "pile-coup-mix-v1",
          "pileCount": 3,
          "eventsPerPile": 12,
          "coupsPerPile": 1,
          "excludedCardTags": [
            "pivotal"
          ],
          "pileFilters": [
            {
              "piles": [
                1,
                2,
                3
              ],
              "metadataEquals": {
                "period": "1968"
              }
            }
          ]
        },
        "cardPlacements": [
          {
            "cardId": "card-121",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-122",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-123",
            "zoneId": "leader:none"
          },
          {
            "cardId": "card-124",
            "zoneId": "leader:none"
          }
        ],
        "outOfPlay": [
          {
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 5
          },
          {
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 10
          },
          {
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 3
          }
        ],
        "seatPools": [
          {
            "seat": "us",
            "availableZoneId": "available-US:none",
            "outOfPlayZoneId": "out-of-play-US:none"
          },
          {
            "seat": "arvn",
            "availableZoneId": "available-ARVN:none",
            "outOfPlayZoneId": "out-of-play-ARVN:none"
          },
          {
            "seat": "nva",
            "availableZoneId": "available-NVA:none"
          },
          {
            "seat": "vc",
            "availableZoneId": "available-VC:none"
          }
        ],
        "initializations": [
          {
            "markerId": "activeLeader",
            "state": "ky"
          },
          {
            "markerId": "cap_aaa",
            "state": "shaded"
          },
          {
            "markerId": "cap_mainForceBns",
            "state": "shaded"
          },
          {
            "markerId": "cap_sa2s",
            "state": "shaded"
          },
          {
            "markerId": "cap_searchAndDestroy",
            "state": "shaded"
          },
          {
            "markerId": "cap_arcLight",
            "state": "unshaded"
          },
          {
            "markerId": "cap_m48Patton",
            "state": "unshaded"
          },
          {
            "trackId": "aid",
            "value": 30
          },
          {
            "trackId": "patronage",
            "value": 15
          },
          {
            "trackId": "trail",
            "value": 3
          },
          {
            "trackId": "totalEcon",
            "value": 15
          },
          {
            "trackId": "vcResources",
            "value": 15
          },
          {
            "trackId": "nvaResources",
            "value": 20
          },
          {
            "trackId": "arvnResources",
            "value": 30
          },
          {
            "trackId": "leaderBoxCardCount",
            "value": 3
          },
          {
            "spaceId": "binh-dinh:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "pleiku-darlac:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "khanh-hoa:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "saigon:none",
            "markerId": "supportOpposition",
            "state": "activeSupport"
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "hue:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "da-nang:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "qui-nhon:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "cam-ranh:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "kontum:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "can-tho:none",
            "markerId": "supportOpposition",
            "state": "passiveSupport"
          },
          {
            "spaceId": "quang-nam:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "tay-ninh:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "markerId": "supportOpposition",
            "state": "activeOpposition"
          },
          {
            "spaceId": "kien-phong:none",
            "markerId": "supportOpposition",
            "state": "passiveOpposition"
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "markerId": "supportOpposition",
            "state": "passiveOpposition"
          },
          {
            "spaceId": "ba-xuyen:none",
            "markerId": "supportOpposition",
            "state": "passiveOpposition"
          }
        ],
        "initialPlacements": [
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 4
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 3
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "quang-tri-thua-thien:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 3
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-nam:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "hue:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "hue:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "da-nang:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "qui-nhon:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "qui-nhon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "cam-ranh:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "cam-ranh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "quang-tin-quang-ngai:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "kontum:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-dinh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "pleiku-darlac:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "khanh-hoa:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "phu-bon-phu-yen:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 3
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "binh-tuy-binh-thuan:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 2
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 4
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "saigon:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "quang-duc-long-khanh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "phuoc-long:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "phuoc-long:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 2
          },
          {
            "spaceId": "phuoc-long:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "us-bases",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-bases",
            "seat": "vc",
            "count": 1,
            "status": {
              "tunnel": "tunneled"
            }
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 3
          },
          {
            "spaceId": "tay-ninh:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "an-loc:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "an-loc:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "us-troops",
            "seat": "us",
            "count": 3
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "us-irregulars",
            "seat": "us",
            "count": 1
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "can-tho:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-phong:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-phong:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-hoa-vinh-binh:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "ba-xuyen:none",
            "pieceTypeId": "arvn-police",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "ba-xuyen:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "arvn-bases",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "arvn-troops",
            "seat": "arvn",
            "count": 2
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "arvn-rangers",
            "seat": "arvn",
            "count": 1
          },
          {
            "spaceId": "kien-giang-an-xuyen:none",
            "pieceTypeId": "vc-guerrillas",
            "seat": "vc",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "north-vietnam:none",
            "pieceTypeId": "nva-troops",
            "seat": "nva",
            "count": 9
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "central-laos:none",
            "pieceTypeId": "nva-troops",
            "seat": "nva",
            "count": 9
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "southern-laos:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "northeast-cambodia:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "northeast-cambodia:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "the-fishhook:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "the-fishhook:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "the-parrots-beak:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          },
          {
            "spaceId": "sihanoukville:none",
            "pieceTypeId": "nva-bases",
            "seat": "nva",
            "count": 1
          },
          {
            "spaceId": "sihanoukville:none",
            "pieceTypeId": "nva-guerrillas",
            "seat": "nva",
            "count": 2
          }
        ]
      }
    }
  ],
  "tableContracts": [
    {
      "id": "fitl-map-production::tracks",
      "assetId": "fitl-map-production",
      "tablePath": "tracks",
      "fields": [
        {
          "field": "id",
          "type": "string"
        },
        {
          "field": "initial",
          "type": "int"
        },
        {
          "field": "max",
          "type": "int"
        },
        {
          "field": "min",
          "type": "int"
        },
        {
          "field": "scope",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "id"
        ]
      ]
    },
    {
      "id": "fitl-piece-catalog-production::inventory",
      "assetId": "fitl-piece-catalog-production",
      "tablePath": "inventory",
      "fields": [
        {
          "field": "pieceTypeId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        },
        {
          "field": "total",
          "type": "int"
        }
      ],
      "uniqueBy": [
        [
          "pieceTypeId"
        ]
      ]
    },
    {
      "id": "fitl-piece-catalog-production::seats",
      "assetId": "fitl-piece-catalog-production",
      "tablePath": "seats",
      "fields": [
        {
          "field": "id",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "id"
        ]
      ]
    },
    {
      "id": "fitl-scenario-full::cardPlacements",
      "assetId": "fitl-scenario-full",
      "tablePath": "cardPlacements",
      "fields": [
        {
          "field": "cardId",
          "type": "string"
        },
        {
          "field": "zoneId",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "cardId"
        ]
      ]
    },
    {
      "id": "fitl-scenario-full::initializations",
      "assetId": "fitl-scenario-full",
      "tablePath": "initializations",
      "fields": [
        {
          "field": "markerId",
          "type": "string"
        },
        {
          "field": "spaceId",
          "type": "string"
        },
        {
          "field": "state",
          "type": "string"
        },
        {
          "field": "trackId",
          "type": "string"
        },
        {
          "field": "value",
          "type": "int"
        }
      ]
    },
    {
      "id": "fitl-scenario-full::outOfPlay",
      "assetId": "fitl-scenario-full",
      "tablePath": "outOfPlay",
      "fields": [
        {
          "field": "count",
          "type": "int"
        },
        {
          "field": "pieceTypeId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "pieceTypeId"
        ]
      ]
    },
    {
      "id": "fitl-scenario-full::seatPools",
      "assetId": "fitl-scenario-full",
      "tablePath": "seatPools",
      "fields": [
        {
          "field": "availableZoneId",
          "type": "string"
        },
        {
          "field": "outOfPlayZoneId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "availableZoneId"
        ],
        [
          "seat"
        ]
      ]
    },
    {
      "id": "fitl-scenario-short::initializations",
      "assetId": "fitl-scenario-short",
      "tablePath": "initializations",
      "fields": [
        {
          "field": "markerId",
          "type": "string"
        },
        {
          "field": "spaceId",
          "type": "string"
        },
        {
          "field": "state",
          "type": "string"
        },
        {
          "field": "trackId",
          "type": "string"
        },
        {
          "field": "value",
          "type": "int"
        }
      ]
    },
    {
      "id": "fitl-scenario-short::outOfPlay",
      "assetId": "fitl-scenario-short",
      "tablePath": "outOfPlay",
      "fields": [
        {
          "field": "count",
          "type": "int"
        },
        {
          "field": "pieceTypeId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "count"
        ],
        [
          "pieceTypeId"
        ]
      ]
    },
    {
      "id": "fitl-scenario-short::seatPools",
      "assetId": "fitl-scenario-short",
      "tablePath": "seatPools",
      "fields": [
        {
          "field": "availableZoneId",
          "type": "string"
        },
        {
          "field": "outOfPlayZoneId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "availableZoneId"
        ],
        [
          "seat"
        ]
      ]
    },
    {
      "id": "fitl-scenario-medium::cardPlacements",
      "assetId": "fitl-scenario-medium",
      "tablePath": "cardPlacements",
      "fields": [
        {
          "field": "cardId",
          "type": "string"
        },
        {
          "field": "zoneId",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "cardId"
        ]
      ]
    },
    {
      "id": "fitl-scenario-medium::initializations",
      "assetId": "fitl-scenario-medium",
      "tablePath": "initializations",
      "fields": [
        {
          "field": "markerId",
          "type": "string"
        },
        {
          "field": "spaceId",
          "type": "string"
        },
        {
          "field": "state",
          "type": "string"
        },
        {
          "field": "trackId",
          "type": "string"
        },
        {
          "field": "value",
          "type": "int"
        }
      ]
    },
    {
      "id": "fitl-scenario-medium::outOfPlay",
      "assetId": "fitl-scenario-medium",
      "tablePath": "outOfPlay",
      "fields": [
        {
          "field": "count",
          "type": "int"
        },
        {
          "field": "pieceTypeId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "count"
        ],
        [
          "pieceTypeId"
        ]
      ]
    },
    {
      "id": "fitl-scenario-medium::seatPools",
      "assetId": "fitl-scenario-medium",
      "tablePath": "seatPools",
      "fields": [
        {
          "field": "availableZoneId",
          "type": "string"
        },
        {
          "field": "outOfPlayZoneId",
          "type": "string"
        },
        {
          "field": "seat",
          "type": "string"
        }
      ],
      "uniqueBy": [
        [
          "availableZoneId"
        ],
        [
          "seat"
        ]
      ]
    }
  ],
  "tokenTypes": [
    {
      "id": "us-troops",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "us"
    },
    {
      "id": "us-bases",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "us"
    },
    {
      "id": "us-irregulars",
      "props": {
        "faction": "string",
        "type": "string",
        "activity": "string"
      },
      "seat": "us"
    },
    {
      "id": "arvn-troops",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "arvn"
    },
    {
      "id": "arvn-police",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "arvn"
    },
    {
      "id": "arvn-rangers",
      "props": {
        "faction": "string",
        "type": "string",
        "activity": "string"
      },
      "seat": "arvn"
    },
    {
      "id": "arvn-bases",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "arvn"
    },
    {
      "id": "nva-troops",
      "props": {
        "faction": "string",
        "type": "string"
      },
      "seat": "nva"
    },
    {
      "id": "nva-guerrillas",
      "props": {
        "faction": "string",
        "type": "string",
        "activity": "string"
      },
      "seat": "nva"
    },
    {
      "id": "nva-bases",
      "props": {
        "faction": "string",
        "type": "string",
        "tunnel": "string"
      },
      "seat": "nva"
    },
    {
      "id": "vc-guerrillas",
      "props": {
        "faction": "string",
        "type": "string",
        "activity": "string"
      },
      "seat": "vc"
    },
    {
      "id": "vc-bases",
      "props": {
        "faction": "string",
        "type": "string",
        "tunnel": "string"
      },
      "seat": "vc"
    },
    {
      "id": "__eventCard",
      "props": {
        "cardId": "string",
        "eventDeckId": "string",
        "isCoup": "boolean"
      }
    }
  ],
  "setup": [
    {
      "setGlobalMarker": {
        "marker": "activeLeader",
        "state": "minh"
      }
    },
    {
      "setMarker": {
        "space": "saigon:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "qui-nhon:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "cam-ranh:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "an-loc:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "can-tho:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "phu-bon-phu-yen:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "khanh-hoa:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "kien-hoa-vinh-binh:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "ba-xuyen:none",
        "marker": "supportOpposition",
        "state": "passiveSupport"
      }
    },
    {
      "setMarker": {
        "space": "quang-tin-quang-ngai:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "setMarker": {
        "space": "quang-duc-long-khanh:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "setMarker": {
        "space": "binh-tuy-binh-thuan:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "setMarker": {
        "space": "tay-ninh:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "setMarker": {
        "space": "kien-phong:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "setMarker": {
        "space": "kien-giang-an-xuyen:none",
        "marker": "supportOpposition",
        "state": "activeOpposition"
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "saigon:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "saigon:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "saigon:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "saigon:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "saigon:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "saigon:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "saigon:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "saigon:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "hue:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "hue:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "hue:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "hue:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "qui-nhon:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "qui-nhon:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "qui-nhon:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "qui-nhon:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "cam-ranh:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "cam-ranh:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "cam-ranh:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "cam-ranh:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "an-loc:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "an-loc:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "an-loc:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "an-loc:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "can-tho:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "can-tho:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "can-tho:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "can-tho:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "da-nang:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "da-nang:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "da-nang:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "kontum:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "kontum:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "kontum:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "quang-tri-thua-thien:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "quang-tri-thua-thien:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "quang-tri-thua-thien:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-tri-thua-thien:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-tri-thua-thien:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "binh-dinh:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "binh-dinh:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "binh-dinh:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "binh-dinh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "binh-dinh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "quang-nam:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "quang-nam:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "pleiku-darlac:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "quang-tin-quang-ngai:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-tin-quang-ngai:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-tin-quang-ngai:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "quang-duc-long-khanh:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-duc-long-khanh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "quang-duc-long-khanh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "binh-tuy-binh-thuan:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "binh-tuy-binh-thuan:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "binh-tuy-binh-thuan:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "tay-ninh:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "tunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "tay-ninh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "tay-ninh:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "phu-bon-phu-yen:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "khanh-hoa:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "kien-hoa-vinh-binh:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "ba-xuyen:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "kien-phong:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "kien-giang-an-xuyen:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "north-vietnam:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "north-vietnam:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "north-vietnam:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "north-vietnam:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "central-laos:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "central-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "central-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "central-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "southern-laos:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "southern-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "southern-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "southern-laos:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "the-parrots-beak:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "the-parrots-beak:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "the-parrots-beak:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "the-parrots-beak:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "out-of-play-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-bases",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-bases",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "out-of-play-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-troops",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-bases",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "us-irregulars",
        "zone": "available-US:none",
        "props": {
          "faction": "US",
          "type": "irregular",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-troops",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-police",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "police"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-rangers",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "ranger",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "arvn-bases",
        "zone": "available-ARVN:none",
        "props": {
          "faction": "ARVN",
          "type": "base"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-troops",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "troops"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-guerrillas",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "nva-bases",
        "zone": "available-NVA:none",
        "props": {
          "faction": "NVA",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-guerrillas",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "guerrilla",
          "activity": "underground"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "vc-bases",
        "zone": "available-VC:none",
        "props": {
          "faction": "VC",
          "type": "base",
          "tunnel": "untunneled"
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-1",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-15",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-17",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-26",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-29",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-31",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-43",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-48",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-50",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-51",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-55",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-63",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-66",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-68",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-75",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-79",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-93",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-97",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-101",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-107",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-110",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-112",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-116",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "props": {
          "cardId": "card-118",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-5",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-6",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-7",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-8",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-10",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-14",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-18",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-22",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-23",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-24",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-25",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-28",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-34",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-38",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-39",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-44",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-46",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-47",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-53",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-56",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-59",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-64",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-67",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-69",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-70",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-72",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-73",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-76",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-78",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-81",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-82",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-83",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-85",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-86",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-87",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-89",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-90",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-95",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-98",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-99",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-100",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-102",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-104",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-105",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-106",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-108",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-109",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "props": {
          "cardId": "card-114",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-2",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-3",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-4",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-9",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-11",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-12",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-13",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-16",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-19",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-20",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-21",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-27",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-30",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-32",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-33",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-35",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-36",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-37",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-40",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-41",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-42",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-45",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-49",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-52",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-54",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-57",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-58",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-60",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-61",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-62",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-65",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-71",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-74",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-77",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-80",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-84",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-88",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-91",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-92",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-94",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-96",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-103",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-111",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-113",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-115",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-117",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-119",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "props": {
          "cardId": "card-120",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-125",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-126",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-127",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-128",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-129",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "props": {
          "cardId": "card-130",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": true
        }
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none"
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none"
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none"
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_3:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_2:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_events_pool_1:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 12
      }
    },
    {
      "draw": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_coups_pool:none",
        "to": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "count": 1
      }
    },
    {
      "shuffle": {
        "zone": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none"
      }
    },
    {
      "moveAll": {
        "from": "__scenario_deck_fitl_scenario_full_fitl_events_initial_card_pack_pile_work:none",
        "to": "deck:none"
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "leader:none",
        "props": {
          "cardId": "card-121",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "leader:none",
        "props": {
          "cardId": "card-122",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "leader:none",
        "props": {
          "cardId": "card-123",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    },
    {
      "createToken": {
        "type": "__eventCard",
        "zone": "leader:none",
        "props": {
          "cardId": "card-124",
          "eventDeckId": "fitl-events-initial-card-pack",
          "isCoup": false
        }
      }
    }
  ],
  "turnStructure": {
    "phases": [
      {
        "id": "main"
      },
      {
        "id": "coupVictory"
      },
      {
        "id": "coupResources"
      },
      {
        "id": "coupSupport"
      },
      {
        "id": "coupRedeploy"
      },
      {
        "id": "coupCommitment"
      },
      {
        "id": "coupReset"
      }
    ],
    "interrupts": [
      {
        "id": "commitment"
      }
    ]
  },
  "turnOrder": {
    "type": "cardDriven",
    "config": {
      "turnFlow": {
        "cardLifecycle": {
          "played": "played:none",
          "lookahead": "lookahead:none",
          "leader": "leader:none"
        },
        "eligibility": {
          "seats": [
            "0",
            "1",
            "2",
            "3"
          ],
          "overrideWindows": [
            {
              "id": "remain-eligible",
              "duration": "nextTurn"
            },
            {
              "id": "make-ineligible",
              "duration": "nextTurn"
            },
            {
              "id": "us-special-window",
              "duration": "turn"
            },
            {
              "id": "arvn-special-window",
              "duration": "turn"
            },
            {
              "id": "nva-special-window",
              "duration": "turn"
            },
            {
              "id": "vc-special-window",
              "duration": "turn"
            }
          ]
        },
        "actionClassByActionId": {
          "pass": "pass",
          "event": "event",
          "pivotalEvent": "event",
          "usOp": "operation",
          "arvnOp": "operation",
          "coupVictoryCheck": "pass",
          "coupResourcesResolve": "pass",
          "coupPacifyUS": "operation",
          "coupPacifyARVN": "operation",
          "coupAgitateVC": "operation",
          "coupArvnRedeployMandatory": "operation",
          "coupArvnRedeployOptionalTroops": "operation",
          "coupArvnRedeployPolice": "operation",
          "coupNvaRedeployTroops": "operation",
          "coupCommitmentResolve": "operation",
          "coupPacifyPass": "pass",
          "coupAgitatePass": "pass",
          "coupRedeployPass": "pass",
          "coupCommitmentPass": "pass"
        },
        "optionMatrix": [
          {
            "first": "operation",
            "second": [
              "limitedOperation"
            ]
          },
          {
            "first": "operationPlusSpecialActivity",
            "second": [
              "limitedOperation",
              "event"
            ]
          },
          {
            "first": "event",
            "second": [
              "operation",
              "operationPlusSpecialActivity"
            ]
          }
        ],
        "passRewards": [
          {
            "seat": "0",
            "resource": "arvnResources",
            "amount": 3
          },
          {
            "seat": "1",
            "resource": "arvnResources",
            "amount": 3
          },
          {
            "seat": "2",
            "resource": "nvaResources",
            "amount": 1
          },
          {
            "seat": "3",
            "resource": "vcResources",
            "amount": 1
          }
        ],
        "freeOperationActionIds": [
          "train",
          "patrol",
          "sweep",
          "assault",
          "rally",
          "march",
          "attack",
          "terror"
        ],
        "cardSeatOrderMetadataKey": "seatOrder",
        "cardSeatOrderMapping": {
          "US": "0",
          "ARVN": "1",
          "NVA": "2",
          "VC": "3"
        },
        "durationWindows": [
          "turn",
          "nextTurn",
          "round",
          "cycle"
        ],
        "monsoon": {
          "restrictedActions": [
            {
              "actionId": "sweep"
            },
            {
              "actionId": "march"
            },
            {
              "actionId": "airStrike",
              "maxParam": {
                "name": "spaces",
                "max": 2
              },
              "maxParamsTotal": {
                "names": [
                  "spaces",
                  "$arcLightNoCoinProvinces"
                ],
                "max": 2
              }
            },
            {
              "actionId": "airLift",
              "maxParam": {
                "name": "spaces",
                "max": 2
              }
            }
          ],
          "blockPivotal": true
        },
        "pivotal": {
          "actionIds": [
            "pivotalEvent"
          ],
          "requirePreActionWindow": true,
          "disallowWhenLookaheadIsCoup": true,
          "interrupt": {
            "precedence": [
              "3",
              "1",
              "2",
              "0"
            ]
          }
        }
      },
      "coupPlan": {
        "phases": [
          {
            "id": "coupVictory",
            "steps": [
              "check-victory"
            ]
          },
          {
            "id": "coupResources",
            "steps": [
              "resolve-resources"
            ]
          },
          {
            "id": "coupSupport",
            "steps": [
              "resolve-support"
            ]
          },
          {
            "id": "coupRedeploy",
            "steps": [
              "resolve-redeploy"
            ]
          },
          {
            "id": "coupCommitment",
            "steps": [
              "resolve-commitment"
            ]
          },
          {
            "id": "coupReset",
            "steps": [
              "resolve-reset"
            ]
          }
        ],
        "finalRoundOmitPhases": [
          "coupCommitment",
          "coupReset"
        ],
        "maxConsecutiveRounds": 1,
        "seatOrder": [
          "0",
          "1",
          "2",
          "3"
        ]
      }
    }
  },
  "actionPipelines": [
    {
      "id": "train-us-profile",
      "actionId": "train",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "US"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "US"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 99,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.0.chooseOne",
                      "bind": "$trainChoice",
                      "options": {
                        "query": "enums",
                        "values": [
                          "place-irregulars",
                          "place-at-base"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$trainChoice"
                        },
                        "right": "place-irregulars"
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__piece",
                            "macroOrigin": {
                              "macroId": "place-from-available-or-map",
                              "stem": "piece"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": {
                                "zoneExpr": {
                                  "concat": [
                                    "available-",
                                    "US",
                                    ":none"
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "irregular"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__piece",
                                  "from": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        "US",
                                        ":none"
                                      ]
                                    }
                                  },
                                  "to": "$space"
                                }
                              }
                            ],
                            "limit": 2,
                            "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__placed",
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__remaining",
                                  "value": {
                                    "op": "-",
                                    "left": 2,
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__placed"
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "!=",
                                                  "left": "US",
                                                  "right": "US"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": "irregular",
                                                  "right": "irregular"
                                                }
                                              ]
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__remaining"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__sourceSpaces",
                                              "options": {
                                                "query": "mapSpaces",
                                                "filter": {
                                                  "condition": {
                                                    "op": ">",
                                                    "left": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$zone",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "irregular"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "US"
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "right": 0
                                                  }
                                                }
                                              },
                                              "max": 99,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__srcSpace",
                                              "macroOrigin": {
                                                "macroId": "place-from-available-or-map",
                                                "stem": "srcSpace"
                                              },
                                              "over": {
                                                "query": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__sourceSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__mapPiece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "mapPiece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__srcSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "irregular"
                                                        },
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "US"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__mapPiece",
                                                          "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_0__srcSpace",
                                                          "to": "$space"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_caps"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "forEach": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                  "macroOrigin": {
                                    "macroId": "place-from-available-or-map",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "tokensInZone",
                                    "zone": {
                                      "zoneExpr": {
                                        "concat": [
                                          "available-",
                                          "ARVN",
                                          ":none"
                                        ]
                                      }
                                    },
                                    "filter": [
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "police"
                                      }
                                    ]
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "concat": [
                                              "available-",
                                              "ARVN",
                                              ":none"
                                            ]
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ],
                                  "limit": 1,
                                  "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed",
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining",
                                        "value": {
                                          "op": "-",
                                          "left": 1,
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "or",
                                                    "args": [
                                                      {
                                                        "op": "!=",
                                                        "left": "ARVN",
                                                        "right": "US"
                                                      },
                                                      {
                                                        "op": "==",
                                                        "left": "police",
                                                        "right": "irregular"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining"
                                                    },
                                                    "right": 0
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "chooseN": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.1.if.then.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces",
                                                    "options": {
                                                      "query": "mapSpaces",
                                                      "filter": {
                                                        "condition": {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$zone",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "police"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "ARVN"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      }
                                                    },
                                                    "max": 99,
                                                    "min": 0
                                                  }
                                                },
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "srcSpace"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces"
                                                    },
                                                    "effects": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "mapPiece"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "police"
                                                              },
                                                              {
                                                                "prop": "faction",
                                                                "op": "eq",
                                                                "value": "ARVN"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                "to": "$space"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$trainChoice"
                            },
                            "right": "place-at-base"
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 0
                          }
                        ]
                      },
                      "then": [
                        {
                          "chooseOne": {
                            "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.0.chooseOne",
                            "bind": "$baseTrainChoice",
                            "options": {
                              "query": "enums",
                              "values": [
                                "rangers",
                                "arvn-cubes"
                              ]
                            }
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "binding",
                                "name": "$baseTrainChoice"
                              },
                              "right": "rangers"
                            },
                            "then": [
                              {
                                "forEach": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__piece",
                                  "macroOrigin": {
                                    "macroId": "place-from-available-or-map",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "tokensInZone",
                                    "zone": {
                                      "zoneExpr": {
                                        "concat": [
                                          "available-",
                                          "ARVN",
                                          ":none"
                                        ]
                                      }
                                    },
                                    "filter": [
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "ranger"
                                      }
                                    ]
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "concat": [
                                              "available-",
                                              "ARVN",
                                              ":none"
                                            ]
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ],
                                  "limit": 2,
                                  "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__placed",
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__remaining",
                                        "value": {
                                          "op": "-",
                                          "left": 2,
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__placed"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "or",
                                                    "args": [
                                                      {
                                                        "op": "!=",
                                                        "left": "ARVN",
                                                        "right": "US"
                                                      },
                                                      {
                                                        "op": "==",
                                                        "left": "ranger",
                                                        "right": "irregular"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__remaining"
                                                    },
                                                    "right": 0
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "chooseN": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__sourceSpaces",
                                                    "options": {
                                                      "query": "mapSpaces",
                                                      "filter": {
                                                        "condition": {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$zone",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "ranger"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "ARVN"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      }
                                                    },
                                                    "max": 99,
                                                    "min": 0
                                                  }
                                                },
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__srcSpace",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "srcSpace"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__sourceSpaces"
                                                    },
                                                    "effects": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__mapPiece",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "mapPiece"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__srcSpace",
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "ranger"
                                                              },
                                                              {
                                                                "prop": "faction",
                                                                "op": "eq",
                                                                "value": "ARVN"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__mapPiece",
                                                                "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_0__srcSpace",
                                                                "to": "$space"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "globalMarkerState",
                                      "marker": "cap_caps"
                                    },
                                    "right": "unshaded"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "ARVN",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "police"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "ARVN",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "ARVN",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "police",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.1.if.then.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "police"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "ARVN"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "police"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "ARVN"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_1__if_then_1__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "binding",
                                    "name": "$baseTrainChoice"
                                  },
                                  "right": "arvn-cubes"
                                },
                                {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "binding",
                                        "name": "__freeOperation"
                                      },
                                      "right": true
                                    },
                                    {
                                      "op": ">=",
                                      "left": {
                                        "ref": "gvar",
                                        "var": "arvnResources"
                                      },
                                      "right": {
                                        "op": "+",
                                        "left": {
                                          "ref": "gvar",
                                          "var": "totalEcon"
                                        },
                                        "right": 3
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "!=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "__freeOperation"
                                    },
                                    "right": true
                                  },
                                  "then": [
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "arvnResources",
                                        "delta": -3
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.2.if.then.1.chooseN",
                                  "bind": "$arvnCubeTypes",
                                  "options": {
                                    "query": "enums",
                                    "values": [
                                      "troops",
                                      "police"
                                    ]
                                  },
                                  "max": 6,
                                  "min": 1
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$cubeType",
                                  "over": {
                                    "query": "binding",
                                    "name": "$arvnCubeTypes"
                                  },
                                  "effects": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "ARVN",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": {
                                                "ref": "binding",
                                                "name": "$cubeType"
                                              }
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "ARVN",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "ARVN",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": {
                                                                "ref": "binding",
                                                                "name": "$cubeType"
                                                              },
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.2.if.then.2.forEach.effects.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$cubeType"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "ARVN"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": {
                                                                        "ref": "binding",
                                                                        "name": "$cubeType"
                                                                      }
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "ARVN"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_2__forEach_effects_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "globalMarkerState",
                                      "marker": "cap_caps"
                                    },
                                    "right": "unshaded"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "ARVN",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "police"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "ARVN",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "ARVN",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "police",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.0.stages[1].effects.0.forEach.effects.2.if.then.2.if.then.3.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "police"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "ARVN"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "police"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "ARVN"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_0__stages_1__effects_0__forEach_effects_2__if_then_2__if_then_3__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "sub-action",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_cords"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$subActionSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[2].effects.0.if.else.0.chooseN",
                      "bind": "$subActionSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  }
                ]
              }
            },
            {
              "forEach": {
                "bind": "$subSpace",
                "over": {
                  "query": "binding",
                  "name": "$subActionSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.0.stages[2].effects.1.forEach.effects.0.chooseOne",
                      "bind": "$subAction",
                      "options": {
                        "query": "enums",
                        "values": [
                          "pacify",
                          "saigon-transfer",
                          "none"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$subAction"
                            },
                            "right": "pacify"
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$subSpace",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 0
                          }
                        ]
                      },
                      "then": [
                        {
                          "let": {
                            "bind": "$usPacPerStepCost",
                            "value": {
                              "if": {
                                "when": {
                                  "op": "==",
                                  "left": {
                                    "ref": "globalMarkerState",
                                    "marker": "activeLeader"
                                  },
                                  "right": "ky"
                                },
                                "then": 4,
                                "else": 3
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">",
                                    "left": {
                                      "ref": "zoneVar",
                                      "zone": "$subSpace",
                                      "var": "terrorCount"
                                    },
                                    "right": 0
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">=",
                                          "left": {
                                            "ref": "gvar",
                                            "var": "arvnResources"
                                          },
                                          "right": {
                                            "op": "+",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "totalEcon"
                                            },
                                            "right": {
                                              "ref": "binding",
                                              "name": "$usPacPerStepCost"
                                            }
                                          }
                                        },
                                        "then": [
                                          {
                                            "addVar": {
                                              "scope": "global",
                                              "var": "arvnResources",
                                              "delta": {
                                                "op": "*",
                                                "left": 1,
                                                "right": {
                                                  "if": {
                                                    "when": {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "globalMarkerState",
                                                        "marker": "activeLeader"
                                                      },
                                                      "right": "ky"
                                                    },
                                                    "then": -4,
                                                    "else": -3
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "setVar": {
                                              "scope": "zoneVar",
                                              "zone": "$subSpace",
                                              "var": "terrorCount",
                                              "value": 0
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "globalMarkerState",
                                      "marker": "cap_cords"
                                    },
                                    "right": "shaded"
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "markerState",
                                                "space": "$subSpace",
                                                "marker": "supportOpposition"
                                              },
                                              "right": "passiveSupport"
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "markerState",
                                                "space": "$subSpace",
                                                "marker": "supportOpposition"
                                              },
                                              "right": "activeSupport"
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">=",
                                                "left": {
                                                  "ref": "gvar",
                                                  "var": "arvnResources"
                                                },
                                                "right": {
                                                  "op": "+",
                                                  "left": {
                                                    "ref": "gvar",
                                                    "var": "totalEcon"
                                                  },
                                                  "right": {
                                                    "ref": "binding",
                                                    "name": "$usPacPerStepCost"
                                                  }
                                                }
                                              },
                                              "then": [
                                                {
                                                  "addVar": {
                                                    "scope": "global",
                                                    "var": "arvnResources",
                                                    "delta": {
                                                      "op": "*",
                                                      "left": 1,
                                                      "right": {
                                                        "if": {
                                                          "when": {
                                                            "op": "==",
                                                            "left": {
                                                              "ref": "globalMarkerState",
                                                              "marker": "activeLeader"
                                                            },
                                                            "right": "ky"
                                                          },
                                                          "then": -4,
                                                          "else": -3
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "setMarker": {
                                                    "space": "$subSpace",
                                                    "marker": "supportOpposition",
                                                    "state": "passiveSupport"
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.0.stages[2].effects.1.forEach.effects.1.if.then.0.let.in.1.if.else.0.chooseOne",
                                        "bind": "$pacLevels",
                                        "options": {
                                          "query": "intsInRange",
                                          "min": 1,
                                          "max": 2
                                        }
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">=",
                                          "left": {
                                            "ref": "gvar",
                                            "var": "arvnResources"
                                          },
                                          "right": {
                                            "op": "+",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "totalEcon"
                                            },
                                            "right": {
                                              "op": "*",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$pacLevels"
                                              },
                                              "right": {
                                                "ref": "binding",
                                                "name": "$usPacPerStepCost"
                                              }
                                            }
                                          }
                                        },
                                        "then": [
                                          {
                                            "addVar": {
                                              "scope": "global",
                                              "var": "arvnResources",
                                              "delta": {
                                                "op": "*",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$pacLevels"
                                                },
                                                "right": {
                                                  "if": {
                                                    "when": {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "globalMarkerState",
                                                        "marker": "activeLeader"
                                                      },
                                                      "right": "ky"
                                                    },
                                                    "then": -4,
                                                    "else": -3
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "shiftMarker": {
                                              "space": "$subSpace",
                                              "marker": "supportOpposition",
                                              "delta": {
                                                "ref": "binding",
                                                "name": "$pacLevels"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$subAction"
                            },
                            "right": "saigon-transfer"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$subSpace",
                              "prop": "spaceId"
                            },
                            "right": "saigon"
                          }
                        ]
                      },
                      "then": [
                        {
                          "chooseOne": {
                            "internalDecisionId": "decision:doc.actionPipelines.0.stages[2].effects.1.forEach.effects.2.if.then.0.chooseOne",
                            "bind": "$transferAmount",
                            "options": {
                              "query": "intsInRange",
                              "min": 1,
                              "max": 3
                            }
                          }
                        },
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "patronage",
                            "delta": {
                              "op": "*",
                              "left": {
                                "ref": "binding",
                                "name": "$transferAmount"
                              },
                              "right": -1
                            }
                          }
                        },
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "arvnResources",
                            "delta": {
                              "ref": "binding",
                              "name": "$transferAmount"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "train-arvn-profile",
      "actionId": "train",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  }
                                ]
                              },
                              {
                                "op": "<=",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  }
                                ]
                              },
                              {
                                "op": "<=",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        }
                      },
                      "max": 99,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[1].effects.0.forEach.effects.0.chooseOne",
                      "bind": "$trainChoice",
                      "options": {
                        "query": "enums",
                        "values": [
                          "rangers",
                          "arvn-cubes"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$trainChoice"
                        },
                        "right": "rangers"
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "!=",
                              "left": {
                                "ref": "binding",
                                "name": "__freeOperation"
                              },
                              "right": true
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "arvnResources",
                                  "delta": -3
                                }
                              }
                            ]
                          }
                        },
                        {
                          "forEach": {
                            "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__piece",
                            "macroOrigin": {
                              "macroId": "place-from-available-or-map",
                              "stem": "piece"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": {
                                "zoneExpr": {
                                  "concat": [
                                    "available-",
                                    "ARVN",
                                    ":none"
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "ranger"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__piece",
                                  "from": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        "ARVN",
                                        ":none"
                                      ]
                                    }
                                  },
                                  "to": "$space"
                                }
                              }
                            ],
                            "limit": 2,
                            "countBind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__placed",
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__remaining",
                                  "value": {
                                    "op": "-",
                                    "left": 2,
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__placed"
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "!=",
                                                  "left": "ARVN",
                                                  "right": "US"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": "ranger",
                                                  "right": "irregular"
                                                }
                                              ]
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__remaining"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.1.stages[1].effects.0.forEach.effects.1.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__sourceSpaces",
                                              "options": {
                                                "query": "mapSpaces",
                                                "filter": {
                                                  "condition": {
                                                    "op": ">",
                                                    "left": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$zone",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "ranger"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "ARVN"
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "right": 0
                                                  }
                                                }
                                              },
                                              "max": 99,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__srcSpace",
                                              "macroOrigin": {
                                                "macroId": "place-from-available-or-map",
                                                "stem": "srcSpace"
                                              },
                                              "over": {
                                                "query": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__sourceSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__mapPiece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "mapPiece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__srcSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "ranger"
                                                        },
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "ARVN"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__mapPiece",
                                                          "from": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_1__srcSpace",
                                                          "to": "$space"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_caps"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "forEach": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                  "macroOrigin": {
                                    "macroId": "place-from-available-or-map",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "tokensInZone",
                                    "zone": {
                                      "zoneExpr": {
                                        "concat": [
                                          "available-",
                                          "ARVN",
                                          ":none"
                                        ]
                                      }
                                    },
                                    "filter": [
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "police"
                                      }
                                    ]
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "concat": [
                                              "available-",
                                              "ARVN",
                                              ":none"
                                            ]
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ],
                                  "limit": 1,
                                  "countBind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed",
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining",
                                        "value": {
                                          "op": "-",
                                          "left": 1,
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "or",
                                                    "args": [
                                                      {
                                                        "op": "!=",
                                                        "left": "ARVN",
                                                        "right": "US"
                                                      },
                                                      {
                                                        "op": "==",
                                                        "left": "police",
                                                        "right": "irregular"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining"
                                                    },
                                                    "right": 0
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "chooseN": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.1.stages[1].effects.0.forEach.effects.1.if.then.2.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces",
                                                    "options": {
                                                      "query": "mapSpaces",
                                                      "filter": {
                                                        "condition": {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$zone",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "police"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "ARVN"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      }
                                                    },
                                                    "max": 99,
                                                    "min": 0
                                                  }
                                                },
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "srcSpace"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces"
                                                    },
                                                    "effects": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "mapPiece"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "police"
                                                              },
                                                              {
                                                                "prop": "faction",
                                                                "op": "eq",
                                                                "value": "ARVN"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                "from": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_1__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                "to": "$space"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$trainChoice"
                            },
                            "right": "arvn-cubes"
                          },
                          {
                            "op": "or",
                            "args": [
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "category"
                                },
                                "right": "city"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$space",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "base"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        ]
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "!=",
                              "left": {
                                "ref": "binding",
                                "name": "__freeOperation"
                              },
                              "right": true
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "arvnResources",
                                  "delta": -3
                                }
                              }
                            ]
                          }
                        },
                        {
                          "forEach": {
                            "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__piece",
                            "macroOrigin": {
                              "macroId": "place-from-available-or-map",
                              "stem": "piece"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": {
                                "zoneExpr": {
                                  "concat": [
                                    "available-",
                                    "ARVN",
                                    ":none"
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__piece",
                                  "from": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        "ARVN",
                                        ":none"
                                      ]
                                    }
                                  },
                                  "to": "$space"
                                }
                              }
                            ],
                            "limit": 6,
                            "countBind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__placed",
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__remaining",
                                  "value": {
                                    "op": "-",
                                    "left": 6,
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__placed"
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "!=",
                                                  "left": "ARVN",
                                                  "right": "US"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": "troops",
                                                  "right": "irregular"
                                                }
                                              ]
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__remaining"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.1.stages[1].effects.0.forEach.effects.2.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__sourceSpaces",
                                              "options": {
                                                "query": "mapSpaces",
                                                "filter": {
                                                  "condition": {
                                                    "op": ">",
                                                    "left": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$zone",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "troops"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "ARVN"
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "right": 0
                                                  }
                                                }
                                              },
                                              "max": 99,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__srcSpace",
                                              "macroOrigin": {
                                                "macroId": "place-from-available-or-map",
                                                "stem": "srcSpace"
                                              },
                                              "over": {
                                                "query": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__sourceSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__mapPiece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "mapPiece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__srcSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "troops"
                                                        },
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "ARVN"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__mapPiece",
                                                          "from": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_1__srcSpace",
                                                          "to": "$space"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_caps"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "forEach": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                  "macroOrigin": {
                                    "macroId": "place-from-available-or-map",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "tokensInZone",
                                    "zone": {
                                      "zoneExpr": {
                                        "concat": [
                                          "available-",
                                          "ARVN",
                                          ":none"
                                        ]
                                      }
                                    },
                                    "filter": [
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "police"
                                      }
                                    ]
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "concat": [
                                              "available-",
                                              "ARVN",
                                              ":none"
                                            ]
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ],
                                  "limit": 1,
                                  "countBind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed",
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining",
                                        "value": {
                                          "op": "-",
                                          "left": 1,
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__placed"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "or",
                                                    "args": [
                                                      {
                                                        "op": "!=",
                                                        "left": "ARVN",
                                                        "right": "US"
                                                      },
                                                      {
                                                        "op": "==",
                                                        "left": "police",
                                                        "right": "irregular"
                                                      }
                                                    ]
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__remaining"
                                                    },
                                                    "right": 0
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "chooseN": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.1.stages[1].effects.0.forEach.effects.2.if.then.2.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces",
                                                    "options": {
                                                      "query": "mapSpaces",
                                                      "filter": {
                                                        "condition": {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$zone",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "police"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "ARVN"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      }
                                                    },
                                                    "max": 99,
                                                    "min": 0
                                                  }
                                                },
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "srcSpace"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__sourceSpaces"
                                                    },
                                                    "effects": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "mapPiece"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "police"
                                                              },
                                                              {
                                                                "prop": "faction",
                                                                "op": "eq",
                                                                "value": "ARVN"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__mapPiece",
                                                                "from": "$__macro_place_from_available_or_map_actionPipelines_1__stages_1__effects_0__forEach_effects_2__if_then_2__macro_cap_train_caps_unshaded_bonus_police__0__if_then_0__srcSpace",
                                                                "to": "$space"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "sub-action",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_cords"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$subActionSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[2].effects.0.if.else.0.chooseN",
                      "bind": "$subActionSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  }
                ]
              }
            },
            {
              "forEach": {
                "bind": "$subSpace",
                "over": {
                  "query": "binding",
                  "name": "$subActionSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.1.stages[2].effects.1.forEach.effects.0.chooseOne",
                      "bind": "$subAction",
                      "options": {
                        "query": "enums",
                        "values": [
                          "pacify",
                          "replace-cubes-with-base",
                          "none"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$subAction"
                            },
                            "right": "pacify"
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$subSpace",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 0
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$subSpace",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "police"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 0
                          }
                        ]
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "zoneVar",
                                "zone": "$subSpace",
                                "var": "terrorCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "arvnResources",
                                  "delta": {
                                    "op": "*",
                                    "left": 1,
                                    "right": {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "globalMarkerState",
                                            "marker": "activeLeader"
                                          },
                                          "right": "ky"
                                        },
                                        "then": -4,
                                        "else": -3
                                      }
                                    }
                                  }
                                }
                              },
                              {
                                "setVar": {
                                  "scope": "zoneVar",
                                  "zone": "$subSpace",
                                  "var": "terrorCount",
                                  "value": 0
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_cords"
                              },
                              "right": "shaded"
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$subSpace",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "passiveSupport"
                                      },
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$subSpace",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "activeSupport"
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "arvnResources",
                                        "delta": {
                                          "op": "*",
                                          "left": 1,
                                          "right": {
                                            "if": {
                                              "when": {
                                                "op": "==",
                                                "left": {
                                                  "ref": "globalMarkerState",
                                                  "marker": "activeLeader"
                                                },
                                                "right": "ky"
                                              },
                                              "then": -4,
                                              "else": -3
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "setMarker": {
                                        "space": "$subSpace",
                                        "marker": "supportOpposition",
                                        "state": "passiveSupport"
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "chooseOne": {
                                  "internalDecisionId": "decision:doc.actionPipelines.1.stages[2].effects.1.forEach.effects.1.if.then.1.if.else.0.chooseOne",
                                  "bind": "$pacLevels",
                                  "options": {
                                    "query": "intsInRange",
                                    "min": 1,
                                    "max": 2
                                  }
                                }
                              },
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "arvnResources",
                                  "delta": {
                                    "op": "*",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$pacLevels"
                                    },
                                    "right": {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "globalMarkerState",
                                            "marker": "activeLeader"
                                          },
                                          "right": "ky"
                                        },
                                        "then": -4,
                                        "else": -3
                                      }
                                    }
                                  }
                                }
                              },
                              {
                                "shiftMarker": {
                                  "space": "$subSpace",
                                  "marker": "supportOpposition",
                                  "delta": {
                                    "ref": "binding",
                                    "name": "$pacLevels"
                                  }
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$subAction"
                            },
                            "right": "replace-cubes-with-base"
                          },
                          {
                            "op": ">=",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$subSpace",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "in",
                                      "value": [
                                        "troops",
                                        "police"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 3
                          },
                          {
                            "op": "<",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$subSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 2
                          }
                        ]
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "arvnResources",
                            "delta": -3
                          }
                        },
                        {
                          "forEach": {
                            "bind": "$cube",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$subSpace",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "police"
                                  ]
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$cube",
                                  "from": "$subSpace",
                                  "to": "available-ARVN:none"
                                }
                              }
                            ],
                            "limit": 3
                          }
                        },
                        {
                          "forEach": {
                            "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__piece",
                            "macroOrigin": {
                              "macroId": "place-from-available-or-map",
                              "stem": "piece"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": {
                                "zoneExpr": {
                                  "concat": [
                                    "available-",
                                    "ARVN",
                                    ":none"
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "base"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__piece",
                                  "from": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        "ARVN",
                                        ":none"
                                      ]
                                    }
                                  },
                                  "to": "$subSpace"
                                }
                              }
                            ],
                            "limit": 1,
                            "countBind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__placed",
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__remaining",
                                  "value": {
                                    "op": "-",
                                    "left": 1,
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__placed"
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "!=",
                                                  "left": "ARVN",
                                                  "right": "US"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": "base",
                                                  "right": "irregular"
                                                }
                                              ]
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__remaining"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.1.stages[2].effects.1.forEach.effects.2.if.then.2.forEach.in.0.let.in.0.if.then.0.chooseN",
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__sourceSpaces",
                                              "options": {
                                                "query": "mapSpaces",
                                                "filter": {
                                                  "condition": {
                                                    "op": ">",
                                                    "left": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$zone",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "base"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "ARVN"
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "right": 0
                                                  }
                                                }
                                              },
                                              "max": 99,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__srcSpace",
                                              "macroOrigin": {
                                                "macroId": "place-from-available-or-map",
                                                "stem": "srcSpace"
                                              },
                                              "over": {
                                                "query": "binding",
                                                "name": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__sourceSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__mapPiece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "mapPiece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__srcSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "base"
                                                        },
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "ARVN"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__mapPiece",
                                                          "from": "$__macro_place_from_available_or_map_actionPipelines_1__stages_2__effects_1__forEach_effects_2__if_then_2__srcSpace",
                                                          "to": "$subSpace"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "rvn-leader-minh-aid-bonus",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "activeLeader"
                  },
                  "right": "minh"
                },
                "then": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 5
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "patrol-us-profile",
      "actionId": "patrol",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-locs",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.2.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetLoCs",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.2.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetLoCs",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        }
                      },
                      "max": 99,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "move-cubes",
          "effects": [
            {
              "forEach": {
                "bind": "$loc",
                "over": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.2.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$movingCubes",
                      "options": {
                        "query": "tokensInMapSpaces",
                        "spaceFilter": {
                          "condition": {
                            "op": "or",
                            "args": [
                              {
                                "op": "adjacent",
                                "left": "$zone",
                                "right": "$loc"
                              },
                              {
                                "op": "connected",
                                "from": "$zone",
                                "to": "$loc",
                                "via": {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "id"
                                      },
                                      "right": "$loc"
                                    },
                                    {
                                      "op": "and",
                                      "args": [
                                        {
                                          "op": "or",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "city"
                                            }
                                          ]
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "NVA",
                                                      "VC"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "in",
                            "value": [
                              "troops",
                              "police"
                            ]
                          }
                        ]
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "ref": "gvar",
                            "var": "nvaResources"
                          }
                        }
                      },
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$cube",
                      "over": {
                        "query": "binding",
                        "name": "$movingCubes"
                      },
                      "effects": [
                        {
                          "moveToken": {
                            "token": "$cube",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$cube"
                              }
                            },
                            "to": "$loc"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_m48Patton"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48PatrolDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48PatrolDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "chooseN": {
                                        "internalDecisionId": "decision:doc.actionPipelines.2.stages[1].effects.0.forEach.effects.2.if.then.0.rollRandom.in.0.if.then.0.chooseN",
                                        "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48PenaltyCube",
                                        "options": {
                                          "query": "binding",
                                          "name": "$movingCubes"
                                        },
                                        "max": 1,
                                        "min": 0
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48Cube",
                                        "macroOrigin": {
                                          "macroId": "cap-patrol-m48-shaded-moved-cube-penalty",
                                          "stem": "m48Cube"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48PenaltyCube"
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48Cube",
                                              "from": "$loc",
                                              "to": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    {
                                                      "ref": "tokenProp",
                                                      "token": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_2__stages_1__effects_0__forEach_effects_2__m48Cube",
                                                      "prop": "faction"
                                                    },
                                                    ":none"
                                                  ]
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "activate-guerrillas",
          "effects": [
            {
              "forEach": {
                "bind": "$actLoc",
                "over": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$usCubeCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$actLoc",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "forEach": {
                            "bind": "$guerrilla",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$actLoc",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$guerrilla",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": {
                              "ref": "binding",
                              "name": "$usCubeCount"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "free-assault",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.2.stages[3].effects.0.chooseN",
                "bind": "$assaultLoCs",
                "options": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "max": 1,
                "min": 0
              }
            },
            {
              "forEach": {
                "bind": "$assaultLoC",
                "over": {
                  "query": "binding",
                  "name": "$assaultLoCs"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$usTroops",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$assaultLoC",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "troops"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$hasUSBase",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$assaultLoC",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$patrolDmg",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": ">",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$hasUSBase"
                                        },
                                        "right": 0
                                      },
                                      "then": {
                                        "op": "*",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$usTroops"
                                        },
                                        "right": 2
                                      },
                                      "else": {
                                        "ref": "binding",
                                        "name": "$usTroops"
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$assaultLoC",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$damage",
                                              "value": {
                                                "ref": "binding",
                                                "name": "$patrolDmg"
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$damage"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseOne": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.2.stages[3].effects.1.forEach.effects.0.let.in.0.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                          "bind": "$targetFactionFirst",
                                                          "options": {
                                                            "query": "enums",
                                                            "values": [
                                                              "NVA",
                                                              "VC"
                                                            ]
                                                          }
                                                        }
                                                      },
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                          "value": {
                                                            "if": {
                                                              "when": {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "binding",
                                                                  "name": "$targetFactionFirst"
                                                                },
                                                                "right": "NVA"
                                                              },
                                                              "then": "VC",
                                                              "else": "NVA"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "removeByPriority": {
                                                                "budget": {
                                                                  "ref": "binding",
                                                                  "name": "$damage"
                                                                },
                                                                "groups": [
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$assaultLoC",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "troops"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "tokenProp",
                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                            "prop": "faction"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$assaultLoC",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$assaultLoC",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  }
                                                                ],
                                                                "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                      "value": {
                                                                        "op": "+",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                        },
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": true,
                                                                                  "right": true
                                                                                },
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": {
                                                                                    "ref": "gvar",
                                                                                    "var": "mom_bodyCount"
                                                                                  },
                                                                                  "right": true
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "addVar": {
                                                                                  "scope": "global",
                                                                                  "var": "aid",
                                                                                  "delta": {
                                                                                    "op": "*",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                                    },
                                                                                    "right": 3
                                                                                  }
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  },
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": ">",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "let": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                            "value": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$assaultLoC",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "guerrilla"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "in",
                                                                                      "value": [
                                                                                        "NVA",
                                                                                        "VC"
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "prop": "activity",
                                                                                      "op": "eq",
                                                                                      "value": "active"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "in": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                                    },
                                                                                    "right": 0
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "piece-removal-ordering",
                                                                                          "stem": "baseTarget"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$assaultLoC",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "in",
                                                                                              "value": [
                                                                                                "NVA",
                                                                                                "VC"
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": "==",
                                                                                                "left": {
                                                                                                  "ref": "tokenProp",
                                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                  "prop": "tunnel"
                                                                                                },
                                                                                                "right": "tunneled"
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "rollRandom": {
                                                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                                    "min": 1,
                                                                                                    "max": 6,
                                                                                                    "in": [
                                                                                                      {
                                                                                                        "if": {
                                                                                                          "when": {
                                                                                                            "op": ">=",
                                                                                                            "left": {
                                                                                                              "ref": "binding",
                                                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                            },
                                                                                                            "right": 4
                                                                                                          },
                                                                                                          "then": [
                                                                                                            {
                                                                                                              "setTokenProp": {
                                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                "prop": "tunnel",
                                                                                                                "value": "untunneled"
                                                                                                              }
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ],
                                                                                              "else": [
                                                                                                {
                                                                                                  "moveToken": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "from": "$assaultLoC",
                                                                                                    "to": {
                                                                                                      "zoneExpr": {
                                                                                                        "concat": [
                                                                                                          "available-",
                                                                                                          {
                                                                                                            "ref": "tokenProp",
                                                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                            "prop": "faction"
                                                                                                          },
                                                                                                          ":none"
                                                                                                        ]
                                                                                                      }
                                                                                                    }
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": {
                                                                                          "ref": "binding",
                                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ],
                                                                "macroOrigin": {
                                                                  "macroId": "piece-removal-ordering",
                                                                  "stem": "remainingDamage"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$assaultLoC",
                                                    "filter": [
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "addVar": {
                                                                "scope": "global",
                                                                "var": "aid",
                                                                "delta": {
                                                                  "op": "*",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_coin_assault_removal_order_actionPipelines_2__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                                  },
                                                                  "right": 6
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "patrol-arvn-profile",
      "actionId": "patrol",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "gvar",
              "var": "mom_bodyCount"
            },
            "right": true
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": 3
          }
        ]
      },
      "costValidation": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "gvar",
              "var": "mom_bodyCount"
            },
            "right": true
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": 3
          }
        ]
      },
      "costEffects": [
        {
          "if": {
            "when": {
              "op": "!=",
              "left": {
                "ref": "gvar",
                "var": "mom_bodyCount"
              },
              "right": true
            },
            "then": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": -3
                }
              }
            ]
          }
        }
      ],
      "targeting": {},
      "stages": [
        {
          "stage": "select-locs",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.3.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetLoCs",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.3.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetLoCs",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        }
                      },
                      "max": 99,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "move-cubes",
          "effects": [
            {
              "forEach": {
                "bind": "$loc",
                "over": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.3.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$movingCubes",
                      "options": {
                        "query": "tokensInMapSpaces",
                        "spaceFilter": {
                          "condition": {
                            "op": "or",
                            "args": [
                              {
                                "op": "adjacent",
                                "left": "$zone",
                                "right": "$loc"
                              },
                              {
                                "op": "connected",
                                "from": "$zone",
                                "to": "$loc",
                                "via": {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "id"
                                      },
                                      "right": "$loc"
                                    },
                                    {
                                      "op": "and",
                                      "args": [
                                        {
                                          "op": "or",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "city"
                                            }
                                          ]
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "NVA",
                                                      "VC"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "in",
                            "value": [
                              "troops",
                              "police"
                            ]
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$cube",
                      "over": {
                        "query": "binding",
                        "name": "$movingCubes"
                      },
                      "effects": [
                        {
                          "moveToken": {
                            "token": "$cube",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$cube"
                              }
                            },
                            "to": "$loc"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_m48Patton"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48PatrolDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48PatrolDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "chooseN": {
                                        "internalDecisionId": "decision:doc.actionPipelines.3.stages[1].effects.0.forEach.effects.2.if.then.0.rollRandom.in.0.if.then.0.chooseN",
                                        "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48PenaltyCube",
                                        "options": {
                                          "query": "binding",
                                          "name": "$movingCubes"
                                        },
                                        "max": 1,
                                        "min": 0
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48Cube",
                                        "macroOrigin": {
                                          "macroId": "cap-patrol-m48-shaded-moved-cube-penalty",
                                          "stem": "m48Cube"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48PenaltyCube"
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48Cube",
                                              "from": "$loc",
                                              "to": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    {
                                                      "ref": "tokenProp",
                                                      "token": "$__macro_cap_patrol_m48_shaded_moved_cube_penalty_actionPipelines_3__stages_1__effects_0__forEach_effects_2__m48Cube",
                                                      "prop": "faction"
                                                    },
                                                    ":none"
                                                  ]
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "activate-guerrillas",
          "effects": [
            {
              "forEach": {
                "bind": "$actLoc",
                "over": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$arvnCubeCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$actLoc",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "forEach": {
                            "bind": "$guerrilla",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$actLoc",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$guerrilla",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": {
                              "ref": "binding",
                              "name": "$arvnCubeCount"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "free-assault",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.3.stages[3].effects.0.chooseN",
                "bind": "$assaultLoCs",
                "options": {
                  "query": "binding",
                  "name": "targetLoCs"
                },
                "max": 1,
                "min": 0
              }
            },
            {
              "forEach": {
                "bind": "$assaultLoC",
                "over": {
                  "query": "binding",
                  "name": "$assaultLoCs"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$arvnCubes",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$assaultLoC",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$patrolDmg",
                            "value": {
                              "op": "/",
                              "left": {
                                "ref": "binding",
                                "name": "$arvnCubes"
                              },
                              "right": 2
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesBefore",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$assaultLoC",
                                        "filter": [
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          },
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$damage",
                                        "value": {
                                          "ref": "binding",
                                          "name": "$patrolDmg"
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$damage"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.3.stages[3].effects.1.forEach.effects.0.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                    "bind": "$targetFactionFirst",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "NVA",
                                                        "VC"
                                                      ]
                                                    }
                                                  }
                                                },
                                                {
                                                  "let": {
                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                    "value": {
                                                      "if": {
                                                        "when": {
                                                          "op": "==",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$targetFactionFirst"
                                                          },
                                                          "right": "NVA"
                                                        },
                                                        "then": "VC",
                                                        "else": "NVA"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "removeByPriority": {
                                                          "budget": {
                                                            "ref": "binding",
                                                            "name": "$damage"
                                                          },
                                                          "groups": [
                                                            {
                                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                              "over": {
                                                                "query": "tokensInZone",
                                                                "zone": "$assaultLoC",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "troops"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "in",
                                                                    "value": [
                                                                      "NVA",
                                                                      "VC"
                                                                    ]
                                                                  }
                                                                ]
                                                              },
                                                              "to": {
                                                                "zoneExpr": {
                                                                  "concat": [
                                                                    "available-",
                                                                    {
                                                                      "ref": "tokenProp",
                                                                      "token": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                      "prop": "faction"
                                                                    },
                                                                    ":none"
                                                                  ]
                                                                }
                                                              },
                                                              "countBind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                              "macroOrigin": {
                                                                "macroId": "piece-removal-ordering",
                                                                "stem": "target"
                                                              }
                                                            },
                                                            {
                                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                              "over": {
                                                                "query": "tokensInZone",
                                                                "zone": "$assaultLoC",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "guerrilla"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": {
                                                                      "ref": "binding",
                                                                      "name": "$targetFactionFirst"
                                                                    }
                                                                  },
                                                                  {
                                                                    "prop": "activity",
                                                                    "op": "eq",
                                                                    "value": "active"
                                                                  }
                                                                ]
                                                              },
                                                              "to": {
                                                                "zoneExpr": {
                                                                  "concat": [
                                                                    "available-",
                                                                    {
                                                                      "ref": "binding",
                                                                      "name": "$targetFactionFirst"
                                                                    },
                                                                    ":none"
                                                                  ]
                                                                }
                                                              },
                                                              "countBind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                              "macroOrigin": {
                                                                "macroId": "piece-removal-ordering",
                                                                "stem": "target"
                                                              }
                                                            },
                                                            {
                                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                              "over": {
                                                                "query": "tokensInZone",
                                                                "zone": "$assaultLoC",
                                                                "filter": [
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "guerrilla"
                                                                  },
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": {
                                                                      "ref": "binding",
                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                    }
                                                                  },
                                                                  {
                                                                    "prop": "activity",
                                                                    "op": "eq",
                                                                    "value": "active"
                                                                  }
                                                                ]
                                                              },
                                                              "to": {
                                                                "zoneExpr": {
                                                                  "concat": [
                                                                    "available-",
                                                                    {
                                                                      "ref": "binding",
                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                    },
                                                                    ":none"
                                                                  ]
                                                                }
                                                              },
                                                              "countBind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                              "macroOrigin": {
                                                                "macroId": "piece-removal-ordering",
                                                                "stem": "target"
                                                              }
                                                            }
                                                          ],
                                                          "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                          "in": [
                                                            {
                                                              "let": {
                                                                "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                "value": {
                                                                  "op": "+",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                  },
                                                                  "right": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                  }
                                                                },
                                                                "in": [
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "and",
                                                                        "args": [
                                                                          {
                                                                            "op": "==",
                                                                            "left": true,
                                                                            "right": true
                                                                          },
                                                                          {
                                                                            "op": "==",
                                                                            "left": {
                                                                              "ref": "gvar",
                                                                              "var": "mom_bodyCount"
                                                                            },
                                                                            "right": true
                                                                          }
                                                                        ]
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "addVar": {
                                                                            "scope": "global",
                                                                            "var": "aid",
                                                                            "delta": {
                                                                              "op": "*",
                                                                              "left": {
                                                                                "ref": "binding",
                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                              },
                                                                              "right": 3
                                                                            }
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            },
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": ">",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                  },
                                                                  "right": 0
                                                                },
                                                                "then": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                      "value": {
                                                                        "aggregate": {
                                                                          "op": "count",
                                                                          "query": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$assaultLoC",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "type",
                                                                                "op": "eq",
                                                                                "value": "guerrilla"
                                                                              },
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "in",
                                                                                "value": [
                                                                                  "NVA",
                                                                                  "VC"
                                                                                ]
                                                                              },
                                                                              {
                                                                                "prop": "activity",
                                                                                "op": "eq",
                                                                                "value": "active"
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "==",
                                                                              "left": {
                                                                                "ref": "binding",
                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                              },
                                                                              "right": 0
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "forEach": {
                                                                                  "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                  "macroOrigin": {
                                                                                    "macroId": "piece-removal-ordering",
                                                                                    "stem": "baseTarget"
                                                                                  },
                                                                                  "over": {
                                                                                    "query": "tokensInZone",
                                                                                    "zone": "$assaultLoC",
                                                                                    "filter": [
                                                                                      {
                                                                                        "prop": "type",
                                                                                        "op": "eq",
                                                                                        "value": "base"
                                                                                      },
                                                                                      {
                                                                                        "prop": "faction",
                                                                                        "op": "in",
                                                                                        "value": [
                                                                                          "NVA",
                                                                                          "VC"
                                                                                        ]
                                                                                      }
                                                                                    ]
                                                                                  },
                                                                                  "effects": [
                                                                                    {
                                                                                      "if": {
                                                                                        "when": {
                                                                                          "op": "==",
                                                                                          "left": {
                                                                                            "ref": "tokenProp",
                                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                            "prop": "tunnel"
                                                                                          },
                                                                                          "right": "tunneled"
                                                                                        },
                                                                                        "then": [
                                                                                          {
                                                                                            "rollRandom": {
                                                                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                              "min": 1,
                                                                                              "max": 6,
                                                                                              "in": [
                                                                                                {
                                                                                                  "if": {
                                                                                                    "when": {
                                                                                                      "op": ">=",
                                                                                                      "left": {
                                                                                                        "ref": "binding",
                                                                                                        "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                      },
                                                                                                      "right": 4
                                                                                                    },
                                                                                                    "then": [
                                                                                                      {
                                                                                                        "setTokenProp": {
                                                                                                          "token": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                          "prop": "tunnel",
                                                                                                          "value": "untunneled"
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "else": [
                                                                                          {
                                                                                            "moveToken": {
                                                                                              "token": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                              "from": "$assaultLoC",
                                                                                              "to": {
                                                                                                "zoneExpr": {
                                                                                                  "concat": [
                                                                                                    "available-",
                                                                                                    {
                                                                                                      "ref": "tokenProp",
                                                                                                      "token": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                      "prop": "faction"
                                                                                                    },
                                                                                                    ":none"
                                                                                                  ]
                                                                                                }
                                                                                              }
                                                                                            }
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  ],
                                                                                  "limit": {
                                                                                    "ref": "binding",
                                                                                    "name": "$__macro_piece_removal_ordering_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                  }
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ],
                                                          "macroOrigin": {
                                                            "macroId": "piece-removal-ordering",
                                                            "stem": "remainingDamage"
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesAfter",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$assaultLoC",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesRemoved",
                                              "value": {
                                                "op": "-",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesBefore"
                                                },
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesAfter"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesRemoved"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "addVar": {
                                                          "scope": "global",
                                                          "var": "aid",
                                                          "delta": {
                                                            "op": "*",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_3__stages_3__effects_1__forEach_effects_0__let_in_0__let_in_0__basesRemoved"
                                                            },
                                                            "right": 6
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "sweep-us-profile",
      "actionId": "sweep",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.4.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_caps"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.4.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.4.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 99,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "move-troops",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.4.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$movingAdjacentTroops",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$troop",
                      "over": {
                        "query": "binding",
                        "name": "$movingAdjacentTroops"
                      },
                      "effects": [
                        {
                          "moveToken": {
                            "token": "$troop",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$troop"
                              }
                            },
                            "to": "$space"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.4.stages[1].effects.0.forEach.effects.2.chooseN",
                      "bind": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLocs_{$space}",
                      "options": {
                        "query": "adjacentZones",
                        "zone": "$space"
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLoc",
                      "macroOrigin": {
                        "macroId": "sweep-loc-hop",
                        "stem": "hopLoc"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLocs_{$space}"
                      },
                      "effects": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLoc",
                                    "prop": "category"
                                  },
                                  "right": "loc"
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLoc",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "right": 0
                                }
                              ]
                            },
                            "then": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.4.stages[1].effects.0.forEach.effects.3.forEach.effects.0.if.then.0.chooseN",
                                  "bind": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__movingHopTroops_{$space}",
                                  "options": {
                                    "query": "tokensInAdjacentZones",
                                    "zone": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopLoc",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "US"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  },
                                  "max": 99,
                                  "min": 0
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopTroop",
                                  "macroOrigin": {
                                    "macroId": "sweep-loc-hop",
                                    "stem": "hopTroop"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__movingHopTroops_{$space}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopTroop",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_sweep_loc_hop_actionPipelines_4__stages_1__effects_0__forEach_effects_2__hopTroop"
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "activate-guerrillas",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__cubeCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__sfCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "irregular"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__totalSweepers",
                                  "value": {
                                    "op": "+",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__cubeCount"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__sfCount"
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__activationLimit",
                                        "value": {
                                          "if": {
                                            "when": {
                                              "op": "zonePropIncludes",
                                              "zone": "$space",
                                              "prop": "terrainTags",
                                              "value": "jungle"
                                            },
                                            "then": {
                                              "op": "/",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__totalSweepers"
                                              },
                                              "right": 2
                                            },
                                            "else": {
                                              "ref": "binding",
                                              "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__totalSweepers"
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__activationLimit"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__guerrilla",
                                                    "macroOrigin": {
                                                      "macroId": "sweep-activation",
                                                      "stem": "guerrilla"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$space",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "guerrilla"
                                                        },
                                                        {
                                                          "prop": "activity",
                                                          "op": "eq",
                                                          "value": "underground"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "setTokenProp": {
                                                          "token": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__guerrilla",
                                                          "prop": "activity",
                                                          "value": "active"
                                                        }
                                                      }
                                                    ],
                                                    "limit": {
                                                      "ref": "binding",
                                                      "name": "$__macro_sweep_activation_actionPipelines_4__stages_2__effects_0__forEach_effects_0__activationLimit"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-cobras-bonus-removal",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_cobras"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.4.stages[3].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpace",
                      "macroOrigin": {
                        "macroId": "cap-sweep-cobras-unshaded-removal",
                        "stem": "cobrasSpace"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpaces"
                      },
                      "effects": [
                        {
                          "removeByPriority": {
                            "budget": 1,
                            "groups": [
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "guerrilla"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "activity",
                                      "op": "eq",
                                      "value": "active"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "tunnel",
                                      "op": "eq",
                                      "value": "untunneled"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_4__stages_3__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              }
                            ],
                            "macroOrigin": {
                              "macroId": "cap-sweep-cobras-unshaded-removal",
                              "stem": "target"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-booby-traps-troop-cost",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_boobyTraps"
                  },
                  "right": "shaded"
                },
                "then": [
                  {
                    "forEach": {
                      "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__space",
                      "macroOrigin": {
                        "macroId": "cap-sweep-booby-traps-shaded-cost",
                        "stem": "space"
                      },
                      "over": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "effects": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__boobyDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__boobyDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__lossTroop",
                                        "macroOrigin": {
                                          "macroId": "cap-sweep-booby-traps-shaded-cost",
                                          "stem": "lossTroop"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "US"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "==",
                                                "left": "US",
                                                "right": "US"
                                              },
                                              "then": [
                                                {
                                                  "moveToken": {
                                                    "token": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__lossTroop",
                                                    "from": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__space",
                                                    "to": {
                                                      "zoneExpr": "casualties-US:none"
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "moveToken": {
                                                    "token": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__lossTroop",
                                                    "from": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_4__stages_4__effects_0__space",
                                                    "to": {
                                                      "zoneExpr": "available-ARVN:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "sweep-arvn-profile",
      "actionId": "sweep",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "legality": {
        "op": ">=",
        "left": {
          "ref": "gvar",
          "var": "arvnResources"
        },
        "right": 3
      },
      "costValidation": {
        "op": ">=",
        "left": {
          "ref": "gvar",
          "var": "arvnResources"
        },
        "right": 3
      },
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.5.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_caps"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.5.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    }
                                  ]
                                }
                              }
                            },
                            "max": {
                              "op": "min",
                              "left": 2,
                              "right": {
                                "op": "floorDiv",
                                "left": {
                                  "ref": "gvar",
                                  "var": "arvnResources"
                                },
                                "right": 3
                              }
                            },
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.5.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    }
                                  ]
                                }
                              }
                            },
                            "max": {
                              "op": "floorDiv",
                              "left": {
                                "ref": "gvar",
                                "var": "arvnResources"
                              },
                              "right": 3
                            },
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "binding",
                          "name": "__freeOperation"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "arvnResources",
                            "delta": -3
                          }
                        }
                      ]
                    }
                  },
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.5.stages[1].effects.0.forEach.effects.1.chooseN",
                      "bind": "$movingTroops@{$space}",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$troop",
                      "over": {
                        "query": "binding",
                        "name": "$movingTroops@{$space}"
                      },
                      "effects": [
                        {
                          "moveToken": {
                            "token": "$troop",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$troop"
                              }
                            },
                            "to": "$space"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.5.stages[1].effects.0.forEach.effects.3.chooseN",
                      "bind": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLocs_{$space}",
                      "options": {
                        "query": "adjacentZones",
                        "zone": "$space"
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLoc",
                      "macroOrigin": {
                        "macroId": "sweep-loc-hop",
                        "stem": "hopLoc"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLocs_{$space}"
                      },
                      "effects": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLoc",
                                    "prop": "category"
                                  },
                                  "right": "loc"
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLoc",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "right": 0
                                }
                              ]
                            },
                            "then": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.5.stages[1].effects.0.forEach.effects.4.forEach.effects.0.if.then.0.chooseN",
                                  "bind": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__movingHopTroops_{$space}",
                                  "options": {
                                    "query": "tokensInAdjacentZones",
                                    "zone": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopLoc",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "ARVN"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  },
                                  "max": 99,
                                  "min": 0
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopTroop",
                                  "macroOrigin": {
                                    "macroId": "sweep-loc-hop",
                                    "stem": "hopTroop"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__movingHopTroops_{$space}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopTroop",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_sweep_loc_hop_actionPipelines_5__stages_1__effects_0__forEach_effects_3__hopTroop"
                                          }
                                        },
                                        "to": "$space"
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__cubeCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__sfCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "ranger"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__totalSweepers",
                                  "value": {
                                    "op": "+",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__cubeCount"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__sfCount"
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__activationLimit",
                                        "value": {
                                          "if": {
                                            "when": {
                                              "op": "zonePropIncludes",
                                              "zone": "$space",
                                              "prop": "terrainTags",
                                              "value": "jungle"
                                            },
                                            "then": {
                                              "op": "/",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__totalSweepers"
                                              },
                                              "right": 2
                                            },
                                            "else": {
                                              "ref": "binding",
                                              "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__totalSweepers"
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__activationLimit"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__guerrilla",
                                                    "macroOrigin": {
                                                      "macroId": "sweep-activation",
                                                      "stem": "guerrilla"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$space",
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "guerrilla"
                                                        },
                                                        {
                                                          "prop": "activity",
                                                          "op": "eq",
                                                          "value": "underground"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "setTokenProp": {
                                                          "token": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__guerrilla",
                                                          "prop": "activity",
                                                          "value": "active"
                                                        }
                                                      }
                                                    ],
                                                    "limit": {
                                                      "ref": "binding",
                                                      "name": "$__macro_sweep_activation_actionPipelines_5__stages_1__effects_0__forEach_effects_4__activationLimit"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-cobras-bonus-removal",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_cobras"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.5.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpace",
                      "macroOrigin": {
                        "macroId": "cap-sweep-cobras-unshaded-removal",
                        "stem": "cobrasSpace"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpaces"
                      },
                      "effects": [
                        {
                          "removeByPriority": {
                            "budget": 1,
                            "groups": [
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "guerrilla"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "activity",
                                      "op": "eq",
                                      "value": "active"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__cobrasSpace",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "tunnel",
                                      "op": "eq",
                                      "value": "untunneled"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_cap_sweep_cobras_unshaded_removal_actionPipelines_5__stages_2__effects_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "cap-sweep-cobras-unshaded-removal",
                                  "stem": "target"
                                }
                              }
                            ],
                            "macroOrigin": {
                              "macroId": "cap-sweep-cobras-unshaded-removal",
                              "stem": "target"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-booby-traps-troop-cost",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_boobyTraps"
                  },
                  "right": "shaded"
                },
                "then": [
                  {
                    "forEach": {
                      "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__space",
                      "macroOrigin": {
                        "macroId": "cap-sweep-booby-traps-shaded-cost",
                        "stem": "space"
                      },
                      "over": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "effects": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__boobyDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__boobyDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__lossTroop",
                                        "macroOrigin": {
                                          "macroId": "cap-sweep-booby-traps-shaded-cost",
                                          "stem": "lossTroop"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "ARVN"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "==",
                                                "left": "ARVN",
                                                "right": "US"
                                              },
                                              "then": [
                                                {
                                                  "moveToken": {
                                                    "token": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__lossTroop",
                                                    "from": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__space",
                                                    "to": {
                                                      "zoneExpr": "casualties-US:none"
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "moveToken": {
                                                    "token": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__lossTroop",
                                                    "from": "$__macro_cap_sweep_booby_traps_shaded_cost_actionPipelines_5__stages_3__effects_0__space",
                                                    "to": {
                                                      "zoneExpr": "available-ARVN:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "assault-us-profile",
      "actionId": "assault",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_generalLansdale"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.6.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "US"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "troops"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_abrams"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.6.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "US"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "troops"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.6.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "US"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "troops"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 99,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_cobras"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_6__stages_1__effects_0__forEach_effects_0__cobrasDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_6__stages_1__effects_0__forEach_effects_0__cobrasDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_6__stages_1__effects_0__forEach_effects_0__cobrasLossTroop",
                                        "macroOrigin": {
                                          "macroId": "cap-assault-cobras-shaded-cost",
                                          "stem": "cobrasLossTroop"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "US"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_6__stages_1__effects_0__forEach_effects_0__cobrasLossTroop",
                                              "from": "$space",
                                              "to": {
                                                "zoneExpr": "casualties-US:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$usTroops",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "troops"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$hasUSBase",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$damage",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": ">",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$hasUSBase"
                                        },
                                        "right": 0
                                      },
                                      "then": {
                                        "op": "*",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$usTroops"
                                        },
                                        "right": 2
                                      },
                                      "else": {
                                        "if": {
                                          "when": {
                                            "op": "zonePropIncludes",
                                            "zone": "$space",
                                            "prop": "terrainTags",
                                            "value": "highland"
                                          },
                                          "then": {
                                            "op": "/",
                                            "left": {
                                              "ref": "binding",
                                              "name": "$usTroops"
                                            },
                                            "right": 2
                                          },
                                          "else": {
                                            "ref": "binding",
                                            "name": "$usTroops"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$damage",
                                              "value": {
                                                "ref": "binding",
                                                "name": "$damage"
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$damage"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseOne": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.6.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                          "bind": "$targetFactionFirst",
                                                          "options": {
                                                            "query": "enums",
                                                            "values": [
                                                              "NVA",
                                                              "VC"
                                                            ]
                                                          }
                                                        }
                                                      },
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                          "value": {
                                                            "if": {
                                                              "when": {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "binding",
                                                                  "name": "$targetFactionFirst"
                                                                },
                                                                "right": "NVA"
                                                              },
                                                              "then": "VC",
                                                              "else": "NVA"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "removeByPriority": {
                                                                "budget": {
                                                                  "ref": "binding",
                                                                  "name": "$damage"
                                                                },
                                                                "groups": [
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "troops"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "tokenProp",
                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                            "prop": "faction"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  }
                                                                ],
                                                                "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                      "value": {
                                                                        "op": "+",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                        },
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": true,
                                                                                  "right": true
                                                                                },
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": {
                                                                                    "ref": "gvar",
                                                                                    "var": "mom_bodyCount"
                                                                                  },
                                                                                  "right": true
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "addVar": {
                                                                                  "scope": "global",
                                                                                  "var": "aid",
                                                                                  "delta": {
                                                                                    "op": "*",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                                    },
                                                                                    "right": 3
                                                                                  }
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  },
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": ">",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "let": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                            "value": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$space",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "guerrilla"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "in",
                                                                                      "value": [
                                                                                        "NVA",
                                                                                        "VC"
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "prop": "activity",
                                                                                      "op": "eq",
                                                                                      "value": "active"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "in": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                                    },
                                                                                    "right": 0
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "piece-removal-ordering",
                                                                                          "stem": "baseTarget"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$space",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "in",
                                                                                              "value": [
                                                                                                "NVA",
                                                                                                "VC"
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": "==",
                                                                                                "left": {
                                                                                                  "ref": "tokenProp",
                                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                  "prop": "tunnel"
                                                                                                },
                                                                                                "right": "tunneled"
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "rollRandom": {
                                                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                                    "min": 1,
                                                                                                    "max": 6,
                                                                                                    "in": [
                                                                                                      {
                                                                                                        "if": {
                                                                                                          "when": {
                                                                                                            "op": ">=",
                                                                                                            "left": {
                                                                                                              "ref": "binding",
                                                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                            },
                                                                                                            "right": 4
                                                                                                          },
                                                                                                          "then": [
                                                                                                            {
                                                                                                              "setTokenProp": {
                                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                "prop": "tunnel",
                                                                                                                "value": "untunneled"
                                                                                                              }
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ],
                                                                                              "else": [
                                                                                                {
                                                                                                  "moveToken": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "from": "$space",
                                                                                                    "to": {
                                                                                                      "zoneExpr": {
                                                                                                        "concat": [
                                                                                                          "available-",
                                                                                                          {
                                                                                                            "ref": "tokenProp",
                                                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                            "prop": "faction"
                                                                                                          },
                                                                                                          ":none"
                                                                                                        ]
                                                                                                      }
                                                                                                    }
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": {
                                                                                          "ref": "binding",
                                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ],
                                                                "macroOrigin": {
                                                                  "macroId": "piece-removal-ordering",
                                                                  "stem": "remainingDamage"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "addVar": {
                                                                "scope": "global",
                                                                "var": "aid",
                                                                "delta": {
                                                                  "op": "*",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_1__effects_0__forEach_effects_1__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                                  },
                                                                  "right": 6
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_searchAndDestroy"
                        },
                        "right": "unshaded"
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$__macro_cap_assault_search_and_destroy_actionPipelines_6__stages_1__effects_0__forEach_effects_2__sndUnderground",
                            "macroOrigin": {
                              "macroId": "cap-assault-search-and-destroy",
                              "stem": "sndUnderground"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_cap_assault_search_and_destroy_actionPipelines_6__stages_1__effects_0__forEach_effects_2__sndUnderground",
                                  "from": "$space",
                                  "to": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        {
                                          "ref": "tokenProp",
                                          "token": "$__macro_cap_assault_search_and_destroy_actionPipelines_6__stages_1__effects_0__forEach_effects_2__sndUnderground",
                                          "prop": "faction"
                                        },
                                        ":none"
                                      ]
                                    }
                                  }
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "globalMarkerState",
                              "marker": "cap_searchAndDestroy"
                            },
                            "right": "shaded"
                          },
                          {
                            "op": "or",
                            "args": [
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "category"
                                },
                                "right": "province"
                              },
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "category"
                                },
                                "right": "city"
                              }
                            ]
                          },
                          {
                            "op": ">",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "population"
                            },
                            "right": 0
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "markerState",
                              "space": "$space",
                              "marker": "supportOpposition"
                            },
                            "right": "activeOpposition"
                          }
                        ]
                      },
                      "then": [
                        {
                          "shiftMarker": {
                            "space": "$space",
                            "marker": "supportOpposition",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-abrams-base-first",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_abrams"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.6.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsSpace",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsTargetSpace",
                      "macroOrigin": {
                        "macroId": "cap-assault-abrams-unshaded-base-first",
                        "stem": "abramsTargetSpace"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsSpace"
                      },
                      "effects": [
                        {
                          "forEach": {
                            "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsBase",
                            "macroOrigin": {
                              "macroId": "cap-assault-abrams-unshaded-base-first",
                              "stem": "abramsBase"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsTargetSpace",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "base"
                                },
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "tunnel",
                                  "op": "eq",
                                  "value": "untunneled"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsBase",
                                  "from": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsTargetSpace",
                                  "to": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        {
                                          "ref": "tokenProp",
                                          "token": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_6__stages_2__effects_0__abramsBase",
                                          "prop": "faction"
                                        },
                                        ":none"
                                      ]
                                    }
                                  }
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-m48-patton-bonus-removal",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_m48Patton"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.6.stages[3].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Spaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                      "macroOrigin": {
                        "macroId": "cap-assault-m48-unshaded-bonus-removal",
                        "stem": "m48Space"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Spaces"
                      },
                      "effects": [
                        {
                          "let": {
                            "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesBefore",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$damage",
                                  "value": 2,
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$damage"
                                          },
                                          "right": 0
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.6.stages[3].effects.0.if.then.1.forEach.effects.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                              "bind": "$targetFactionFirst",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                              "value": {
                                                "if": {
                                                  "when": {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$targetFactionFirst"
                                                    },
                                                    "right": "NVA"
                                                  },
                                                  "then": "VC",
                                                  "else": "NVA"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "removeByPriority": {
                                                    "budget": {
                                                      "ref": "binding",
                                                      "name": "$damage"
                                                    },
                                                    "groups": [
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "troops"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": {
                                                                "ref": "binding",
                                                                "name": "$targetFactionFirst"
                                                              }
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "binding",
                                                                "name": "$targetFactionFirst"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": {
                                                                "ref": "binding",
                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                              }
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "binding",
                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      }
                                                    ],
                                                    "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                          "value": {
                                                            "op": "+",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": "and",
                                                                  "args": [
                                                                    {
                                                                      "op": "==",
                                                                      "left": false,
                                                                      "right": true
                                                                    },
                                                                    {
                                                                      "op": "==",
                                                                      "left": {
                                                                        "ref": "gvar",
                                                                        "var": "mom_bodyCount"
                                                                      },
                                                                      "right": true
                                                                    }
                                                                  ]
                                                                },
                                                                "then": [
                                                                  {
                                                                    "addVar": {
                                                                      "scope": "global",
                                                                      "var": "aid",
                                                                      "delta": {
                                                                        "op": "*",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                        },
                                                                        "right": 3
                                                                      }
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "let": {
                                                                "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                "value": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "in": [
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "==",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "forEach": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                            "macroOrigin": {
                                                                              "macroId": "piece-removal-ordering",
                                                                              "stem": "baseTarget"
                                                                            },
                                                                            "over": {
                                                                              "query": "tokensInZone",
                                                                              "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                                              "filter": [
                                                                                {
                                                                                  "prop": "type",
                                                                                  "op": "eq",
                                                                                  "value": "base"
                                                                                },
                                                                                {
                                                                                  "prop": "faction",
                                                                                  "op": "in",
                                                                                  "value": [
                                                                                    "NVA",
                                                                                    "VC"
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            },
                                                                            "effects": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "tokenProp",
                                                                                      "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                      "prop": "tunnel"
                                                                                    },
                                                                                    "right": "tunneled"
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "rollRandom": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                        "min": 1,
                                                                                        "max": 6,
                                                                                        "in": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": ">=",
                                                                                                "left": {
                                                                                                  "ref": "binding",
                                                                                                  "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                },
                                                                                                "right": 4
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "setTokenProp": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "prop": "tunnel",
                                                                                                    "value": "untunneled"
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  ],
                                                                                  "else": [
                                                                                    {
                                                                                      "moveToken": {
                                                                                        "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "from": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                                                                        "to": {
                                                                                          "zoneExpr": {
                                                                                            "concat": [
                                                                                              "available-",
                                                                                              {
                                                                                                "ref": "tokenProp",
                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                "prop": "faction"
                                                                                              },
                                                                                              ":none"
                                                                                            ]
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ],
                                                                            "limit": {
                                                                              "ref": "binding",
                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                            }
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ],
                                                    "macroOrigin": {
                                                      "macroId": "piece-removal-ordering",
                                                      "stem": "remainingDamage"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "let": {
                                  "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesAfter",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_6__stages_3__effects_0__m48Space",
                                        "filter": [
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          },
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved",
                                        "value": {
                                          "op": "-",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesBefore"
                                          },
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesAfter"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "addVar": {
                                                    "scope": "global",
                                                    "var": "aid",
                                                    "delta": {
                                                      "op": "*",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved"
                                                      },
                                                      "right": 6
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "arvn-followup",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "or",
                  "args": [
                    {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_bodyCount"
                      },
                      "right": true
                    },
                    {
                      "op": ">=",
                      "left": {
                        "ref": "gvar",
                        "var": "arvnResources"
                      },
                      "right": {
                        "op": "+",
                        "left": {
                          "ref": "gvar",
                          "var": "totalEcon"
                        },
                        "right": 3
                      }
                    }
                  ]
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.6.stages[4].effects.0.if.then.0.chooseN",
                      "bind": "$arvnFollowupSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$arvnSpace",
                      "over": {
                        "query": "binding",
                        "name": "$arvnFollowupSpaces"
                      },
                      "effects": [
                        {
                          "if": {
                            "when": {
                              "op": "!=",
                              "left": {
                                "ref": "gvar",
                                "var": "mom_bodyCount"
                              },
                              "right": true
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "arvnResources",
                                  "delta": -3
                                }
                              }
                            ]
                          }
                        },
                        {
                          "let": {
                            "bind": "$arvnCubes",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$arvnSpace",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "in",
                                      "value": [
                                        "troops",
                                        "police"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$arvnDamage",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "zonePropIncludes",
                                        "zone": "$arvnSpace",
                                        "prop": "terrainTags",
                                        "value": "highland"
                                      },
                                      "then": {
                                        "op": "/",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$arvnCubes"
                                        },
                                        "right": 3
                                      },
                                      "else": {
                                        "op": "/",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$arvnCubes"
                                        },
                                        "right": 2
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$arvnSpace",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$damage",
                                              "value": {
                                                "ref": "binding",
                                                "name": "$arvnDamage"
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$damage"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseOne": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.6.stages[4].effects.0.if.then.1.forEach.effects.1.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                          "bind": "$targetFactionFirst",
                                                          "options": {
                                                            "query": "enums",
                                                            "values": [
                                                              "NVA",
                                                              "VC"
                                                            ]
                                                          }
                                                        }
                                                      },
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                          "value": {
                                                            "if": {
                                                              "when": {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "binding",
                                                                  "name": "$targetFactionFirst"
                                                                },
                                                                "right": "NVA"
                                                              },
                                                              "then": "VC",
                                                              "else": "NVA"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "removeByPriority": {
                                                                "budget": {
                                                                  "ref": "binding",
                                                                  "name": "$damage"
                                                                },
                                                                "groups": [
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$arvnSpace",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "troops"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "tokenProp",
                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                            "prop": "faction"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$arvnSpace",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$arvnSpace",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  }
                                                                ],
                                                                "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                      "value": {
                                                                        "op": "+",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                        },
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": true,
                                                                                  "right": true
                                                                                },
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": {
                                                                                    "ref": "gvar",
                                                                                    "var": "mom_bodyCount"
                                                                                  },
                                                                                  "right": true
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "addVar": {
                                                                                  "scope": "global",
                                                                                  "var": "aid",
                                                                                  "delta": {
                                                                                    "op": "*",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                                    },
                                                                                    "right": 3
                                                                                  }
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  },
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": ">",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "let": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                            "value": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$arvnSpace",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "guerrilla"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "in",
                                                                                      "value": [
                                                                                        "NVA",
                                                                                        "VC"
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "prop": "activity",
                                                                                      "op": "eq",
                                                                                      "value": "active"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "in": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                                    },
                                                                                    "right": 0
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "piece-removal-ordering",
                                                                                          "stem": "baseTarget"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$arvnSpace",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "in",
                                                                                              "value": [
                                                                                                "NVA",
                                                                                                "VC"
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": "==",
                                                                                                "left": {
                                                                                                  "ref": "tokenProp",
                                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                  "prop": "tunnel"
                                                                                                },
                                                                                                "right": "tunneled"
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "rollRandom": {
                                                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                                    "min": 1,
                                                                                                    "max": 6,
                                                                                                    "in": [
                                                                                                      {
                                                                                                        "if": {
                                                                                                          "when": {
                                                                                                            "op": ">=",
                                                                                                            "left": {
                                                                                                              "ref": "binding",
                                                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                            },
                                                                                                            "right": 4
                                                                                                          },
                                                                                                          "then": [
                                                                                                            {
                                                                                                              "setTokenProp": {
                                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                "prop": "tunnel",
                                                                                                                "value": "untunneled"
                                                                                                              }
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ],
                                                                                              "else": [
                                                                                                {
                                                                                                  "moveToken": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "from": "$arvnSpace",
                                                                                                    "to": {
                                                                                                      "zoneExpr": {
                                                                                                        "concat": [
                                                                                                          "available-",
                                                                                                          {
                                                                                                            "ref": "tokenProp",
                                                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                            "prop": "faction"
                                                                                                          },
                                                                                                          ":none"
                                                                                                        ]
                                                                                                      }
                                                                                                    }
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": {
                                                                                          "ref": "binding",
                                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ],
                                                                "macroOrigin": {
                                                                  "macroId": "piece-removal-ordering",
                                                                  "stem": "remainingDamage"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$arvnSpace",
                                                    "filter": [
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "addVar": {
                                                                "scope": "global",
                                                                "var": "aid",
                                                                "delta": {
                                                                  "op": "*",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_coin_assault_removal_order_actionPipelines_6__stages_4__effects_0__if_then_1__forEach_effects_1__let_in_0__let_in_0__basesRemoved"
                                                                  },
                                                                  "right": 6
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "assault-arvn-profile",
      "actionId": "assault",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "gvar",
              "var": "mom_bodyCount"
            },
            "right": true
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": 3
          }
        ]
      },
      "costValidation": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "gvar",
              "var": "mom_bodyCount"
            },
            "right": true
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": 3
          }
        ]
      },
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.7.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "ARVN"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "troops",
                                            "police"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_abrams"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.7.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "ARVN"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "in",
                                                "value": [
                                                  "troops",
                                                  "police"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    }
                                  ]
                                }
                              }
                            },
                            "max": {
                              "if": {
                                "when": {
                                  "op": "==",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "mom_bodyCount"
                                  },
                                  "right": true
                                },
                                "then": 99,
                                "else": {
                                  "op": "min",
                                  "left": 2,
                                  "right": {
                                    "op": "floorDiv",
                                    "left": {
                                      "ref": "gvar",
                                      "var": "arvnResources"
                                    },
                                    "right": 3
                                  }
                                }
                              }
                            },
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.7.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "ARVN"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "in",
                                                "value": [
                                                  "troops",
                                                  "police"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    }
                                  ]
                                }
                              }
                            },
                            "max": {
                              "if": {
                                "when": {
                                  "op": "==",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "mom_bodyCount"
                                  },
                                  "right": true
                                },
                                "then": 99,
                                "else": {
                                  "op": "floorDiv",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "arvnResources"
                                  },
                                  "right": 3
                                }
                              }
                            },
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "!=",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "gvar",
                              "var": "mom_bodyCount"
                            },
                            "right": true
                          }
                        ]
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "arvnResources",
                            "delta": -3
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_cobras"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "rollRandom": {
                            "bind": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_7__stages_1__effects_0__forEach_effects_1__cobrasDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_7__stages_1__effects_0__forEach_effects_1__cobrasDie"
                                    },
                                    "right": 3
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_7__stages_1__effects_0__forEach_effects_1__cobrasLossTroop",
                                        "macroOrigin": {
                                          "macroId": "cap-assault-cobras-shaded-cost",
                                          "stem": "cobrasLossTroop"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "US"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_cap_assault_cobras_shaded_cost_actionPipelines_7__stages_1__effects_0__forEach_effects_1__cobrasLossTroop",
                                              "from": "$space",
                                              "to": {
                                                "zoneExpr": "casualties-US:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$isProvince",
                      "value": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "category"
                            },
                            "right": "province"
                          },
                          "then": 1,
                          "else": 0
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$arvnCubes",
                            "value": {
                              "if": {
                                "when": {
                                  "op": "==",
                                  "left": {
                                    "ref": "binding",
                                    "name": "$isProvince"
                                  },
                                  "right": 1
                                },
                                "then": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$space",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "ARVN"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "troops"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "else": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$space",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "ARVN"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "troops",
                                            "police"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$damage",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "zonePropIncludes",
                                        "zone": "$space",
                                        "prop": "terrainTags",
                                        "value": "highland"
                                      },
                                      "then": {
                                        "op": "/",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$arvnCubes"
                                        },
                                        "right": 3
                                      },
                                      "else": {
                                        "op": "/",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$arvnCubes"
                                        },
                                        "right": 2
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$damage",
                                              "value": {
                                                "ref": "binding",
                                                "name": "$damage"
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$damage"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseOne": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.7.stages[1].effects.0.forEach.effects.2.let.in.0.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                          "bind": "$targetFactionFirst",
                                                          "options": {
                                                            "query": "enums",
                                                            "values": [
                                                              "NVA",
                                                              "VC"
                                                            ]
                                                          }
                                                        }
                                                      },
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                          "value": {
                                                            "if": {
                                                              "when": {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "binding",
                                                                  "name": "$targetFactionFirst"
                                                                },
                                                                "right": "NVA"
                                                              },
                                                              "then": "VC",
                                                              "else": "NVA"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "removeByPriority": {
                                                                "budget": {
                                                                  "ref": "binding",
                                                                  "name": "$damage"
                                                                },
                                                                "groups": [
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "troops"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "tokenProp",
                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                            "prop": "faction"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$targetFactionFirst"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  },
                                                                  {
                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                    "over": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          }
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    },
                                                                    "to": {
                                                                      "zoneExpr": {
                                                                        "concat": [
                                                                          "available-",
                                                                          {
                                                                            "ref": "binding",
                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                          },
                                                                          ":none"
                                                                        ]
                                                                      }
                                                                    },
                                                                    "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                                    "macroOrigin": {
                                                                      "macroId": "piece-removal-ordering",
                                                                      "stem": "target"
                                                                    }
                                                                  }
                                                                ],
                                                                "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                      "value": {
                                                                        "op": "+",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                        },
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": true,
                                                                                  "right": true
                                                                                },
                                                                                {
                                                                                  "op": "==",
                                                                                  "left": {
                                                                                    "ref": "gvar",
                                                                                    "var": "mom_bodyCount"
                                                                                  },
                                                                                  "right": true
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "addVar": {
                                                                                  "scope": "global",
                                                                                  "var": "aid",
                                                                                  "delta": {
                                                                                    "op": "*",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                                    },
                                                                                    "right": 3
                                                                                  }
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  },
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": ">",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "let": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                            "value": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$space",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "guerrilla"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "in",
                                                                                      "value": [
                                                                                        "NVA",
                                                                                        "VC"
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "prop": "activity",
                                                                                      "op": "eq",
                                                                                      "value": "active"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "in": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "binding",
                                                                                      "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                                    },
                                                                                    "right": 0
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "piece-removal-ordering",
                                                                                          "stem": "baseTarget"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$space",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "in",
                                                                                              "value": [
                                                                                                "NVA",
                                                                                                "VC"
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": "==",
                                                                                                "left": {
                                                                                                  "ref": "tokenProp",
                                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                  "prop": "tunnel"
                                                                                                },
                                                                                                "right": "tunneled"
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "rollRandom": {
                                                                                                    "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                                    "min": 1,
                                                                                                    "max": 6,
                                                                                                    "in": [
                                                                                                      {
                                                                                                        "if": {
                                                                                                          "when": {
                                                                                                            "op": ">=",
                                                                                                            "left": {
                                                                                                              "ref": "binding",
                                                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                            },
                                                                                                            "right": 4
                                                                                                          },
                                                                                                          "then": [
                                                                                                            {
                                                                                                              "setTokenProp": {
                                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                "prop": "tunnel",
                                                                                                                "value": "untunneled"
                                                                                                              }
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ],
                                                                                              "else": [
                                                                                                {
                                                                                                  "moveToken": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "from": "$space",
                                                                                                    "to": {
                                                                                                      "zoneExpr": {
                                                                                                        "concat": [
                                                                                                          "available-",
                                                                                                          {
                                                                                                            "ref": "tokenProp",
                                                                                                            "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                            "prop": "faction"
                                                                                                          },
                                                                                                          ":none"
                                                                                                        ]
                                                                                                      }
                                                                                                    }
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": {
                                                                                          "ref": "binding",
                                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ],
                                                                "macroOrigin": {
                                                                  "macroId": "piece-removal-ordering",
                                                                  "stem": "remainingDamage"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "addVar": {
                                                                "scope": "global",
                                                                "var": "aid",
                                                                "delta": {
                                                                  "op": "*",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_1__effects_0__forEach_effects_2__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                                  },
                                                                  "right": 6
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_searchAndDestroy"
                        },
                        "right": "unshaded"
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$__macro_cap_assault_search_and_destroy_actionPipelines_7__stages_1__effects_0__forEach_effects_3__sndUnderground",
                            "macroOrigin": {
                              "macroId": "cap-assault-search-and-destroy",
                              "stem": "sndUnderground"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_cap_assault_search_and_destroy_actionPipelines_7__stages_1__effects_0__forEach_effects_3__sndUnderground",
                                  "from": "$space",
                                  "to": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        {
                                          "ref": "tokenProp",
                                          "token": "$__macro_cap_assault_search_and_destroy_actionPipelines_7__stages_1__effects_0__forEach_effects_3__sndUnderground",
                                          "prop": "faction"
                                        },
                                        ":none"
                                      ]
                                    }
                                  }
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "globalMarkerState",
                              "marker": "cap_searchAndDestroy"
                            },
                            "right": "shaded"
                          },
                          {
                            "op": "or",
                            "args": [
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "category"
                                },
                                "right": "province"
                              },
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "category"
                                },
                                "right": "city"
                              }
                            ]
                          },
                          {
                            "op": ">",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "population"
                            },
                            "right": 0
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "markerState",
                              "space": "$space",
                              "marker": "supportOpposition"
                            },
                            "right": "activeOpposition"
                          }
                        ]
                      },
                      "then": [
                        {
                          "shiftMarker": {
                            "space": "$space",
                            "marker": "supportOpposition",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-abrams-base-first",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_abrams"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.7.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsSpace",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsTargetSpace",
                      "macroOrigin": {
                        "macroId": "cap-assault-abrams-unshaded-base-first",
                        "stem": "abramsTargetSpace"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsSpace"
                      },
                      "effects": [
                        {
                          "forEach": {
                            "bind": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsBase",
                            "macroOrigin": {
                              "macroId": "cap-assault-abrams-unshaded-base-first",
                              "stem": "abramsBase"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsTargetSpace",
                              "filter": [
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "base"
                                },
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "tunnel",
                                  "op": "eq",
                                  "value": "untunneled"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsBase",
                                  "from": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsTargetSpace",
                                  "to": {
                                    "zoneExpr": {
                                      "concat": [
                                        "available-",
                                        {
                                          "ref": "tokenProp",
                                          "token": "$__macro_cap_assault_abrams_unshaded_base_first_actionPipelines_7__stages_2__effects_0__abramsBase",
                                          "prop": "faction"
                                        },
                                        ":none"
                                      ]
                                    }
                                  }
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-m48-patton-bonus-removal",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_m48Patton"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.7.stages[3].effects.0.if.then.0.chooseN",
                      "bind": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Spaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 2,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                      "macroOrigin": {
                        "macroId": "cap-assault-m48-unshaded-bonus-removal",
                        "stem": "m48Space"
                      },
                      "over": {
                        "query": "binding",
                        "name": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Spaces"
                      },
                      "effects": [
                        {
                          "let": {
                            "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesBefore",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                  "filter": [
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    },
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$damage",
                                  "value": 2,
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$damage"
                                          },
                                          "right": 0
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.7.stages[3].effects.0.if.then.1.forEach.effects.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                              "bind": "$targetFactionFirst",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                              "value": {
                                                "if": {
                                                  "when": {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$targetFactionFirst"
                                                    },
                                                    "right": "NVA"
                                                  },
                                                  "then": "VC",
                                                  "else": "NVA"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "removeByPriority": {
                                                    "budget": {
                                                      "ref": "binding",
                                                      "name": "$damage"
                                                    },
                                                    "groups": [
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "troops"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": {
                                                                "ref": "binding",
                                                                "name": "$targetFactionFirst"
                                                              }
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "binding",
                                                                "name": "$targetFactionFirst"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": {
                                                                "ref": "binding",
                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                              }
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "binding",
                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "countBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                        "macroOrigin": {
                                                          "macroId": "piece-removal-ordering",
                                                          "stem": "target"
                                                        }
                                                      }
                                                    ],
                                                    "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                          "value": {
                                                            "op": "+",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": "and",
                                                                  "args": [
                                                                    {
                                                                      "op": "==",
                                                                      "left": false,
                                                                      "right": true
                                                                    },
                                                                    {
                                                                      "op": "==",
                                                                      "left": {
                                                                        "ref": "gvar",
                                                                        "var": "mom_bodyCount"
                                                                      },
                                                                      "right": true
                                                                    }
                                                                  ]
                                                                },
                                                                "then": [
                                                                  {
                                                                    "addVar": {
                                                                      "scope": "global",
                                                                      "var": "aid",
                                                                      "delta": {
                                                                        "op": "*",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                        },
                                                                        "right": 3
                                                                      }
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "let": {
                                                                "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                "value": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "prop": "activity",
                                                                          "op": "eq",
                                                                          "value": "active"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "in": [
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "==",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                        },
                                                                        "right": 0
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "forEach": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                            "macroOrigin": {
                                                                              "macroId": "piece-removal-ordering",
                                                                              "stem": "baseTarget"
                                                                            },
                                                                            "over": {
                                                                              "query": "tokensInZone",
                                                                              "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                                              "filter": [
                                                                                {
                                                                                  "prop": "type",
                                                                                  "op": "eq",
                                                                                  "value": "base"
                                                                                },
                                                                                {
                                                                                  "prop": "faction",
                                                                                  "op": "in",
                                                                                  "value": [
                                                                                    "NVA",
                                                                                    "VC"
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            },
                                                                            "effects": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "==",
                                                                                    "left": {
                                                                                      "ref": "tokenProp",
                                                                                      "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                      "prop": "tunnel"
                                                                                    },
                                                                                    "right": "tunneled"
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "rollRandom": {
                                                                                        "bind": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                        "min": 1,
                                                                                        "max": 6,
                                                                                        "in": [
                                                                                          {
                                                                                            "if": {
                                                                                              "when": {
                                                                                                "op": ">=",
                                                                                                "left": {
                                                                                                  "ref": "binding",
                                                                                                  "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                },
                                                                                                "right": 4
                                                                                              },
                                                                                              "then": [
                                                                                                {
                                                                                                  "setTokenProp": {
                                                                                                    "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                    "prop": "tunnel",
                                                                                                    "value": "untunneled"
                                                                                                  }
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  ],
                                                                                  "else": [
                                                                                    {
                                                                                      "moveToken": {
                                                                                        "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                        "from": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                                                                        "to": {
                                                                                          "zoneExpr": {
                                                                                            "concat": [
                                                                                              "available-",
                                                                                              {
                                                                                                "ref": "tokenProp",
                                                                                                "token": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                "prop": "faction"
                                                                                              },
                                                                                              ":none"
                                                                                            ]
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ],
                                                                            "limit": {
                                                                              "ref": "binding",
                                                                              "name": "$__macro_piece_removal_ordering_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                            }
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ],
                                                    "macroOrigin": {
                                                      "macroId": "piece-removal-ordering",
                                                      "stem": "remainingDamage"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "let": {
                                  "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesAfter",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$__macro_cap_assault_m48_unshaded_bonus_removal_actionPipelines_7__stages_3__effects_0__m48Space",
                                        "filter": [
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          },
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved",
                                        "value": {
                                          "op": "-",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesBefore"
                                          },
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesAfter"
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "addVar": {
                                                    "scope": "global",
                                                    "var": "aid",
                                                    "delta": {
                                                      "op": "*",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_coin_assault_removal_order_actionPipelines_7__stages_3__effects_0__macro_cap_assault_m48_unshaded_bonus_removal__0__if_then_1__forEach_effects_0__basesRemoved"
                                                      },
                                                      "right": 6
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "rally-nva-profile",
      "actionId": "rally",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.8.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "passiveSupport"
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "activeSupport"
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 0
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.8.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "passiveSupport"
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "activeSupport"
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "ref": "gvar",
                            "var": "nvaResources"
                          }
                        }
                      },
                      "min": 0
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "binding",
                          "name": "__freeOperation"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "nvaResources",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$nvaBaseCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "NVA"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "base"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "binding",
                                "name": "$nvaBaseCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": ">=",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "NVA"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 2
                                      },
                                      {
                                        "op": "<",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 2
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.8.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.0.if.then.0.chooseOne",
                                        "bind": "$noBaseChoice",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "place-guerrilla",
                                            "replace-with-base"
                                          ]
                                        }
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.8.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.0.if.else.0.chooseOne",
                                        "bind": "$noBaseChoice",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "place-guerrilla"
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$noBaseChoice"
                                    },
                                    "right": "place-guerrilla"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "NVA",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "NVA",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "NVA",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "guerrilla",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.8.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "NVA"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "guerrilla"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "NVA"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$noBaseChoice"
                                    },
                                    "right": "replace-with-base"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$g",
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$g",
                                              "from": "$space",
                                              "to": {
                                                "zoneExpr": "available-NVA:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 2
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "NVA",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "base"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "NVA",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "NVA",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "base",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.8.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.2.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "base"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "NVA"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "NVA"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "binding",
                                "name": "$nvaBaseCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "let": {
                                  "bind": "$rallyLimit",
                                  "value": {
                                    "op": "+",
                                    "left": {
                                      "ref": "gvar",
                                      "var": "trail"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$nvaBaseCount"
                                    }
                                  },
                                  "in": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "NVA",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "NVA",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": {
                                          "ref": "binding",
                                          "name": "$rallyLimit"
                                        },
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$rallyLimit"
                                                },
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "NVA",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "guerrilla",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.8.stages[1].effects.0.forEach.effects.1.let.in.1.if.then.0.let.in.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "NVA"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "guerrilla"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "NVA"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_8__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_0__let_in_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "trail-improvement",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "and",
                  "args": [
                    {
                      "op": ">=",
                      "left": {
                        "ref": "gvar",
                        "var": "nvaResources"
                      },
                      "right": 2
                    },
                    {
                      "op": "<",
                      "left": {
                        "ref": "gvar",
                        "var": "trail"
                      },
                      "right": 4
                    },
                    {
                      "op": "!=",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_mcnamaraLine"
                      },
                      "right": true
                    }
                  ]
                },
                "then": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.8.stages[2].effects.0.if.then.0.chooseOne",
                      "bind": "$improveTrail",
                      "options": {
                        "query": "enums",
                        "values": [
                          "yes",
                          "no"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$improveTrail"
                        },
                        "right": "yes"
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_aaa"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.8.stages[2].effects.0.if.then.1.if.then.0.if.then.0.chooseN",
                                  "bind": "$trailImproveSpaces",
                                  "options": {
                                    "query": "mapSpaces",
                                    "filter": {
                                      "condition": {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "country"
                                            },
                                            "right": "laos"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "country"
                                            },
                                            "right": "cambodia"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "max": 1,
                                  "min": 1
                                }
                              }
                            ],
                            "else": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.8.stages[2].effects.0.if.then.1.if.then.0.if.else.0.chooseN",
                                  "bind": "$trailImproveSpaces",
                                  "options": {
                                    "query": "mapSpaces",
                                    "filter": {
                                      "condition": {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "country"
                                            },
                                            "right": "laos"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "country"
                                            },
                                            "right": "cambodia"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "max": 99,
                                  "min": 1
                                }
                              }
                            ]
                          }
                        },
                        {
                          "forEach": {
                            "bind": "$trailSpace",
                            "over": {
                              "query": "binding",
                              "name": "$trailImproveSpaces"
                            },
                            "effects": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": ">=",
                                        "left": {
                                          "ref": "gvar",
                                          "var": "nvaResources"
                                        },
                                        "right": 2
                                      },
                                      {
                                        "op": "<",
                                        "left": {
                                          "ref": "gvar",
                                          "var": "trail"
                                        },
                                        "right": 4
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "nvaResources",
                                        "delta": -2
                                      }
                                    },
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "trail",
                                        "delta": {
                                          "if": {
                                            "when": {
                                              "op": "==",
                                              "left": {
                                                "ref": "globalMarkerState",
                                                "marker": "cap_sa2s"
                                              },
                                              "right": "shaded"
                                            },
                                            "then": {
                                              "if": {
                                                "when": {
                                                  "op": ">=",
                                                  "left": {
                                                    "ref": "gvar",
                                                    "var": "trail"
                                                  },
                                                  "right": 3
                                                },
                                                "then": 1,
                                                "else": 2
                                              }
                                            },
                                            "else": 1
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "rally-vc-profile",
      "actionId": "rally",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.9.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "passiveSupport"
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "activeSupport"
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 0
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.9.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "passiveSupport"
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "markerState",
                                  "space": "$zone",
                                  "marker": "supportOpposition"
                                },
                                "right": "activeSupport"
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "ref": "gvar",
                            "var": "vcResources"
                          }
                        }
                      },
                      "min": 0
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "binding",
                          "name": "__freeOperation"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "vcResources",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$vcBaseCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "VC"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "base"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "binding",
                                "name": "$vcBaseCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": ">=",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "VC"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 2
                                      },
                                      {
                                        "op": "<",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 2
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.0.if.then.0.chooseOne",
                                        "bind": "$noBaseChoice",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "place-guerrilla",
                                            "replace-with-base"
                                          ]
                                        }
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.0.if.else.0.chooseOne",
                                        "bind": "$noBaseChoice",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "place-guerrilla"
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$noBaseChoice"
                                    },
                                    "right": "place-guerrilla"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "VC",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "VC",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "VC",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "guerrilla",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.1.if.then.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "guerrilla"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "VC"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "guerrilla"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_1__if_then_0__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$noBaseChoice"
                                    },
                                    "right": "replace-with-base"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$g",
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$g",
                                              "from": "$space",
                                              "to": {
                                                "zoneExpr": "available-VC:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 2
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__piece",
                                        "macroOrigin": {
                                          "macroId": "place-from-available-or-map",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": {
                                            "zoneExpr": {
                                              "concat": [
                                                "available-",
                                                "VC",
                                                ":none"
                                              ]
                                            }
                                          },
                                          "filter": [
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "base"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "concat": [
                                                    "available-",
                                                    "VC",
                                                    ":none"
                                                  ]
                                                }
                                              },
                                              "to": "$space"
                                            }
                                          }
                                        ],
                                        "limit": 1,
                                        "countBind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__placed",
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__remaining",
                                              "value": {
                                                "op": "-",
                                                "left": 1,
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__placed"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "or",
                                                          "args": [
                                                            {
                                                              "op": "!=",
                                                              "left": "VC",
                                                              "right": "US"
                                                            },
                                                            {
                                                              "op": "==",
                                                              "left": "base",
                                                              "right": "irregular"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__remaining"
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseN": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.0.if.then.2.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__sourceSpaces",
                                                          "options": {
                                                            "query": "mapSpaces",
                                                            "filter": {
                                                              "condition": {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$zone",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "type",
                                                                          "op": "eq",
                                                                          "value": "base"
                                                                        },
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "eq",
                                                                          "value": "VC"
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            }
                                                          },
                                                          "max": 99,
                                                          "min": 0
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "srcSpace"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__sourceSpaces"
                                                          },
                                                          "effects": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__mapPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "mapPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    },
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__mapPiece",
                                                                      "from": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_0__if_then_2__if_then_1__srcSpace",
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "binding",
                                "name": "$vcBaseCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "chooseOne": {
                                  "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.1.if.then.0.chooseOne",
                                  "bind": "$withBaseChoice",
                                  "options": {
                                    "query": "enums",
                                    "values": [
                                      "place-guerrillas",
                                      "flip-underground"
                                    ]
                                  }
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$withBaseChoice"
                                    },
                                    "right": "place-guerrillas"
                                  },
                                  "then": [
                                    {
                                      "let": {
                                        "bind": "$rallyLimit",
                                        "value": {
                                          "op": "+",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$space",
                                            "prop": "population"
                                          },
                                          "right": {
                                            "ref": "binding",
                                            "name": "$vcBaseCount"
                                          }
                                        },
                                        "in": [
                                          {
                                            "forEach": {
                                              "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__piece",
                                              "macroOrigin": {
                                                "macroId": "place-from-available-or-map",
                                                "stem": "piece"
                                              },
                                              "over": {
                                                "query": "tokensInZone",
                                                "zone": {
                                                  "zoneExpr": {
                                                    "concat": [
                                                      "available-",
                                                      "VC",
                                                      ":none"
                                                    ]
                                                  }
                                                },
                                                "filter": [
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "guerrilla"
                                                  }
                                                ]
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__piece",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "concat": [
                                                          "available-",
                                                          "VC",
                                                          ":none"
                                                        ]
                                                      }
                                                    },
                                                    "to": "$space"
                                                  }
                                                }
                                              ],
                                              "limit": {
                                                "ref": "binding",
                                                "name": "$rallyLimit"
                                              },
                                              "countBind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__placed",
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__remaining",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$rallyLimit"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__placed"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": "and",
                                                            "args": [
                                                              {
                                                                "op": "or",
                                                                "args": [
                                                                  {
                                                                    "op": "!=",
                                                                    "left": "VC",
                                                                    "right": "US"
                                                                  },
                                                                  {
                                                                    "op": "==",
                                                                    "left": "guerrilla",
                                                                    "right": "irregular"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "op": ">",
                                                                "left": {
                                                                  "ref": "binding",
                                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__remaining"
                                                                },
                                                                "right": 0
                                                              }
                                                            ]
                                                          },
                                                          "then": [
                                                            {
                                                              "chooseN": {
                                                                "internalDecisionId": "decision:doc.actionPipelines.9.stages[1].effects.0.forEach.effects.1.let.in.1.if.then.1.if.then.0.let.in.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__sourceSpaces",
                                                                "options": {
                                                                  "query": "mapSpaces",
                                                                  "filter": {
                                                                    "condition": {
                                                                      "op": ">",
                                                                      "left": {
                                                                        "aggregate": {
                                                                          "op": "count",
                                                                          "query": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$zone",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "type",
                                                                                "op": "eq",
                                                                                "value": "guerrilla"
                                                                              },
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "eq",
                                                                                "value": "VC"
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      },
                                                                      "right": 0
                                                                    }
                                                                  }
                                                                },
                                                                "max": 99,
                                                                "min": 0
                                                              }
                                                            },
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__srcSpace",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "srcSpace"
                                                                },
                                                                "over": {
                                                                  "query": "binding",
                                                                  "name": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__sourceSpaces"
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "forEach": {
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__mapPiece",
                                                                      "macroOrigin": {
                                                                        "macroId": "place-from-available-or-map",
                                                                        "stem": "mapPiece"
                                                                      },
                                                                      "over": {
                                                                        "query": "tokensInZone",
                                                                        "zone": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__srcSpace",
                                                                        "filter": [
                                                                          {
                                                                            "prop": "type",
                                                                            "op": "eq",
                                                                            "value": "guerrilla"
                                                                          },
                                                                          {
                                                                            "prop": "faction",
                                                                            "op": "eq",
                                                                            "value": "VC"
                                                                          }
                                                                        ]
                                                                      },
                                                                      "effects": [
                                                                        {
                                                                          "moveToken": {
                                                                            "token": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__mapPiece",
                                                                            "from": "$__macro_place_from_available_or_map_actionPipelines_9__stages_1__effects_0__forEach_effects_1__let_in_1__if_then_1__if_then_0__let_in_0__srcSpace",
                                                                            "to": "$space"
                                                                          }
                                                                        }
                                                                      ],
                                                                      "limit": 1
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$withBaseChoice"
                                    },
                                    "right": "flip-underground"
                                  },
                                  "then": [
                                    {
                                      "forEach": {
                                        "bind": "$g",
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$space",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            },
                                            {
                                              "prop": "activity",
                                              "op": "eq",
                                              "value": "active"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "setTokenProp": {
                                              "token": "$g",
                                              "prop": "activity",
                                              "value": "underground"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-cadres-rally-agitate",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_cadres"
                  },
                  "right": "shaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.9.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "$cadresAgitateSpaces",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "max": 1,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$cadresSpace",
                      "over": {
                        "query": "binding",
                        "name": "$cadresAgitateSpaces"
                      },
                      "effects": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": ">",
                                  "left": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$cadresSpace",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "VC"
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "right": 0
                                },
                                {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$cadresSpace",
                                        "prop": "category"
                                      },
                                      "right": "city"
                                    },
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$cadresSpace",
                                        "prop": "category"
                                      },
                                      "right": "province"
                                    }
                                  ]
                                },
                                {
                                  "op": ">",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$cadresSpace",
                                    "prop": "population"
                                  },
                                  "right": 0
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$cadresSpace",
                                    "marker": "supportOpposition"
                                  },
                                  "right": "activeOpposition"
                                }
                              ]
                            },
                            "then": [
                              {
                                "shiftMarker": {
                                  "space": "$cadresSpace",
                                  "marker": "supportOpposition",
                                  "delta": -1
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "march-nva-profile",
      "actionId": "march",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-destinations",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.10.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "nvaResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInAdjacentZones",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "guerrilla",
                                            "troops"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.10.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "nvaResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInAdjacentZones",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "guerrilla",
                                            "troops"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "nvaResources"
                                },
                                "right": 0
                              },
                              "then": {
                                "ref": "gvar",
                                "var": "nvaResources"
                              },
                              "else": 99
                            }
                          }
                        }
                      },
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-destination",
          "effects": [
            {
              "forEach": {
                "bind": "$destSpace",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.10.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$movingGuerrillas@{$destSpace}",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$destSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.10.stages[1].effects.0.forEach.effects.1.chooseN",
                      "bind": "$movingTroops@{$destSpace}",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$destSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "let": {
                      "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__movingCount",
                      "value": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "binding",
                              "name": "$movingGuerrillas@{$destSpace}"
                            }
                          }
                        },
                        "right": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "binding",
                              "name": "$movingTroops@{$destSpace}"
                            }
                          }
                        }
                      },
                      "in": [
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "binding",
                                "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__movingCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": true,
                                        "right": true
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "gvar",
                                          "var": "trail"
                                        },
                                        "right": 4
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "country"
                                            },
                                            "right": "laos"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "country"
                                            },
                                            "right": "cambodia"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  "then": [],
                                  "else": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "binding",
                                                "name": "__freeOperation"
                                              },
                                              "right": true
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$destSpace",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "addVar": {
                                              "scope": "global",
                                              "var": "nvaResources",
                                              "delta": -1
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece",
                                  "macroOrigin": {
                                    "macroId": "insurgent-march-resolve-destination",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$movingGuerrillas@{$destSpace}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece"
                                          }
                                        },
                                        "to": "$destSpace"
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece",
                                  "macroOrigin": {
                                    "macroId": "insurgent-march-resolve-destination",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$movingTroops@{$destSpace}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__piece"
                                          }
                                        },
                                        "to": "$destSpace"
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "let": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__isLocOrSupport",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "or",
                                            "args": [
                                              {
                                                "op": "==",
                                                "left": {
                                                  "ref": "markerState",
                                                  "space": "$destSpace",
                                                  "marker": "supportOpposition"
                                                },
                                                "right": "passiveSupport"
                                              },
                                              {
                                                "op": "==",
                                                "left": {
                                                  "ref": "markerState",
                                                  "space": "$destSpace",
                                                  "marker": "supportOpposition"
                                                },
                                                "right": "activeSupport"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      "then": true,
                                      "else": false
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__coinCount",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$destSpace",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "US",
                                                    "ARVN"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "in",
                                                  "value": [
                                                    "troops",
                                                    "police",
                                                    "irregular",
                                                    "ranger"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__isLocOrSupport"
                                                    },
                                                    "right": true
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "op": "+",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__movingCount"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__coinCount"
                                                      }
                                                    },
                                                    "right": 3
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__movedPiece",
                                                    "macroOrigin": {
                                                      "macroId": "insurgent-march-resolve-destination",
                                                      "stem": "movedPiece"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$movingGuerrillas@{$destSpace}"
                                                    },
                                                    "effects": [
                                                      {
                                                        "setTokenProp": {
                                                          "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__movedPiece",
                                                          "prop": "activity",
                                                          "value": "active"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 99
                                                  }
                                                },
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "==",
                                                          "left": {
                                                            "ref": "gvar",
                                                            "var": "mom_claymores"
                                                          },
                                                          "right": true
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "binding",
                                                                "name": "$movingGuerrillas@{$destSpace}"
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__claymoresRemoved",
                                                          "macroOrigin": {
                                                            "macroId": "insurgent-march-resolve-destination",
                                                            "stem": "claymoresRemoved"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$movingGuerrillas@{$destSpace}"
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__claymoresRemoved",
                                                                "from": {
                                                                  "zoneExpr": {
                                                                    "ref": "tokenZone",
                                                                    "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_1__effects_0__forEach_effects_0__claymoresRemoved"
                                                                  }
                                                                },
                                                                "to": {
                                                                  "zoneExpr": {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "==",
                                                                        "left": "NVA",
                                                                        "right": "NVA"
                                                                      },
                                                                      "then": "available-NVA:none",
                                                                      "else": "available-VC:none"
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "select-trail-chain-destinations",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "and",
                  "args": [
                    {
                      "op": ">",
                      "left": {
                        "ref": "gvar",
                        "var": "trail"
                      },
                      "right": 0
                    },
                    {
                      "op": "!=",
                      "left": {
                        "ref": "binding",
                        "name": "__actionClass"
                      },
                      "right": "limitedOperation"
                    }
                  ]
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.10.stages[2].effects.0.if.then.0.chooseN",
                      "bind": "chainSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "or",
                            "args": [
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "laos"
                              },
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "cambodia"
                              }
                            ]
                          }
                        }
                      },
                      "max": 99,
                      "min": 0
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-trail-chain-destinations",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "and",
                  "args": [
                    {
                      "op": ">",
                      "left": {
                        "ref": "gvar",
                        "var": "trail"
                      },
                      "right": 0
                    },
                    {
                      "op": "!=",
                      "left": {
                        "ref": "binding",
                        "name": "__actionClass"
                      },
                      "right": "limitedOperation"
                    }
                  ]
                },
                "then": [
                  {
                    "forEach": {
                      "bind": "$destSpace",
                      "over": {
                        "query": "binding",
                        "name": "chainSpaces"
                      },
                      "effects": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.10.stages[3].effects.0.if.then.0.forEach.effects.0.chooseN",
                            "bind": "$movingGuerrillas@{$destSpace}",
                            "options": {
                              "query": "tokensInAdjacentZones",
                              "zone": "$destSpace",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "NVA"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                }
                              ]
                            },
                            "max": 99,
                            "min": 0
                          }
                        },
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.10.stages[3].effects.0.if.then.0.forEach.effects.1.chooseN",
                            "bind": "$movingTroops@{$destSpace}",
                            "options": {
                              "query": "tokensInAdjacentZones",
                              "zone": "$destSpace",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "NVA"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            "max": 99,
                            "min": 0
                          }
                        },
                        {
                          "let": {
                            "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__movingCount",
                            "value": {
                              "op": "+",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "binding",
                                    "name": "$movingGuerrillas@{$destSpace}"
                                  }
                                }
                              },
                              "right": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "binding",
                                    "name": "$movingTroops@{$destSpace}"
                                  }
                                }
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__movingCount"
                                    },
                                    "right": 0
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": true,
                                              "right": true
                                            },
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "gvar",
                                                "var": "trail"
                                              },
                                              "right": 4
                                            },
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "==",
                                                  "left": {
                                                    "ref": "zoneProp",
                                                    "zone": "$destSpace",
                                                    "prop": "country"
                                                  },
                                                  "right": "laos"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": {
                                                    "ref": "zoneProp",
                                                    "zone": "$destSpace",
                                                    "prop": "country"
                                                  },
                                                  "right": "cambodia"
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        "then": [],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "!=",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "__freeOperation"
                                                    },
                                                    "right": true
                                                  },
                                                  {
                                                    "op": "!=",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$destSpace",
                                                      "prop": "category"
                                                    },
                                                    "right": "loc"
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "addVar": {
                                                    "scope": "global",
                                                    "var": "nvaResources",
                                                    "delta": -1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece",
                                        "macroOrigin": {
                                          "macroId": "insurgent-march-resolve-destination",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$movingGuerrillas@{$destSpace}"
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "ref": "tokenZone",
                                                  "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece"
                                                }
                                              },
                                              "to": "$destSpace"
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece",
                                        "macroOrigin": {
                                          "macroId": "insurgent-march-resolve-destination",
                                          "stem": "piece"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$movingTroops@{$destSpace}"
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece",
                                              "from": {
                                                "zoneExpr": {
                                                  "ref": "tokenZone",
                                                  "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__piece"
                                                }
                                              },
                                              "to": "$destSpace"
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "let": {
                                        "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__isLocOrSupport",
                                        "value": {
                                          "if": {
                                            "when": {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "==",
                                                  "left": {
                                                    "ref": "zoneProp",
                                                    "zone": "$destSpace",
                                                    "prop": "category"
                                                  },
                                                  "right": "loc"
                                                },
                                                {
                                                  "op": "or",
                                                  "args": [
                                                    {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "markerState",
                                                        "space": "$destSpace",
                                                        "marker": "supportOpposition"
                                                      },
                                                      "right": "passiveSupport"
                                                    },
                                                    {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "markerState",
                                                        "space": "$destSpace",
                                                        "marker": "supportOpposition"
                                                      },
                                                      "right": "activeSupport"
                                                    }
                                                  ]
                                                }
                                              ]
                                            },
                                            "then": true,
                                            "else": false
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__coinCount",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$destSpace",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "US",
                                                          "ARVN"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "in",
                                                        "value": [
                                                          "troops",
                                                          "police",
                                                          "irregular",
                                                          "ranger"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "==",
                                                          "left": {
                                                            "ref": "binding",
                                                            "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__isLocOrSupport"
                                                          },
                                                          "right": true
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "op": "+",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__movingCount"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__coinCount"
                                                            }
                                                          },
                                                          "right": 3
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__movedPiece",
                                                          "macroOrigin": {
                                                            "macroId": "insurgent-march-resolve-destination",
                                                            "stem": "movedPiece"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$movingGuerrillas@{$destSpace}"
                                                          },
                                                          "effects": [
                                                            {
                                                              "setTokenProp": {
                                                                "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__movedPiece",
                                                                "prop": "activity",
                                                                "value": "active"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 99
                                                        }
                                                      },
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": "and",
                                                            "args": [
                                                              {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "gvar",
                                                                  "var": "mom_claymores"
                                                                },
                                                                "right": true
                                                              },
                                                              {
                                                                "op": ">",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "binding",
                                                                      "name": "$movingGuerrillas@{$destSpace}"
                                                                    }
                                                                  }
                                                                },
                                                                "right": 0
                                                              }
                                                            ]
                                                          },
                                                          "then": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__claymoresRemoved",
                                                                "macroOrigin": {
                                                                  "macroId": "insurgent-march-resolve-destination",
                                                                  "stem": "claymoresRemoved"
                                                                },
                                                                "over": {
                                                                  "query": "binding",
                                                                  "name": "$movingGuerrillas@{$destSpace}"
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__claymoresRemoved",
                                                                      "from": {
                                                                        "zoneExpr": {
                                                                          "ref": "tokenZone",
                                                                          "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_10__stages_3__effects_0__if_then_0__forEach_effects_0__claymoresRemoved"
                                                                        }
                                                                      },
                                                                      "to": {
                                                                        "zoneExpr": {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "==",
                                                                              "left": "NVA",
                                                                              "right": "NVA"
                                                                            },
                                                                            "then": "available-NVA:none",
                                                                            "else": "available-VC:none"
                                                                          }
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "march-vc-profile",
      "actionId": "march",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-destinations",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.11.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "vcResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInAdjacentZones",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "guerrilla",
                                            "troops"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.11.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "vcResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInAdjacentZones",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "in",
                                          "value": [
                                            "guerrilla",
                                            "troops"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "vcResources"
                                },
                                "right": 0
                              },
                              "then": {
                                "ref": "gvar",
                                "var": "vcResources"
                              },
                              "else": 99
                            }
                          }
                        }
                      },
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-destination",
          "effects": [
            {
              "forEach": {
                "bind": "$destSpace",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.11.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$movingGuerrillas@{$destSpace}",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$destSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.11.stages[1].effects.0.forEach.effects.1.chooseN",
                      "bind": "$movingTroops@{$destSpace}",
                      "options": {
                        "query": "tokensInAdjacentZones",
                        "zone": "$destSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "let": {
                      "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__movingCount",
                      "value": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "binding",
                              "name": "$movingGuerrillas@{$destSpace}"
                            }
                          }
                        },
                        "right": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "binding",
                              "name": "$movingTroops@{$destSpace}"
                            }
                          }
                        }
                      },
                      "in": [
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "binding",
                                "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__movingCount"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": false,
                                        "right": true
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "gvar",
                                          "var": "trail"
                                        },
                                        "right": 4
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "country"
                                            },
                                            "right": "laos"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "country"
                                            },
                                            "right": "cambodia"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  "then": [],
                                  "else": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "binding",
                                                "name": "__freeOperation"
                                              },
                                              "right": true
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$destSpace",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "addVar": {
                                              "scope": "global",
                                              "var": "vcResources",
                                              "delta": -1
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece",
                                  "macroOrigin": {
                                    "macroId": "insurgent-march-resolve-destination",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$movingGuerrillas@{$destSpace}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece"
                                          }
                                        },
                                        "to": "$destSpace"
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece",
                                  "macroOrigin": {
                                    "macroId": "insurgent-march-resolve-destination",
                                    "stem": "piece"
                                  },
                                  "over": {
                                    "query": "binding",
                                    "name": "$movingTroops@{$destSpace}"
                                  },
                                  "effects": [
                                    {
                                      "moveToken": {
                                        "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece",
                                        "from": {
                                          "zoneExpr": {
                                            "ref": "tokenZone",
                                            "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__piece"
                                          }
                                        },
                                        "to": "$destSpace"
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "let": {
                                  "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__isLocOrSupport",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$destSpace",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "or",
                                            "args": [
                                              {
                                                "op": "==",
                                                "left": {
                                                  "ref": "markerState",
                                                  "space": "$destSpace",
                                                  "marker": "supportOpposition"
                                                },
                                                "right": "passiveSupport"
                                              },
                                              {
                                                "op": "==",
                                                "left": {
                                                  "ref": "markerState",
                                                  "space": "$destSpace",
                                                  "marker": "supportOpposition"
                                                },
                                                "right": "activeSupport"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      "then": true,
                                      "else": false
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__coinCount",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$destSpace",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "US",
                                                    "ARVN"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "in",
                                                  "value": [
                                                    "troops",
                                                    "police",
                                                    "irregular",
                                                    "ranger"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__isLocOrSupport"
                                                    },
                                                    "right": true
                                                  },
                                                  {
                                                    "op": ">",
                                                    "left": {
                                                      "op": "+",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__movingCount"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__coinCount"
                                                      }
                                                    },
                                                    "right": 3
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__movedPiece",
                                                    "macroOrigin": {
                                                      "macroId": "insurgent-march-resolve-destination",
                                                      "stem": "movedPiece"
                                                    },
                                                    "over": {
                                                      "query": "binding",
                                                      "name": "$movingGuerrillas@{$destSpace}"
                                                    },
                                                    "effects": [
                                                      {
                                                        "setTokenProp": {
                                                          "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__movedPiece",
                                                          "prop": "activity",
                                                          "value": "active"
                                                        }
                                                      }
                                                    ],
                                                    "limit": {
                                                      "if": {
                                                        "when": {
                                                          "op": "==",
                                                          "left": {
                                                            "ref": "globalMarkerState",
                                                            "marker": "cap_mainForceBns"
                                                          },
                                                          "right": "unshaded"
                                                        },
                                                        "then": 99,
                                                        "else": 1
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": "==",
                                                          "left": {
                                                            "ref": "gvar",
                                                            "var": "mom_claymores"
                                                          },
                                                          "right": true
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "binding",
                                                                "name": "$movingGuerrillas@{$destSpace}"
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__claymoresRemoved",
                                                          "macroOrigin": {
                                                            "macroId": "insurgent-march-resolve-destination",
                                                            "stem": "claymoresRemoved"
                                                          },
                                                          "over": {
                                                            "query": "binding",
                                                            "name": "$movingGuerrillas@{$destSpace}"
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__claymoresRemoved",
                                                                "from": {
                                                                  "zoneExpr": {
                                                                    "ref": "tokenZone",
                                                                    "token": "$__macro_insurgent_march_resolve_destination_actionPipelines_11__stages_1__effects_0__forEach_effects_0__claymoresRemoved"
                                                                  }
                                                                },
                                                                "to": {
                                                                  "zoneExpr": {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "==",
                                                                        "left": "VC",
                                                                        "right": "NVA"
                                                                      },
                                                                      "then": "available-NVA:none",
                                                                      "else": "available-VC:none"
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "attack-nva-profile",
      "actionId": "attack",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.12.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.12.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "ref": "gvar",
                            "var": "nvaResources"
                          }
                        }
                      },
                      "min": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 1,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "nvaResources"
                                },
                                "right": 0
                              },
                              "then": 1,
                              "else": 0
                            }
                          }
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cost-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "binding",
                          "name": "__freeOperation"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_pt76"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "removeByPriority": {
                                  "budget": 1,
                                  "groups": [
                                    {
                                      "bind": "$pt76CostTroop",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "NVA"
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "troops"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": "available-NVA:none"
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "nvaResources",
                                  "delta": -1
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.12.stages[2].effects.0.forEach.effects.0.chooseOne",
                      "bind": "$attackMode",
                      "options": {
                        "query": "enums",
                        "values": [
                          "guerrilla-attack",
                          "troops-attack"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$attackMode"
                        },
                        "right": "guerrilla-attack"
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$g",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "NVA"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$g",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ]
                          }
                        },
                        {
                          "let": {
                            "bind": "$guerrillaCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "NVA"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "guerrilla"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "rollRandom": {
                                  "bind": "$dieRoll",
                                  "min": 1,
                                  "max": 6,
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "<=",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$dieRoll"
                                          },
                                          "right": {
                                            "ref": "binding",
                                            "name": "$guerrillaCount"
                                          }
                                        },
                                        "then": [
                                          {
                                            "let": {
                                              "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesBefore",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "removeByPriority": {
                                                    "budget": 2,
                                                    "groups": [
                                                      {
                                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "US"
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "neq",
                                                              "value": "base"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": "casualties-US:none"
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "insurgent-attack-removal-order",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "ARVN"
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "neq",
                                                              "value": "base"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": "available-ARVN:none"
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "insurgent-attack-removal-order",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "US"
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "base"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": "casualties-US:none"
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "insurgent-attack-removal-order",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "ARVN"
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "base"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": "available-ARVN:none"
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "insurgent-attack-removal-order",
                                                          "stem": "target"
                                                        }
                                                      }
                                                    ],
                                                    "macroOrigin": {
                                                      "macroId": "insurgent-attack-removal-order",
                                                      "stem": "target"
                                                    }
                                                  }
                                                },
                                                {
                                                  "let": {
                                                    "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesAfter",
                                                    "value": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "eq",
                                                              "value": "US"
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved",
                                                          "value": {
                                                            "op": "-",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesBefore"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesAfter"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": ">",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved"
                                                                  },
                                                                  "right": 0
                                                                },
                                                                "then": [
                                                                  {
                                                                    "forEach": {
                                                                      "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__attritionPiece",
                                                                      "macroOrigin": {
                                                                        "macroId": "insurgent-attack-removal-order",
                                                                        "stem": "attritionPiece"
                                                                      },
                                                                      "over": {
                                                                        "query": "tokensInZone",
                                                                        "zone": "$space",
                                                                        "filter": [
                                                                          {
                                                                            "prop": "faction",
                                                                            "op": "eq",
                                                                            "value": "NVA"
                                                                          }
                                                                        ]
                                                                      },
                                                                      "effects": [
                                                                        {
                                                                          "moveToken": {
                                                                            "token": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__attritionPiece",
                                                                            "from": "$space",
                                                                            "to": {
                                                                              "zoneExpr": {
                                                                                "concat": [
                                                                                  "available-",
                                                                                  "NVA",
                                                                                  ":none"
                                                                                ]
                                                                              }
                                                                            }
                                                                          }
                                                                        }
                                                                      ],
                                                                      "limit": {
                                                                        "ref": "binding",
                                                                        "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_1__if_then_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved"
                                                                      }
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$attackMode"
                        },
                        "right": "troops-attack"
                      },
                      "then": [
                        {
                          "let": {
                            "bind": "$nvaTroops",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "NVA"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$damage",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "==",
                                        "left": {
                                          "ref": "globalMarkerState",
                                          "marker": "cap_pt76"
                                        },
                                        "right": "shaded"
                                      },
                                      "then": {
                                        "ref": "binding",
                                        "name": "$nvaTroops"
                                      },
                                      "else": {
                                        "op": "/",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$nvaTroops"
                                        },
                                        "right": 2
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usPiecesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "removeByPriority": {
                                              "budget": {
                                                "ref": "binding",
                                                "name": "$damage"
                                              },
                                              "groups": [
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "insurgent-attack-removal-order",
                                                "stem": "target"
                                              }
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usPiecesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usPiecesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usPiecesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__attritionPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "insurgent-attack-removal-order",
                                                                  "stem": "attritionPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "NVA"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__attritionPiece",
                                                                      "from": "$space",
                                                                      "to": {
                                                                        "zoneExpr": {
                                                                          "concat": [
                                                                            "available-",
                                                                            "NVA",
                                                                            ":none"
                                                                          ]
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": {
                                                                  "ref": "binding",
                                                                  "name": "$__macro_insurgent_attack_removal_order_actionPipelines_12__stages_2__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__usRemoved"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "attack-vc-profile",
      "actionId": "attack",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.13.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.13.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "ref": "gvar",
                            "var": "vcResources"
                          }
                        }
                      },
                      "min": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 1,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "vcResources"
                                },
                                "right": 0
                              },
                              "then": 1,
                              "else": 0
                            }
                          }
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cost-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "binding",
                          "name": "__freeOperation"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "vcResources",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "forEach": {
                      "bind": "$g",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "effects": [
                        {
                          "setTokenProp": {
                            "token": "$g",
                            "prop": "activity",
                            "value": "active"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$guerrillaCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "VC"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "guerrilla"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "rollRandom": {
                            "bind": "$dieRoll",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "<=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$dieRoll"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$guerrillaCount"
                                    }
                                  },
                                  "then": [
                                    {
                                      "let": {
                                        "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesBefore",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "removeByPriority": {
                                              "budget": 2,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-attack-removal-order",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "insurgent-attack-removal-order",
                                                "stem": "target"
                                              }
                                            }
                                          },
                                          {
                                            "let": {
                                              "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesAfter",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved",
                                                    "value": {
                                                      "op": "-",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesBefore"
                                                      },
                                                      "right": {
                                                        "ref": "binding",
                                                        "name": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usPiecesAfter"
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__attritionPiece",
                                                                "macroOrigin": {
                                                                  "macroId": "insurgent-attack-removal-order",
                                                                  "stem": "attritionPiece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__attritionPiece",
                                                                      "from": "$space",
                                                                      "to": {
                                                                        "zoneExpr": {
                                                                          "concat": [
                                                                            "available-",
                                                                            "VC",
                                                                            ":none"
                                                                          ]
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": {
                                                                  "ref": "binding",
                                                                  "name": "$__macro_insurgent_attack_removal_order_actionPipelines_13__stages_2__effects_0__forEach_effects_1__let_in_0__rollRandom_in_0__if_then_0__usRemoved"
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "terror-nva-profile",
      "actionId": "terror",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.14.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            },
                                            {
                                              "prop": "activity",
                                              "op": "eq",
                                              "value": "underground"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": true,
                                        "right": true
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "NVA"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "nvaResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.14.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            },
                                            {
                                              "prop": "activity",
                                              "op": "eq",
                                              "value": "underground"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": true,
                                        "right": true
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "NVA"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "nvaResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "nvaResources"
                                },
                                "right": 0
                              },
                              "then": {
                                "ref": "gvar",
                                "var": "nvaResources"
                              },
                              "else": 99
                            }
                          }
                        }
                      },
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "!=",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        ]
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "nvaResources",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "or",
                        "args": [
                          {
                            "op": "!=",
                            "left": "NVA",
                            "right": "VC"
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "globalMarkerState",
                              "marker": "cap_cadres"
                            },
                            "right": "unshaded"
                          }
                        ]
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$__macro_insurgent_terror_resolve_space_actionPipelines_14__stages_1__effects_0__forEach_effects_0__g",
                            "macroOrigin": {
                              "macroId": "insurgent-terror-resolve-space",
                              "stem": "g"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "NVA"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$__macro_insurgent_terror_resolve_space_actionPipelines_14__stages_1__effects_0__forEach_effects_0__g",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$space",
                          "prop": "category"
                        },
                        "right": "loc"
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$space",
                                    "marker": "sabotage"
                                  },
                                  "right": "sabotage"
                                },
                                {
                                  "op": "<",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "terrorSabotageMarkersPlaced"
                                  },
                                  "right": 15
                                }
                              ]
                            },
                            "then": [
                              {
                                "setMarker": {
                                  "space": "$space",
                                  "marker": "sabotage",
                                  "state": "sabotage"
                                }
                              },
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "terrorSabotageMarkersPlaced",
                                  "delta": 1
                                }
                              }
                            ]
                          }
                        }
                      ],
                      "else": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$space",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                },
                                {
                                  "op": "<",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "terrorSabotageMarkersPlaced"
                                  },
                                  "right": 15
                                }
                              ]
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "zoneVar",
                                  "zone": "$space",
                                  "var": "terrorCount",
                                  "delta": 1
                                }
                              },
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "terrorSabotageMarkersPlaced",
                                  "delta": 1
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": true,
                              "right": true
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "or",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$space",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "passiveSupport"
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$space",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "activeSupport"
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "shiftMarker": {
                                        "space": "$space",
                                        "marker": "supportOpposition",
                                        "delta": -1
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "if": {
                                  "when": {
                                    "op": "!=",
                                    "left": {
                                      "ref": "markerState",
                                      "space": "$space",
                                      "marker": "supportOpposition"
                                    },
                                    "right": "activeOpposition"
                                  },
                                  "then": [
                                    {
                                      "shiftMarker": {
                                        "space": "$space",
                                        "marker": "supportOpposition",
                                        "delta": -1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "terror-vc-profile",
      "actionId": "terror",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "__actionClass"
                  },
                  "right": "limitedOperation"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.15.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            },
                                            {
                                              "prop": "activity",
                                              "op": "eq",
                                              "value": "underground"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": false,
                                        "right": true
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "VC"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "vcResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.15.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "guerrilla"
                                            },
                                            {
                                              "prop": "activity",
                                              "op": "eq",
                                              "value": "underground"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": false,
                                        "right": true
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "VC"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "binding",
                                              "name": "__freeOperation"
                                            },
                                            "right": true
                                          },
                                          {
                                            "op": ">",
                                            "left": {
                                              "ref": "gvar",
                                              "var": "vcResources"
                                            },
                                            "right": 0
                                          }
                                        ]
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "province"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": {
                        "if": {
                          "when": {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          "then": 99,
                          "else": {
                            "if": {
                              "when": {
                                "op": ">",
                                "left": {
                                  "ref": "gvar",
                                  "var": "vcResources"
                                },
                                "right": 0
                              },
                              "then": {
                                "ref": "gvar",
                                "var": "vcResources"
                              },
                              "else": 99
                            }
                          }
                        }
                      },
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "!=",
                            "left": {
                              "ref": "binding",
                              "name": "__freeOperation"
                            },
                            "right": true
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "category"
                            },
                            "right": "loc"
                          }
                        ]
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "vcResources",
                            "delta": -1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "or",
                        "args": [
                          {
                            "op": "!=",
                            "left": "VC",
                            "right": "VC"
                          },
                          {
                            "op": "!=",
                            "left": {
                              "ref": "globalMarkerState",
                              "marker": "cap_cadres"
                            },
                            "right": "unshaded"
                          }
                        ]
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$__macro_insurgent_terror_resolve_space_actionPipelines_15__stages_1__effects_0__forEach_effects_0__g",
                            "macroOrigin": {
                              "macroId": "insurgent-terror-resolve-space",
                              "stem": "g"
                            },
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "VC"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "guerrilla"
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$__macro_insurgent_terror_resolve_space_actionPipelines_15__stages_1__effects_0__forEach_effects_0__g",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": 1
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$space",
                          "prop": "category"
                        },
                        "right": "loc"
                      },
                      "then": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$space",
                                    "marker": "sabotage"
                                  },
                                  "right": "sabotage"
                                },
                                {
                                  "op": "<",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "terrorSabotageMarkersPlaced"
                                  },
                                  "right": 15
                                }
                              ]
                            },
                            "then": [
                              {
                                "setMarker": {
                                  "space": "$space",
                                  "marker": "sabotage",
                                  "state": "sabotage"
                                }
                              },
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "terrorSabotageMarkersPlaced",
                                  "delta": 1
                                }
                              }
                            ]
                          }
                        }
                      ],
                      "else": [
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$space",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                },
                                {
                                  "op": "<",
                                  "left": {
                                    "ref": "gvar",
                                    "var": "terrorSabotageMarkersPlaced"
                                  },
                                  "right": 15
                                }
                              ]
                            },
                            "then": [
                              {
                                "addVar": {
                                  "scope": "zoneVar",
                                  "zone": "$space",
                                  "var": "terrorCount",
                                  "delta": 1
                                }
                              },
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "terrorSabotageMarkersPlaced",
                                  "delta": 1
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": false,
                              "right": true
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "or",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$space",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "passiveSupport"
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "markerState",
                                          "space": "$space",
                                          "marker": "supportOpposition"
                                        },
                                        "right": "activeSupport"
                                      }
                                    ]
                                  },
                                  "then": [
                                    {
                                      "shiftMarker": {
                                        "space": "$space",
                                        "marker": "supportOpposition",
                                        "delta": -1
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "if": {
                                  "when": {
                                    "op": "!=",
                                    "left": {
                                      "ref": "markerState",
                                      "space": "$space",
                                      "marker": "supportOpposition"
                                    },
                                    "right": "activeOpposition"
                                  },
                                  "then": [
                                    {
                                      "shiftMarker": {
                                        "space": "$space",
                                        "marker": "supportOpposition",
                                        "delta": -1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "advise-profile",
      "actionId": "advise",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "accompanyingOps": [
        "train",
        "patrol"
      ],
      "compoundParamConstraints": [
        {
          "relation": "disjoint",
          "operationParam": "targetSpaces",
          "specialActivityParam": "targetSpaces"
        }
      ],
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "gvar",
                    "var": "mom_typhoonKate"
                  },
                  "right": true
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.16.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.16.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              }
                            ]
                          }
                        }
                      },
                      "max": 2,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": ">",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "lookahead:none",
                              "filter": [
                                {
                                  "prop": "isCoup",
                                  "op": "eq",
                                  "value": true
                                }
                              ]
                            }
                          }
                        },
                        "right": 0
                      },
                      "then": [
                        {
                          "chooseOne": {
                            "internalDecisionId": "decision:doc.actionPipelines.16.stages[1].effects.0.forEach.effects.0.if.then.0.chooseOne",
                            "bind": "$adviseMode@{$space}",
                            "options": {
                              "query": "enums",
                              "values": [
                                "assault",
                                "activate-remove"
                              ]
                            }
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseOne": {
                            "internalDecisionId": "decision:doc.actionPipelines.16.stages[1].effects.0.forEach.effects.0.if.else.0.chooseOne",
                            "bind": "$adviseMode@{$space}",
                            "options": {
                              "query": "enums",
                              "values": [
                                "sweep",
                                "assault",
                                "activate-remove"
                              ]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$adviseMode@{$space}"
                        },
                        "right": "sweep"
                      },
                      "then": [
                        {
                          "let": {
                            "bind": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__cubeCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "in",
                                      "value": [
                                        "troops",
                                        "police"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__sfCount",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "ARVN"
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "ranger"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__totalSweepers",
                                        "value": {
                                          "op": "+",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__cubeCount"
                                          },
                                          "right": {
                                            "ref": "binding",
                                            "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__sfCount"
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__activationLimit",
                                              "value": {
                                                "if": {
                                                  "when": {
                                                    "op": "zonePropIncludes",
                                                    "zone": "$space",
                                                    "prop": "terrainTags",
                                                    "value": "jungle"
                                                  },
                                                  "then": {
                                                    "op": "/",
                                                    "left": {
                                                      "ref": "binding",
                                                      "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__totalSweepers"
                                                    },
                                                    "right": 2
                                                  },
                                                  "else": {
                                                    "ref": "binding",
                                                    "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__totalSweepers"
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": ">",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__activationLimit"
                                                      },
                                                      "right": 0
                                                    },
                                                    "then": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__guerrilla",
                                                          "macroOrigin": {
                                                            "macroId": "sweep-activation",
                                                            "stem": "guerrilla"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$space",
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "guerrilla"
                                                              },
                                                              {
                                                                "prop": "activity",
                                                                "op": "eq",
                                                                "value": "underground"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "setTokenProp": {
                                                                "token": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__guerrilla",
                                                                "prop": "activity",
                                                                "value": "active"
                                                              }
                                                            }
                                                          ],
                                                          "limit": {
                                                            "ref": "binding",
                                                            "name": "$__macro_sweep_activation_actionPipelines_16__stages_1__effects_0__forEach_effects_1__if_then_0__activationLimit"
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$adviseMode@{$space}"
                        },
                        "right": "assault"
                      },
                      "then": [
                        {
                          "let": {
                            "bind": "$isProvince",
                            "value": {
                              "if": {
                                "when": {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$space",
                                    "prop": "category"
                                  },
                                  "right": "province"
                                },
                                "then": 1,
                                "else": 0
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$arvnCubes",
                                  "value": {
                                    "if": {
                                      "when": {
                                        "op": "==",
                                        "left": {
                                          "ref": "binding",
                                          "name": "$isProvince"
                                        },
                                        "right": 1
                                      },
                                      "then": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$space",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "ARVN"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "troops"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "else": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$space",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "ARVN"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "in",
                                                "value": [
                                                  "troops",
                                                  "police"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "let": {
                                        "bind": "$damage",
                                        "value": {
                                          "if": {
                                            "when": {
                                              "op": "zonePropIncludes",
                                              "zone": "$space",
                                              "prop": "terrainTags",
                                              "value": "highland"
                                            },
                                            "then": {
                                              "op": "/",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$arvnCubes"
                                              },
                                              "right": 3
                                            },
                                            "else": {
                                              "op": "/",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$arvnCubes"
                                              },
                                              "right": 2
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "let": {
                                              "bind": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesBefore",
                                              "value": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "in": [
                                                {
                                                  "let": {
                                                    "bind": "$damage",
                                                    "value": {
                                                      "ref": "binding",
                                                      "name": "$damage"
                                                    },
                                                    "in": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$damage"
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "chooseOne": {
                                                                "internalDecisionId": "decision:doc.actionPipelines.16.stages[1].effects.0.forEach.effects.2.if.then.0.let.in.0.let.in.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                                                "bind": "$targetFactionFirst",
                                                                "options": {
                                                                  "query": "enums",
                                                                  "values": [
                                                                    "NVA",
                                                                    "VC"
                                                                  ]
                                                                }
                                                              }
                                                            },
                                                            {
                                                              "let": {
                                                                "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond",
                                                                "value": {
                                                                  "if": {
                                                                    "when": {
                                                                      "op": "==",
                                                                      "left": {
                                                                        "ref": "binding",
                                                                        "name": "$targetFactionFirst"
                                                                      },
                                                                      "right": "NVA"
                                                                    },
                                                                    "then": "VC",
                                                                    "else": "NVA"
                                                                  }
                                                                },
                                                                "in": [
                                                                  {
                                                                    "removeByPriority": {
                                                                      "budget": {
                                                                        "ref": "binding",
                                                                        "name": "$damage"
                                                                      },
                                                                      "groups": [
                                                                        {
                                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                          "over": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$space",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "type",
                                                                                "op": "eq",
                                                                                "value": "troops"
                                                                              },
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "in",
                                                                                "value": [
                                                                                  "NVA",
                                                                                  "VC"
                                                                                ]
                                                                              }
                                                                            ]
                                                                          },
                                                                          "to": {
                                                                            "zoneExpr": {
                                                                              "concat": [
                                                                                "available-",
                                                                                {
                                                                                  "ref": "tokenProp",
                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                                  "prop": "faction"
                                                                                },
                                                                                ":none"
                                                                              ]
                                                                            }
                                                                          },
                                                                          "countBind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__troopsRemoved",
                                                                          "macroOrigin": {
                                                                            "macroId": "piece-removal-ordering",
                                                                            "stem": "target"
                                                                          }
                                                                        },
                                                                        {
                                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                          "over": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$space",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "type",
                                                                                "op": "eq",
                                                                                "value": "guerrilla"
                                                                              },
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "eq",
                                                                                "value": {
                                                                                  "ref": "binding",
                                                                                  "name": "$targetFactionFirst"
                                                                                }
                                                                              },
                                                                              {
                                                                                "prop": "activity",
                                                                                "op": "eq",
                                                                                "value": "active"
                                                                              }
                                                                            ]
                                                                          },
                                                                          "to": {
                                                                            "zoneExpr": {
                                                                              "concat": [
                                                                                "available-",
                                                                                {
                                                                                  "ref": "binding",
                                                                                  "name": "$targetFactionFirst"
                                                                                },
                                                                                ":none"
                                                                              ]
                                                                            }
                                                                          },
                                                                          "countBind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed",
                                                                          "macroOrigin": {
                                                                            "macroId": "piece-removal-ordering",
                                                                            "stem": "target"
                                                                          }
                                                                        },
                                                                        {
                                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__target",
                                                                          "over": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$space",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "type",
                                                                                "op": "eq",
                                                                                "value": "guerrilla"
                                                                              },
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "eq",
                                                                                "value": {
                                                                                  "ref": "binding",
                                                                                  "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                                }
                                                                              },
                                                                              {
                                                                                "prop": "activity",
                                                                                "op": "eq",
                                                                                "value": "active"
                                                                              }
                                                                            ]
                                                                          },
                                                                          "to": {
                                                                            "zoneExpr": {
                                                                              "concat": [
                                                                                "available-",
                                                                                {
                                                                                  "ref": "binding",
                                                                                  "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__targetFactionSecond"
                                                                                },
                                                                                ":none"
                                                                              ]
                                                                            }
                                                                          },
                                                                          "countBind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed",
                                                                          "macroOrigin": {
                                                                            "macroId": "piece-removal-ordering",
                                                                            "stem": "target"
                                                                          }
                                                                        }
                                                                      ],
                                                                      "remainingBind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage",
                                                                      "in": [
                                                                        {
                                                                          "let": {
                                                                            "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved",
                                                                            "value": {
                                                                              "op": "+",
                                                                              "left": {
                                                                                "ref": "binding",
                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas1Removed"
                                                                              },
                                                                              "right": {
                                                                                "ref": "binding",
                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillas2Removed"
                                                                              }
                                                                            },
                                                                            "in": [
                                                                              {
                                                                                "if": {
                                                                                  "when": {
                                                                                    "op": "and",
                                                                                    "args": [
                                                                                      {
                                                                                        "op": "==",
                                                                                        "left": false,
                                                                                        "right": true
                                                                                      },
                                                                                      {
                                                                                        "op": "==",
                                                                                        "left": {
                                                                                          "ref": "gvar",
                                                                                          "var": "mom_bodyCount"
                                                                                        },
                                                                                        "right": true
                                                                                      }
                                                                                    ]
                                                                                  },
                                                                                  "then": [
                                                                                    {
                                                                                      "addVar": {
                                                                                        "scope": "global",
                                                                                        "var": "aid",
                                                                                        "delta": {
                                                                                          "op": "*",
                                                                                          "left": {
                                                                                            "ref": "binding",
                                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemoved"
                                                                                          },
                                                                                          "right": 3
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        },
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": ">",
                                                                              "left": {
                                                                                "ref": "binding",
                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                              },
                                                                              "right": 0
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "let": {
                                                                                  "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining",
                                                                                  "value": {
                                                                                    "aggregate": {
                                                                                      "op": "count",
                                                                                      "query": {
                                                                                        "query": "tokensInZone",
                                                                                        "zone": "$space",
                                                                                        "filter": [
                                                                                          {
                                                                                            "prop": "type",
                                                                                            "op": "eq",
                                                                                            "value": "guerrilla"
                                                                                          },
                                                                                          {
                                                                                            "prop": "faction",
                                                                                            "op": "in",
                                                                                            "value": [
                                                                                              "NVA",
                                                                                              "VC"
                                                                                            ]
                                                                                          },
                                                                                          {
                                                                                            "prop": "activity",
                                                                                            "op": "eq",
                                                                                            "value": "active"
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  },
                                                                                  "in": [
                                                                                    {
                                                                                      "if": {
                                                                                        "when": {
                                                                                          "op": "==",
                                                                                          "left": {
                                                                                            "ref": "binding",
                                                                                            "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__guerrillasRemaining"
                                                                                          },
                                                                                          "right": 0
                                                                                        },
                                                                                        "then": [
                                                                                          {
                                                                                            "forEach": {
                                                                                              "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                              "macroOrigin": {
                                                                                                "macroId": "piece-removal-ordering",
                                                                                                "stem": "baseTarget"
                                                                                              },
                                                                                              "over": {
                                                                                                "query": "tokensInZone",
                                                                                                "zone": "$space",
                                                                                                "filter": [
                                                                                                  {
                                                                                                    "prop": "type",
                                                                                                    "op": "eq",
                                                                                                    "value": "base"
                                                                                                  },
                                                                                                  {
                                                                                                    "prop": "faction",
                                                                                                    "op": "in",
                                                                                                    "value": [
                                                                                                      "NVA",
                                                                                                      "VC"
                                                                                                    ]
                                                                                                  }
                                                                                                ]
                                                                                              },
                                                                                              "effects": [
                                                                                                {
                                                                                                  "if": {
                                                                                                    "when": {
                                                                                                      "op": "==",
                                                                                                      "left": {
                                                                                                        "ref": "tokenProp",
                                                                                                        "token": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                        "prop": "tunnel"
                                                                                                      },
                                                                                                      "right": "tunneled"
                                                                                                    },
                                                                                                    "then": [
                                                                                                      {
                                                                                                        "rollRandom": {
                                                                                                          "bind": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll",
                                                                                                          "min": 1,
                                                                                                          "max": 6,
                                                                                                          "in": [
                                                                                                            {
                                                                                                              "if": {
                                                                                                                "when": {
                                                                                                                  "op": ">=",
                                                                                                                  "left": {
                                                                                                                    "ref": "binding",
                                                                                                                    "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__dieRoll"
                                                                                                                  },
                                                                                                                  "right": 4
                                                                                                                },
                                                                                                                "then": [
                                                                                                                  {
                                                                                                                    "setTokenProp": {
                                                                                                                      "token": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                      "prop": "tunnel",
                                                                                                                      "value": "untunneled"
                                                                                                                    }
                                                                                                                  }
                                                                                                                ]
                                                                                                              }
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      }
                                                                                                    ],
                                                                                                    "else": [
                                                                                                      {
                                                                                                        "moveToken": {
                                                                                                          "token": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                          "from": "$space",
                                                                                                          "to": {
                                                                                                            "zoneExpr": {
                                                                                                              "concat": [
                                                                                                                "available-",
                                                                                                                {
                                                                                                                  "ref": "tokenProp",
                                                                                                                  "token": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__baseTarget",
                                                                                                                  "prop": "faction"
                                                                                                                },
                                                                                                                ":none"
                                                                                                              ]
                                                                                                            }
                                                                                                          }
                                                                                                        }
                                                                                                      }
                                                                                                    ]
                                                                                                  }
                                                                                                }
                                                                                              ],
                                                                                              "limit": {
                                                                                                "ref": "binding",
                                                                                                "name": "$__macro_piece_removal_ordering_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__macro_coin_assault_removal_order__0__let_in_0__remainingDamage"
                                                                                              }
                                                                                            }
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ],
                                                                      "macroOrigin": {
                                                                        "macroId": "piece-removal-ordering",
                                                                        "stem": "remainingDamage"
                                                                      }
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "let": {
                                                    "bind": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesAfter",
                                                    "value": {
                                                      "aggregate": {
                                                        "op": "count",
                                                        "query": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "base"
                                                            },
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesRemoved",
                                                          "value": {
                                                            "op": "-",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesBefore"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesAfter"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": ">",
                                                                  "left": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                                  },
                                                                  "right": 0
                                                                },
                                                                "then": [
                                                                  {
                                                                    "addVar": {
                                                                      "scope": "global",
                                                                      "var": "aid",
                                                                      "delta": {
                                                                        "op": "*",
                                                                        "left": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_coin_assault_removal_order_actionPipelines_16__stages_1__effects_0__forEach_effects_2__if_then_0__let_in_0__let_in_0__let_in_0__basesRemoved"
                                                                        },
                                                                        "right": 6
                                                                      }
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$adviseMode@{$space}"
                        },
                        "right": "activate-remove"
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$friendlySF",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "US",
                                    "ARVN"
                                  ]
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "irregular",
                                    "ranger"
                                  ]
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$friendlySF",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": 1
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": false,
                              "right": true
                            },
                            "then": [
                              {
                                "let": {
                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__undergroundEnemyCount",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "guerrilla"
                                          },
                                          {
                                            "prop": "activity",
                                            "op": "eq",
                                            "value": "underground"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__undergroundEnemyCount"
                                          },
                                          "right": 0
                                        },
                                        "then": [
                                          {
                                            "removeByPriority": {
                                              "budget": 2,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "troops"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "guerrilla"
                                                      },
                                                      {
                                                        "prop": "activity",
                                                        "op": "eq",
                                                        "value": "active"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "us-sa-remove-insurgents",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "removeByPriority": {
                                              "budget": 2,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "troops"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "guerrilla"
                                                      },
                                                      {
                                                        "prop": "activity",
                                                        "op": "eq",
                                                        "value": "active"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "tunnel",
                                                        "op": "neq",
                                                        "value": "tunneled"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "us-sa-remove-insurgents",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "removeByPriority": {
                                  "budget": 2,
                                  "groups": [
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "troops"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    },
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "guerrilla"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    },
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          },
                                          {
                                            "prop": "tunnel",
                                            "op": "neq",
                                            "value": "tunneled"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_16__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    }
                                  ],
                                  "macroOrigin": {
                                    "macroId": "us-sa-remove-insurgents",
                                    "stem": "target"
                                  }
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "optional-aid",
          "effects": [
            {
              "chooseOne": {
                "internalDecisionId": "decision:doc.actionPipelines.16.stages[2].effects.0.chooseOne",
                "bind": "$adviseAid",
                "options": {
                  "query": "enums",
                  "values": [
                    "yes",
                    "no"
                  ]
                }
              }
            },
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "binding",
                    "name": "$adviseAid"
                  },
                  "right": "yes"
                },
                "then": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 6
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "advise-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "adviseCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "us-special-window"
      ]
    },
    {
      "id": "air-lift-profile",
      "actionId": "airLift",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "accompanyingOps": "any",
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "and",
            "args": [
              {
                "op": "!=",
                "left": {
                  "ref": "gvar",
                  "var": "mom_medevacShaded"
                },
                "right": true
              },
              {
                "op": "!=",
                "left": {
                  "ref": "gvar",
                  "var": "mom_typhoonKate"
                },
                "right": true
              }
            ]
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.17.stages[0].effects.0.chooseN",
                "bind": "spaces",
                "options": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "!=",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "country"
                      },
                      "right": "northVietnam"
                    }
                  }
                },
                "max": 4,
                "min": 1
              }
            }
          ]
        },
        {
          "stage": "move-us-troops",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.17.stages[1].effects.0.chooseN",
                "bind": "$usLiftTroops",
                "options": {
                  "query": "tokensInMapSpaces",
                  "spaceFilter": {
                    "condition": {
                      "op": "in",
                      "item": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "id"
                      },
                      "set": {
                        "ref": "binding",
                        "name": "spaces"
                      }
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "US"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                },
                "max": 99,
                "min": 0
              }
            },
            {
              "forEach": {
                "bind": "$usTroop",
                "over": {
                  "query": "binding",
                  "name": "$usLiftTroops"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.17.stages[1].effects.1.forEach.effects.0.chooseOne",
                      "bind": "$usLiftDestination@{$usTroop}",
                      "options": {
                        "query": "binding",
                        "name": "spaces"
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "tokenZone",
                          "token": "$usTroop"
                        },
                        "right": {
                          "ref": "binding",
                          "name": "$usLiftDestination@{$usTroop}"
                        }
                      },
                      "then": [
                        {
                          "moveToken": {
                            "token": "$usTroop",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$usTroop"
                              }
                            },
                            "to": {
                              "zoneExpr": {
                                "ref": "binding",
                                "name": "$usLiftDestination@{$usTroop}"
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "move-coin-lift-pieces",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.17.stages[2].effects.0.chooseN",
                "bind": "$coinLiftPieces",
                "options": {
                  "query": "concat",
                  "sources": [
                    {
                      "query": "tokensInMapSpaces",
                      "spaceFilter": {
                        "condition": {
                          "op": "in",
                          "item": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "id"
                          },
                          "set": {
                            "ref": "binding",
                            "name": "spaces"
                          }
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "ARVN"
                        },
                        {
                          "prop": "type",
                          "op": "in",
                          "value": [
                            "troops",
                            "ranger"
                          ]
                        }
                      ]
                    },
                    {
                      "query": "tokensInMapSpaces",
                      "spaceFilter": {
                        "condition": {
                          "op": "in",
                          "item": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "id"
                          },
                          "set": {
                            "ref": "binding",
                            "name": "spaces"
                          }
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "US"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "irregular"
                        }
                      ]
                    }
                  ]
                },
                "max": 4,
                "min": 0
              }
            },
            {
              "forEach": {
                "bind": "$coinLiftPiece",
                "over": {
                  "query": "binding",
                  "name": "$coinLiftPieces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.17.stages[2].effects.1.forEach.effects.0.chooseOne",
                      "bind": "$coinLiftDestination@{$coinLiftPiece}",
                      "options": {
                        "query": "binding",
                        "name": "spaces"
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "tokenZone",
                          "token": "$coinLiftPiece"
                        },
                        "right": {
                          "ref": "binding",
                          "name": "$coinLiftDestination@{$coinLiftPiece}"
                        }
                      },
                      "then": [
                        {
                          "moveToken": {
                            "token": "$coinLiftPiece",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$coinLiftPiece"
                              }
                            },
                            "to": {
                              "zoneExpr": {
                                "ref": "binding",
                                "name": "$coinLiftDestination@{$coinLiftPiece}"
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "air-lift-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "airLiftCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "us-special-window"
      ]
    },
    {
      "id": "air-strike-profile",
      "actionId": "airStrike",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "accompanyingOps": "any",
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "and",
            "args": [
              {
                "op": "!=",
                "left": {
                  "ref": "gvar",
                  "var": "mom_rollingThunder"
                },
                "right": true
              },
              {
                "op": "!=",
                "left": {
                  "ref": "gvar",
                  "var": "mom_daNang"
                },
                "right": true
              },
              {
                "op": "!=",
                "left": {
                  "ref": "gvar",
                  "var": "mom_bombingPause"
                },
                "right": true
              }
            ]
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.18.stages[0].effects.0.chooseN",
                "bind": "$arcLightNoCoinProvinces",
                "options": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "!=",
                          "left": {
                            "ref": "gvar",
                            "var": "fitl_acesAirStrikeWindow"
                          },
                          "right": true
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "globalMarkerState",
                            "marker": "cap_arcLight"
                          },
                          "right": "unshaded"
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        },
                        {
                          "op": "==",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "in",
                                    "value": [
                                      "US",
                                      "ARVN"
                                    ]
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "max": {
                  "if": {
                    "when": {
                      "op": "and",
                      "args": [
                        {
                          "op": "!=",
                          "left": {
                            "ref": "gvar",
                            "var": "fitl_acesAirStrikeWindow"
                          },
                          "right": true
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "globalMarkerState",
                            "marker": "cap_arcLight"
                          },
                          "right": "unshaded"
                        }
                      ]
                    },
                    "then": 1,
                    "else": 0
                  }
                },
                "min": 0
              }
            },
            {
              "chooseN": {
                "internalDecisionId": "decision:doc.actionPipelines.18.stages[0].effects.1.chooseN",
                "bind": "spaces",
                "options": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "or",
                      "args": [
                        {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "gvar",
                                "var": "fitl_acesAirStrikeWindow"
                              },
                              "right": true
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "province"
                            },
                            {
                              "op": "or",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "country"
                                  },
                                  "right": "northVietnam"
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "country"
                                  },
                                  "right": "laos"
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "country"
                                  },
                                  "right": "cambodia"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "op": "and",
                          "args": [
                            {
                              "op": "!=",
                              "left": {
                                "ref": "gvar",
                                "var": "fitl_acesAirStrikeWindow"
                              },
                              "right": true
                            },
                            {
                              "op": "!=",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "country"
                              },
                              "right": "northVietnam"
                            },
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "in",
                                        "value": [
                                          "US",
                                          "ARVN"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            }
                          ]
                        }
                      ]
                    }
                  }
                },
                "max": {
                  "if": {
                    "when": {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "fitl_acesAirStrikeWindow"
                      },
                      "right": true
                    },
                    "then": 1,
                    "else": {
                      "op": "-",
                      "left": 6,
                      "right": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "binding",
                            "name": "$arcLightNoCoinProvinces"
                          }
                        }
                      }
                    }
                  }
                },
                "min": {
                  "if": {
                    "when": {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "fitl_acesAirStrikeWindow"
                      },
                      "right": true
                    },
                    "then": 1,
                    "else": 0
                  }
                }
              }
            }
          ]
        },
        {
          "stage": "remove-active-enemy-pieces",
          "effects": [
            {
              "setVar": {
                "scope": "global",
                "var": "airStrikeRemaining",
                "value": {
                  "if": {
                    "when": {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_wildWeasels"
                      },
                      "right": true
                    },
                    "then": 1,
                    "else": {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "globalMarkerState",
                            "marker": "cap_lgbs"
                          },
                          "right": "shaded"
                        },
                        "then": 4,
                        "else": 6
                      }
                    }
                  }
                }
              }
            },
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "concat",
                  "sources": [
                    {
                      "query": "binding",
                      "name": "spaces"
                    },
                    {
                      "query": "binding",
                      "name": "$arcLightNoCoinProvinces"
                    }
                  ]
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$enemyBefore",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "in",
                                "value": [
                                  "NVA",
                                  "VC"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "gvar",
                                "var": "airStrikeRemaining"
                              },
                              "right": 0
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": true,
                                    "right": true
                                  },
                                  "then": [
                                    {
                                      "let": {
                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__undergroundEnemyCount",
                                        "value": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                },
                                                {
                                                  "prop": "activity",
                                                  "op": "eq",
                                                  "value": "underground"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "in": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__undergroundEnemyCount"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "removeByPriority": {
                                                    "budget": {
                                                      "ref": "gvar",
                                                      "var": "airStrikeRemaining"
                                                    },
                                                    "groups": [
                                                      {
                                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "troops"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "us-sa-remove-insurgents",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "us-sa-remove-insurgents",
                                                          "stem": "target"
                                                        }
                                                      }
                                                    ],
                                                    "macroOrigin": {
                                                      "macroId": "us-sa-remove-insurgents",
                                                      "stem": "target"
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "removeByPriority": {
                                                    "budget": {
                                                      "ref": "gvar",
                                                      "var": "airStrikeRemaining"
                                                    },
                                                    "groups": [
                                                      {
                                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "troops"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "us-sa-remove-insurgents",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "guerrilla"
                                                            },
                                                            {
                                                              "prop": "activity",
                                                              "op": "eq",
                                                              "value": "active"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "us-sa-remove-insurgents",
                                                          "stem": "target"
                                                        }
                                                      },
                                                      {
                                                        "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                        "over": {
                                                          "query": "tokensInZone",
                                                          "zone": "$space",
                                                          "filter": [
                                                            {
                                                              "prop": "faction",
                                                              "op": "in",
                                                              "value": [
                                                                "NVA",
                                                                "VC"
                                                              ]
                                                            },
                                                            {
                                                              "prop": "type",
                                                              "op": "eq",
                                                              "value": "base"
                                                            },
                                                            {
                                                              "prop": "tunnel",
                                                              "op": "neq",
                                                              "value": "tunneled"
                                                            }
                                                          ]
                                                        },
                                                        "to": {
                                                          "zoneExpr": {
                                                            "concat": [
                                                              "available-",
                                                              {
                                                                "ref": "tokenProp",
                                                                "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                                "prop": "faction"
                                                              },
                                                              ":none"
                                                            ]
                                                          }
                                                        },
                                                        "macroOrigin": {
                                                          "macroId": "us-sa-remove-insurgents",
                                                          "stem": "target"
                                                        }
                                                      }
                                                    ],
                                                    "macroOrigin": {
                                                      "macroId": "us-sa-remove-insurgents",
                                                      "stem": "target"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "removeByPriority": {
                                        "budget": {
                                          "ref": "gvar",
                                          "var": "airStrikeRemaining"
                                        },
                                        "groups": [
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "tunnel",
                                                  "op": "neq",
                                                  "value": "tunneled"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_18__stages_1__effects_1__forEach_effects_0__let_in_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          }
                                        ],
                                        "macroOrigin": {
                                          "macroId": "us-sa-remove-insurgents",
                                          "stem": "target"
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "let": {
                            "bind": "$enemyAfter",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "addVar": {
                                  "scope": "global",
                                  "var": "airStrikeRemaining",
                                  "delta": {
                                    "op": "-",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$enemyAfter"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$enemyBefore"
                                    }
                                  }
                                }
                              },
                              {
                                "let": {
                                  "bind": "$removedInSpace",
                                  "value": {
                                    "op": "-",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$enemyBefore"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$enemyAfter"
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "==",
                                                  "left": {
                                                    "ref": "zoneProp",
                                                    "zone": "$space",
                                                    "prop": "category"
                                                  },
                                                  "right": "province"
                                                },
                                                {
                                                  "op": "==",
                                                  "left": {
                                                    "ref": "zoneProp",
                                                    "zone": "$space",
                                                    "prop": "category"
                                                  },
                                                  "right": "city"
                                                }
                                              ]
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$space",
                                                "prop": "population"
                                              },
                                              "right": 0
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "markerState",
                                                "space": "$space",
                                                "marker": "supportOpposition"
                                              },
                                              "right": "activeOpposition"
                                            },
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": "!=",
                                                  "left": {
                                                    "ref": "globalMarkerState",
                                                    "marker": "cap_lgbs"
                                                  },
                                                  "right": "unshaded"
                                                },
                                                {
                                                  "op": "!=",
                                                  "left": {
                                                    "ref": "binding",
                                                    "name": "$removedInSpace"
                                                  },
                                                  "right": 1
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "shiftMarker": {
                                              "space": "$space",
                                              "marker": "supportOpposition",
                                              "delta": {
                                                "if": {
                                                  "when": {
                                                    "op": "and",
                                                    "args": [
                                                      {
                                                        "op": "==",
                                                        "left": {
                                                          "ref": "globalMarkerState",
                                                          "marker": "cap_arcLight"
                                                        },
                                                        "right": "shaded"
                                                      },
                                                      {
                                                        "op": ">",
                                                        "left": {
                                                          "ref": "binding",
                                                          "name": "$removedInSpace"
                                                        },
                                                        "right": 1
                                                      }
                                                    ]
                                                  },
                                                  "then": -2,
                                                  "else": -1
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "optional-trail-degrade",
          "effects": [
            {
              "chooseOne": {
                "internalDecisionId": "decision:doc.actionPipelines.18.stages[2].effects.0.chooseOne",
                "bind": "$degradeTrail",
                "options": {
                  "query": "enums",
                  "values": [
                    "yes",
                    "no"
                  ]
                }
              }
            },
            {
              "if": {
                "when": {
                  "op": "and",
                  "args": [
                    {
                      "op": "==",
                      "left": {
                        "ref": "binding",
                        "name": "$degradeTrail"
                      },
                      "right": "yes"
                    },
                    {
                      "op": ">",
                      "left": {
                        "ref": "gvar",
                        "var": "trail"
                      },
                      "right": 0
                    },
                    {
                      "op": "!=",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_oriskany"
                      },
                      "right": true
                    },
                    {
                      "op": "!=",
                      "left": {
                        "ref": "gvar",
                        "var": "fitl_acesAirStrikeWindow"
                      },
                      "right": true
                    },
                    {
                      "op": "or",
                      "args": [
                        {
                          "op": "!=",
                          "left": {
                            "ref": "gvar",
                            "var": "mom_wildWeasels"
                          },
                          "right": true
                        },
                        {
                          "op": "==",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "concat",
                                "sources": [
                                  {
                                    "query": "binding",
                                    "name": "spaces"
                                  },
                                  {
                                    "query": "binding",
                                    "name": "$arcLightNoCoinProvinces"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  ]
                },
                "then": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_topGun"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "rollRandom": {
                            "bind": "$topGunDie",
                            "min": 1,
                            "max": 6,
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$topGunDie"
                                    },
                                    "right": 4
                                  },
                                  "then": [
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "trail",
                                        "delta": {
                                          "op": "-",
                                          "left": 0,
                                          "right": {
                                            "if": {
                                              "when": {
                                                "op": "==",
                                                "left": {
                                                  "ref": "globalMarkerState",
                                                  "marker": "cap_aaa"
                                                },
                                                "right": "shaded"
                                              },
                                              "then": {
                                                "if": {
                                                  "when": {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "globalMarkerState",
                                                      "marker": "cap_topGun"
                                                    },
                                                    "right": "unshaded"
                                                  },
                                                  "then": 2,
                                                  "else": 1
                                                }
                                              },
                                              "else": {
                                                "if": {
                                                  "when": {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "globalMarkerState",
                                                      "marker": "cap_topGun"
                                                    },
                                                    "right": "unshaded"
                                                  },
                                                  "then": 2,
                                                  "else": 1
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "globalMarkerState",
                                                "marker": "cap_migs"
                                              },
                                              "right": "shaded"
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "globalMarkerState",
                                                "marker": "cap_topGun"
                                              },
                                              "right": "unshaded"
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.18.stages[2].effects.1.if.then.0.if.then.0.rollRandom.in.0.if.then.1.if.then.0.chooseN",
                                              "bind": "$migsCostSpaces",
                                              "options": {
                                                "query": "concat",
                                                "sources": [
                                                  {
                                                    "query": "binding",
                                                    "name": "spaces"
                                                  },
                                                  {
                                                    "query": "binding",
                                                    "name": "$arcLightNoCoinProvinces"
                                                  }
                                                ]
                                              },
                                              "max": 1,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$migsCostSpace",
                                              "over": {
                                                "query": "binding",
                                                "name": "$migsCostSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$migsCostTroop",
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$migsCostSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "US"
                                                        },
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "troops"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$migsCostTroop",
                                                          "from": "$migsCostSpace",
                                                          "to": {
                                                            "zoneExpr": "casualties-US:none"
                                                          }
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "globalMarkerState",
                                            "marker": "cap_sa2s"
                                          },
                                          "right": "unshaded"
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.18.stages[2].effects.1.if.then.0.if.then.0.rollRandom.in.0.if.then.2.if.then.0.chooseN",
                                              "bind": "$sa2sCostSpaces",
                                              "options": {
                                                "query": "concat",
                                                "sources": [
                                                  {
                                                    "query": "binding",
                                                    "name": "spaces"
                                                  },
                                                  {
                                                    "query": "binding",
                                                    "name": "$arcLightNoCoinProvinces"
                                                  }
                                                ]
                                              },
                                              "max": 1,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$sa2sCostSpace",
                                              "over": {
                                                "query": "binding",
                                                "name": "$sa2sCostSpaces"
                                              },
                                              "effects": [
                                                {
                                                  "forEach": {
                                                    "bind": "$sa2sCostPiece",
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": "$sa2sCostSpace",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "eq",
                                                          "value": "NVA"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$sa2sCostPiece",
                                                          "from": "$sa2sCostSpace",
                                                          "to": {
                                                            "zoneExpr": "available-NVA:none"
                                                          }
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ],
                      "else": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "trail",
                            "delta": {
                              "op": "-",
                              "left": 0,
                              "right": {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "globalMarkerState",
                                      "marker": "cap_aaa"
                                    },
                                    "right": "shaded"
                                  },
                                  "then": {
                                    "if": {
                                      "when": {
                                        "op": "==",
                                        "left": {
                                          "ref": "globalMarkerState",
                                          "marker": "cap_topGun"
                                        },
                                        "right": "unshaded"
                                      },
                                      "then": 2,
                                      "else": 1
                                    }
                                  },
                                  "else": {
                                    "if": {
                                      "when": {
                                        "op": "==",
                                        "left": {
                                          "ref": "globalMarkerState",
                                          "marker": "cap_topGun"
                                        },
                                        "right": "unshaded"
                                      },
                                      "then": 2,
                                      "else": 1
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "globalMarkerState",
                                    "marker": "cap_migs"
                                  },
                                  "right": "shaded"
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "globalMarkerState",
                                    "marker": "cap_topGun"
                                  },
                                  "right": "unshaded"
                                }
                              ]
                            },
                            "then": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.18.stages[2].effects.1.if.then.0.if.else.1.if.then.0.chooseN",
                                  "bind": "$migsCostSpaces",
                                  "options": {
                                    "query": "concat",
                                    "sources": [
                                      {
                                        "query": "binding",
                                        "name": "spaces"
                                      },
                                      {
                                        "query": "binding",
                                        "name": "$arcLightNoCoinProvinces"
                                      }
                                    ]
                                  },
                                  "max": 1,
                                  "min": 0
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$migsCostSpace",
                                  "over": {
                                    "query": "binding",
                                    "name": "$migsCostSpaces"
                                  },
                                  "effects": [
                                    {
                                      "forEach": {
                                        "bind": "$migsCostTroop",
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$migsCostSpace",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "US"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$migsCostTroop",
                                              "from": "$migsCostSpace",
                                              "to": {
                                                "zoneExpr": "casualties-US:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_sa2s"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "chooseN": {
                                  "internalDecisionId": "decision:doc.actionPipelines.18.stages[2].effects.1.if.then.0.if.else.2.if.then.0.chooseN",
                                  "bind": "$sa2sCostSpaces",
                                  "options": {
                                    "query": "concat",
                                    "sources": [
                                      {
                                        "query": "binding",
                                        "name": "spaces"
                                      },
                                      {
                                        "query": "binding",
                                        "name": "$arcLightNoCoinProvinces"
                                      }
                                    ]
                                  },
                                  "max": 1,
                                  "min": 0
                                }
                              },
                              {
                                "forEach": {
                                  "bind": "$sa2sCostSpace",
                                  "over": {
                                    "query": "binding",
                                    "name": "$sa2sCostSpaces"
                                  },
                                  "effects": [
                                    {
                                      "forEach": {
                                        "bind": "$sa2sCostPiece",
                                        "over": {
                                          "query": "tokensInZone",
                                          "zone": "$sa2sCostSpace",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            }
                                          ]
                                        },
                                        "effects": [
                                          {
                                            "moveToken": {
                                              "token": "$sa2sCostPiece",
                                              "from": "$sa2sCostSpace",
                                              "to": {
                                                "zoneExpr": "available-NVA:none"
                                              }
                                            }
                                          }
                                        ],
                                        "limit": 1
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "air-strike-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "airStrikeCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "us-special-window"
      ]
    },
    {
      "id": "govern-profile",
      "actionId": "govern",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "accompanyingOps": [
        "train",
        "patrol"
      ],
      "compoundParamConstraints": [
        {
          "relation": "disjoint",
          "operationParam": "targetSpaces",
          "specialActivityParam": "targetSpaces"
        }
      ],
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_mandateOfHeaven"
                  },
                  "right": "shaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.19.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "markerState",
                                      "space": "$zone",
                                      "marker": "supportOpposition"
                                    },
                                    "right": "passiveSupport"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "markerState",
                                      "space": "$zone",
                                      "marker": "supportOpposition"
                                    },
                                    "right": "activeSupport"
                                  }
                                ]
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "id"
                                },
                                "right": "saigon:none"
                              },
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "gvar",
                          "var": "mom_typhoonKate"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.19.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "markerState",
                                            "space": "$zone",
                                            "marker": "supportOpposition"
                                          },
                                          "right": "passiveSupport"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "markerState",
                                            "space": "$zone",
                                            "marker": "supportOpposition"
                                          },
                                          "right": "activeSupport"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "id"
                                      },
                                      "right": "saigon:none"
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "US",
                                                  "ARVN"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 1,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.19.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "province"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "category"
                                          },
                                          "right": "city"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "markerState",
                                            "space": "$zone",
                                            "marker": "supportOpposition"
                                          },
                                          "right": "passiveSupport"
                                        },
                                        {
                                          "op": "==",
                                          "left": {
                                            "ref": "markerState",
                                            "space": "$zone",
                                            "marker": "supportOpposition"
                                          },
                                          "right": "activeSupport"
                                        }
                                      ]
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "id"
                                      },
                                      "right": "saigon:none"
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "US",
                                                  "ARVN"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "in",
                                                "value": [
                                                  "NVA",
                                                  "VC"
                                                ]
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_mandateOfHeaven"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.19.stages[1].effects.0.if.then.0.chooseOne",
                      "bind": "$mandateNoShiftSpace",
                      "options": {
                        "query": "binding",
                        "name": "targetSpaces"
                      }
                    }
                  }
                ]
              }
            },
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.19.stages[1].effects.1.forEach.effects.0.chooseOne",
                      "bind": "$governMode@{$space}",
                      "options": {
                        "query": "enums",
                        "values": [
                          "aid",
                          "patronage"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "binding",
                          "name": "$governMode@{$space}"
                        },
                        "right": "aid"
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "aid",
                            "delta": {
                              "op": "*",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$space",
                                "prop": "population"
                              },
                              "right": 3
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$governMode@{$space}"
                            },
                            "right": "patronage"
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "in",
                                      "value": [
                                        "troops",
                                        "police"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "right": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "aid",
                            "delta": {
                              "op": "*",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$space",
                                "prop": "population"
                              },
                              "right": -1
                            }
                          }
                        },
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "patronage",
                            "delta": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "population"
                            }
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": {
                                "ref": "globalMarkerState",
                                "marker": "cap_mandateOfHeaven"
                              },
                              "right": "unshaded"
                            },
                            "then": [
                              {
                                "if": {
                                  "when": {
                                    "op": "!=",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$mandateNoShiftSpace"
                                    },
                                    "right": {
                                      "ref": "binding",
                                      "name": "$space"
                                    }
                                  },
                                  "then": [
                                    {
                                      "shiftMarker": {
                                        "space": "$space",
                                        "marker": "supportOpposition",
                                        "delta": -1
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "shiftMarker": {
                                  "space": "$space",
                                  "marker": "supportOpposition",
                                  "delta": -1
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "govern-telemetry",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "activeLeader"
                  },
                  "right": "youngTurks"
                },
                "then": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "patronage",
                      "delta": 2
                    }
                  }
                ]
              }
            },
            {
              "addVar": {
                "scope": "global",
                "var": "governCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "arvn-special-window"
      ]
    },
    {
      "id": "transport-profile",
      "actionId": "transport",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "accompanyingOps": "any",
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_typhoonKate"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-origin",
          "effects": [
            {
              "chooseOne": {
                "internalDecisionId": "decision:doc.actionPipelines.20.stages[0].effects.0.chooseOne",
                "bind": "$transportOrigin",
                "options": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "!=",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "country"
                          },
                          "right": "northVietnam"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "in",
                                    "value": [
                                      "troops",
                                      "ranger"
                                    ]
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                }
              }
            }
          ]
        },
        {
          "stage": "select-destination",
          "effects": [
            {
              "chooseOne": {
                "internalDecisionId": "decision:doc.actionPipelines.20.stages[1].effects.0.chooseOne",
                "bind": "$transportDestination",
                "options": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "!=",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "country"
                          },
                          "right": "northVietnam"
                        },
                        {
                          "op": "or",
                          "args": [
                            {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "globalMarkerState",
                                    "marker": "activeLeader"
                                  },
                                  "right": "khanh"
                                },
                                {
                                  "op": "connected",
                                  "from": "$transportOrigin",
                                  "to": "$zone",
                                  "via": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      },
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "country"
                                        },
                                        "right": "northVietnam"
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  },
                                  "maxDepth": 2
                                }
                              ]
                            },
                            {
                              "op": "and",
                              "args": [
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "globalMarkerState",
                                    "marker": "activeLeader"
                                  },
                                  "right": "khanh"
                                },
                                {
                                  "op": "connected",
                                  "from": "$transportOrigin",
                                  "to": "$zone",
                                  "via": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "city"
                                          }
                                        ]
                                      },
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "country"
                                        },
                                        "right": "northVietnam"
                                      },
                                      {
                                        "op": "==",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                }
              }
            }
          ]
        },
        {
          "stage": "move-selected-pieces",
          "effects": [
            {
              "forEach": {
                "bind": "$piece",
                "over": {
                  "query": "tokensInZone",
                  "zone": "$transportOrigin",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "in",
                      "value": [
                        "troops",
                        "ranger"
                      ]
                    }
                  ]
                },
                "effects": [
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "tokenZone",
                          "token": "$piece"
                        },
                        "right": {
                          "ref": "binding",
                          "name": "$transportDestination"
                        }
                      },
                      "then": [
                        {
                          "moveToken": {
                            "token": "$piece",
                            "from": {
                              "zoneExpr": {
                                "ref": "tokenZone",
                                "token": "$piece"
                              }
                            },
                            "to": {
                              "zoneExpr": {
                                "ref": "binding",
                                "name": "$transportDestination"
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                ],
                "limit": 6
              }
            }
          ]
        },
        {
          "stage": "flip-rangers-underground",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "mapSpaces"
                },
                "effects": [
                  {
                    "forEach": {
                      "bind": "$ranger",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "ranger"
                          }
                        ]
                      },
                      "effects": [
                        {
                          "setTokenProp": {
                            "token": "$ranger",
                            "prop": "activity",
                            "value": "underground"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "cap-armored-cavalry-unshaded-assault",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_armoredCavalry"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": false,
                        "right": true
                      },
                      "then": [
                        {
                          "let": {
                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__undergroundEnemyCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$transportDestination",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "guerrilla"
                                    },
                                    {
                                      "prop": "activity",
                                      "op": "eq",
                                      "value": "underground"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__undergroundEnemyCount"
                                    },
                                    "right": 0
                                  },
                                  "then": [
                                    {
                                      "removeByPriority": {
                                        "budget": 1,
                                        "groups": [
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$transportDestination",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$transportDestination",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                },
                                                {
                                                  "prop": "activity",
                                                  "op": "eq",
                                                  "value": "active"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          }
                                        ],
                                        "macroOrigin": {
                                          "macroId": "us-sa-remove-insurgents",
                                          "stem": "target"
                                        }
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "removeByPriority": {
                                        "budget": 1,
                                        "groups": [
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$transportDestination",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "troops"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$transportDestination",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                },
                                                {
                                                  "prop": "activity",
                                                  "op": "eq",
                                                  "value": "active"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$transportDestination",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "NVA",
                                                    "VC"
                                                  ]
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                },
                                                {
                                                  "prop": "tunnel",
                                                  "op": "neq",
                                                  "value": "tunneled"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": {
                                                "concat": [
                                                  "available-",
                                                  {
                                                    "ref": "tokenProp",
                                                    "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                                    "prop": "faction"
                                                  },
                                                  ":none"
                                                ]
                                              }
                                            },
                                            "macroOrigin": {
                                              "macroId": "us-sa-remove-insurgents",
                                              "stem": "target"
                                            }
                                          }
                                        ],
                                        "macroOrigin": {
                                          "macroId": "us-sa-remove-insurgents",
                                          "stem": "target"
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ],
                      "else": [
                        {
                          "removeByPriority": {
                            "budget": 1,
                            "groups": [
                              {
                                "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$transportDestination",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "us-sa-remove-insurgents",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$transportDestination",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "guerrilla"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "us-sa-remove-insurgents",
                                  "stem": "target"
                                }
                              },
                              {
                                "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                "over": {
                                  "query": "tokensInZone",
                                  "zone": "$transportDestination",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "base"
                                    },
                                    {
                                      "prop": "tunnel",
                                      "op": "neq",
                                      "value": "tunneled"
                                    }
                                  ]
                                },
                                "to": {
                                  "zoneExpr": {
                                    "concat": [
                                      "available-",
                                      {
                                        "ref": "tokenProp",
                                        "token": "$__macro_us_sa_remove_insurgents_actionPipelines_20__stages_4__effects_0__if_then_0__target",
                                        "prop": "faction"
                                      },
                                      ":none"
                                    ]
                                  }
                                },
                                "macroOrigin": {
                                  "macroId": "us-sa-remove-insurgents",
                                  "stem": "target"
                                }
                              }
                            ],
                            "macroOrigin": {
                              "macroId": "us-sa-remove-insurgents",
                              "stem": "target"
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "transport-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "transportCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "arvn-special-window"
      ]
    },
    {
      "id": "raid-profile",
      "actionId": "raid",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "accompanyingOps": [
        "patrol",
        "sweep",
        "assault"
      ],
      "legality": true,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "gvar",
                    "var": "mom_typhoonKate"
                  },
                  "right": true
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.21.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "!=",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "northVietnam"
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.21.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "!=",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "northVietnam"
                          }
                        }
                      },
                      "max": 2,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.21.stages[1].effects.0.forEach.effects.0.chooseN",
                      "bind": "$raidIncomingFrom@{$space}",
                      "options": {
                        "query": "adjacentZones",
                        "zone": "$space"
                      },
                      "max": 99,
                      "min": 0
                    }
                  },
                  {
                    "forEach": {
                      "bind": "$source",
                      "over": {
                        "query": "binding",
                        "name": "$raidIncomingFrom@{$space}"
                      },
                      "effects": [
                        {
                          "forEach": {
                            "bind": "$ranger",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$source",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "ranger"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "moveToken": {
                                  "token": "$ranger",
                                  "from": {
                                    "zoneExpr": {
                                      "ref": "tokenZone",
                                      "token": "$ranger"
                                    }
                                  },
                                  "to": "$space"
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "chooseOne": {
                      "internalDecisionId": "decision:doc.actionPipelines.21.stages[1].effects.0.forEach.effects.2.chooseOne",
                      "bind": "$raidRemove@{$space}",
                      "options": {
                        "query": "enums",
                        "values": [
                          "yes",
                          "no"
                        ]
                      }
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "and",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "binding",
                              "name": "$raidRemove@{$space}"
                            },
                            "right": "yes"
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "ranger"
                                    },
                                    {
                                      "prop": "activity",
                                      "op": "eq",
                                      "value": "underground"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": 0
                          }
                        ]
                      },
                      "then": [
                        {
                          "forEach": {
                            "bind": "$activatingRanger",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "ranger"
                                },
                                {
                                  "prop": "activity",
                                  "op": "eq",
                                  "value": "underground"
                                }
                              ]
                            },
                            "effects": [
                              {
                                "setTokenProp": {
                                  "token": "$activatingRanger",
                                  "prop": "activity",
                                  "value": "active"
                                }
                              }
                            ],
                            "limit": 1
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "==",
                              "left": false,
                              "right": true
                            },
                            "then": [
                              {
                                "let": {
                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__undergroundEnemyCount",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "guerrilla"
                                          },
                                          {
                                            "prop": "activity",
                                            "op": "eq",
                                            "value": "underground"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": ">",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__undergroundEnemyCount"
                                          },
                                          "right": 0
                                        },
                                        "then": [
                                          {
                                            "removeByPriority": {
                                              "budget": 2,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "troops"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "guerrilla"
                                                      },
                                                      {
                                                        "prop": "activity",
                                                        "op": "eq",
                                                        "value": "active"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "us-sa-remove-insurgents",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "removeByPriority": {
                                              "budget": 2,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "troops"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "guerrilla"
                                                      },
                                                      {
                                                        "prop": "activity",
                                                        "op": "eq",
                                                        "value": "active"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$space",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "NVA",
                                                          "VC"
                                                        ]
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      },
                                                      {
                                                        "prop": "tunnel",
                                                        "op": "neq",
                                                        "value": "tunneled"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": {
                                                      "concat": [
                                                        "available-",
                                                        {
                                                          "ref": "tokenProp",
                                                          "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                                          "prop": "faction"
                                                        },
                                                        ":none"
                                                      ]
                                                    }
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "us-sa-remove-insurgents",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "us-sa-remove-insurgents",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ],
                            "else": [
                              {
                                "removeByPriority": {
                                  "budget": 2,
                                  "groups": [
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "troops"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    },
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "guerrilla"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    },
                                    {
                                      "bind": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                      "over": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "in",
                                            "value": [
                                              "NVA",
                                              "VC"
                                            ]
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "base"
                                          },
                                          {
                                            "prop": "tunnel",
                                            "op": "neq",
                                            "value": "tunneled"
                                          }
                                        ]
                                      },
                                      "to": {
                                        "zoneExpr": {
                                          "concat": [
                                            "available-",
                                            {
                                              "ref": "tokenProp",
                                              "token": "$__macro_us_sa_remove_insurgents_actionPipelines_21__stages_1__effects_0__forEach_effects_3__if_then_1__target",
                                              "prop": "faction"
                                            },
                                            ":none"
                                          ]
                                        }
                                      },
                                      "macroOrigin": {
                                        "macroId": "us-sa-remove-insurgents",
                                        "stem": "target"
                                      }
                                    }
                                  ],
                                  "macroOrigin": {
                                    "macroId": "us-sa-remove-insurgents",
                                    "stem": "target"
                                  }
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "raid-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "raidCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "arvn-special-window"
      ]
    },
    {
      "id": "infiltrate-profile",
      "actionId": "infiltrate",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "accompanyingOps": [
        "rally",
        "march"
      ],
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_mcnamaraLine"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "or",
                  "args": [
                    {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_typhoonKate"
                      },
                      "right": true
                    },
                    {
                      "op": "==",
                      "left": {
                        "ref": "gvar",
                        "var": "mom_559thTransportGrp"
                      },
                      "right": true
                    }
                  ]
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.22.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "base"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.22.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "base"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "VC"
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 2,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$nvaBaseCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "NVA"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "base"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$nvaPieceCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "NVA"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$vcPieceCount",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$space",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "VC"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$nvaBaseCount"
                                              },
                                              "right": 0
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$nvaPieceCount"
                                              },
                                              "right": {
                                                "ref": "binding",
                                                "name": "$vcPieceCount"
                                              }
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                              "bind": "$infiltrateMode@{$space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "build-up",
                                                  "takeover"
                                                ]
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$nvaBaseCount"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.0.if.else.0.if.then.0.chooseOne",
                                                    "bind": "$infiltrateMode@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "build-up"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.0.if.else.0.if.else.0.chooseOne",
                                                    "bind": "$infiltrateMode@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "takeover"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$infiltrateMode@{$space}"
                                          },
                                          "right": "build-up"
                                        },
                                        "then": [
                                          {
                                            "let": {
                                              "bind": "$buildUpLimit",
                                              "value": {
                                                "op": "+",
                                                "left": {
                                                  "ref": "gvar",
                                                  "var": "trail"
                                                },
                                                "right": {
                                                  "ref": "binding",
                                                  "name": "$nvaBaseCount"
                                                }
                                              },
                                              "in": [
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__piece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "piece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": {
                                                        "zoneExpr": {
                                                          "concat": [
                                                            "available-",
                                                            "NVA",
                                                            ":none"
                                                          ]
                                                        }
                                                      },
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "troops"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__piece",
                                                          "from": {
                                                            "zoneExpr": {
                                                              "concat": [
                                                                "available-",
                                                                "NVA",
                                                                ":none"
                                                              ]
                                                            }
                                                          },
                                                          "to": "$space"
                                                        }
                                                      }
                                                    ],
                                                    "limit": {
                                                      "ref": "binding",
                                                      "name": "$buildUpLimit"
                                                    },
                                                    "countBind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__placed",
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__remaining",
                                                          "value": {
                                                            "op": "-",
                                                            "left": {
                                                              "ref": "binding",
                                                              "name": "$buildUpLimit"
                                                            },
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__placed"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": "and",
                                                                  "args": [
                                                                    {
                                                                      "op": "or",
                                                                      "args": [
                                                                        {
                                                                          "op": "!=",
                                                                          "left": "NVA",
                                                                          "right": "US"
                                                                        },
                                                                        {
                                                                          "op": "==",
                                                                          "left": "troops",
                                                                          "right": "irregular"
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "op": ">",
                                                                      "left": {
                                                                        "ref": "binding",
                                                                        "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__remaining"
                                                                      },
                                                                      "right": 0
                                                                    }
                                                                  ]
                                                                },
                                                                "then": [
                                                                  {
                                                                    "chooseN": {
                                                                      "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.1.if.then.0.let.in.0.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__sourceSpaces",
                                                                      "options": {
                                                                        "query": "mapSpaces",
                                                                        "filter": {
                                                                          "condition": {
                                                                            "op": ">",
                                                                            "left": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$zone",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "troops"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "eq",
                                                                                      "value": "NVA"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "right": 0
                                                                          }
                                                                        }
                                                                      },
                                                                      "max": 99,
                                                                      "min": 0
                                                                    }
                                                                  },
                                                                  {
                                                                    "forEach": {
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__srcSpace",
                                                                      "macroOrigin": {
                                                                        "macroId": "place-from-available-or-map",
                                                                        "stem": "srcSpace"
                                                                      },
                                                                      "over": {
                                                                        "query": "binding",
                                                                        "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__sourceSpaces"
                                                                      },
                                                                      "effects": [
                                                                        {
                                                                          "forEach": {
                                                                            "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__mapPiece",
                                                                            "macroOrigin": {
                                                                              "macroId": "place-from-available-or-map",
                                                                              "stem": "mapPiece"
                                                                            },
                                                                            "over": {
                                                                              "query": "tokensInZone",
                                                                              "zone": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__srcSpace",
                                                                              "filter": [
                                                                                {
                                                                                  "prop": "type",
                                                                                  "op": "eq",
                                                                                  "value": "troops"
                                                                                },
                                                                                {
                                                                                  "prop": "faction",
                                                                                  "op": "eq",
                                                                                  "value": "NVA"
                                                                                }
                                                                              ]
                                                                            },
                                                                            "effects": [
                                                                              {
                                                                                "moveToken": {
                                                                                  "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__mapPiece",
                                                                                  "from": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_0__let_in_0__srcSpace",
                                                                                  "to": "$space"
                                                                                }
                                                                              }
                                                                            ],
                                                                            "limit": 1
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.1.if.then.1.chooseN",
                                              "bind": "$infiltrateGuerrillasToReplace@{$space}",
                                              "options": {
                                                "query": "tokensInZone",
                                                "zone": "$space",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "NVA"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "guerrilla"
                                                  }
                                                ]
                                              },
                                              "max": 99,
                                              "min": 0
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$replacingGuerrilla",
                                              "over": {
                                                "query": "binding",
                                                "name": "$infiltrateGuerrillasToReplace@{$space}"
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$replacingGuerrilla",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "ref": "tokenZone",
                                                        "token": "$replacingGuerrilla"
                                                      }
                                                    },
                                                    "to": {
                                                      "zoneExpr": "available-NVA:none"
                                                    }
                                                  }
                                                },
                                                {
                                                  "forEach": {
                                                    "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__piece",
                                                    "macroOrigin": {
                                                      "macroId": "place-from-available-or-map",
                                                      "stem": "piece"
                                                    },
                                                    "over": {
                                                      "query": "tokensInZone",
                                                      "zone": {
                                                        "zoneExpr": {
                                                          "concat": [
                                                            "available-",
                                                            "NVA",
                                                            ":none"
                                                          ]
                                                        }
                                                      },
                                                      "filter": [
                                                        {
                                                          "prop": "type",
                                                          "op": "eq",
                                                          "value": "troops"
                                                        }
                                                      ]
                                                    },
                                                    "effects": [
                                                      {
                                                        "moveToken": {
                                                          "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__piece",
                                                          "from": {
                                                            "zoneExpr": {
                                                              "concat": [
                                                                "available-",
                                                                "NVA",
                                                                ":none"
                                                              ]
                                                            }
                                                          },
                                                          "to": "$space"
                                                        }
                                                      }
                                                    ],
                                                    "limit": 1,
                                                    "countBind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__placed",
                                                    "in": [
                                                      {
                                                        "let": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__remaining",
                                                          "value": {
                                                            "op": "-",
                                                            "left": 1,
                                                            "right": {
                                                              "ref": "binding",
                                                              "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__placed"
                                                            }
                                                          },
                                                          "in": [
                                                            {
                                                              "if": {
                                                                "when": {
                                                                  "op": "and",
                                                                  "args": [
                                                                    {
                                                                      "op": "or",
                                                                      "args": [
                                                                        {
                                                                          "op": "!=",
                                                                          "left": "NVA",
                                                                          "right": "US"
                                                                        },
                                                                        {
                                                                          "op": "==",
                                                                          "left": "troops",
                                                                          "right": "irregular"
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "op": ">",
                                                                      "left": {
                                                                        "ref": "binding",
                                                                        "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__remaining"
                                                                      },
                                                                      "right": 0
                                                                    }
                                                                  ]
                                                                },
                                                                "then": [
                                                                  {
                                                                    "chooseN": {
                                                                      "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.1.if.then.2.forEach.effects.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__sourceSpaces",
                                                                      "options": {
                                                                        "query": "mapSpaces",
                                                                        "filter": {
                                                                          "condition": {
                                                                            "op": ">",
                                                                            "left": {
                                                                              "aggregate": {
                                                                                "op": "count",
                                                                                "query": {
                                                                                  "query": "tokensInZone",
                                                                                  "zone": "$zone",
                                                                                  "filter": [
                                                                                    {
                                                                                      "prop": "type",
                                                                                      "op": "eq",
                                                                                      "value": "troops"
                                                                                    },
                                                                                    {
                                                                                      "prop": "faction",
                                                                                      "op": "eq",
                                                                                      "value": "NVA"
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            },
                                                                            "right": 0
                                                                          }
                                                                        }
                                                                      },
                                                                      "max": 99,
                                                                      "min": 0
                                                                    }
                                                                  },
                                                                  {
                                                                    "forEach": {
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__srcSpace",
                                                                      "macroOrigin": {
                                                                        "macroId": "place-from-available-or-map",
                                                                        "stem": "srcSpace"
                                                                      },
                                                                      "over": {
                                                                        "query": "binding",
                                                                        "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__sourceSpaces"
                                                                      },
                                                                      "effects": [
                                                                        {
                                                                          "forEach": {
                                                                            "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__mapPiece",
                                                                            "macroOrigin": {
                                                                              "macroId": "place-from-available-or-map",
                                                                              "stem": "mapPiece"
                                                                            },
                                                                            "over": {
                                                                              "query": "tokensInZone",
                                                                              "zone": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__srcSpace",
                                                                              "filter": [
                                                                                {
                                                                                  "prop": "type",
                                                                                  "op": "eq",
                                                                                  "value": "troops"
                                                                                },
                                                                                {
                                                                                  "prop": "faction",
                                                                                  "op": "eq",
                                                                                  "value": "NVA"
                                                                                }
                                                                              ]
                                                                            },
                                                                            "effects": [
                                                                              {
                                                                                "moveToken": {
                                                                                  "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__mapPiece",
                                                                                  "from": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_1__if_then_2__forEach_effects_1__srcSpace",
                                                                                  "to": "$space"
                                                                                }
                                                                              }
                                                                            ],
                                                                            "limit": 1
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$infiltrateMode@{$space}"
                                          },
                                          "right": "takeover"
                                        },
                                        "then": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": "or",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "markerState",
                                                      "space": "$space",
                                                      "marker": "supportOpposition"
                                                    },
                                                    "right": "activeOpposition"
                                                  },
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "markerState",
                                                      "space": "$space",
                                                      "marker": "supportOpposition"
                                                    },
                                                    "right": "passiveOpposition"
                                                  }
                                                ]
                                              },
                                              "then": [
                                                {
                                                  "shiftMarker": {
                                                    "space": "$space",
                                                    "marker": "supportOpposition",
                                                    "delta": 1
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.1.chooseOne",
                                              "bind": "$infiltrateTakeoverReplace@{$space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "yes",
                                                  "no"
                                                ]
                                              }
                                            }
                                          },
                                          {
                                            "if": {
                                              "when": {
                                                "op": "==",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$infiltrateTakeoverReplace@{$space}"
                                                },
                                                "right": "yes"
                                              },
                                              "then": [
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "and",
                                                      "args": [
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$space",
                                                                "filter": [
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "VC"
                                                                  },
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "guerrilla"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        },
                                                        {
                                                          "op": ">",
                                                          "left": {
                                                            "aggregate": {
                                                              "op": "count",
                                                              "query": {
                                                                "query": "tokensInZone",
                                                                "zone": "$space",
                                                                "filter": [
                                                                  {
                                                                    "prop": "faction",
                                                                    "op": "eq",
                                                                    "value": "VC"
                                                                  },
                                                                  {
                                                                    "prop": "type",
                                                                    "op": "eq",
                                                                    "value": "base"
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          },
                                                          "right": 0
                                                        }
                                                      ]
                                                    },
                                                    "then": [
                                                      {
                                                        "chooseOne": {
                                                          "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.0.if.then.0.chooseOne",
                                                          "bind": "$infiltrateTakeoverTargetType@{$space}",
                                                          "options": {
                                                            "query": "enums",
                                                            "values": [
                                                              "guerrilla",
                                                              "base"
                                                            ]
                                                          }
                                                        }
                                                      }
                                                    ],
                                                    "else": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "aggregate": {
                                                                "op": "count",
                                                                "query": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    },
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "guerrilla"
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "chooseOne": {
                                                                "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.0.if.else.0.if.then.0.chooseOne",
                                                                "bind": "$infiltrateTakeoverTargetType@{$space}",
                                                                "options": {
                                                                  "query": "enums",
                                                                  "values": [
                                                                    "guerrilla"
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          ],
                                                          "else": [
                                                            {
                                                              "chooseOne": {
                                                                "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.0.if.else.0.if.else.0.chooseOne",
                                                                "bind": "$infiltrateTakeoverTargetType@{$space}",
                                                                "options": {
                                                                  "query": "enums",
                                                                  "values": [
                                                                    "base"
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$infiltrateTakeoverTargetType@{$space}"
                                                      },
                                                      "right": "guerrilla"
                                                    },
                                                    "then": [
                                                      {
                                                        "forEach": {
                                                          "bind": "$vcGuerrillaTarget",
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": "$space",
                                                            "filter": [
                                                              {
                                                                "prop": "faction",
                                                                "op": "eq",
                                                                "value": "VC"
                                                              },
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "guerrilla"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$vcGuerrillaTarget",
                                                                "from": "$space",
                                                                "to": {
                                                                  "zoneExpr": "available-VC:none"
                                                                }
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1
                                                        }
                                                      },
                                                      {
                                                        "forEach": {
                                                          "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__piece",
                                                          "macroOrigin": {
                                                            "macroId": "place-from-available-or-map",
                                                            "stem": "piece"
                                                          },
                                                          "over": {
                                                            "query": "tokensInZone",
                                                            "zone": {
                                                              "zoneExpr": {
                                                                "concat": [
                                                                  "available-",
                                                                  "NVA",
                                                                  ":none"
                                                                ]
                                                              }
                                                            },
                                                            "filter": [
                                                              {
                                                                "prop": "type",
                                                                "op": "eq",
                                                                "value": "guerrilla"
                                                              }
                                                            ]
                                                          },
                                                          "effects": [
                                                            {
                                                              "moveToken": {
                                                                "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__piece",
                                                                "from": {
                                                                  "zoneExpr": {
                                                                    "concat": [
                                                                      "available-",
                                                                      "NVA",
                                                                      ":none"
                                                                    ]
                                                                  }
                                                                },
                                                                "to": "$space"
                                                              }
                                                            }
                                                          ],
                                                          "limit": 1,
                                                          "countBind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__placed",
                                                          "in": [
                                                            {
                                                              "let": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__remaining",
                                                                "value": {
                                                                  "op": "-",
                                                                  "left": 1,
                                                                  "right": {
                                                                    "ref": "binding",
                                                                    "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__placed"
                                                                  }
                                                                },
                                                                "in": [
                                                                  {
                                                                    "if": {
                                                                      "when": {
                                                                        "op": "and",
                                                                        "args": [
                                                                          {
                                                                            "op": "or",
                                                                            "args": [
                                                                              {
                                                                                "op": "!=",
                                                                                "left": "NVA",
                                                                                "right": "US"
                                                                              },
                                                                              {
                                                                                "op": "==",
                                                                                "left": "guerrilla",
                                                                                "right": "irregular"
                                                                              }
                                                                            ]
                                                                          },
                                                                          {
                                                                            "op": ">",
                                                                            "left": {
                                                                              "ref": "binding",
                                                                              "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__remaining"
                                                                            },
                                                                            "right": 0
                                                                          }
                                                                        ]
                                                                      },
                                                                      "then": [
                                                                        {
                                                                          "chooseN": {
                                                                            "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.1.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                            "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__sourceSpaces",
                                                                            "options": {
                                                                              "query": "mapSpaces",
                                                                              "filter": {
                                                                                "condition": {
                                                                                  "op": ">",
                                                                                  "left": {
                                                                                    "aggregate": {
                                                                                      "op": "count",
                                                                                      "query": {
                                                                                        "query": "tokensInZone",
                                                                                        "zone": "$zone",
                                                                                        "filter": [
                                                                                          {
                                                                                            "prop": "type",
                                                                                            "op": "eq",
                                                                                            "value": "guerrilla"
                                                                                          },
                                                                                          {
                                                                                            "prop": "faction",
                                                                                            "op": "eq",
                                                                                            "value": "NVA"
                                                                                          }
                                                                                        ]
                                                                                      }
                                                                                    }
                                                                                  },
                                                                                  "right": 0
                                                                                }
                                                                              }
                                                                            },
                                                                            "max": 99,
                                                                            "min": 0
                                                                          }
                                                                        },
                                                                        {
                                                                          "forEach": {
                                                                            "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__srcSpace",
                                                                            "macroOrigin": {
                                                                              "macroId": "place-from-available-or-map",
                                                                              "stem": "srcSpace"
                                                                            },
                                                                            "over": {
                                                                              "query": "binding",
                                                                              "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__sourceSpaces"
                                                                            },
                                                                            "effects": [
                                                                              {
                                                                                "forEach": {
                                                                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__mapPiece",
                                                                                  "macroOrigin": {
                                                                                    "macroId": "place-from-available-or-map",
                                                                                    "stem": "mapPiece"
                                                                                  },
                                                                                  "over": {
                                                                                    "query": "tokensInZone",
                                                                                    "zone": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__srcSpace",
                                                                                    "filter": [
                                                                                      {
                                                                                        "prop": "type",
                                                                                        "op": "eq",
                                                                                        "value": "guerrilla"
                                                                                      },
                                                                                      {
                                                                                        "prop": "faction",
                                                                                        "op": "eq",
                                                                                        "value": "NVA"
                                                                                      }
                                                                                    ]
                                                                                  },
                                                                                  "effects": [
                                                                                    {
                                                                                      "moveToken": {
                                                                                        "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__mapPiece",
                                                                                        "from": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_1__if_then_1__srcSpace",
                                                                                        "to": "$space"
                                                                                      }
                                                                                    }
                                                                                  ],
                                                                                  "limit": 1
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "if": {
                                                    "when": {
                                                      "op": "==",
                                                      "left": {
                                                        "ref": "binding",
                                                        "name": "$infiltrateTakeoverTargetType@{$space}"
                                                      },
                                                      "right": "base"
                                                    },
                                                    "then": [
                                                      {
                                                        "if": {
                                                          "when": {
                                                            "op": ">",
                                                            "left": {
                                                              "aggregate": {
                                                                "op": "count",
                                                                "query": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    },
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    },
                                                                    {
                                                                      "prop": "tunnel",
                                                                      "op": "eq",
                                                                      "value": "tunneled"
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            },
                                                            "right": 0
                                                          },
                                                          "then": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$vcTunneledBaseTarget",
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    },
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    },
                                                                    {
                                                                      "prop": "tunnel",
                                                                      "op": "eq",
                                                                      "value": "tunneled"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$vcTunneledBaseTarget",
                                                                      "from": "$space",
                                                                      "to": {
                                                                        "zoneExpr": "available-VC:none"
                                                                      }
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            },
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__piece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "piece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": {
                                                                    "zoneExpr": {
                                                                      "concat": [
                                                                        "available-",
                                                                        "NVA",
                                                                        ":none"
                                                                      ]
                                                                    }
                                                                  },
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__piece",
                                                                      "from": {
                                                                        "zoneExpr": {
                                                                          "concat": [
                                                                            "available-",
                                                                            "NVA",
                                                                            ":none"
                                                                          ]
                                                                        }
                                                                      },
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1,
                                                                "countBind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__placed",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__remaining",
                                                                      "value": {
                                                                        "op": "-",
                                                                        "left": 1,
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__placed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "or",
                                                                                  "args": [
                                                                                    {
                                                                                      "op": "!=",
                                                                                      "left": "NVA",
                                                                                      "right": "US"
                                                                                    },
                                                                                    {
                                                                                      "op": "==",
                                                                                      "left": "base",
                                                                                      "right": "irregular"
                                                                                    }
                                                                                  ]
                                                                                },
                                                                                {
                                                                                  "op": ">",
                                                                                  "left": {
                                                                                    "ref": "binding",
                                                                                    "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__remaining"
                                                                                  },
                                                                                  "right": 0
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "chooseN": {
                                                                                  "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.2.if.then.0.if.then.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__sourceSpaces",
                                                                                  "options": {
                                                                                    "query": "mapSpaces",
                                                                                    "filter": {
                                                                                      "condition": {
                                                                                        "op": ">",
                                                                                        "left": {
                                                                                          "aggregate": {
                                                                                            "op": "count",
                                                                                            "query": {
                                                                                              "query": "tokensInZone",
                                                                                              "zone": "$zone",
                                                                                              "filter": [
                                                                                                {
                                                                                                  "prop": "type",
                                                                                                  "op": "eq",
                                                                                                  "value": "base"
                                                                                                },
                                                                                                {
                                                                                                  "prop": "faction",
                                                                                                  "op": "eq",
                                                                                                  "value": "NVA"
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        },
                                                                                        "right": 0
                                                                                      }
                                                                                    }
                                                                                  },
                                                                                  "max": 99,
                                                                                  "min": 0
                                                                                }
                                                                              },
                                                                              {
                                                                                "forEach": {
                                                                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__srcSpace",
                                                                                  "macroOrigin": {
                                                                                    "macroId": "place-from-available-or-map",
                                                                                    "stem": "srcSpace"
                                                                                  },
                                                                                  "over": {
                                                                                    "query": "binding",
                                                                                    "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__sourceSpaces"
                                                                                  },
                                                                                  "effects": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__mapPiece",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "place-from-available-or-map",
                                                                                          "stem": "mapPiece"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__srcSpace",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "eq",
                                                                                              "value": "NVA"
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "moveToken": {
                                                                                              "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__mapPiece",
                                                                                              "from": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_then_1__srcSpace",
                                                                                              "to": "$space"
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": 1
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            },
                                                            {
                                                              "forEach": {
                                                                "bind": "$nvaTunneledBase",
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "NVA"
                                                                    },
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "setTokenProp": {
                                                                      "token": "$nvaTunneledBase",
                                                                      "prop": "tunnel",
                                                                      "value": "tunneled"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            }
                                                          ],
                                                          "else": [
                                                            {
                                                              "forEach": {
                                                                "bind": "$vcUntunneledBaseTarget",
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": "$space",
                                                                  "filter": [
                                                                    {
                                                                      "prop": "faction",
                                                                      "op": "eq",
                                                                      "value": "VC"
                                                                    },
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$vcUntunneledBaseTarget",
                                                                      "from": "$space",
                                                                      "to": {
                                                                        "zoneExpr": "available-VC:none"
                                                                      }
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1
                                                              }
                                                            },
                                                            {
                                                              "forEach": {
                                                                "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__piece",
                                                                "macroOrigin": {
                                                                  "macroId": "place-from-available-or-map",
                                                                  "stem": "piece"
                                                                },
                                                                "over": {
                                                                  "query": "tokensInZone",
                                                                  "zone": {
                                                                    "zoneExpr": {
                                                                      "concat": [
                                                                        "available-",
                                                                        "NVA",
                                                                        ":none"
                                                                      ]
                                                                    }
                                                                  },
                                                                  "filter": [
                                                                    {
                                                                      "prop": "type",
                                                                      "op": "eq",
                                                                      "value": "base"
                                                                    }
                                                                  ]
                                                                },
                                                                "effects": [
                                                                  {
                                                                    "moveToken": {
                                                                      "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__piece",
                                                                      "from": {
                                                                        "zoneExpr": {
                                                                          "concat": [
                                                                            "available-",
                                                                            "NVA",
                                                                            ":none"
                                                                          ]
                                                                        }
                                                                      },
                                                                      "to": "$space"
                                                                    }
                                                                  }
                                                                ],
                                                                "limit": 1,
                                                                "countBind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__placed",
                                                                "in": [
                                                                  {
                                                                    "let": {
                                                                      "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__remaining",
                                                                      "value": {
                                                                        "op": "-",
                                                                        "left": 1,
                                                                        "right": {
                                                                          "ref": "binding",
                                                                          "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__placed"
                                                                        }
                                                                      },
                                                                      "in": [
                                                                        {
                                                                          "if": {
                                                                            "when": {
                                                                              "op": "and",
                                                                              "args": [
                                                                                {
                                                                                  "op": "or",
                                                                                  "args": [
                                                                                    {
                                                                                      "op": "!=",
                                                                                      "left": "NVA",
                                                                                      "right": "US"
                                                                                    },
                                                                                    {
                                                                                      "op": "==",
                                                                                      "left": "base",
                                                                                      "right": "irregular"
                                                                                    }
                                                                                  ]
                                                                                },
                                                                                {
                                                                                  "op": ">",
                                                                                  "left": {
                                                                                    "ref": "binding",
                                                                                    "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__remaining"
                                                                                  },
                                                                                  "right": 0
                                                                                }
                                                                              ]
                                                                            },
                                                                            "then": [
                                                                              {
                                                                                "chooseN": {
                                                                                  "internalDecisionId": "decision:doc.actionPipelines.22.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.let.in.2.if.then.2.if.then.2.if.then.0.if.else.1.forEach.in.0.let.in.0.if.then.0.chooseN",
                                                                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__sourceSpaces",
                                                                                  "options": {
                                                                                    "query": "mapSpaces",
                                                                                    "filter": {
                                                                                      "condition": {
                                                                                        "op": ">",
                                                                                        "left": {
                                                                                          "aggregate": {
                                                                                            "op": "count",
                                                                                            "query": {
                                                                                              "query": "tokensInZone",
                                                                                              "zone": "$zone",
                                                                                              "filter": [
                                                                                                {
                                                                                                  "prop": "type",
                                                                                                  "op": "eq",
                                                                                                  "value": "base"
                                                                                                },
                                                                                                {
                                                                                                  "prop": "faction",
                                                                                                  "op": "eq",
                                                                                                  "value": "NVA"
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          }
                                                                                        },
                                                                                        "right": 0
                                                                                      }
                                                                                    }
                                                                                  },
                                                                                  "max": 99,
                                                                                  "min": 0
                                                                                }
                                                                              },
                                                                              {
                                                                                "forEach": {
                                                                                  "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__srcSpace",
                                                                                  "macroOrigin": {
                                                                                    "macroId": "place-from-available-or-map",
                                                                                    "stem": "srcSpace"
                                                                                  },
                                                                                  "over": {
                                                                                    "query": "binding",
                                                                                    "name": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__sourceSpaces"
                                                                                  },
                                                                                  "effects": [
                                                                                    {
                                                                                      "forEach": {
                                                                                        "bind": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__mapPiece",
                                                                                        "macroOrigin": {
                                                                                          "macroId": "place-from-available-or-map",
                                                                                          "stem": "mapPiece"
                                                                                        },
                                                                                        "over": {
                                                                                          "query": "tokensInZone",
                                                                                          "zone": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__srcSpace",
                                                                                          "filter": [
                                                                                            {
                                                                                              "prop": "type",
                                                                                              "op": "eq",
                                                                                              "value": "base"
                                                                                            },
                                                                                            {
                                                                                              "prop": "faction",
                                                                                              "op": "eq",
                                                                                              "value": "NVA"
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        "effects": [
                                                                                          {
                                                                                            "moveToken": {
                                                                                              "token": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__mapPiece",
                                                                                              "from": "$__macro_place_from_available_or_map_actionPipelines_22__stages_1__effects_0__forEach_effects_0__let_in_0__let_in_0__let_in_2__if_then_2__if_then_2__if_then_0__if_else_1__srcSpace",
                                                                                              "to": "$space"
                                                                                            }
                                                                                          }
                                                                                        ],
                                                                                        "limit": 1
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                ]
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    ]
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "infiltrate-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "infiltrateCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "nva-special-window"
      ]
    },
    {
      "id": "bombard-profile",
      "actionId": "bombard",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "accompanyingOps": "any",
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_typhoonKate"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_longRangeGuns"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.23.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">=",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 3
                                  },
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "base"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  }
                                ]
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">=",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 3
                                  },
                                  {
                                    "op": ">=",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInAdjacentZones",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "NVA"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "eq",
                                              "value": "troops"
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 3
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "cap_longRangeGuns"
                        },
                        "right": "shaded"
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.23.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        },
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "base"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        }
                                      ]
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "NVA"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        },
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInAdjacentZones",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "NVA"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 3,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.23.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        },
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "base"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        }
                                      ]
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "NVA"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        },
                                        {
                                          "op": ">=",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInAdjacentZones",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "NVA"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 3
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "let": {
                      "bind": "$usTroopCount",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "troops"
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$arvnTroopCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "eq",
                                      "value": "troops"
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">",
                                    "left": {
                                      "op": "+",
                                      "left": {
                                        "ref": "binding",
                                        "name": "$usTroopCount"
                                      },
                                      "right": {
                                        "ref": "binding",
                                        "name": "$arvnTroopCount"
                                      }
                                    },
                                    "right": 0
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$usTroopCount"
                                              },
                                              "right": 0
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$arvnTroopCount"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.23.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.if.then.0.if.then.0.chooseOne",
                                              "bind": "$bombardFaction@{$space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "US",
                                                  "ARVN"
                                                ]
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$usTroopCount"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.23.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.if.then.0.if.else.0.if.then.0.chooseOne",
                                                    "bind": "$bombardFaction@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "US"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.23.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.if.then.0.if.else.0.if.else.0.chooseOne",
                                                    "bind": "$bombardFaction@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "ARVN"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$bombardFaction@{$space}"
                                          },
                                          "right": "US"
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.23.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.if.then.1.if.then.0.chooseN",
                                              "bind": "$bombardTroops@{$space}",
                                              "options": {
                                                "query": "tokensInZone",
                                                "zone": "$space",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "US"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              },
                                              "max": 1,
                                              "min": 1
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$bombardTroop",
                                              "over": {
                                                "query": "binding",
                                                "name": "$bombardTroops@{$space}"
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$bombardTroop",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "ref": "tokenZone",
                                                        "token": "$bombardTroop"
                                                      }
                                                    },
                                                    "to": {
                                                      "zoneExpr": "casualties-US:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.23.stages[1].effects.0.forEach.effects.0.let.in.0.let.in.0.if.then.1.if.else.0.chooseN",
                                              "bind": "$bombardTroops@{$space}",
                                              "options": {
                                                "query": "tokensInZone",
                                                "zone": "$space",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "ARVN"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              },
                                              "max": 1,
                                              "min": 1
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$bombardTroop",
                                              "over": {
                                                "query": "binding",
                                                "name": "$bombardTroops@{$space}"
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$bombardTroop",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "ref": "tokenZone",
                                                        "token": "$bombardTroop"
                                                      }
                                                    },
                                                    "to": {
                                                      "zoneExpr": "available-ARVN:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "bombard-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "bombardCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "nva-special-window"
      ]
    },
    {
      "id": "nva-ambush-profile",
      "actionId": "ambushNva",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 2
      },
      "accompanyingOps": [
        "march",
        "attack"
      ],
      "compoundParamConstraints": [
        {
          "relation": "subset",
          "operationParam": "targetSpaces",
          "specialActivityParam": "targetSpaces"
        }
      ],
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_claymores"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_boobyTraps"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.24.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "NVA"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "category"
                                        },
                                        "right": "loc"
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInAdjacentZones",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "US",
                                                    "ARVN"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "gvar",
                          "var": "mom_typhoonKate"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.24.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "NVA"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "guerrilla"
                                              },
                                              {
                                                "prop": "activity",
                                                "op": "eq",
                                                "value": "underground"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        },
                                        {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInAdjacentZones",
                                                    "zone": "$zone",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "US",
                                                          "ARVN"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "right": 0
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 1,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.24.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "NVA"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "guerrilla"
                                              },
                                              {
                                                "prop": "activity",
                                                "op": "eq",
                                                "value": "underground"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        },
                                        {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInAdjacentZones",
                                                    "zone": "$zone",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "US",
                                                          "ARVN"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "right": 0
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                "macroOrigin": {
                  "macroId": "insurgent-ambush-resolve-spaces",
                  "stem": "space"
                },
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "forEach": {
                      "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__ambushingGuerrilla",
                      "macroOrigin": {
                        "macroId": "insurgent-ambush-resolve-spaces",
                        "stem": "ambushingGuerrilla"
                      },
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          },
                          {
                            "prop": "activity",
                            "op": "eq",
                            "value": "underground"
                          }
                        ]
                      },
                      "effects": [
                        {
                          "setTokenProp": {
                            "token": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__ambushingGuerrilla",
                            "prop": "activity",
                            "value": "active"
                          }
                        }
                      ],
                      "limit": 1
                    }
                  },
                  {
                    "let": {
                      "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__enemyInSpace",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "in",
                                "value": [
                                  "US",
                                  "ARVN"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__enemyInAdjacent",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInAdjacentZones",
                                  "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "US",
                                        "ARVN"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__enemyInSpace"
                                              },
                                              "right": 0
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__enemyInAdjacent"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.24.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.then.0.chooseOne",
                                              "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "self",
                                                  "adjacent"
                                                ]
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__enemyInAdjacent"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.24.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.else.0.if.then.0.chooseOne",
                                                    "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "adjacent"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.24.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.else.0.if.else.0.chooseOne",
                                                    "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "self"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.24.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.else.0.chooseOne",
                                        "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "self"
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}"
                                    },
                                    "right": "self"
                                  },
                                  "then": [
                                    {
                                      "removeByPriority": {
                                        "budget": 1,
                                        "groups": [
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "neq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "casualties-US:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "neq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "available-ARVN:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "casualties-US:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "available-ARVN:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          }
                                        ],
                                        "macroOrigin": {
                                          "macroId": "insurgent-ambush-remove-coin-piece",
                                          "stem": "target"
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}"
                                    },
                                    "right": "adjacent"
                                  },
                                  "then": [
                                    {
                                      "chooseN": {
                                        "internalDecisionId": "decision:doc.actionPipelines.24.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.2.if.then.0.chooseN",
                                        "bind": "$ambushAdjacentTargets@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}",
                                        "options": {
                                          "query": "mapSpaces",
                                          "filter": {
                                            "condition": {
                                              "op": "and",
                                              "args": [
                                                {
                                                  "op": "adjacent",
                                                  "left": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space",
                                                  "right": "$zone"
                                                },
                                                {
                                                  "op": ">",
                                                  "left": {
                                                    "aggregate": {
                                                      "op": "count",
                                                      "query": {
                                                        "query": "tokensInZone",
                                                        "zone": "$zone",
                                                        "filter": [
                                                          {
                                                            "prop": "faction",
                                                            "op": "in",
                                                            "value": [
                                                              "US",
                                                              "ARVN"
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  "right": 0
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "n": 1
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__adjacentAmbushTarget",
                                        "macroOrigin": {
                                          "macroId": "insurgent-ambush-resolve-spaces",
                                          "stem": "adjacentAmbushTarget"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$ambushAdjacentTargets@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__space}"
                                        },
                                        "effects": [
                                          {
                                            "removeByPriority": {
                                              "budget": 1,
                                              "groups": [
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_24__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_24__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "insurgent-ambush-remove-coin-piece",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "ambush-nva-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "nvaAmbushCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "nva-special-window"
      ]
    },
    {
      "id": "tax-profile",
      "actionId": "tax",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "accompanyingOps": "any",
      "legality": null,
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "gvar",
                    "var": "mom_typhoonKate"
                  },
                  "right": true
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.25.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "<=",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "NVA",
                                                "VC"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.25.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  {
                                    "op": "<=",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "NVA",
                                                "VC"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 4,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$space",
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "forEach": {
                      "bind": "$taxingGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          },
                          {
                            "prop": "activity",
                            "op": "eq",
                            "value": "underground"
                          }
                        ]
                      },
                      "effects": [
                        {
                          "setTokenProp": {
                            "token": "$taxingGuerrilla",
                            "prop": "activity",
                            "value": "active"
                          }
                        }
                      ],
                      "limit": 1
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$space",
                          "prop": "category"
                        },
                        "right": "loc"
                      },
                      "then": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "vcResources",
                            "delta": {
                              "ref": "zoneProp",
                              "zone": "$space",
                              "prop": "econ"
                            }
                          }
                        }
                      ],
                      "else": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "vcResources",
                            "delta": {
                              "op": "*",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$space",
                                "prop": "population"
                              },
                              "right": 2
                            }
                          }
                        },
                        {
                          "if": {
                            "when": {
                              "op": "!=",
                              "left": {
                                "ref": "markerState",
                                "space": "$space",
                                "marker": "supportOpposition"
                              },
                              "right": "activeSupport"
                            },
                            "then": [
                              {
                                "shiftMarker": {
                                  "space": "$space",
                                  "marker": "supportOpposition",
                                  "delta": 1
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "tax-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "taxCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "vc-special-window"
      ]
    },
    {
      "id": "subvert-profile",
      "actionId": "subvert",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "accompanyingOps": [
        "rally",
        "march",
        "terror"
      ],
      "legality": {
        "op": ">",
        "left": {
          "aggregate": {
            "op": "count",
            "query": {
              "query": "mapSpaces",
              "filter": {
                "condition": {
                  "op": "and",
                  "args": [
                    {
                      "op": "!=",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "country"
                      },
                      "right": "northVietnam"
                    },
                    {
                      "op": ">",
                      "left": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$zone",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "VC"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "guerrilla"
                              },
                              {
                                "prop": "activity",
                                "op": "eq",
                                "value": "underground"
                              }
                            ]
                          }
                        }
                      },
                      "right": 0
                    },
                    {
                      "op": "or",
                      "args": [
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "in",
                                    "value": [
                                      "troops",
                                      "police"
                                    ]
                                  }
                                ]
                              }
                            }
                          },
                          "right": 1
                        },
                        {
                          "op": "and",
                          "args": [
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "ARVN"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "in",
                                        "value": [
                                          "troops",
                                          "police"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            },
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "available-VC:none",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "VC"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "guerrilla"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "right": 0
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "gvar",
                    "var": "mom_typhoonKate"
                  },
                  "right": true
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.26.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "ARVN"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "in",
                                              "value": [
                                                "troops",
                                                "police"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 1
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "in",
                                                  "value": [
                                                    "troops",
                                                    "police"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "available-VC:none",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "VC"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.26.stages[0].effects.0.if.else.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "eq",
                                              "value": "ARVN"
                                            },
                                            {
                                              "prop": "type",
                                              "op": "in",
                                              "value": [
                                                "troops",
                                                "police"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 1
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "in",
                                                  "value": [
                                                    "troops",
                                                    "police"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInZone",
                                              "zone": "available-VC:none",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "VC"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "guerrilla"
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 2,
                      "min": 1
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "let": {
                "bind": "$arvnCubesInAvailableBefore",
                "value": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "available-ARVN:none",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "ARVN"
                        },
                        {
                          "prop": "type",
                          "op": "in",
                          "value": [
                            "troops",
                            "police"
                          ]
                        }
                      ]
                    }
                  }
                },
                "in": [
                  {
                    "forEach": {
                      "bind": "$space",
                      "over": {
                        "query": "binding",
                        "name": "targetSpaces"
                      },
                      "effects": [
                        {
                          "let": {
                            "bind": "$arvnCubeCount",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    },
                                    {
                                      "prop": "type",
                                      "op": "in",
                                      "value": [
                                        "troops",
                                        "police"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "let": {
                                  "bind": "$availableVcGuerrillaCount",
                                  "value": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "available-VC:none",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "VC"
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "guerrilla"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "in": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$arvnCubeCount"
                                              },
                                              "right": 1
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$availableVcGuerrillaCount"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.26.stages[1].effects.0.let.in.0.forEach.effects.0.let.in.0.let.in.0.if.then.0.chooseOne",
                                              "bind": "$subvertMode@{$space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "remove-2",
                                                  "replace-1"
                                                ]
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$arvnCubeCount"
                                                },
                                                "right": 1
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.26.stages[1].effects.0.let.in.0.forEach.effects.0.let.in.0.let.in.0.if.else.0.if.then.0.chooseOne",
                                                    "bind": "$subvertMode@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "remove-2"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.26.stages[1].effects.0.let.in.0.forEach.effects.0.let.in.0.let.in.0.if.else.0.if.else.0.chooseOne",
                                                    "bind": "$subvertMode@{$space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "replace-1"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$subvertMode@{$space}"
                                          },
                                          "right": "remove-2"
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.26.stages[1].effects.0.let.in.0.forEach.effects.0.let.in.0.let.in.1.if.then.0.chooseN",
                                              "bind": "$subvertRemovedCubes@{$space}",
                                              "options": {
                                                "query": "tokensInZone",
                                                "zone": "$space",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "ARVN"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "in",
                                                    "value": [
                                                      "troops",
                                                      "police"
                                                    ]
                                                  }
                                                ]
                                              },
                                              "max": 2,
                                              "min": 2
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$removedCube",
                                              "over": {
                                                "query": "binding",
                                                "name": "$subvertRemovedCubes@{$space}"
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$removedCube",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "ref": "tokenZone",
                                                        "token": "$removedCube"
                                                      }
                                                    },
                                                    "to": {
                                                      "zoneExpr": "available-ARVN:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "if": {
                                        "when": {
                                          "op": "==",
                                          "left": {
                                            "ref": "binding",
                                            "name": "$subvertMode@{$space}"
                                          },
                                          "right": "replace-1"
                                        },
                                        "then": [
                                          {
                                            "chooseN": {
                                              "internalDecisionId": "decision:doc.actionPipelines.26.stages[1].effects.0.let.in.0.forEach.effects.0.let.in.0.let.in.2.if.then.0.chooseN",
                                              "bind": "$subvertReplacedCube@{$space}",
                                              "options": {
                                                "query": "tokensInZone",
                                                "zone": "$space",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "ARVN"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "in",
                                                    "value": [
                                                      "troops",
                                                      "police"
                                                    ]
                                                  }
                                                ]
                                              },
                                              "max": 1,
                                              "min": 1
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$replacedCube",
                                              "over": {
                                                "query": "binding",
                                                "name": "$subvertReplacedCube@{$space}"
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$replacedCube",
                                                    "from": {
                                                      "zoneExpr": {
                                                        "ref": "tokenZone",
                                                        "token": "$replacedCube"
                                                      }
                                                    },
                                                    "to": {
                                                      "zoneExpr": "available-ARVN:none"
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "forEach": {
                                              "bind": "$replacementVcGuerrilla",
                                              "over": {
                                                "query": "tokensInZone",
                                                "zone": "available-VC:none",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "VC"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "guerrilla"
                                                  }
                                                ]
                                              },
                                              "effects": [
                                                {
                                                  "moveToken": {
                                                    "token": "$replacementVcGuerrilla",
                                                    "from": {
                                                      "zoneExpr": "available-VC:none"
                                                    },
                                                    "to": {
                                                      "zoneExpr": "$space"
                                                    }
                                                  }
                                                }
                                              ],
                                              "limit": 1
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  {
                    "let": {
                      "bind": "$arvnCubesInAvailableAfter",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "available-ARVN:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "police"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$arvnCubesAffected",
                            "value": {
                              "op": "-",
                              "left": {
                                "ref": "binding",
                                "name": "$arvnCubesInAvailableAfter"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "$arvnCubesInAvailableBefore"
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": ">",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$arvnCubesAffected"
                                    },
                                    "right": 0
                                  },
                                  "then": [
                                    {
                                      "addVar": {
                                        "scope": "global",
                                        "var": "patronage",
                                        "delta": {
                                          "op": "*",
                                          "left": -1,
                                          "right": {
                                            "op": "floorDiv",
                                            "left": {
                                              "ref": "binding",
                                              "name": "$arvnCubesAffected"
                                            },
                                            "right": 2
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "subvert-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "subvertCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "vc-special-window"
      ]
    },
    {
      "id": "vc-ambush-profile",
      "actionId": "ambushVc",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "accompanyingOps": [
        "march",
        "attack"
      ],
      "compoundParamConstraints": [
        {
          "relation": "subset",
          "operationParam": "targetSpaces",
          "specialActivityParam": "targetSpaces"
        }
      ],
      "legality": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "binding",
              "name": "__freeOperation"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "gvar",
              "var": "mom_claymores"
            },
            "right": true
          }
        ]
      },
      "costValidation": null,
      "costEffects": [],
      "targeting": {},
      "stages": [
        {
          "stage": "select-spaces",
          "effects": [
            {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "cap_boobyTraps"
                  },
                  "right": "unshaded"
                },
                "then": [
                  {
                    "chooseN": {
                      "internalDecisionId": "decision:doc.actionPipelines.27.stages[0].effects.0.if.then.0.chooseN",
                      "bind": "targetSpaces",
                      "options": {
                        "query": "mapSpaces",
                        "filter": {
                          "condition": {
                            "op": "and",
                            "args": [
                              {
                                "op": "!=",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "northVietnam"
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "eq",
                                          "value": "VC"
                                        },
                                        {
                                          "prop": "type",
                                          "op": "eq",
                                          "value": "guerrilla"
                                        },
                                        {
                                          "prop": "activity",
                                          "op": "eq",
                                          "value": "underground"
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": 0
                              },
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": ">",
                                    "left": {
                                      "aggregate": {
                                        "op": "count",
                                        "query": {
                                          "query": "tokensInZone",
                                          "zone": "$zone",
                                          "filter": [
                                            {
                                              "prop": "faction",
                                              "op": "in",
                                              "value": [
                                                "US",
                                                "ARVN"
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "right": 0
                                  },
                                  {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "==",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "category"
                                        },
                                        "right": "loc"
                                      },
                                      {
                                        "op": ">",
                                        "left": {
                                          "aggregate": {
                                            "op": "count",
                                            "query": {
                                              "query": "tokensInAdjacentZones",
                                              "zone": "$zone",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "in",
                                                  "value": [
                                                    "US",
                                                    "ARVN"
                                                  ]
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "right": 0
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "max": 1,
                      "min": 1
                    }
                  }
                ],
                "else": [
                  {
                    "if": {
                      "when": {
                        "op": "==",
                        "left": {
                          "ref": "gvar",
                          "var": "mom_typhoonKate"
                        },
                        "right": true
                      },
                      "then": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.27.stages[0].effects.0.if.else.0.if.then.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "VC"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "guerrilla"
                                              },
                                              {
                                                "prop": "activity",
                                                "op": "eq",
                                                "value": "underground"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        },
                                        {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInAdjacentZones",
                                                    "zone": "$zone",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "US",
                                                          "ARVN"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "right": 0
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 1,
                            "min": 1
                          }
                        }
                      ],
                      "else": [
                        {
                          "chooseN": {
                            "internalDecisionId": "decision:doc.actionPipelines.27.stages[0].effects.0.if.else.0.if.else.0.chooseN",
                            "bind": "targetSpaces",
                            "options": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "northVietnam"
                                    },
                                    {
                                      "op": ">",
                                      "left": {
                                        "aggregate": {
                                          "op": "count",
                                          "query": {
                                            "query": "tokensInZone",
                                            "zone": "$zone",
                                            "filter": [
                                              {
                                                "prop": "faction",
                                                "op": "eq",
                                                "value": "VC"
                                              },
                                              {
                                                "prop": "type",
                                                "op": "eq",
                                                "value": "guerrilla"
                                              },
                                              {
                                                "prop": "activity",
                                                "op": "eq",
                                                "value": "underground"
                                              }
                                            ]
                                          }
                                        }
                                      },
                                      "right": 0
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": 0
                                        },
                                        {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "aggregate": {
                                                  "op": "count",
                                                  "query": {
                                                    "query": "tokensInAdjacentZones",
                                                    "zone": "$zone",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "in",
                                                        "value": [
                                                          "US",
                                                          "ARVN"
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                }
                                              },
                                              "right": 0
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "max": 2,
                            "min": 1
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "resolve-per-space",
          "effects": [
            {
              "forEach": {
                "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                "macroOrigin": {
                  "macroId": "insurgent-ambush-resolve-spaces",
                  "stem": "space"
                },
                "over": {
                  "query": "binding",
                  "name": "targetSpaces"
                },
                "effects": [
                  {
                    "forEach": {
                      "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__ambushingGuerrilla",
                      "macroOrigin": {
                        "macroId": "insurgent-ambush-resolve-spaces",
                        "stem": "ambushingGuerrilla"
                      },
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          },
                          {
                            "prop": "activity",
                            "op": "eq",
                            "value": "underground"
                          }
                        ]
                      },
                      "effects": [
                        {
                          "setTokenProp": {
                            "token": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__ambushingGuerrilla",
                            "prop": "activity",
                            "value": "active"
                          }
                        }
                      ],
                      "limit": 1
                    }
                  },
                  {
                    "let": {
                      "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__enemyInSpace",
                      "value": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "in",
                                "value": [
                                  "US",
                                  "ARVN"
                                ]
                              }
                            ]
                          }
                        }
                      },
                      "in": [
                        {
                          "let": {
                            "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__enemyInAdjacent",
                            "value": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInAdjacentZones",
                                  "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "US",
                                        "ARVN"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "in": [
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                      "prop": "category"
                                    },
                                    "right": "loc"
                                  },
                                  "then": [
                                    {
                                      "if": {
                                        "when": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__enemyInSpace"
                                              },
                                              "right": 0
                                            },
                                            {
                                              "op": ">",
                                              "left": {
                                                "ref": "binding",
                                                "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__enemyInAdjacent"
                                              },
                                              "right": 0
                                            }
                                          ]
                                        },
                                        "then": [
                                          {
                                            "chooseOne": {
                                              "internalDecisionId": "decision:doc.actionPipelines.27.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.then.0.chooseOne",
                                              "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}",
                                              "options": {
                                                "query": "enums",
                                                "values": [
                                                  "self",
                                                  "adjacent"
                                                ]
                                              }
                                            }
                                          }
                                        ],
                                        "else": [
                                          {
                                            "if": {
                                              "when": {
                                                "op": ">",
                                                "left": {
                                                  "ref": "binding",
                                                  "name": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__enemyInAdjacent"
                                                },
                                                "right": 0
                                              },
                                              "then": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.27.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.else.0.if.then.0.chooseOne",
                                                    "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "adjacent"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ],
                                              "else": [
                                                {
                                                  "chooseOne": {
                                                    "internalDecisionId": "decision:doc.actionPipelines.27.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.then.0.if.else.0.if.else.0.chooseOne",
                                                    "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}",
                                                    "options": {
                                                      "query": "enums",
                                                      "values": [
                                                        "self"
                                                      ]
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "else": [
                                    {
                                      "chooseOne": {
                                        "internalDecisionId": "decision:doc.actionPipelines.27.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.0.if.else.0.chooseOne",
                                        "bind": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}",
                                        "options": {
                                          "query": "enums",
                                          "values": [
                                            "self"
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}"
                                    },
                                    "right": "self"
                                  },
                                  "then": [
                                    {
                                      "removeByPriority": {
                                        "budget": {
                                          "if": {
                                            "when": {
                                              "op": "==",
                                              "left": {
                                                "ref": "globalMarkerState",
                                                "marker": "cap_mainForceBns"
                                              },
                                              "right": "shaded"
                                            },
                                            "then": 2,
                                            "else": 1
                                          }
                                        },
                                        "groups": [
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "neq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "casualties-US:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "neq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "available-ARVN:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "US"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "casualties-US:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          },
                                          {
                                            "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_1__if_then_0__target",
                                            "over": {
                                              "query": "tokensInZone",
                                              "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                              "filter": [
                                                {
                                                  "prop": "faction",
                                                  "op": "eq",
                                                  "value": "ARVN"
                                                },
                                                {
                                                  "prop": "type",
                                                  "op": "eq",
                                                  "value": "base"
                                                }
                                              ]
                                            },
                                            "to": {
                                              "zoneExpr": "available-ARVN:none"
                                            },
                                            "macroOrigin": {
                                              "macroId": "insurgent-ambush-remove-coin-piece",
                                              "stem": "target"
                                            }
                                          }
                                        ],
                                        "macroOrigin": {
                                          "macroId": "insurgent-ambush-remove-coin-piece",
                                          "stem": "target"
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              {
                                "if": {
                                  "when": {
                                    "op": "==",
                                    "left": {
                                      "ref": "binding",
                                      "name": "$ambushTargetMode@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}"
                                    },
                                    "right": "adjacent"
                                  },
                                  "then": [
                                    {
                                      "chooseN": {
                                        "internalDecisionId": "decision:doc.actionPipelines.27.stages[1].effects.0.forEach.effects.1.let.in.0.let.in.2.if.then.0.chooseN",
                                        "bind": "$ambushAdjacentTargets@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}",
                                        "options": {
                                          "query": "mapSpaces",
                                          "filter": {
                                            "condition": {
                                              "op": "and",
                                              "args": [
                                                {
                                                  "op": "adjacent",
                                                  "left": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space",
                                                  "right": "$zone"
                                                },
                                                {
                                                  "op": ">",
                                                  "left": {
                                                    "aggregate": {
                                                      "op": "count",
                                                      "query": {
                                                        "query": "tokensInZone",
                                                        "zone": "$zone",
                                                        "filter": [
                                                          {
                                                            "prop": "faction",
                                                            "op": "in",
                                                            "value": [
                                                              "US",
                                                              "ARVN"
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  "right": 0
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        "n": 1
                                      }
                                    },
                                    {
                                      "forEach": {
                                        "bind": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__adjacentAmbushTarget",
                                        "macroOrigin": {
                                          "macroId": "insurgent-ambush-resolve-spaces",
                                          "stem": "adjacentAmbushTarget"
                                        },
                                        "over": {
                                          "query": "binding",
                                          "name": "$ambushAdjacentTargets@{$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__space}"
                                        },
                                        "effects": [
                                          {
                                            "removeByPriority": {
                                              "budget": {
                                                "if": {
                                                  "when": {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "globalMarkerState",
                                                      "marker": "cap_mainForceBns"
                                                    },
                                                    "right": "shaded"
                                                  },
                                                  "then": 2,
                                                  "else": 1
                                                }
                                              },
                                              "groups": [
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "neq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "US"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "casualties-US:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                },
                                                {
                                                  "bind": "$__macro_insurgent_ambush_remove_coin_piece_actionPipelines_27__stages_1__effects_0__macro_insurgent_ambush_resolve_spaces__0__forEach_effects_1__let_in_0__let_in_2__if_then_1__forEach_effects_0__target",
                                                  "over": {
                                                    "query": "tokensInZone",
                                                    "zone": "$__macro_insurgent_ambush_resolve_spaces_actionPipelines_27__stages_1__effects_0__adjacentAmbushTarget",
                                                    "filter": [
                                                      {
                                                        "prop": "faction",
                                                        "op": "eq",
                                                        "value": "ARVN"
                                                      },
                                                      {
                                                        "prop": "type",
                                                        "op": "eq",
                                                        "value": "base"
                                                      }
                                                    ]
                                                  },
                                                  "to": {
                                                    "zoneExpr": "available-ARVN:none"
                                                  },
                                                  "macroOrigin": {
                                                    "macroId": "insurgent-ambush-remove-coin-piece",
                                                    "stem": "target"
                                                  }
                                                }
                                              ],
                                              "macroOrigin": {
                                                "macroId": "insurgent-ambush-remove-coin-piece",
                                                "stem": "target"
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        },
        {
          "stage": "ambush-vc-telemetry",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "vcAmbushCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic",
      "linkedWindows": [
        "vc-special-window"
      ]
    },
    {
      "id": "us-op-profile",
      "actionId": "usOp",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "legality": null,
      "costValidation": {
        "op": ">=",
        "left": {
          "ref": "pvar",
          "player": {
            "id": 1
          },
          "var": "resources"
        },
        "right": {
          "op": "+",
          "left": {
            "ref": "gvar",
            "var": "totalEcon"
          },
          "right": 5
        }
      },
      "costEffects": [
        {
          "addVar": {
            "scope": "pvar",
            "player": {
              "id": 1
            },
            "var": "resources",
            "delta": -5
          }
        }
      ],
      "targeting": {
        "select": "allEligible",
        "order": "lexicographicSpaceId"
      },
      "stages": [
        {
          "stage": "us-resolve",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "usOpCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    },
    {
      "id": "arvn-op-profile",
      "actionId": "arvnOp",
      "applicability": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 1
      },
      "legality": null,
      "costValidation": {
        "op": ">=",
        "left": {
          "ref": "pvar",
          "player": "active",
          "var": "resources"
        },
        "right": 5
      },
      "costEffects": [
        {
          "addVar": {
            "scope": "pvar",
            "player": "active",
            "var": "resources",
            "delta": -5
          }
        }
      ],
      "targeting": {
        "select": "allEligible",
        "order": "lexicographicSpaceId"
      },
      "stages": [
        {
          "stage": "arvn-resolve",
          "effects": [
            {
              "addVar": {
                "scope": "global",
                "var": "arvnOpCount",
                "delta": 1
              }
            }
          ]
        }
      ],
      "atomicity": "atomic"
    }
  ],
  "actions": [
    {
      "id": "pass",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "coupVictoryCheck",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupVictory"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": [
        {
          "scope": "phase",
          "max": 1
        }
      ]
    },
    {
      "id": "coupResourcesResolve",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupResources"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [
        {
          "let": {
            "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__remaining",
            "value": {
              "op": "-",
              "left": 15,
              "right": {
                "ref": "gvar",
                "var": "terrorSabotageMarkersPlaced"
              }
            },
            "in": [
              {
                "if": {
                  "when": {
                    "op": ">",
                    "left": {
                      "ref": "binding",
                      "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__remaining"
                    },
                    "right": 0
                  },
                  "then": [
                    {
                      "let": {
                        "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__eligibleCount",
                        "value": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "and",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "category"
                                      },
                                      "right": "loc"
                                    },
                                    {
                                      "op": "!=",
                                      "left": {
                                        "ref": "markerState",
                                        "space": "$zone",
                                        "marker": "sabotage"
                                      },
                                      "right": "sabotage"
                                    },
                                    {
                                      "op": "or",
                                      "args": [
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "NVA",
                                                      "VC"
                                                    ]
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "guerrilla"
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "right": {
                                            "aggregate": {
                                              "op": "count",
                                              "query": {
                                                "query": "tokensInZone",
                                                "zone": "$zone",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "in",
                                                    "value": [
                                                      "US",
                                                      "ARVN"
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "op": ">",
                                          "left": {
                                            "aggregate": {
                                              "op": "sum",
                                              "query": {
                                                "query": "adjacentZones",
                                                "zone": "$zone"
                                              },
                                              "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                              "valueExpr": {
                                                "if": {
                                                  "when": {
                                                    "op": "and",
                                                    "args": [
                                                      {
                                                        "op": "==",
                                                        "left": {
                                                          "ref": "zoneProp",
                                                          "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                          "prop": "category"
                                                        },
                                                        "right": "city"
                                                      },
                                                      {
                                                        "op": "<=",
                                                        "left": {
                                                          "aggregate": {
                                                            "op": "count",
                                                            "query": {
                                                              "query": "tokensInZone",
                                                              "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                              "filter": [
                                                                {
                                                                  "prop": "faction",
                                                                  "op": "in",
                                                                  "value": [
                                                                    "US",
                                                                    "ARVN"
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          }
                                                        },
                                                        "right": {
                                                          "aggregate": {
                                                            "op": "count",
                                                            "query": {
                                                              "query": "tokensInZone",
                                                              "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                              "filter": [
                                                                {
                                                                  "prop": "faction",
                                                                  "op": "in",
                                                                  "value": [
                                                                    "NVA",
                                                                    "VC"
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  },
                                                  "then": 1,
                                                  "else": 0
                                                }
                                              }
                                            }
                                          },
                                          "right": 0
                                        }
                                      ]
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        },
                        "in": [
                          {
                            "if": {
                              "when": {
                                "op": "<=",
                                "left": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__eligibleCount"
                                },
                                "right": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__remaining"
                                }
                              },
                              "then": [
                                {
                                  "forEach": {
                                    "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__loc",
                                    "macroOrigin": {
                                      "macroId": "coup-auto-sabotage",
                                      "stem": "loc"
                                    },
                                    "over": {
                                      "query": "mapSpaces",
                                      "filter": {
                                        "condition": {
                                          "op": "and",
                                          "args": [
                                            {
                                              "op": "==",
                                              "left": {
                                                "ref": "zoneProp",
                                                "zone": "$zone",
                                                "prop": "category"
                                              },
                                              "right": "loc"
                                            },
                                            {
                                              "op": "!=",
                                              "left": {
                                                "ref": "markerState",
                                                "space": "$zone",
                                                "marker": "sabotage"
                                              },
                                              "right": "sabotage"
                                            },
                                            {
                                              "op": "or",
                                              "args": [
                                                {
                                                  "op": ">",
                                                  "left": {
                                                    "aggregate": {
                                                      "op": "count",
                                                      "query": {
                                                        "query": "tokensInZone",
                                                        "zone": "$zone",
                                                        "filter": [
                                                          {
                                                            "prop": "faction",
                                                            "op": "in",
                                                            "value": [
                                                              "NVA",
                                                              "VC"
                                                            ]
                                                          },
                                                          {
                                                            "prop": "type",
                                                            "op": "eq",
                                                            "value": "guerrilla"
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  "right": {
                                                    "aggregate": {
                                                      "op": "count",
                                                      "query": {
                                                        "query": "tokensInZone",
                                                        "zone": "$zone",
                                                        "filter": [
                                                          {
                                                            "prop": "faction",
                                                            "op": "in",
                                                            "value": [
                                                              "US",
                                                              "ARVN"
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "op": ">",
                                                  "left": {
                                                    "aggregate": {
                                                      "op": "sum",
                                                      "query": {
                                                        "query": "adjacentZones",
                                                        "zone": "$zone"
                                                      },
                                                      "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                      "valueExpr": {
                                                        "if": {
                                                          "when": {
                                                            "op": "and",
                                                            "args": [
                                                              {
                                                                "op": "==",
                                                                "left": {
                                                                  "ref": "zoneProp",
                                                                  "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                  "prop": "category"
                                                                },
                                                                "right": "city"
                                                              },
                                                              {
                                                                "op": "<=",
                                                                "left": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "US",
                                                                            "ARVN"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                },
                                                                "right": {
                                                                  "aggregate": {
                                                                    "op": "count",
                                                                    "query": {
                                                                      "query": "tokensInZone",
                                                                      "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                      "filter": [
                                                                        {
                                                                          "prop": "faction",
                                                                          "op": "in",
                                                                          "value": [
                                                                            "NVA",
                                                                            "VC"
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            ]
                                                          },
                                                          "then": 1,
                                                          "else": 0
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "right": 0
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    "effects": [
                                      {
                                        "setMarker": {
                                          "space": "$__macro_coup_auto_sabotage_actions_2__effects_0__loc",
                                          "marker": "sabotage",
                                          "state": "sabotage"
                                        }
                                      },
                                      {
                                        "addVar": {
                                          "scope": "global",
                                          "var": "terrorSabotageMarkersPlaced",
                                          "delta": 1
                                        }
                                      }
                                    ]
                                  }
                                }
                              ],
                              "else": [
                                {
                                  "let": {
                                    "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__priorActivePlayer",
                                    "value": {
                                      "ref": "activePlayer"
                                    },
                                    "in": [
                                      {
                                        "setActivePlayer": {
                                          "player": {
                                            "id": 3
                                          }
                                        }
                                      },
                                      {
                                        "chooseN": {
                                          "internalDecisionId": "decision:doc.actions.2.effects.0.let.in.0.if.then.0.let.in.0.if.else.0.let.in.1.chooseN",
                                          "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__chosenLocs",
                                          "options": {
                                            "query": "mapSpaces",
                                            "filter": {
                                              "condition": {
                                                "op": "and",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "loc"
                                                  },
                                                  {
                                                    "op": "!=",
                                                    "left": {
                                                      "ref": "markerState",
                                                      "space": "$zone",
                                                      "marker": "sabotage"
                                                    },
                                                    "right": "sabotage"
                                                  },
                                                  {
                                                    "op": "or",
                                                    "args": [
                                                      {
                                                        "op": ">",
                                                        "left": {
                                                          "aggregate": {
                                                            "op": "count",
                                                            "query": {
                                                              "query": "tokensInZone",
                                                              "zone": "$zone",
                                                              "filter": [
                                                                {
                                                                  "prop": "faction",
                                                                  "op": "in",
                                                                  "value": [
                                                                    "NVA",
                                                                    "VC"
                                                                  ]
                                                                },
                                                                {
                                                                  "prop": "type",
                                                                  "op": "eq",
                                                                  "value": "guerrilla"
                                                                }
                                                              ]
                                                            }
                                                          }
                                                        },
                                                        "right": {
                                                          "aggregate": {
                                                            "op": "count",
                                                            "query": {
                                                              "query": "tokensInZone",
                                                              "zone": "$zone",
                                                              "filter": [
                                                                {
                                                                  "prop": "faction",
                                                                  "op": "in",
                                                                  "value": [
                                                                    "US",
                                                                    "ARVN"
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          }
                                                        }
                                                      },
                                                      {
                                                        "op": ">",
                                                        "left": {
                                                          "aggregate": {
                                                            "op": "sum",
                                                            "query": {
                                                              "query": "adjacentZones",
                                                              "zone": "$zone"
                                                            },
                                                            "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                            "valueExpr": {
                                                              "if": {
                                                                "when": {
                                                                  "op": "and",
                                                                  "args": [
                                                                    {
                                                                      "op": "==",
                                                                      "left": {
                                                                        "ref": "zoneProp",
                                                                        "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                        "prop": "category"
                                                                      },
                                                                      "right": "city"
                                                                    },
                                                                    {
                                                                      "op": "<=",
                                                                      "left": {
                                                                        "aggregate": {
                                                                          "op": "count",
                                                                          "query": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "in",
                                                                                "value": [
                                                                                  "US",
                                                                                  "ARVN"
                                                                                ]
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      },
                                                                      "right": {
                                                                        "aggregate": {
                                                                          "op": "count",
                                                                          "query": {
                                                                            "query": "tokensInZone",
                                                                            "zone": "$__macro_coup_auto_sabotage_actions_2__effects_0__adj",
                                                                            "filter": [
                                                                              {
                                                                                "prop": "faction",
                                                                                "op": "in",
                                                                                "value": [
                                                                                  "NVA",
                                                                                  "VC"
                                                                                ]
                                                                              }
                                                                            ]
                                                                          }
                                                                        }
                                                                      }
                                                                    }
                                                                  ]
                                                                },
                                                                "then": 1,
                                                                "else": 0
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "right": 0
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            }
                                          },
                                          "max": {
                                            "ref": "binding",
                                            "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__remaining"
                                          },
                                          "min": {
                                            "ref": "binding",
                                            "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__remaining"
                                          }
                                        }
                                      },
                                      {
                                        "setActivePlayer": {
                                          "player": {
                                            "chosen": "$__macro_coup_auto_sabotage_actions_2__effects_0__priorActivePlayer"
                                          }
                                        }
                                      },
                                      {
                                        "forEach": {
                                          "bind": "$__macro_coup_auto_sabotage_actions_2__effects_0__loc",
                                          "macroOrigin": {
                                            "macroId": "coup-auto-sabotage",
                                            "stem": "loc"
                                          },
                                          "over": {
                                            "query": "binding",
                                            "name": "$__macro_coup_auto_sabotage_actions_2__effects_0__chosenLocs"
                                          },
                                          "effects": [
                                            {
                                              "setMarker": {
                                                "space": "$__macro_coup_auto_sabotage_actions_2__effects_0__loc",
                                                "marker": "sabotage",
                                                "state": "sabotage"
                                              }
                                            },
                                            {
                                              "addVar": {
                                                "scope": "global",
                                                "var": "terrorSabotageMarkersPlaced",
                                                "delta": 1
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "if": {
            "when": {
              "op": ">",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "mapSpaces",
                    "filter": {
                      "condition": {
                        "op": "and",
                        "args": [
                          {
                            "op": "or",
                            "args": [
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "laos"
                              },
                              {
                                "op": "==",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$zone",
                                  "prop": "country"
                                },
                                "right": "cambodia"
                              }
                            ]
                          },
                          {
                            "op": ">",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "US",
                                        "ARVN"
                                      ]
                                    }
                                  ]
                                }
                              }
                            },
                            "right": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "in",
                                      "value": [
                                        "NVA",
                                        "VC"
                                      ]
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  }
                }
              },
              "right": 0
            },
            "then": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": -1
                }
              }
            ]
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "totalEcon",
            "value": 15
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_arvn_earnings_actions_2__effects_2__sabotagedLoc",
            "macroOrigin": {
              "macroId": "coup-arvn-earnings",
              "stem": "sabotagedLoc"
            },
            "over": {
              "query": "mapSpaces",
              "filter": {
                "condition": {
                  "op": "and",
                  "args": [
                    {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "loc"
                    },
                    {
                      "op": "==",
                      "left": {
                        "ref": "markerState",
                        "space": "$zone",
                        "marker": "sabotage"
                      },
                      "right": "sabotage"
                    }
                  ]
                }
              }
            },
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "totalEcon",
                  "delta": {
                    "op": "-",
                    "left": 0,
                    "right": {
                      "ref": "zoneProp",
                      "zone": "$__macro_coup_arvn_earnings_actions_2__effects_2__sabotagedLoc",
                      "prop": "econ"
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "arvnResources",
            "delta": {
              "op": "+",
              "left": {
                "ref": "gvar",
                "var": "aid"
              },
              "right": {
                "ref": "gvar",
                "var": "totalEcon"
              }
            }
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "vcResources",
            "delta": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInMapSpaces",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "VC"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "base"
                    }
                  ]
                }
              }
            }
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "nvaResources",
            "delta": {
              "op": "+",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "laos"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "cambodia"
                          }
                        ]
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "base"
                      }
                    ]
                  }
                }
              },
              "right": {
                "op": "*",
                "left": 2,
                "right": {
                  "ref": "gvar",
                  "var": "trail"
                }
              }
            }
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "aid",
            "delta": {
              "op": "-",
              "left": 0,
              "right": {
                "op": "*",
                "left": 3,
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "casualties-US:none"
                    }
                  }
                }
              }
            }
          }
        }
      ],
      "limits": [
        {
          "scope": "phase",
          "max": 1
        }
      ]
    },
    {
      "id": "coupPacifyPass",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupSupport"
      ],
      "params": [],
      "pre": {
        "op": "or",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 0
          },
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 1
          }
        ]
      },
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "coupAgitatePass",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupSupport"
      ],
      "params": [],
      "pre": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 3
      },
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "coupPacifyUS",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupSupport"
      ],
      "params": [
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces",
            "filter": {
              "condition": {
                "op": "or",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "city"
                  },
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "province"
                  }
                ]
              }
            }
          }
        },
        {
          "name": "action",
          "domain": {
            "query": "enums",
            "values": [
              "removeTerror",
              "shiftSupport"
            ]
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 0
          },
          {
            "op": "or",
            "args": [
              {
                "op": "<",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "coupPacifySpaceUsage"
                          },
                          "right": "used"
                        }
                      }
                    }
                  }
                },
                "right": 4
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "coupPacifySpaceUsage"
                              },
                              "right": "used"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "US",
                        "ARVN"
                      ]
                    }
                  ]
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "NVA",
                        "VC"
                      ]
                    }
                  ]
                }
              }
            }
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "police"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "US"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": {
              "op": "+",
              "left": {
                "ref": "gvar",
                "var": "totalEcon"
              },
              "right": {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "activeLeader"
                    },
                    "right": "ky"
                  },
                  "then": 4,
                  "else": 3
                }
              }
            }
          },
          {
            "op": "or",
            "args": [
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "removeTerror"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": ">",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              },
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "shiftSupport"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "supportOpposition"
                                  },
                                  "right": "activeSupport"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "coupSupportShiftCount"
                                  },
                                  "right": "two"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "arvnResources",
            "delta": {
              "op": "*",
              "left": 1,
              "right": {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "activeLeader"
                    },
                    "right": "ky"
                  },
                  "then": -4,
                  "else": -3
                }
              }
            }
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "action"
              },
              "right": "removeTerror"
            },
            "then": [
              {
                "setVar": {
                  "scope": "zoneVar",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "var": "terrorCount",
                  "value": 0
                }
              }
            ],
            "else": [
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "coupSupportShiftCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "setMarker": {
            "space": {
              "zoneExpr": {
                "ref": "binding",
                "name": "targetSpace"
              }
            },
            "marker": "coupPacifySpaceUsage",
            "state": "used"
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupPacifyARVN",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupSupport"
      ],
      "params": [
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces",
            "filter": {
              "condition": {
                "op": "or",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "city"
                  },
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "province"
                  }
                ]
              }
            }
          }
        },
        {
          "name": "action",
          "domain": {
            "query": "enums",
            "values": [
              "removeTerror",
              "shiftSupport"
            ]
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 1
          },
          {
            "op": "or",
            "args": [
              {
                "op": "<",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "coupPacifySpaceUsage"
                          },
                          "right": "used"
                        }
                      }
                    }
                  }
                },
                "right": 4
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "coupPacifySpaceUsage"
                              },
                              "right": "used"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "US",
                        "ARVN"
                      ]
                    }
                  ]
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "NVA",
                        "VC"
                      ]
                    }
                  ]
                }
              }
            }
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "police"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "arvnResources"
            },
            "right": {
              "if": {
                "when": {
                  "op": "==",
                  "left": {
                    "ref": "globalMarkerState",
                    "marker": "activeLeader"
                  },
                  "right": "ky"
                },
                "then": 4,
                "else": 3
              }
            }
          },
          {
            "op": "or",
            "args": [
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "removeTerror"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": ">",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              },
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "shiftSupport"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "supportOpposition"
                                  },
                                  "right": "activeSupport"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "coupSupportShiftCount"
                                  },
                                  "right": "two"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "arvnResources",
            "delta": {
              "op": "*",
              "left": 1,
              "right": {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "activeLeader"
                    },
                    "right": "ky"
                  },
                  "then": -4,
                  "else": -3
                }
              }
            }
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "action"
              },
              "right": "removeTerror"
            },
            "then": [
              {
                "setVar": {
                  "scope": "zoneVar",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "var": "terrorCount",
                  "value": 0
                }
              }
            ],
            "else": [
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "coupSupportShiftCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "setMarker": {
            "space": {
              "zoneExpr": {
                "ref": "binding",
                "name": "targetSpace"
              }
            },
            "marker": "coupPacifySpaceUsage",
            "state": "used"
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupAgitateVC",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupSupport"
      ],
      "params": [
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces",
            "filter": {
              "condition": {
                "op": "or",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "city"
                  },
                  {
                    "op": "==",
                    "left": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "category"
                    },
                    "right": "province"
                  }
                ]
              }
            }
          }
        },
        {
          "name": "action",
          "domain": {
            "query": "enums",
            "values": [
              "removeTerror",
              "shiftOpposition"
            ]
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 3
          },
          {
            "op": "or",
            "args": [
              {
                "op": "<",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "coupAgitateSpaceUsage"
                          },
                          "right": "used"
                        }
                      }
                    }
                  }
                },
                "right": 4
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "coupAgitateSpaceUsage"
                              },
                              "right": "used"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "VC"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": "<=",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "US",
                        "ARVN"
                      ]
                    }
                  ]
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "NVA",
                        "VC"
                      ]
                    }
                  ]
                }
              }
            }
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "vcResources"
            },
            "right": 1
          },
          {
            "op": "or",
            "args": [
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "removeTerror"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": ">",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              },
              {
                "op": "and",
                "args": [
                  {
                    "op": "==",
                    "left": {
                      "ref": "binding",
                      "name": "action"
                    },
                    "right": "shiftOpposition"
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneVar",
                                    "zone": "$zone",
                                    "var": "terrorCount"
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "supportOpposition"
                                  },
                                  "right": "activeOpposition"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "!=",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "coupSupportShiftCount"
                                  },
                                  "right": "two"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  }
                ]
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "vcResources",
            "delta": -1
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "action"
              },
              "right": "removeTerror"
            },
            "then": [
              {
                "setVar": {
                  "scope": "zoneVar",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "var": "terrorCount",
                  "value": 0
                }
              }
            ],
            "else": [
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "shiftMarker": {
                  "space": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "marker": "coupSupportShiftCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "setMarker": {
            "space": {
              "zoneExpr": {
                "ref": "binding",
                "name": "targetSpace"
              }
            },
            "marker": "coupAgitateSpaceUsage",
            "state": "used"
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupArvnRedeployMandatory",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupRedeploy"
      ],
      "params": [
        {
          "name": "sourceSpace",
          "domain": {
            "query": "mapSpaces"
          }
        },
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces"
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 1
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": "or",
            "args": [
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "sourceSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "loc"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "sourceSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "province"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": "==",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "in",
                      "value": [
                        "US",
                        "ARVN"
                      ]
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "base"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": "or",
            "args": [
              {
                "op": "and",
                "args": [
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "category"
                                  },
                                  "right": "city"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": "<=",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": {
                            "zoneExpr": {
                              "ref": "binding",
                              "name": "targetSpace"
                            }
                          },
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "eq",
                              "value": "NVA"
                            }
                          ]
                        }
                      }
                    },
                    "right": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": {
                            "zoneExpr": {
                              "ref": "binding",
                              "name": "targetSpace"
                            }
                          },
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "in",
                              "value": [
                                "US",
                                "ARVN",
                                "VC"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": {
                        "zoneExpr": {
                          "ref": "binding",
                          "name": "targetSpace"
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "in",
                          "value": [
                            "US",
                            "ARVN"
                          ]
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "base"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": "saigon:none"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "forEach": {
            "bind": "$movedTroop",
            "over": {
              "query": "tokensInZone",
              "zone": {
                "zoneExpr": {
                  "ref": "binding",
                  "name": "sourceSpace"
                }
              },
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "ARVN"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "troops"
                }
              ]
            },
            "effects": [
              {
                "moveToken": {
                  "token": "$movedTroop",
                  "from": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  }
                }
              }
            ],
            "limit": 1
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupArvnRedeployOptionalTroops",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupRedeploy"
      ],
      "params": [
        {
          "name": "sourceSpace",
          "domain": {
            "query": "mapSpaces"
          }
        },
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces"
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 1
          },
          {
            "op": "==",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "or",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "loc"
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "province"
                            }
                          ]
                        },
                        {
                          "op": "==",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "in",
                                    "value": [
                                      "US",
                                      "ARVN"
                                    ]
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "base"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "troops"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                }
              }
            },
            "right": 0
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": "or",
            "args": [
              {
                "op": "and",
                "args": [
                  {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "id"
                                  },
                                  "right": {
                                    "ref": "binding",
                                    "name": "targetSpace"
                                  }
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "category"
                                  },
                                  "right": "city"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "right": 0
                  },
                  {
                    "op": "<=",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": {
                            "zoneExpr": {
                              "ref": "binding",
                              "name": "targetSpace"
                            }
                          },
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "eq",
                              "value": "NVA"
                            }
                          ]
                        }
                      }
                    },
                    "right": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": {
                            "zoneExpr": {
                              "ref": "binding",
                              "name": "targetSpace"
                            }
                          },
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "in",
                              "value": [
                                "US",
                                "ARVN",
                                "VC"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": {
                        "zoneExpr": {
                          "ref": "binding",
                          "name": "targetSpace"
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "in",
                          "value": [
                            "US",
                            "ARVN"
                          ]
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "base"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": "saigon:none"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "forEach": {
            "bind": "$movedTroop",
            "over": {
              "query": "tokensInZone",
              "zone": {
                "zoneExpr": {
                  "ref": "binding",
                  "name": "sourceSpace"
                }
              },
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "ARVN"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "troops"
                }
              ]
            },
            "effects": [
              {
                "moveToken": {
                  "token": "$movedTroop",
                  "from": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  }
                }
              }
            ],
            "limit": 1
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupArvnRedeployPolice",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupRedeploy"
      ],
      "params": [
        {
          "name": "sourceSpace",
          "domain": {
            "query": "mapSpaces"
          }
        },
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces"
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 1
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "ARVN"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "police"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "id"
                          },
                          "right": {
                            "ref": "binding",
                            "name": "targetSpace"
                          }
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "country"
                          },
                          "right": "southVietnam"
                        }
                      ]
                    }
                  }
                }
              }
            },
            "right": 0
          },
          {
            "op": "or",
            "args": [
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "id"
                              },
                              "right": {
                                "ref": "binding",
                                "name": "targetSpace"
                              }
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "loc"
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "right": 0
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": {
                        "zoneExpr": {
                          "ref": "binding",
                          "name": "targetSpace"
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "in",
                          "value": [
                            "US",
                            "ARVN"
                          ]
                        }
                      ]
                    }
                  }
                },
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": {
                        "zoneExpr": {
                          "ref": "binding",
                          "name": "targetSpace"
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "in",
                          "value": [
                            "NVA",
                            "VC"
                          ]
                        }
                      ]
                    }
                  }
                }
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "forEach": {
            "bind": "$movedPolice",
            "over": {
              "query": "tokensInZone",
              "zone": {
                "zoneExpr": {
                  "ref": "binding",
                  "name": "sourceSpace"
                }
              },
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "ARVN"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "police"
                }
              ]
            },
            "effects": [
              {
                "moveToken": {
                  "token": "$movedPolice",
                  "from": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  }
                }
              }
            ],
            "limit": 1
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupNvaRedeployTroops",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupRedeploy"
      ],
      "params": [
        {
          "name": "sourceSpace",
          "domain": {
            "query": "mapSpaces"
          }
        },
        {
          "name": "targetSpace",
          "domain": {
            "query": "mapSpaces"
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 2
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "NVA"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "right": 0
          },
          {
            "op": ">",
            "left": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  },
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "NVA"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "base"
                    }
                  ]
                }
              }
            },
            "right": 0
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "forEach": {
            "bind": "$movedTroop",
            "over": {
              "query": "tokensInZone",
              "zone": {
                "zoneExpr": {
                  "ref": "binding",
                  "name": "sourceSpace"
                }
              },
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "NVA"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "troops"
                }
              ]
            },
            "effects": [
              {
                "moveToken": {
                  "token": "$movedTroop",
                  "from": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "sourceSpace"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "targetSpace"
                    }
                  }
                }
              }
            ],
            "limit": 1
          }
        }
      ],
      "limits": []
    },
    {
      "id": "coupRedeployPass",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupRedeploy"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "coupCommitmentPass",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupCommitment"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "coupCommitmentResolve",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "coupCommitment"
      ],
      "params": [],
      "pre": {
        "op": "==",
        "left": {
          "ref": "activePlayer"
        },
        "right": 0
      },
      "cost": [],
      "effects": [
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__usTroopCasualties",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": "casualties-US:none",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "US"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "in": [
              {
                "removeByPriority": {
                  "budget": {
                    "op": "floorDiv",
                    "left": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_14__effects_0__usTroopCasualties"
                    },
                    "right": 3
                  },
                  "groups": [
                    {
                      "bind": "$__macro_coup_process_commitment_actions_14__effects_0__casualtyTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "casualties-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "out-of-play-US:none"
                      },
                      "macroOrigin": {
                        "macroId": "coup-process-commitment",
                        "stem": "casualtyTroop"
                      }
                    }
                  ],
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "casualtyTroop"
                  }
                }
              }
            ]
          }
        },
        {
          "moveAll": {
            "from": "casualties-US:none",
            "to": "out-of-play-US:none",
            "filter": {
              "op": "and",
              "args": [
                {
                  "op": "==",
                  "left": {
                    "ref": "tokenProp",
                    "token": "$token",
                    "prop": "faction"
                  },
                  "right": "US"
                },
                {
                  "op": "==",
                  "left": {
                    "ref": "tokenProp",
                    "token": "$token",
                    "prop": "type"
                  },
                  "right": "base"
                }
              ]
            }
          }
        },
        {
          "moveAll": {
            "from": "casualties-US:none",
            "to": "available-US:none"
          }
        },
        {
          "chooseN": {
            "internalDecisionId": "decision:doc.actions.14.effects.3.chooseN",
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopsFromAvailable",
            "options": {
              "query": "tokensInZone",
              "zone": "available-US:none",
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "US"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "troops"
                }
              ]
            },
            "max": 10,
            "min": 0
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromAvailable",
            "macroOrigin": {
              "macroId": "coup-process-commitment",
              "stem": "movingTroopFromAvailable"
            },
            "over": {
              "query": "binding",
              "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopsFromAvailable"
            },
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.actions.14.effects.4.forEach.effects.0.chooseOne",
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopDestFromAvailable",
                  "options": {
                    "query": "mapSpaces",
                    "filter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "id"
                            },
                            "right": "saigon:none"
                          },
                          {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "moveToken": {
                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromAvailable",
                  "from": {
                    "zoneExpr": {
                      "ref": "tokenZone",
                      "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromAvailable"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopDestFromAvailable"
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__troopsMovedFromAvailable",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "binding",
                  "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopsFromAvailable"
                }
              }
            },
            "in": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.actions.14.effects.5.let.in.0.chooseN",
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopsFromMap",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "southVietnam"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "troops"
                      }
                    ]
                  },
                  "max": {
                    "op": "-",
                    "left": 10,
                    "right": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_14__effects_0__troopsMovedFromAvailable"
                    }
                  },
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap",
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "movingTroopFromMap"
                  },
                  "over": {
                    "query": "binding",
                    "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopsFromMap"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.actions.14.effects.5.let.in.1.forEach.effects.0.chooseOne",
                        "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopMapMoveMode",
                        "options": {
                          "query": "enums",
                          "values": [
                            "to-available",
                            "to-map"
                          ]
                        }
                      }
                    },
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "binding",
                            "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopMapMoveMode"
                          },
                          "right": "to-available"
                        },
                        "then": [
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ],
                        "else": [
                          {
                            "chooseOne": {
                              "internalDecisionId": "decision:doc.actions.14.effects.5.let.in.1.forEach.effects.1.if.else.0.chooseOne",
                              "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopDestFromMap",
                              "options": {
                                "query": "mapSpaces",
                                "filter": {
                                  "condition": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "id"
                                        },
                                        "right": {
                                          "ref": "tokenZone",
                                          "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap"
                                        }
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "id"
                                            },
                                            "right": "saigon:none"
                                          },
                                          {
                                            "op": "and",
                                            "args": [
                                              {
                                                "op": "or",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "province"
                                                  },
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "city"
                                                  }
                                                ]
                                              },
                                              {
                                                "op": ">",
                                                "left": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "US",
                                                            "ARVN"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                "right": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "NVA",
                                                            "VC"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingTroopFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitTroopDestFromMap"
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "chooseN": {
            "internalDecisionId": "decision:doc.actions.14.effects.6.chooseN",
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitBasesFromAvailable",
            "options": {
              "query": "tokensInZone",
              "zone": "available-US:none",
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "US"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "base"
                }
              ]
            },
            "max": 2,
            "min": 0
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromAvailable",
            "macroOrigin": {
              "macroId": "coup-process-commitment",
              "stem": "movingBaseFromAvailable"
            },
            "over": {
              "query": "binding",
              "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBasesFromAvailable"
            },
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.actions.14.effects.7.forEach.effects.0.chooseOne",
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseDestFromAvailable",
                  "options": {
                    "query": "mapSpaces",
                    "filter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "id"
                            },
                            "right": "saigon:none"
                          },
                          {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "moveToken": {
                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromAvailable",
                  "from": {
                    "zoneExpr": {
                      "ref": "tokenZone",
                      "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromAvailable"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseDestFromAvailable"
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_14__effects_0__basesMovedFromAvailable",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "binding",
                  "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBasesFromAvailable"
                }
              }
            },
            "in": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.actions.14.effects.8.let.in.0.chooseN",
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitBasesFromMap",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "southVietnam"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "base"
                      }
                    ]
                  },
                  "max": {
                    "op": "-",
                    "left": 2,
                    "right": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_14__effects_0__basesMovedFromAvailable"
                    }
                  },
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap",
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "movingBaseFromMap"
                  },
                  "over": {
                    "query": "binding",
                    "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBasesFromMap"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.actions.14.effects.8.let.in.1.forEach.effects.0.chooseOne",
                        "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseMapMoveMode",
                        "options": {
                          "query": "enums",
                          "values": [
                            "to-available",
                            "to-map"
                          ]
                        }
                      }
                    },
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "binding",
                            "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseMapMoveMode"
                          },
                          "right": "to-available"
                        },
                        "then": [
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ],
                        "else": [
                          {
                            "chooseOne": {
                              "internalDecisionId": "decision:doc.actions.14.effects.8.let.in.1.forEach.effects.1.if.else.0.chooseOne",
                              "bind": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseDestFromMap",
                              "options": {
                                "query": "mapSpaces",
                                "filter": {
                                  "condition": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "id"
                                        },
                                        "right": {
                                          "ref": "tokenZone",
                                          "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap"
                                        }
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "id"
                                            },
                                            "right": "saigon:none"
                                          },
                                          {
                                            "op": "and",
                                            "args": [
                                              {
                                                "op": "or",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "province"
                                                  },
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "city"
                                                  }
                                                ]
                                              },
                                              {
                                                "op": ">",
                                                "left": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "US",
                                                            "ARVN"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                "right": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "NVA",
                                                            "VC"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_14__effects_0__movingBaseFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_process_commitment_actions_14__effects_0__commitBaseDestFromMap"
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      ],
      "limits": [
        {
          "scope": "phase",
          "max": 1
        }
      ]
    },
    {
      "id": "pivotalEvent",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [
        {
          "name": "eventCardId",
          "domain": {
            "query": "enums",
            "values": [
              "card-121",
              "card-122",
              "card-123",
              "card-124"
            ]
          }
        }
      ],
      "pre": {
        "op": "or",
        "args": [
          {
            "op": "and",
            "args": [
              {
                "op": "==",
                "left": {
                  "ref": "activePlayer"
                },
                "right": 0
              },
              {
                "op": "==",
                "left": {
                  "ref": "binding",
                  "name": "eventCardId"
                },
                "right": "card-121"
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "leader:none",
                      "filter": [
                        {
                          "prop": "cardId",
                          "op": "eq",
                          "value": "card-121"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": "and",
            "args": [
              {
                "op": "==",
                "left": {
                  "ref": "activePlayer"
                },
                "right": 2
              },
              {
                "op": "==",
                "left": {
                  "ref": "binding",
                  "name": "eventCardId"
                },
                "right": "card-122"
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "leader:none",
                      "filter": [
                        {
                          "prop": "cardId",
                          "op": "eq",
                          "value": "card-122"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": "and",
            "args": [
              {
                "op": "==",
                "left": {
                  "ref": "activePlayer"
                },
                "right": 1
              },
              {
                "op": "==",
                "left": {
                  "ref": "binding",
                  "name": "eventCardId"
                },
                "right": "card-123"
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "leader:none",
                      "filter": [
                        {
                          "prop": "cardId",
                          "op": "eq",
                          "value": "card-123"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              }
            ]
          },
          {
            "op": "and",
            "args": [
              {
                "op": "==",
                "left": {
                  "ref": "activePlayer"
                },
                "right": 3
              },
              {
                "op": "==",
                "left": {
                  "ref": "binding",
                  "name": "eventCardId"
                },
                "right": "card-124"
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "leader:none",
                      "filter": [
                        {
                          "prop": "cardId",
                          "op": "eq",
                          "value": "card-124"
                        }
                      ]
                    }
                  }
                },
                "right": 0
              }
            ]
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "eventCardId"
              },
              "right": "card-121"
            },
            "then": [
              {
                "forEach": {
                  "bind": "$pivotalCard",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "leader:none",
                    "filter": [
                      {
                        "prop": "cardId",
                        "op": "eq",
                        "value": "card-121"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$pivotalCard",
                        "from": "leader:none",
                        "to": "played:none"
                      }
                    }
                  ],
                  "limit": 1
                }
              }
            ]
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "eventCardId"
              },
              "right": "card-122"
            },
            "then": [
              {
                "forEach": {
                  "bind": "$pivotalCard",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "leader:none",
                    "filter": [
                      {
                        "prop": "cardId",
                        "op": "eq",
                        "value": "card-122"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$pivotalCard",
                        "from": "leader:none",
                        "to": "played:none"
                      }
                    }
                  ],
                  "limit": 1
                }
              }
            ]
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "eventCardId"
              },
              "right": "card-123"
            },
            "then": [
              {
                "forEach": {
                  "bind": "$pivotalCard",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "leader:none",
                    "filter": [
                      {
                        "prop": "cardId",
                        "op": "eq",
                        "value": "card-123"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$pivotalCard",
                        "from": "leader:none",
                        "to": "played:none"
                      }
                    }
                  ],
                  "limit": 1
                }
              }
            ]
          }
        },
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "binding",
                "name": "eventCardId"
              },
              "right": "card-124"
            },
            "then": [
              {
                "forEach": {
                  "bind": "$pivotalCard",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "leader:none",
                    "filter": [
                      {
                        "prop": "cardId",
                        "op": "eq",
                        "value": "card-124"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$pivotalCard",
                        "from": "leader:none",
                        "to": "played:none"
                      }
                    }
                  ],
                  "limit": 1
                }
              }
            ]
          }
        }
      ],
      "limits": []
    },
    {
      "id": "train",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "patrol",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "sweep",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "assault",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "rally",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "march",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "attack",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "terror",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "advise",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "airLift",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "airStrike",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "govern",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "transport",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "raid",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "infiltrate",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "bombard",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "ambushNva",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "tax",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "subvert",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "ambushVc",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "nvaTransferResources",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [
        {
          "name": "amount",
          "domain": {
            "query": "intsInVarRange",
            "var": "nvaResources",
            "min": 1
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 2
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "nvaResources"
            },
            "right": {
              "ref": "binding",
              "name": "amount"
            }
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "nvaResources",
            "delta": {
              "op": "*",
              "left": {
                "ref": "binding",
                "name": "amount"
              },
              "right": -1
            }
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "vcResources",
            "delta": {
              "ref": "binding",
              "name": "amount"
            }
          }
        }
      ],
      "limits": []
    },
    {
      "id": "vcTransferResources",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [
        {
          "name": "amount",
          "domain": {
            "query": "intsInVarRange",
            "var": "vcResources",
            "min": 1
          }
        }
      ],
      "pre": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "activePlayer"
            },
            "right": 3
          },
          {
            "op": ">=",
            "left": {
              "ref": "gvar",
              "var": "vcResources"
            },
            "right": {
              "ref": "binding",
              "name": "amount"
            }
          }
        ]
      },
      "cost": [],
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "vcResources",
            "delta": {
              "op": "*",
              "left": {
                "ref": "binding",
                "name": "amount"
              },
              "right": -1
            }
          }
        },
        {
          "addVar": {
            "scope": "global",
            "var": "nvaResources",
            "delta": {
              "ref": "binding",
              "name": "amount"
            }
          }
        }
      ],
      "limits": []
    },
    {
      "id": "usOp",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "arvnOp",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    },
    {
      "id": "resolveCommitment",
      "actor": "active",
      "executor": {
        "id": 0
      },
      "phase": [
        "commitment"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__usTroopCasualties",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": "casualties-US:none",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "US"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "troops"
                    }
                  ]
                }
              }
            },
            "in": [
              {
                "removeByPriority": {
                  "budget": {
                    "op": "floorDiv",
                    "left": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_40__effects_0__usTroopCasualties"
                    },
                    "right": 3
                  },
                  "groups": [
                    {
                      "bind": "$__macro_coup_process_commitment_actions_40__effects_0__casualtyTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "casualties-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "out-of-play-US:none"
                      },
                      "macroOrigin": {
                        "macroId": "coup-process-commitment",
                        "stem": "casualtyTroop"
                      }
                    }
                  ],
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "casualtyTroop"
                  }
                }
              }
            ]
          }
        },
        {
          "moveAll": {
            "from": "casualties-US:none",
            "to": "out-of-play-US:none",
            "filter": {
              "op": "and",
              "args": [
                {
                  "op": "==",
                  "left": {
                    "ref": "tokenProp",
                    "token": "$token",
                    "prop": "faction"
                  },
                  "right": "US"
                },
                {
                  "op": "==",
                  "left": {
                    "ref": "tokenProp",
                    "token": "$token",
                    "prop": "type"
                  },
                  "right": "base"
                }
              ]
            }
          }
        },
        {
          "moveAll": {
            "from": "casualties-US:none",
            "to": "available-US:none"
          }
        },
        {
          "chooseN": {
            "internalDecisionId": "decision:doc.actions.40.effects.3.chooseN",
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopsFromAvailable",
            "options": {
              "query": "tokensInZone",
              "zone": "available-US:none",
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "US"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "troops"
                }
              ]
            },
            "max": 10,
            "min": 0
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromAvailable",
            "macroOrigin": {
              "macroId": "coup-process-commitment",
              "stem": "movingTroopFromAvailable"
            },
            "over": {
              "query": "binding",
              "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopsFromAvailable"
            },
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.actions.40.effects.4.forEach.effects.0.chooseOne",
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopDestFromAvailable",
                  "options": {
                    "query": "mapSpaces",
                    "filter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "id"
                            },
                            "right": "saigon:none"
                          },
                          {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "moveToken": {
                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromAvailable",
                  "from": {
                    "zoneExpr": {
                      "ref": "tokenZone",
                      "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromAvailable"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopDestFromAvailable"
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__troopsMovedFromAvailable",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "binding",
                  "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopsFromAvailable"
                }
              }
            },
            "in": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.actions.40.effects.5.let.in.0.chooseN",
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopsFromMap",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "southVietnam"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "troops"
                      }
                    ]
                  },
                  "max": {
                    "op": "-",
                    "left": 10,
                    "right": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_40__effects_0__troopsMovedFromAvailable"
                    }
                  },
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap",
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "movingTroopFromMap"
                  },
                  "over": {
                    "query": "binding",
                    "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopsFromMap"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.actions.40.effects.5.let.in.1.forEach.effects.0.chooseOne",
                        "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopMapMoveMode",
                        "options": {
                          "query": "enums",
                          "values": [
                            "to-available",
                            "to-map"
                          ]
                        }
                      }
                    },
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "binding",
                            "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopMapMoveMode"
                          },
                          "right": "to-available"
                        },
                        "then": [
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ],
                        "else": [
                          {
                            "chooseOne": {
                              "internalDecisionId": "decision:doc.actions.40.effects.5.let.in.1.forEach.effects.1.if.else.0.chooseOne",
                              "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopDestFromMap",
                              "options": {
                                "query": "mapSpaces",
                                "filter": {
                                  "condition": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "id"
                                        },
                                        "right": {
                                          "ref": "tokenZone",
                                          "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap"
                                        }
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "id"
                                            },
                                            "right": "saigon:none"
                                          },
                                          {
                                            "op": "and",
                                            "args": [
                                              {
                                                "op": "or",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "province"
                                                  },
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "city"
                                                  }
                                                ]
                                              },
                                              {
                                                "op": ">",
                                                "left": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "US",
                                                            "ARVN"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                "right": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "NVA",
                                                            "VC"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingTroopFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitTroopDestFromMap"
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "chooseN": {
            "internalDecisionId": "decision:doc.actions.40.effects.6.chooseN",
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitBasesFromAvailable",
            "options": {
              "query": "tokensInZone",
              "zone": "available-US:none",
              "filter": [
                {
                  "prop": "faction",
                  "op": "eq",
                  "value": "US"
                },
                {
                  "prop": "type",
                  "op": "eq",
                  "value": "base"
                }
              ]
            },
            "max": 2,
            "min": 0
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromAvailable",
            "macroOrigin": {
              "macroId": "coup-process-commitment",
              "stem": "movingBaseFromAvailable"
            },
            "over": {
              "query": "binding",
              "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBasesFromAvailable"
            },
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.actions.40.effects.7.forEach.effects.0.chooseOne",
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseDestFromAvailable",
                  "options": {
                    "query": "mapSpaces",
                    "filter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "category"
                            },
                            "right": "loc"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "id"
                            },
                            "right": "saigon:none"
                          },
                          {
                            "op": "and",
                            "args": [
                              {
                                "op": "or",
                                "args": [
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "province"
                                  },
                                  {
                                    "op": "==",
                                    "left": {
                                      "ref": "zoneProp",
                                      "zone": "$zone",
                                      "prop": "category"
                                    },
                                    "right": "city"
                                  }
                                ]
                              },
                              {
                                "op": ">",
                                "left": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "US",
                                            "ARVN"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                },
                                "right": {
                                  "aggregate": {
                                    "op": "count",
                                    "query": {
                                      "query": "tokensInZone",
                                      "zone": "$zone",
                                      "filter": [
                                        {
                                          "prop": "faction",
                                          "op": "in",
                                          "value": [
                                            "NVA",
                                            "VC"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "moveToken": {
                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromAvailable",
                  "from": {
                    "zoneExpr": {
                      "ref": "tokenZone",
                      "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromAvailable"
                    }
                  },
                  "to": {
                    "zoneExpr": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseDestFromAvailable"
                    }
                  }
                }
              }
            ]
          }
        },
        {
          "let": {
            "bind": "$__macro_coup_process_commitment_actions_40__effects_0__basesMovedFromAvailable",
            "value": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "binding",
                  "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBasesFromAvailable"
                }
              }
            },
            "in": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.actions.40.effects.8.let.in.0.chooseN",
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitBasesFromMap",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "southVietnam"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "base"
                      }
                    ]
                  },
                  "max": {
                    "op": "-",
                    "left": 2,
                    "right": {
                      "ref": "binding",
                      "name": "$__macro_coup_process_commitment_actions_40__effects_0__basesMovedFromAvailable"
                    }
                  },
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap",
                  "macroOrigin": {
                    "macroId": "coup-process-commitment",
                    "stem": "movingBaseFromMap"
                  },
                  "over": {
                    "query": "binding",
                    "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBasesFromMap"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.actions.40.effects.8.let.in.1.forEach.effects.0.chooseOne",
                        "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseMapMoveMode",
                        "options": {
                          "query": "enums",
                          "values": [
                            "to-available",
                            "to-map"
                          ]
                        }
                      }
                    },
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "binding",
                            "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseMapMoveMode"
                          },
                          "right": "to-available"
                        },
                        "then": [
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ],
                        "else": [
                          {
                            "chooseOne": {
                              "internalDecisionId": "decision:doc.actions.40.effects.8.let.in.1.forEach.effects.1.if.else.0.chooseOne",
                              "bind": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseDestFromMap",
                              "options": {
                                "query": "mapSpaces",
                                "filter": {
                                  "condition": {
                                    "op": "and",
                                    "args": [
                                      {
                                        "op": "!=",
                                        "left": {
                                          "ref": "zoneProp",
                                          "zone": "$zone",
                                          "prop": "id"
                                        },
                                        "right": {
                                          "ref": "tokenZone",
                                          "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap"
                                        }
                                      },
                                      {
                                        "op": "or",
                                        "args": [
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "category"
                                            },
                                            "right": "loc"
                                          },
                                          {
                                            "op": "==",
                                            "left": {
                                              "ref": "zoneProp",
                                              "zone": "$zone",
                                              "prop": "id"
                                            },
                                            "right": "saigon:none"
                                          },
                                          {
                                            "op": "and",
                                            "args": [
                                              {
                                                "op": "or",
                                                "args": [
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "province"
                                                  },
                                                  {
                                                    "op": "==",
                                                    "left": {
                                                      "ref": "zoneProp",
                                                      "zone": "$zone",
                                                      "prop": "category"
                                                    },
                                                    "right": "city"
                                                  }
                                                ]
                                              },
                                              {
                                                "op": ">",
                                                "left": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "US",
                                                            "ARVN"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                "right": {
                                                  "aggregate": {
                                                    "op": "count",
                                                    "query": {
                                                      "query": "tokensInZone",
                                                      "zone": "$zone",
                                                      "filter": [
                                                        {
                                                          "prop": "faction",
                                                          "op": "in",
                                                          "value": [
                                                            "NVA",
                                                            "VC"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "moveToken": {
                              "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$__macro_coup_process_commitment_actions_40__effects_0__movingBaseFromMap"
                                }
                              },
                              "to": {
                                "zoneExpr": {
                                  "ref": "binding",
                                  "name": "$__macro_coup_process_commitment_actions_40__effects_0__commitBaseDestFromMap"
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "popInterruptPhase": {}
        }
      ],
      "limits": []
    },
    {
      "id": "event",
      "actor": "active",
      "executor": "actor",
      "phase": [
        "main"
      ],
      "capabilities": [
        "cardEvent"
      ],
      "params": [],
      "pre": null,
      "cost": [],
      "effects": [],
      "limits": []
    }
  ],
  "triggers": [
    {
      "id": "on-coup-support-enter",
      "event": {
        "type": "phaseEnter",
        "phase": "coupSupport"
      },
      "effects": [
        {
          "forEach": {
            "bind": "$__macro_coup_support_reset_trackers_triggers_0__effects_0__space",
            "macroOrigin": {
              "macroId": "coup-support-reset-trackers",
              "stem": "space"
            },
            "over": {
              "query": "mapSpaces"
            },
            "effects": [
              {
                "setMarker": {
                  "space": "$__macro_coup_support_reset_trackers_triggers_0__effects_0__space",
                  "marker": "coupPacifySpaceUsage",
                  "state": "open"
                }
              },
              {
                "setMarker": {
                  "space": "$__macro_coup_support_reset_trackers_triggers_0__effects_0__space",
                  "marker": "coupAgitateSpaceUsage",
                  "state": "open"
                }
              },
              {
                "setMarker": {
                  "space": "$__macro_coup_support_reset_trackers_triggers_0__effects_0__space",
                  "marker": "coupSupportShiftCount",
                  "state": "zero"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "on-coup-redeploy-enter",
      "event": {
        "type": "phaseEnter",
        "phase": "coupRedeploy"
      },
      "effects": [
        {
          "forEach": {
            "bind": "$__macro_coup_laos_cambodia_removal_triggers_1__effects_0__space",
            "macroOrigin": {
              "macroId": "coup-laos-cambodia-removal",
              "stem": "space"
            },
            "over": {
              "query": "mapSpaces",
              "filter": {
                "condition": {
                  "op": "or",
                  "args": [
                    {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "country"
                      },
                      "right": "laos"
                    },
                    {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "country"
                      },
                      "right": "cambodia"
                    }
                  ]
                }
              }
            },
            "effects": [
              {
                "moveAll": {
                  "from": "$__macro_coup_laos_cambodia_removal_triggers_1__effects_0__space",
                  "to": "out-of-play-US:none",
                  "filter": {
                    "op": "and",
                    "args": [
                      {
                        "op": "==",
                        "left": {
                          "ref": "tokenProp",
                          "token": "$token",
                          "prop": "faction"
                        },
                        "right": "US"
                      },
                      {
                        "op": "==",
                        "left": {
                          "ref": "tokenProp",
                          "token": "$token",
                          "prop": "type"
                        },
                        "right": "troops"
                      }
                    ]
                  }
                }
              },
              {
                "moveAll": {
                  "from": "$__macro_coup_laos_cambodia_removal_triggers_1__effects_0__space",
                  "to": "available-US:none",
                  "filter": {
                    "op": "and",
                    "args": [
                      {
                        "op": "==",
                        "left": {
                          "ref": "tokenProp",
                          "token": "$token",
                          "prop": "faction"
                        },
                        "right": "US"
                      },
                      {
                        "op": "!=",
                        "left": {
                          "ref": "tokenProp",
                          "token": "$token",
                          "prop": "type"
                        },
                        "right": "troops"
                      }
                    ]
                  }
                }
              },
              {
                "moveAll": {
                  "from": "$__macro_coup_laos_cambodia_removal_triggers_1__effects_0__space",
                  "to": "available-ARVN:none",
                  "filter": {
                    "op": "==",
                    "left": {
                      "ref": "tokenProp",
                      "token": "$token",
                      "prop": "faction"
                    },
                    "right": "ARVN"
                  }
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "on-coup-reset-enter",
      "event": {
        "type": "phaseEnter",
        "phase": "coupReset"
      },
      "effects": [
        {
          "if": {
            "when": {
              "op": "==",
              "left": {
                "ref": "gvar",
                "var": "trail"
              },
              "right": 0
            },
            "then": [
              {
                "setVar": {
                  "scope": "global",
                  "var": "trail",
                  "value": 1
                }
              }
            ],
            "else": [
              {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "gvar",
                      "var": "trail"
                    },
                    "right": 4
                  },
                  "then": [
                    {
                      "setVar": {
                        "scope": "global",
                        "var": "trail",
                        "value": 3
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
            "macroOrigin": {
              "macroId": "coup-reset-markers",
              "stem": "space"
            },
            "over": {
              "query": "mapSpaces"
            },
            "effects": [
              {
                "setVar": {
                  "scope": "zoneVar",
                  "zone": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                  "var": "terrorCount",
                  "value": 0
                }
              },
              {
                "setMarker": {
                  "space": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                  "marker": "sabotage",
                  "state": "none"
                }
              }
            ]
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "terrorSabotageMarkersPlaced",
            "value": 0
          }
        },
        {
          "forEach": {
            "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
            "macroOrigin": {
              "macroId": "coup-reset-markers",
              "stem": "space"
            },
            "over": {
              "query": "mapSpaces"
            },
            "effects": [
              {
                "forEach": {
                  "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                  "macroOrigin": {
                    "macroId": "coup-reset-markers",
                    "stem": "token"
                  },
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "guerrilla"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ]
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                  "macroOrigin": {
                    "macroId": "coup-reset-markers",
                    "stem": "token"
                  },
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "VC"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "guerrilla"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ]
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                  "macroOrigin": {
                    "macroId": "coup-reset-markers",
                    "stem": "token"
                  },
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "irregular"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ]
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                  "macroOrigin": {
                    "macroId": "coup-reset-markers",
                    "stem": "token"
                  },
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$__macro_coup_reset_markers_triggers_2__effects_0__space",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "ARVN"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "ranger"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$__macro_coup_reset_markers_triggers_2__effects_0__token",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_wildWeasels",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_adsid",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_rollingThunder",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_medevacUnshaded",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_medevacShaded",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_blowtorchKomer",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_claymores",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_daNang",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_mcnamaraLine",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_oriskany",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_bombingPause",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_559thTransportGrp",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_bodyCount",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_generalLansdale",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "mom_typhoonKate",
            "value": false
          }
        },
        {
          "setVar": {
            "scope": "global",
            "var": "fitl_acesAirStrikeWindow",
            "value": false
          }
        },
        {
          "setGlobalMarker": {
            "marker": "leaderFlipped",
            "state": "normal"
          }
        }
      ]
    },
    {
      "id": "mom-adsid-on-trail-change",
      "event": {
        "type": "varChanged",
        "scope": "global",
        "var": "trail"
      },
      "when": {
        "op": "and",
        "args": [
          {
            "op": "==",
            "left": {
              "ref": "gvar",
              "var": "mom_adsid"
            },
            "right": true
          },
          {
            "op": "!=",
            "left": {
              "ref": "binding",
              "name": "$oldValue"
            },
            "right": {
              "ref": "binding",
              "name": "$newValue"
            }
          }
        ]
      },
      "effects": [
        {
          "addVar": {
            "scope": "global",
            "var": "nvaResources",
            "delta": -6
          }
        }
      ]
    }
  ],
  "terminal": {
    "conditions": [],
    "checkpoints": [
      {
        "id": "us-victory",
        "seat": "0",
        "timing": "duringCoup",
        "when": {
          "op": "and",
          "args": [
            {
              "op": "==",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInZone",
                    "zone": "played:none",
                    "filter": [
                      {
                        "prop": "isCoup",
                        "op": "eq",
                        "value": true
                      }
                    ]
                  }
                }
              },
              "right": 1
            },
            {
              "op": ">",
              "left": {
                "op": "+",
                "left": {
                  "aggregate": {
                    "op": "sum",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "or",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "supportOpposition"
                              },
                              "right": "passiveSupport"
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "supportOpposition"
                              },
                              "right": "activeSupport"
                            }
                          ]
                        }
                      }
                    },
                    "bind": "$zone",
                    "valueExpr": {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "activeSupport"
                        },
                        "then": {
                          "op": "*",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "population"
                          },
                          "right": 2
                        },
                        "else": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "population"
                        }
                      }
                    }
                  }
                },
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInZone",
                      "zone": "available-US:none",
                      "filter": [
                        {
                          "prop": "type",
                          "op": "in",
                          "value": [
                            "troops",
                            "base"
                          ]
                        }
                      ]
                    }
                  }
                }
              },
              "right": 50
            }
          ]
        }
      },
      {
        "id": "arvn-victory",
        "seat": "1",
        "timing": "duringCoup",
        "when": {
          "op": "and",
          "args": [
            {
              "op": "==",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInZone",
                    "zone": "played:none",
                    "filter": [
                      {
                        "prop": "isCoup",
                        "op": "eq",
                        "value": true
                      }
                    ]
                  }
                }
              },
              "right": 1
            },
            {
              "op": ">",
              "left": {
                "op": "+",
                "left": {
                  "aggregate": {
                    "op": "sum",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": ">",
                          "left": {
                            "op": "+",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "ARVN"
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          "right": {
                            "op": "+",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "NVA"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "VC"
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "bind": "$zone",
                    "valueExpr": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "population"
                    }
                  }
                },
                "right": {
                  "ref": "gvar",
                  "var": "patronage"
                }
              },
              "right": 50
            }
          ]
        }
      },
      {
        "id": "nva-victory",
        "seat": "2",
        "timing": "duringCoup",
        "when": {
          "op": "and",
          "args": [
            {
              "op": "==",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInZone",
                    "zone": "played:none",
                    "filter": [
                      {
                        "prop": "isCoup",
                        "op": "eq",
                        "value": true
                      }
                    ]
                  }
                }
              },
              "right": 1
            },
            {
              "op": ">",
              "left": {
                "op": "+",
                "left": {
                  "aggregate": {
                    "op": "sum",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "NVA"
                                  }
                                ]
                              }
                            }
                          },
                          "right": {
                            "op": "+",
                            "left": {
                              "aggregate": {
                                "op": "count",
                                "query": {
                                  "query": "tokensInZone",
                                  "zone": "$zone",
                                  "filter": [
                                    {
                                      "prop": "faction",
                                      "op": "eq",
                                      "value": "US"
                                    }
                                  ]
                                }
                              }
                            },
                            "right": {
                              "op": "+",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "ARVN"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "VC"
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "bind": "$zone",
                    "valueExpr": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "population"
                    }
                  }
                },
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "NVA"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "base"
                        }
                      ]
                    }
                  }
                }
              },
              "right": 18
            }
          ]
        }
      },
      {
        "id": "vc-victory",
        "seat": "3",
        "timing": "duringCoup",
        "when": {
          "op": "and",
          "args": [
            {
              "op": "==",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInZone",
                    "zone": "played:none",
                    "filter": [
                      {
                        "prop": "isCoup",
                        "op": "eq",
                        "value": true
                      }
                    ]
                  }
                }
              },
              "right": 1
            },
            {
              "op": ">",
              "left": {
                "op": "+",
                "left": {
                  "aggregate": {
                    "op": "sum",
                    "query": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "or",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "supportOpposition"
                              },
                              "right": "passiveOpposition"
                            },
                            {
                              "op": "==",
                              "left": {
                                "ref": "markerState",
                                "space": "$zone",
                                "marker": "supportOpposition"
                              },
                              "right": "activeOpposition"
                            }
                          ]
                        }
                      }
                    },
                    "bind": "$zone",
                    "valueExpr": {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "activeOpposition"
                        },
                        "then": {
                          "op": "*",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "population"
                          },
                          "right": 2
                        },
                        "else": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "population"
                        }
                      }
                    }
                  }
                },
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "VC"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "base"
                        }
                      ]
                    }
                  }
                }
              },
              "right": 35
            }
          ]
        }
      },
      {
        "id": "final-coup-ranking",
        "seat": "2",
        "timing": "finalCoup",
        "when": {
          "op": "and",
          "args": [
            {
              "op": "==",
              "left": {
                "aggregate": {
                  "op": "count",
                  "query": {
                    "query": "tokensInZone",
                    "zone": "played:none",
                    "filter": [
                      {
                        "prop": "isCoup",
                        "op": "eq",
                        "value": true
                      }
                    ]
                  }
                }
              },
              "right": 1
            },
            {
              "op": "==",
              "left": {
                "ref": "zoneCount",
                "zone": "deck:none"
              },
              "right": 0
            },
            {
              "op": "==",
              "left": {
                "ref": "zoneCount",
                "zone": "lookahead:none"
              },
              "right": 0
            }
          ]
        }
      }
    ],
    "margins": [
      {
        "seat": "0",
        "value": {
          "op": "-",
          "left": {
            "op": "+",
            "left": {
              "aggregate": {
                "op": "sum",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "or",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "passiveSupport"
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "activeSupport"
                        }
                      ]
                    }
                  }
                },
                "bind": "$zone",
                "valueExpr": {
                  "if": {
                    "when": {
                      "op": "==",
                      "left": {
                        "ref": "markerState",
                        "space": "$zone",
                        "marker": "supportOpposition"
                      },
                      "right": "activeSupport"
                    },
                    "then": {
                      "op": "*",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "population"
                      },
                      "right": 2
                    },
                    "else": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "population"
                    }
                  }
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInZone",
                  "zone": "available-US:none",
                  "filter": [
                    {
                      "prop": "type",
                      "op": "in",
                      "value": [
                        "troops",
                        "base"
                      ]
                    }
                  ]
                }
              }
            }
          },
          "right": 50
        }
      },
      {
        "seat": "1",
        "value": {
          "op": "-",
          "left": {
            "op": "+",
            "left": {
              "aggregate": {
                "op": "sum",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": ">",
                      "left": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$zone",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "US"
                                }
                              ]
                            }
                          }
                        },
                        "right": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$zone",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                }
                              ]
                            }
                          }
                        }
                      },
                      "right": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$zone",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "NVA"
                                }
                              ]
                            }
                          }
                        },
                        "right": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$zone",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "VC"
                                }
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "bind": "$zone",
                "valueExpr": {
                  "ref": "zoneProp",
                  "zone": "$zone",
                  "prop": "population"
                }
              }
            },
            "right": {
              "ref": "gvar",
              "var": "patronage"
            }
          },
          "right": 50
        }
      },
      {
        "seat": "2",
        "value": {
          "op": "-",
          "left": {
            "op": "+",
            "left": {
              "aggregate": {
                "op": "sum",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": ">",
                      "left": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$zone",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "NVA"
                              }
                            ]
                          }
                        }
                      },
                      "right": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$zone",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "US"
                                }
                              ]
                            }
                          }
                        },
                        "right": {
                          "op": "+",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  }
                                ]
                              }
                            }
                          },
                          "right": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "VC"
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "bind": "$zone",
                "valueExpr": {
                  "ref": "zoneProp",
                  "zone": "$zone",
                  "prop": "population"
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInMapSpaces",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "NVA"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "base"
                    }
                  ]
                }
              }
            }
          },
          "right": 18
        }
      },
      {
        "seat": "3",
        "value": {
          "op": "-",
          "left": {
            "op": "+",
            "left": {
              "aggregate": {
                "op": "sum",
                "query": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "or",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "passiveOpposition"
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$zone",
                            "marker": "supportOpposition"
                          },
                          "right": "activeOpposition"
                        }
                      ]
                    }
                  }
                },
                "bind": "$zone",
                "valueExpr": {
                  "if": {
                    "when": {
                      "op": "==",
                      "left": {
                        "ref": "markerState",
                        "space": "$zone",
                        "marker": "supportOpposition"
                      },
                      "right": "activeOpposition"
                    },
                    "then": {
                      "op": "*",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "population"
                      },
                      "right": 2
                    },
                    "else": {
                      "ref": "zoneProp",
                      "zone": "$zone",
                      "prop": "population"
                    }
                  }
                }
              }
            },
            "right": {
              "aggregate": {
                "op": "count",
                "query": {
                  "query": "tokensInMapSpaces",
                  "filter": [
                    {
                      "prop": "faction",
                      "op": "eq",
                      "value": "VC"
                    },
                    {
                      "prop": "type",
                      "op": "eq",
                      "value": "base"
                    }
                  ]
                }
              }
            }
          },
          "right": 35
        }
      }
    ],
    "ranking": {
      "order": "desc",
      "tieBreakOrder": [
        "3",
        "1",
        "2",
        "0"
      ]
    }
  },
  "eventDecks": [
    {
      "id": "fitl-events-initial-card-pack",
      "drawZone": "deck:none",
      "discardZone": "played:none",
      "shuffleOnSetup": true,
      "cards": [
        {
          "id": "card-1",
          "title": "Gulf of Tonkin",
          "sideMode": "dual",
          "order": 1,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "US",
              "NVA",
              "ARVN",
              "VC"
            ],
            "flavorText": "Escalation trigger."
          },
          "unshaded": {
            "text": "US free Air Strikes, then moves 6 US pieces from out-of-play to any Cities.",
            "effectTiming": "afterGrants",
            "freeOperationGrants": [
              {
                "seat": "2",
                "executeAsSeat": "0",
                "sequence": {
                  "chain": "gulf-of-tonkin-us-airstrike",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airStrike"
                ]
              }
            ],
            "effects": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.17.unshaded.effects.0.distributeTokens.selectTokens",
                  "bind": "$__selected_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens",
                  "options": {
                    "query": "tokensInZone",
                    "zone": "out-of-play-US:none",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      }
                    ]
                  },
                  "max": 6
                }
              },
              {
                "forEach": {
                  "bind": "$__token_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens",
                  "over": {
                    "query": "binding",
                    "name": "$__selected_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.17.unshaded.effects.0.distributeTokens.chooseDestination",
                        "bind": "$__destination_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens",
                        "options": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "city"
                            }
                          }
                        }
                      }
                    },
                    {
                      "moveToken": {
                        "token": "$__token_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$__token_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens"
                          }
                        },
                        "to": {
                          "zoneExpr": {
                            "ref": "binding",
                            "name": "$__destination_doc_eventDecks_0_cards_17_unshaded_effects_0_distributeTokens"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Congressional regrets: Aid -1 per Casualty. All Casualties out of play.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": {
                    "op": "*",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": "casualties-US:none",
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "eq",
                              "value": "US"
                            }
                          ]
                        }
                      }
                    },
                    "right": -1
                  }
                }
              },
              {
                "moveAll": {
                  "from": "casualties-US:none",
                  "to": "out-of-play-US:none"
                }
              }
            ]
          }
        },
        {
          "id": "card-2",
          "title": "Kissinger",
          "sideMode": "dual",
          "order": 2,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "NVA",
              "ARVN",
              "VC"
            ],
            "flavorText": "Operation Menu."
          },
          "unshaded": {
            "text": "Remove a die roll of Insurgent pieces total from Cambodia and Laos.",
            "effects": [
              {
                "rollRandom": {
                  "bind": "$dieRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "chooseN": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.18.unshaded.effects.0.rollRandom.in.0.chooseN",
                        "bind": "$insurgentPieces",
                        "options": {
                          "query": "concat",
                          "sources": [
                            {
                              "query": "tokensInMapSpaces",
                              "spaceFilter": {
                                "condition": {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "cambodia"
                                    },
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "laos"
                                    }
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "guerrilla"
                                  ]
                                }
                              ]
                            },
                            {
                              "query": "tokensInMapSpaces",
                              "spaceFilter": {
                                "condition": {
                                  "op": "or",
                                  "args": [
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "cambodia"
                                    },
                                    {
                                      "op": "==",
                                      "left": {
                                        "ref": "zoneProp",
                                        "zone": "$zone",
                                        "prop": "country"
                                      },
                                      "right": "laos"
                                    }
                                  ]
                                }
                              },
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "in",
                                  "value": [
                                    "NVA",
                                    "VC"
                                  ]
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "base"
                                },
                                {
                                  "prop": "tunnel",
                                  "op": "eq",
                                  "value": "untunneled"
                                }
                              ]
                            }
                          ]
                        },
                        "max": {
                          "ref": "binding",
                          "name": "$dieRoll"
                        },
                        "min": 0
                      }
                    },
                    {
                      "forEach": {
                        "bind": "$piece",
                        "over": {
                          "query": "binding",
                          "name": "$insurgentPieces"
                        },
                        "effects": [
                          {
                            "moveToken": {
                              "token": "$piece",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$piece"
                                }
                              },
                              "to": {
                                "zoneExpr": {
                                  "concat": [
                                    "available-",
                                    {
                                      "ref": "tokenProp",
                                      "token": "$piece",
                                      "prop": "faction"
                                    },
                                    ":none"
                                  ]
                                }
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA places 2 pieces in Cambodia. US moves any 2 US Troops to out of play. Aid -6.",
            "effects": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.18.shaded.effects.0.distributeTokens.selectTokens",
                  "bind": "$__selected_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens",
                  "options": {
                    "query": "tokensInZone",
                    "zone": "available-NVA:none",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      }
                    ]
                  },
                  "max": 2,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$__token_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens",
                  "over": {
                    "query": "binding",
                    "name": "$__selected_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens"
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.18.shaded.effects.0.distributeTokens.chooseDestination",
                        "bind": "$__destination_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens",
                        "options": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "country"
                              },
                              "right": "cambodia"
                            }
                          }
                        }
                      }
                    },
                    {
                      "moveToken": {
                        "token": "$__token_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$__token_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens"
                          }
                        },
                        "to": {
                          "zoneExpr": {
                            "ref": "binding",
                            "name": "$__destination_doc_eventDecks_0_cards_18_shaded_effects_0_distributeTokens"
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.18.shaded.effects.1.chooseN",
                  "bind": "$usTroops",
                  "options": {
                    "query": "concat",
                    "sources": [
                      {
                        "query": "tokensInMapSpaces",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      {
                        "query": "tokensInZone",
                        "zone": "casualties-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      }
                    ]
                  },
                  "max": 2,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$usTroop",
                  "over": {
                    "query": "binding",
                    "name": "$usTroops"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$usTroop",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$usTroop"
                          }
                        },
                        "to": {
                          "zoneExpr": "out-of-play-US:none"
                        }
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -6
                }
              }
            ]
          }
        },
        {
          "id": "card-3",
          "title": "Peace Talks",
          "sideMode": "dual",
          "order": 3,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "NVA",
              "ARVN",
              "VC"
            ],
            "flavorText": "Public negotiations mask battlefield pressure."
          },
          "unshaded": {
            "text": "NVA Resources -9. Linebacker II allowed when Support + Available US (Troops + Bases) > 25.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": -9
                }
              },
              {
                "setVar": {
                  "scope": "global",
                  "var": "linebacker11SupportAvailable",
                  "value": 0
                }
              },
              {
                "forEach": {
                  "bind": "$space",
                  "over": {
                    "query": "mapSpaces"
                  },
                  "effects": [
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$space",
                            "marker": "supportOpposition"
                          },
                          "right": "passiveSupport"
                        },
                        "then": [
                          {
                            "addVar": {
                              "scope": "global",
                              "var": "linebacker11SupportAvailable",
                              "delta": {
                                "ref": "zoneProp",
                                "zone": "$space",
                                "prop": "population"
                              }
                            }
                          }
                        ]
                      }
                    },
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "markerState",
                            "space": "$space",
                            "marker": "supportOpposition"
                          },
                          "right": "activeSupport"
                        },
                        "then": [
                          {
                            "addVar": {
                              "scope": "global",
                              "var": "linebacker11SupportAvailable",
                              "delta": {
                                "op": "*",
                                "left": {
                                  "ref": "zoneProp",
                                  "zone": "$space",
                                  "prop": "population"
                                },
                                "right": 2
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "linebacker11SupportAvailable",
                  "delta": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "linebacker11SupportAvailable",
                  "delta": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      }
                    }
                  }
                }
              },
              {
                "if": {
                  "when": {
                    "op": ">",
                    "left": {
                      "ref": "gvar",
                      "var": "linebacker11SupportAvailable"
                    },
                    "right": 25
                  },
                  "then": [
                    {
                      "setVar": {
                        "scope": "global",
                        "var": "linebacker11Allowed",
                        "value": true
                      }
                    }
                  ],
                  "else": [
                    {
                      "setVar": {
                        "scope": "global",
                        "var": "linebacker11Allowed",
                        "value": false
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Bombing halt: NVA Resources +9. If Trail is 0-2, set Trail to 3.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": 9
                }
              },
              {
                "if": {
                  "when": {
                    "op": "<=",
                    "left": {
                      "ref": "gvar",
                      "var": "trail"
                    },
                    "right": 2
                  },
                  "then": [
                    {
                      "setVar": {
                        "scope": "global",
                        "var": "trail",
                        "value": 3
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-4",
          "title": "Top Gun",
          "sideMode": "dual",
          "order": 4,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "NVA",
              "ARVN",
              "VC"
            ],
            "flavorText": "Naval aviators sharpen air-superiority tactics."
          },
          "unshaded": {
            "text": "Cancel shaded MiGs. Air Strikes Degrade Trail 2 boxes. US CAPABILITY.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_topGun",
                  "state": "unshaded"
                }
              },
              {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "cap_migs"
                    },
                    "right": "shaded"
                  },
                  "then": [
                    {
                      "setGlobalMarker": {
                        "marker": "cap_migs",
                        "state": "inactive"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Air Strike Degrades Trail after applying 2 hits only on die roll of 4-6.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_topGun",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-5",
          "title": "Wild Weasels",
          "sideMode": "dual",
          "order": 5,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "NVA",
              "ARVN",
              "VC"
            ],
            "flavorText": "Air defense suppression."
          },
          "unshaded": {
            "text": "Remove shaded SA-2s or, if no shaded SA-2s, Degrade Trail 2 boxes and NVA Resources -9.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "cap_sa2s"
                    },
                    "right": "shaded"
                  },
                  "then": [
                    {
                      "setGlobalMarker": {
                        "marker": "cap_sa2s",
                        "state": "inactive"
                      }
                    }
                  ],
                  "else": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "trail",
                        "delta": -2
                      }
                    },
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "nvaResources",
                        "delta": -9
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Complex strike packages: Until Coup, Air Strike either Degrades Trail or may remove just 1 piece (not 1-6). MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-wild-weasels",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_wildWeasels",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_wildWeasels",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-6",
          "title": "Aces",
          "sideMode": "dual",
          "order": 6,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "NVA",
              "VC",
              "ARVN"
            ],
            "flavorText": "Robin Olds ambushes MiGs."
          },
          "unshaded": {
            "text": "Free Air Strike any 1 space outside the South with 6 hits and Degrade Trail 2 boxes.",
            "effectTiming": "afterGrants",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "aces-us-airstrike",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airStrike"
                ]
              }
            ],
            "lastingEffects": [
              {
                "id": "evt-aces-window",
                "duration": "turn",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "fitl_acesAirStrikeWindow",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "fitl_acesAirStrikeWindow",
                      "value": false
                    }
                  }
                ]
              }
            ],
            "effects": [
              {
                "setVar": {
                  "scope": "global",
                  "var": "fitl_acesAirStrikeWindow",
                  "value": false
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": -2
                }
              }
            ]
          },
          "shaded": {
            "text": "MiG ace 'Colonel Tomb': 2 Available US Troops to Casualties. Improve Trail by 2 boxes.",
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "usTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "casualties-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": 2
                }
              }
            ]
          }
        },
        {
          "id": "card-7",
          "title": "ADSID",
          "sideMode": "dual",
          "order": 7,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "NVA",
              "VC",
              "ARVN"
            ],
            "flavorText": "Air-delivered seismic intrusion detector."
          },
          "unshaded": {
            "text": "Through Coup, -6 NVA Resources at any Trail# change. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-adsid",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_adsid",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_adsid",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Dubious technology: Improve Trail by 1 box and to a minimum of 2. ARVN Resources -9.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": 1
                }
              },
              {
                "if": {
                  "when": {
                    "op": "<",
                    "left": {
                      "ref": "gvar",
                      "var": "trail"
                    },
                    "right": 2
                  },
                  "then": [
                    {
                      "setVar": {
                        "scope": "global",
                        "var": "trail",
                        "value": 2
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": -9
                }
              }
            ]
          }
        },
        {
          "id": "card-8",
          "title": "Arc Light",
          "sideMode": "dual",
          "order": 8,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "NVA",
              "VC",
              "ARVN"
            ],
            "flavorText": "Guided B-52 tactical bombing."
          },
          "unshaded": {
            "text": "1 space each Air Strike may be a Province without COIN pieces. US CAPABILITY.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_arcLight",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Air Strike spaces removing >1 piece shift 2 levels toward Active Opposition.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_arcLight",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-9",
          "title": "Psychedelic Cookie",
          "sideMode": "dual",
          "order": 9,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "NVA",
              "VC",
              "ARVN"
            ],
            "flavorText": "Field improvisation expands helicopter mobility."
          },
          "unshaded": {
            "text": "US moves up to 3 US Troops from out of play to Available or South Vietnam, or from the map to Available.",
            "effects": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.25.unshaded.effects.0.chooseN",
                  "bind": "$usTroops",
                  "options": {
                    "query": "concat",
                    "sources": [
                      {
                        "query": "tokensInZone",
                        "zone": "out-of-play-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      {
                        "query": "tokensInMapSpaces",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      }
                    ]
                  },
                  "max": 3,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$usTroop",
                  "over": {
                    "query": "binding",
                    "name": "$usTroops"
                  },
                  "effects": [
                    {
                      "if": {
                        "when": {
                          "op": "==",
                          "left": {
                            "ref": "tokenZone",
                            "token": "$usTroop"
                          },
                          "right": "out-of-play-US:none"
                        },
                        "then": [
                          {
                            "chooseOne": {
                              "internalDecisionId": "decision:doc.eventDecks.0.cards.25.unshaded.effects.1.forEach.effects.0.if.then.0.chooseOne",
                              "bind": "$oopTroopDestination@{$usTroop}",
                              "options": {
                                "query": "enums",
                                "values": [
                                  "available-US:none",
                                  "south-vietnam-map"
                                ]
                              }
                            }
                          },
                          {
                            "if": {
                              "when": {
                                "op": "==",
                                "left": {
                                  "ref": "binding",
                                  "name": "$oopTroopDestination@{$usTroop}"
                                },
                                "right": "available-US:none"
                              },
                              "then": [
                                {
                                  "moveToken": {
                                    "token": "$usTroop",
                                    "from": {
                                      "zoneExpr": {
                                        "ref": "tokenZone",
                                        "token": "$usTroop"
                                      }
                                    },
                                    "to": {
                                      "zoneExpr": "available-US:none"
                                    }
                                  }
                                }
                              ],
                              "else": [
                                {
                                  "chooseOne": {
                                    "internalDecisionId": "decision:doc.eventDecks.0.cards.25.unshaded.effects.1.forEach.effects.0.if.then.1.if.else.0.chooseOne",
                                    "bind": "$southVietnamSpace@{$usTroop}",
                                    "options": {
                                      "query": "mapSpaces",
                                      "filter": {
                                        "condition": {
                                          "op": "==",
                                          "left": {
                                            "ref": "zoneProp",
                                            "zone": "$zone",
                                            "prop": "country"
                                          },
                                          "right": "southVietnam"
                                        }
                                      }
                                    }
                                  }
                                },
                                {
                                  "moveToken": {
                                    "token": "$usTroop",
                                    "from": {
                                      "zoneExpr": {
                                        "ref": "tokenZone",
                                        "token": "$usTroop"
                                      }
                                    },
                                    "to": {
                                      "zoneExpr": {
                                        "ref": "binding",
                                        "name": "$southVietnamSpace@{$usTroop}"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ],
                        "else": [
                          {
                            "moveToken": {
                              "token": "$usTroop",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$usTroop"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "US takes 3 of its Troops from the map out of play.",
            "effects": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.25.shaded.effects.0.chooseN",
                  "bind": "$usMapTroops",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "US"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "troops"
                      }
                    ]
                  },
                  "max": 3,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$usTroop",
                  "over": {
                    "query": "binding",
                    "name": "$usMapTroops"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$usTroop",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$usTroop"
                          }
                        },
                        "to": {
                          "zoneExpr": "out-of-play-US:none"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-10",
          "title": "Rolling Thunder",
          "sideMode": "dual",
          "order": 10,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "NVA",
              "VC",
              "ARVN"
            ],
            "flavorText": "Sustained bombing."
          },
          "unshaded": {
            "text": "Degrade Trail 2 boxes. -9 NVA Resources. NVA Ineligible through next card.",
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "seat",
                  "seat": "2"
                },
                "eligible": false,
                "windowId": "make-ineligible"
              }
            ],
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": -2
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": -9
                }
              }
            ]
          },
          "shaded": {
            "text": "Assets to restricted strategic air campaign: -5 ARVN Resources. No Air Strike until Coup. MOMENTUM",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": -5
                }
              }
            ],
            "lastingEffects": [
              {
                "id": "mom-rolling-thunder",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_rollingThunder",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_rollingThunder",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-11",
          "title": "Abrams",
          "sideMode": "dual",
          "order": 11,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "NVA",
              "VC"
            ],
            "flavorText": "Command shift prioritizes selective base targeting."
          },
          "unshaded": {
            "text": "US capability: one Assault space removes untunneled base first.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_abrams",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "US capability (shaded): US/ARVN Assault is limited to max 2 spaces.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_abrams",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-12",
          "title": "Capt Buck Adams",
          "sideMode": "dual",
          "order": 12,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "NVA",
              "VC"
            ],
            "flavorText": "Aggressive river command disrupts entrenched cells."
          },
          "unshaded": {
            "text": "River assault: flip guerrillas and remove exposed insurgents."
          },
          "shaded": {
            "text": "Counter-ambushes force US attrition and tactical withdrawal."
          }
        },
        {
          "id": "card-13",
          "title": "Cobras",
          "sideMode": "dual",
          "order": 13,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "NVA",
              "VC"
            ],
            "flavorText": "Gunship support amplifies Sweep and complicates Assault."
          },
          "unshaded": {
            "text": "US capability: up to 2 Sweep spaces each remove 1 active/untunneled enemy.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cobras",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "US capability (shaded): each Assault space may lose 1 US Troop on low die roll.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cobras",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-14",
          "title": "M-48 Patton",
          "sideMode": "dual",
          "order": 14,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "ARVN",
              "NVA",
              "VC"
            ],
            "flavorText": "Armored punch."
          },
          "unshaded": {
            "text": "2 non-Lowland US Assault spaces each remove 2 extra enemy pieces.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_m48Patton",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "RPGs: After US/ARVN Patrol, NVA removes up to 2 cubes that moved (US to Casualties).",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_m48Patton",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-15",
          "title": "Medevac",
          "sideMode": "dual",
          "order": 15,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "US",
              "ARVN",
              "NVA",
              "VC"
            ],
            "flavorText": "Helicopter evacuation doctrine expands."
          },
          "unshaded": {
            "text": "Through Coup, all Troop casualties return to Available.",
            "lastingEffects": [
              {
                "id": "mom-medevac-unshaded",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_medevacUnshaded",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_medevacUnshaded",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Through Coup, US Troop casualties remain unavailable.",
            "lastingEffects": [
              {
                "id": "mom-medevac-shaded",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_medevacShaded",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_medevacShaded",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-16",
          "title": "Blowtorch Komer",
          "sideMode": "dual",
          "order": 16,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Pacification drive intensifies political pressure."
          },
          "unshaded": {
            "text": "Through Coup, Pacification shifts 1 additional level toward Support. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-blowtorch-komer",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_blowtorchKomer",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_blowtorchKomer",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Pacification backlash: rural coercion increases opposition pressure."
          }
        },
        {
          "id": "card-17",
          "title": "Claymores",
          "sideMode": "dual",
          "order": 17,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Perimeter."
          },
          "unshaded": {
            "text": "Stay Eligible. Until Coup, no Ambush; remove 1 Guerrilla from each Marching group that Activates.",
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "active"
                },
                "eligible": true,
                "windowId": "remain-eligible"
              }
            ],
            "lastingEffects": [
              {
                "id": "mom-claymores",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_claymores",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_claymores",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Infiltrators turn mines around: remove 1 COIN Base and 1 Underground Insurgent from a space with both.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "in",
                                    "value": [
                                      "US",
                                      "ARVN"
                                    ]
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "base"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "in",
                                    "value": [
                                      "NVA",
                                      "VC"
                                    ]
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "guerrilla"
                                  },
                                  {
                                    "prop": "activity",
                                    "op": "eq",
                                    "value": "underground"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "targetCoinBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$targetCoinBase",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    },
                    {
                      "bind": "targetInsurgent",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          },
                          {
                            "prop": "activity",
                            "op": "eq",
                            "value": "underground"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$targetInsurgent",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-18",
          "title": "Combined Action Platoons",
          "sideMode": "dual",
          "order": 18,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Hamlet defense."
          },
          "unshaded": {
            "text": "US Training places or relocates an added Police into any 1 space with US Troops.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_caps",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Passive posture: US may select max 2 spaces per Sweep.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_caps",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-19",
          "title": "CORDS",
          "sideMode": "dual",
          "order": 19,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Civil-military integration accelerates local governance."
          },
          "unshaded": {
            "text": "US capability: US/ARVN Train may execute sub-activity in up to 2 spaces.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cords",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "US capability (shaded): Pacification in Train can only set to Passive Support.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cords",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-20",
          "title": "Laser Guided Bombs",
          "sideMode": "dual",
          "order": 20,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Precision strike doctrine changes target priorities."
          },
          "unshaded": {
            "text": "US capability: Air Strike may spare one selected space from casualties.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_lgbs",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "US capability (shaded): Air Strike may remove at most 4 pieces total.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_lgbs",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-21",
          "title": "Americal",
          "sideMode": "dual",
          "order": 21,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "VC",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Rapid redeployment reshapes local balance."
          },
          "unshaded": {
            "text": "US Troops reposition to pressure insurgent strongholds."
          },
          "shaded": {
            "text": "Escalation costs: local backlash shifts spaces toward Opposition."
          }
        },
        {
          "id": "card-22",
          "title": "Da Nang",
          "sideMode": "dual",
          "order": 22,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "VC",
              "NVA",
              "ARVN"
            ],
            "flavorText": "US Marines arrive."
          },
          "unshaded": {
            "text": "US places up to 6 Troops in Da Nang, up to 3 from out of play.",
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "usTroopOutOfPlay",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "out-of-play-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "da-nang:none"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "usTroopAvailable",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "da-nang:none"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "VC fire closes air base: Remove all Support within 1 space of Da Nang. No Air Strike until Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-da-nang",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_daNang",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_daNang",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-23",
          "title": "Operation Attleboro",
          "sideMode": "dual",
          "order": 23,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "VC",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Stab at Iron Triangle."
          },
          "unshaded": {
            "text": "US free Air Lifts into, Sweeps in, then Assaults a space with a Tunnel, removing Tunneled Bases as if no Tunnel.",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "operation-attleboro-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airLift"
                ]
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "operation-attleboro-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ]
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "operation-attleboro-us",
                  "step": 2
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Heavy casualties, few results: Select a Tunnel space: remove a die roll of US Troops within 1 space of it to Casualties."
          }
        },
        {
          "id": "card-24",
          "title": "Operation Starlite",
          "sideMode": "dual",
          "order": 24,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "VC",
              "NVA",
              "ARVN"
            ],
            "flavorText": "VC caught off guard."
          },
          "unshaded": {
            "text": "Remove all VC from a coastal Province with or adjacent to US Troops.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 99,
                  "groups": [
                    {
                      "bind": "vcPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetProvince",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-VC:none"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Slipped away: In up to 3 Provinces, flip all VC Guerrillas Underground. Stay Eligible.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "active"
                },
                "eligible": true,
                "windowId": "remain-eligible"
              }
            ],
            "effects": [
              {
                "forEach": {
                  "bind": "$vcGuerrilla",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$targetProvince",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "VC"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "guerrilla"
                      },
                      {
                        "prop": "activity",
                        "op": "eq",
                        "value": "active"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$vcGuerrilla",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-25",
          "title": "TF-116 Riverines",
          "sideMode": "dual",
          "order": 25,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "VC",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Delta boats."
          },
          "unshaded": {
            "text": "Remove all NVA/VC from Mekong LoCs. US or ARVN free Sweep into/in then free Assault each Lowland touching Mekong.",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "tf116-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep",
                  "assault"
                ]
              },
              {
                "seat": "1",
                "sequence": {
                  "chain": "tf116-arvn",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep",
                  "assault"
                ]
              }
            ],
            "targets": [
              {
                "id": "$targetLoc",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "loc"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 99,
                  "groups": [
                    {
                      "bind": "insurgentPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetLoc",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$insurgentPiece",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "VC river fortifications: Place 2 VC Guerrillas per Mekong LoC space, then Sabotage each that has more VC than COIN.",
            "targets": [
              {
                "id": "$targetLoc",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "loc"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetLoc"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-26",
          "title": "LRRP",
          "sideMode": "dual",
          "order": 26,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "US",
              "VC",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Long-range reconnaissance patrols probe deep."
          },
          "unshaded": {
            "text": "Place up to 2 Irregulars, then US executes free Air Strike.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ],
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "lrrp-us-airstrike",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airStrike"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Counterintelligence sweep: remove up to 2 Irregulars to Available.",
            "targets": [
              {
                "id": "$sourceSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-27",
          "title": "Phoenix Program",
          "sideMode": "dual",
          "order": 27,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "VC",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Neutralization campaigns expand."
          },
          "unshaded": {
            "text": "Intelligence campaign: Aid -1.",
            "targets": [
              {
                "id": "vc-in-coin-control",
                "selector": {
                  "query": "players"
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -1
                }
              }
            ]
          },
          "shaded": {
            "text": "Repression backlash: Aid -2 and ARVN Resources -1.",
            "targets": [
              {
                "id": "terror-spaces",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -2
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": -1
                }
              }
            ]
          }
        },
        {
          "id": "card-28",
          "title": "Search and Destroy",
          "sideMode": "dual",
          "order": 28,
          "tags": [
            "capability",
            "US"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "US",
              "VC",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Mobile counter-guerrilla ops."
          },
          "unshaded": {
            "text": "Each US Assault space may remove 1 Underground Guerrilla.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_searchAndDestroy",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Villagers in the crossfire: Each US and ARVN Assault Province shifts by 1 level toward Active Opposition.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_searchAndDestroy",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-29",
          "title": "Tribesmen",
          "sideMode": "dual",
          "order": 29,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "US",
              "VC",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Highland loyalties shift under pressure."
          },
          "unshaded": {
            "text": "Remove Insurgent Guerrillas, then replace with Irregulars.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "insurgentGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$insurgentGuerrilla",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Montagnard backlash: remove Irregulars and infiltrate Guerrillas.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "nvaGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-NVA:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-30",
          "title": "USS New Jersey",
          "sideMode": "dual",
          "order": 30,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "US",
              "VC",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Battleship fire support pounds coastal positions."
          },
          "unshaded": {
            "text": "US executes free Air Strikes in coastal spaces."
          },
          "shaded": {
            "text": "Counterfire and dispersion blunt naval bombardment."
          }
        },
        {
          "id": "card-31",
          "title": "AAA",
          "sideMode": "dual",
          "order": 31,
          "tags": [
            "capability",
            "NVA"
          ],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "US",
              "ARVN",
              "VC"
            ],
            "flavorText": "Air defense guns thicken around infiltration routes."
          },
          "unshaded": {
            "text": "NVA capability: Rally Trail improvement restricted.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_aaa",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA capability (shaded): air defense suppresses COIN air power.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_aaa",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-32",
          "title": "Long Range Guns",
          "sideMode": "dual",
          "order": 32,
          "tags": [
            "capability",
            "NVA"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "ARVN",
              "VC"
            ],
            "flavorText": "Long-range artillery extends pressure across contested routes."
          },
          "unshaded": {
            "text": "NVA capability: Bombard can target adjacent spaces from farther range.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_longRangeGuns",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA capability (shaded): COIN movement near artillery zones risks attrition.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_longRangeGuns",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-33",
          "title": "MiGs",
          "sideMode": "dual",
          "order": 33,
          "tags": [
            "capability",
            "NVA"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "ARVN",
              "VC"
            ],
            "flavorText": "Interceptors contest US air power over the North."
          },
          "unshaded": {
            "text": "NVA capability: Air Strike pressure is reduced unless unshaded Top Gun is active.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_migs",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA capability (shaded): US Air Strike can trigger extra troop costs in affected spaces.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "globalMarkerState",
                      "marker": "cap_topGun"
                    },
                    "right": "unshaded"
                  },
                  "then": [
                    {
                      "setGlobalMarker": {
                        "marker": "cap_migs",
                        "state": "inactive"
                      }
                    }
                  ],
                  "else": [
                    {
                      "setGlobalMarker": {
                        "marker": "cap_migs",
                        "state": "shaded"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-34",
          "title": "SA-2s",
          "sideMode": "dual",
          "order": 34,
          "tags": [
            "capability",
            "NVA"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "US",
              "ARVN",
              "VC"
            ],
            "flavorText": "Surface-to-air missiles tighten the northern shield."
          },
          "unshaded": {
            "text": "NVA capability: Air Strike can remove only 2 pieces in one selected space.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_sa2s",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA capability (shaded): Air Strike losses can include US Troops when available.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_sa2s",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-35",
          "title": "Thanh Hoa",
          "sideMode": "dual",
          "order": 35,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "ARVN",
              "VC"
            ],
            "flavorText": "Air-defense concentration blunts repeated bridge attacks."
          },
          "unshaded": {
            "text": "NVA fortifies logistics corridor resilience around Trail adjustments."
          },
          "shaded": {
            "text": "Strike disruption causes COIN losses and protects northern throughput."
          }
        },
        {
          "id": "card-36",
          "title": "Hamburger Hill",
          "sideMode": "dual",
          "order": 36,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "VC",
              "ARVN"
            ],
            "flavorText": "A brutal highland battle drives force repositioning and tunnel pressure."
          },
          "unshaded": {
            "text": "Reposition selected NVA/VC forces and intensify pressure against exposed COIN units."
          },
          "shaded": {
            "text": "COIN assault gains ground but incurs attrition and tunnel-side effects."
          }
        },
        {
          "id": "card-37",
          "title": "Khe Sanh",
          "sideMode": "dual",
          "order": 37,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "VC",
              "ARVN"
            ],
            "flavorText": "Siege operations force major commitment and casualties."
          },
          "unshaded": {
            "text": "Mass removal pressure in one contested area; route vulnerable US losses to Casualties."
          },
          "shaded": {
            "text": "Relief effort redistributes pieces and partially relieves siege pressure."
          }
        },
        {
          "id": "card-38",
          "title": "McNamara Line",
          "sideMode": "single",
          "order": 38,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "US",
              "VC",
              "ARVN"
            ],
            "flavorText": "Barrier planning constrains infiltration routes."
          },
          "unshaded": {
            "text": "No Infiltrate or Trail Improvement until Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-mcnamara-line",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_mcnamaraLine",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_mcnamaraLine",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-39",
          "title": "Oriskany",
          "sideMode": "dual",
          "order": 39,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "US",
              "VC",
              "ARVN"
            ],
            "flavorText": "Carrier deck fire disrupts strike tempo."
          },
          "unshaded": {
            "text": "Air Strike degrades Trail by 2 and lowers NVA Resources by 9."
          },
          "shaded": {
            "text": "No Trail degrade from Air Strike until Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-oriskany",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_oriskany",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_oriskany",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-40",
          "title": "PoWs",
          "sideMode": "dual",
          "order": 40,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "US",
              "VC",
              "ARVN"
            ],
            "flavorText": "Prisoner exchanges and detention politics alter casualty flows."
          },
          "unshaded": {
            "text": "Move selected Casualties and adjust resources based on exchange outcomes."
          },
          "shaded": {
            "text": "Captivity leverage deepens COIN attrition and slows force recovery."
          }
        },
        {
          "id": "card-41",
          "title": "Bombing Pause",
          "sideMode": "dual",
          "order": 41,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "ARVN",
              "US",
              "VC"
            ],
            "flavorText": "Air campaign pauses shift tempo across infiltration and support tracks."
          },
          "unshaded": {
            "text": "No Air Strike until Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-bombing-pause",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_bombingPause",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_bombingPause",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Pause collapses: US resumes heavy air pressure and NVA pays strategic costs."
          }
        },
        {
          "id": "card-42",
          "title": "Chou En Lai",
          "sideMode": "dual",
          "order": 42,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "ARVN",
              "US",
              "VC"
            ],
            "flavorText": "Chinese leverage links diplomacy to wartime resource shifts."
          },
          "unshaded": {
            "text": "Resource shifts follow diplomatic signaling and die-based political momentum."
          },
          "shaded": {
            "text": "Diplomatic friction disrupts aid flows and rebalances insurgent support."
          }
        },
        {
          "id": "card-43",
          "title": "Economic Aid",
          "sideMode": "dual",
          "order": 43,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "ARVN",
              "US",
              "VC"
            ],
            "flavorText": "Free World aids Saigon."
          },
          "unshaded": {
            "text": "2 ARVN or 2 US Bases out-of-play to Available. Then ARVN Resources +6 or Aid +12.",
            "branches": [
              {
                "id": "return-us-bases-and-aid",
                "order": 1,
                "targets": [
                  {
                    "id": "us-out-of-play-bases",
                    "selector": {
                      "query": "players"
                    },
                    "cardinality": {
                      "max": 2
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 2,
                      "groups": [
                        {
                          "bind": "usBaseOutOfPlay",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "out-of-play-US:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "base"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-US:none"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 12
                    }
                  }
                ]
              },
              {
                "id": "return-arvn-bases-and-resources",
                "order": 2,
                "targets": [
                  {
                    "id": "arvn-out-of-play-bases",
                    "selector": {
                      "query": "players"
                    },
                    "cardinality": {
                      "max": 2
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 2,
                      "groups": [
                        {
                          "bind": "arvnBaseOutOfPlay",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "out-of-play-ARVN:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "base"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-ARVN:none"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "arvnResources",
                      "delta": 6
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Moscow aids Hanoi: Improve the Trail 1 box. Then either Improve it 1 more box or add +10 NVA Resources.",
            "branches": [
              {
                "id": "improve-trail-twice",
                "order": 1,
                "effects": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "trail",
                      "delta": 1
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "trail",
                      "delta": 1
                    }
                  }
                ]
              },
              {
                "id": "improve-trail-and-add-resources",
                "order": 2,
                "effects": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "trail",
                      "delta": 1
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "nvaResources",
                      "delta": 10
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-44",
          "title": "Ia Drang",
          "sideMode": "dual",
          "order": 44,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "ARVN",
              "US",
              "VC"
            ],
            "flavorText": "Silver Bayonet."
          },
          "unshaded": {
            "text": "US free Air Lifts into 1 space with any NVA piece, then free Sweeps and Assaults there.",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "ia-drang-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airLift"
                ],
                "zoneFilter": {
                  "op": ">",
                  "left": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "$zone",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          }
                        ]
                      }
                    }
                  },
                  "right": 0
                }
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "ia-drang-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ],
                "zoneFilter": {
                  "op": ">",
                  "left": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "$zone",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          }
                        ]
                      }
                    }
                  },
                  "right": 0
                }
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "ia-drang-us",
                  "step": 2
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ],
                "zoneFilter": {
                  "op": ">",
                  "left": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "$zone",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          }
                        ]
                      }
                    }
                  },
                  "right": 0
                }
              }
            ]
          },
          "shaded": {
            "text": "Dong Xuan campaign-hot LZs: Select a Province with NVA Troops then remove a die roll of US Troops within 1 space of it to Casualties.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "NVA"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "troops"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "rollRandom": {
                  "bind": "$iaDrangLossRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "removeByPriority": {
                        "budget": {
                          "ref": "binding",
                          "name": "$iaDrangLossRoll"
                        },
                        "groups": [
                          {
                            "bind": "usTroopInProvince",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$targetProvince",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "US"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            "to": {
                              "zoneExpr": "casualties-US:none"
                            }
                          }
                        ],
                        "remainingBind": "$remainingLosses",
                        "in": [
                          {
                            "forEach": {
                              "bind": "$adjacentSpace",
                              "over": {
                                "query": "adjacentZones",
                                "zone": "$targetProvince"
                              },
                              "effects": [
                                {
                                  "if": {
                                    "when": {
                                      "op": ">",
                                      "left": {
                                        "ref": "binding",
                                        "name": "$remainingLosses"
                                      },
                                      "right": 0
                                    },
                                    "then": [
                                      {
                                        "removeByPriority": {
                                          "budget": {
                                            "ref": "binding",
                                            "name": "$remainingLosses"
                                          },
                                          "groups": [
                                            {
                                              "bind": "usTroopAdjacent",
                                              "over": {
                                                "query": "tokensInZone",
                                                "zone": "$adjacentSpace",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "US"
                                                  },
                                                  {
                                                    "prop": "type",
                                                    "op": "eq",
                                                    "value": "troops"
                                                  }
                                                ]
                                              },
                                              "to": {
                                                "zoneExpr": "casualties-US:none"
                                              }
                                            }
                                          ],
                                          "remainingBind": "$remainingLosses"
                                        }
                                      }
                                    ],
                                    "else": []
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-45",
          "title": "PT-76",
          "sideMode": "dual",
          "order": 45,
          "tags": [
            "capability",
            "NVA"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "ARVN",
              "US",
              "VC"
            ],
            "flavorText": "Amphibious armor expands NVA assault options in difficult terrain."
          },
          "unshaded": {
            "text": "NVA capability: selected Assaults gain armored removal pressure.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_pt76",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "NVA capability (shaded): armored commitments increase NVA troop exposure.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_pt76",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-46",
          "title": "559th Transport Grp",
          "sideMode": "dual",
          "order": 46,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "ARVN",
              "VC",
              "US"
            ],
            "flavorText": "Route command tightens corridor discipline."
          },
          "unshaded": {
            "text": "NVA Infiltrate to only 1 destination space through Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-559th-transport-grp",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_559thTransportGrp",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_559thTransportGrp",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "US Aid -6 and NVA Resources +6.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -6
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": 6
                }
              }
            ]
          }
        },
        {
          "id": "card-47",
          "title": "Chu Luc",
          "sideMode": "dual",
          "order": 47,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "ARVN",
              "VC",
              "US"
            ],
            "flavorText": "Main-force concentration accelerates in contested provinces."
          },
          "unshaded": {
            "text": "Place 3 NVA Troops into any spaces with NVA pieces.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": ">",
                      "left": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$zone",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "NVA"
                              }
                            ]
                          }
                        }
                      },
                      "right": 0
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "nvaTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-NVA:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Place 2 VC Guerrillas into any spaces with VC pieces.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": ">",
                      "left": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "$zone",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "VC"
                              }
                            ]
                          }
                        }
                      },
                      "right": 0
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-48",
          "title": "Nam Dong",
          "sideMode": "dual",
          "order": 48,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "ARVN",
              "VC",
              "US"
            ],
            "flavorText": "A CIDG camp attack ripples across I Corps."
          },
          "unshaded": {
            "text": "Remove Guerrillas and a COIN Base in one space.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "insurgentGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$insurgentGuerrilla",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "coinBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$coinBase",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Propaganda aftermath: remove a COIN Base; NVA Resources +3.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "coinBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$coinBase",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": 3
                }
              }
            ]
          }
        },
        {
          "id": "card-49",
          "title": "Russian Arms",
          "sideMode": "dual",
          "order": 49,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "ARVN",
              "VC",
              "US"
            ],
            "flavorText": "External materiel shipments increase insurgent placement flexibility."
          },
          "unshaded": {
            "text": "Place NVA/VC pieces into eligible spaces and improve insurgent posture."
          },
          "shaded": {
            "text": "Arms pipeline disruption limits placement and redirects strategic effort."
          }
        },
        {
          "id": "card-50",
          "title": "Uncle Ho",
          "sideMode": "dual",
          "order": 50,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "ARVN",
              "VC",
              "US"
            ],
            "flavorText": "Strategic guidance reshapes tempo of operations."
          },
          "unshaded": {
            "text": "Either ARVN executes 2 free Limited Operations, or VC then NVA execute 3 total.",
            "branches": [
              {
                "id": "arvn-two-free-limited-ops",
                "order": 1,
                "freeOperationGrants": [
                  {
                    "seat": "1",
                    "sequence": {
                      "chain": "uncle-ho-unshaded-arvn-two",
                      "step": 0
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "1",
                    "sequence": {
                      "chain": "uncle-ho-unshaded-arvn-two",
                      "step": 1
                    },
                    "operationClass": "limitedOperation"
                  }
                ]
              },
              {
                "id": "vc-then-nva-three-free-limited-ops",
                "order": 2,
                "freeOperationGrants": [
                  {
                    "seat": "3",
                    "sequence": {
                      "chain": "uncle-ho-unshaded-vc-nva-three",
                      "step": 0
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "3",
                    "sequence": {
                      "chain": "uncle-ho-unshaded-vc-nva-three",
                      "step": 1
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "2",
                    "sequence": {
                      "chain": "uncle-ho-unshaded-vc-nva-three",
                      "step": 2
                    },
                    "operationClass": "limitedOperation"
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "COIN initiative: US/ARVN execute 3 total free Limited Operations.",
            "branches": [
              {
                "id": "us-then-arvn-three-free-limited-ops",
                "order": 1,
                "freeOperationGrants": [
                  {
                    "seat": "0",
                    "sequence": {
                      "chain": "uncle-ho-shaded-us-arvn-three",
                      "step": 0
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "1",
                    "sequence": {
                      "chain": "uncle-ho-shaded-us-arvn-three",
                      "step": 1
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "1",
                    "sequence": {
                      "chain": "uncle-ho-shaded-us-arvn-three",
                      "step": 2
                    },
                    "operationClass": "limitedOperation"
                  }
                ]
              },
              {
                "id": "us-two-free-limited-ops",
                "order": 2,
                "freeOperationGrants": [
                  {
                    "seat": "0",
                    "sequence": {
                      "chain": "uncle-ho-shaded-us-two",
                      "step": 0
                    },
                    "operationClass": "limitedOperation"
                  },
                  {
                    "seat": "0",
                    "sequence": {
                      "chain": "uncle-ho-shaded-us-two",
                      "step": 1
                    },
                    "operationClass": "limitedOperation"
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-51",
          "title": "301st Supply Bn",
          "sideMode": "dual",
          "order": 51,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "VC",
              "US",
              "ARVN"
            ],
            "flavorText": "Throughput under strain."
          },
          "unshaded": {
            "text": "Remove non-base Insurgents outside South Vietnam.",
            "targets": [
              {
                "id": "$outsideSouthSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "!=",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "country"
                      },
                      "right": "southVietnam"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "nvaTroops",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$outsideSouthSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-NVA:none"
                      }
                    },
                    {
                      "bind": "nvaGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$outsideSouthSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-NVA:none"
                      }
                    },
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$outsideSouthSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-VC:none"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Improve Trail 1 box and add NVA Resources equal to a die roll.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": 1
                }
              },
              {
                "rollRandom": {
                  "bind": "$dieRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "nvaResources",
                        "delta": {
                          "ref": "binding",
                          "name": "$dieRoll"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-52",
          "title": "RAND",
          "sideMode": "dual",
          "order": 52,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "VC",
              "US",
              "ARVN"
            ],
            "flavorText": "Analyst leaks expose hidden assumptions and reverse perceived advantages."
          },
          "unshaded": {
            "text": "Flip one currently active capability to its opposite side.",
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.80.unshaded.effects.0.chooseOne",
                  "bind": "$randCapabilityMarker",
                  "options": {
                    "query": "globalMarkers",
                    "states": [
                      "unshaded",
                      "shaded"
                    ]
                  }
                }
              },
              {
                "flipGlobalMarker": {
                  "marker": {
                    "ref": "binding",
                    "name": "$randCapabilityMarker"
                  },
                  "stateA": "unshaded",
                  "stateB": "shaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Flip one currently active capability to its opposite side.",
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.80.shaded.effects.0.chooseOne",
                  "bind": "$randCapabilityMarker",
                  "options": {
                    "query": "globalMarkers",
                    "states": [
                      "unshaded",
                      "shaded"
                    ]
                  }
                }
              },
              {
                "flipGlobalMarker": {
                  "marker": {
                    "ref": "binding",
                    "name": "$randCapabilityMarker"
                  },
                  "stateA": "unshaded",
                  "stateB": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-53",
          "title": "Sappers",
          "sideMode": "dual",
          "order": 53,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "VC",
              "US",
              "ARVN"
            ],
            "flavorText": "Shock teams probe base perimeters."
          },
          "unshaded": {
            "text": "Remove a COIN Base and up to 2 Troops from one selected space.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "coinBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$coinBase",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    },
                    {
                      "bind": "coinTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$coinTroop",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Remove 3 NVA/VC Guerrillas from one selected space.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "insurgentGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$insurgentGuerrilla",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-54",
          "title": "Son Tay",
          "sideMode": "dual",
          "order": 54,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "VC",
              "US",
              "ARVN"
            ],
            "flavorText": "Raid planning reshapes near-term eligibility and initiative windows."
          },
          "unshaded": {
            "text": "Adjust next-card eligibility to favor COIN follow-on operations."
          },
          "shaded": {
            "text": "Raid aftermath shifts eligibility toward insurgent initiative."
          }
        },
        {
          "id": "card-55",
          "title": "Trucks",
          "sideMode": "dual",
          "order": 55,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "NVA",
              "VC",
              "US",
              "ARVN"
            ],
            "flavorText": "Logistics under pressure."
          },
          "unshaded": {
            "text": "Degrade Trail 2 boxes. NVA selects and removes 4 of its pieces each from Laos and Cambodia.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "trail",
                  "delta": -2
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.47.unshaded.effects.1.chooseN",
                  "bind": "$nvaLaosPieces",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "laos"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      }
                    ]
                  },
                  "max": 4,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$nvaLaosPiece",
                  "over": {
                    "query": "binding",
                    "name": "$nvaLaosPieces"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$nvaLaosPiece",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$nvaLaosPiece"
                          }
                        },
                        "to": {
                          "zoneExpr": "available-NVA:none"
                        }
                      }
                    }
                  ]
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.47.unshaded.effects.3.chooseN",
                  "bind": "$nvaCambodiaPieces",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "==",
                        "left": {
                          "ref": "zoneProp",
                          "zone": "$zone",
                          "prop": "country"
                        },
                        "right": "cambodia"
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      }
                    ]
                  },
                  "max": 4,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$nvaCambodiaPiece",
                  "over": {
                    "query": "binding",
                    "name": "$nvaCambodiaPieces"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$nvaCambodiaPiece",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$nvaCambodiaPiece"
                          }
                        },
                        "to": {
                          "zoneExpr": "available-NVA:none"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Add twice Trail value to each NVA and VC Resources. NVA moves its unTunneled Bases anywhere within Laos/Cambodia.",
            "effects": [
              {
                "let": {
                  "bind": "$trailBonus",
                  "value": {
                    "op": "*",
                    "left": 2,
                    "right": {
                      "ref": "gvar",
                      "var": "trail"
                    }
                  },
                  "in": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "nvaResources",
                        "delta": {
                          "ref": "binding",
                          "name": "$trailBonus"
                        }
                      }
                    },
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "vcResources",
                        "delta": {
                          "ref": "binding",
                          "name": "$trailBonus"
                        }
                      }
                    }
                  ]
                }
              },
              {
                "forEach": {
                  "bind": "$nvaBase",
                  "over": {
                    "query": "tokensInMapSpaces",
                    "spaceFilter": {
                      "condition": {
                        "op": "or",
                        "args": [
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "laos"
                          },
                          {
                            "op": "==",
                            "left": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "country"
                            },
                            "right": "cambodia"
                          }
                        ]
                      }
                    },
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "NVA"
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "base"
                      },
                      {
                        "prop": "tunnel",
                        "op": "eq",
                        "value": "untunneled"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.47.shaded.effects.1.forEach.effects.0.chooseOne",
                        "bind": "$baseDestination@{$nvaBase}",
                        "options": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "or",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "country"
                                  },
                                  "right": "laos"
                                },
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "country"
                                  },
                                  "right": "cambodia"
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    {
                      "moveToken": {
                        "token": "$nvaBase",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$nvaBase"
                          }
                        },
                        "to": {
                          "zoneExpr": {
                            "ref": "binding",
                            "name": "$baseDestination@{$nvaBase}"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-56",
          "title": "Vo Nguyen Giap",
          "sideMode": "dual",
          "order": 56,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Operational tempo follows strategic concentration."
          },
          "unshaded": {
            "text": "NVA execute free March then free Attack.",
            "freeOperationGrants": [
              {
                "seat": "2",
                "sequence": {
                  "chain": "vo-nguyen-giap-nva",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "march"
                ]
              },
              {
                "seat": "2",
                "sequence": {
                  "chain": "vo-nguyen-giap-nva",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "attack"
                ]
              }
            ]
          },
          "shaded": {
            "text": "NVA execute free March in up to 3 spaces, then 1 free Op or Special Activity in each."
          }
        },
        {
          "id": "card-57",
          "title": "International Unrest",
          "sideMode": "dual",
          "order": 57,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Global pressure amplifies domestic war costs and casualty politics."
          },
          "unshaded": {
            "text": "Casualty-driven die roll reduces COIN political leverage."
          },
          "shaded": {
            "text": "External backlash constrains insurgent options and forces resource tradeoffs."
          }
        },
        {
          "id": "card-58",
          "title": "Pathet Lao",
          "sideMode": "dual",
          "order": 58,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Laotian coordination alters trail security and redeployment pressure."
          },
          "unshaded": {
            "text": "Conditionally improve Trail or trigger selective redeploy effects."
          },
          "shaded": {
            "text": "Cross-border disruption degrades Trail tempo and complicates redeploy planning."
          }
        },
        {
          "id": "card-59",
          "title": "Plei Mei",
          "sideMode": "dual",
          "order": 59,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Highland clashes force rapid tactical repositioning."
          },
          "unshaded": {
            "text": "Remove enemy pieces in one selected Highland and execute free March.",
            "freeOperationGrants": [
              {
                "seat": "2",
                "sequence": {
                  "chain": "plei-mei-nva",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "march"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Remove COIN pieces in one selected Highland and execute free Attack.",
            "freeOperationGrants": [
              {
                "seat": "2",
                "sequence": {
                  "chain": "plei-mei-nva",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "attack"
                ]
              }
            ]
          }
        },
        {
          "id": "card-60",
          "title": "War Photographer",
          "sideMode": "dual",
          "order": 60,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Images from the front alter force posture and political appetite."
          },
          "unshaded": {
            "text": "Place pieces from Out of Play into selected spaces."
          },
          "shaded": {
            "text": "Media backlash moves selected forces back out of theater."
          }
        },
        {
          "id": "card-61",
          "title": "Armored Cavalry",
          "sideMode": "dual",
          "order": 61,
          "tags": [
            "capability",
            "ARVN"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "Mechanized formations increase ARVN operational reach."
          },
          "unshaded": {
            "text": "ARVN capability: Armored columns improve ARVN mobile operation efficiency.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_armoredCavalry",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "ARVN capability (shaded): armored commitments create vulnerabilities around ARVN moves.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_armoredCavalry",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-62",
          "title": "Cambodian Civil War",
          "sideMode": "dual",
          "order": 62,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "Border conflict opens corridors for rapid intervention and disruption."
          },
          "unshaded": {
            "text": "COIN executes free Air Lift then free Sweep; remove one insurgent Base from Cambodia."
          },
          "shaded": {
            "text": "Regional escalation favors insurgents: remove one COIN Base from Cambodia."
          }
        },
        {
          "id": "card-63",
          "title": "Fact Finding",
          "sideMode": "dual",
          "order": 63,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "Investigations expose gaps in pacification claims."
          },
          "unshaded": {
            "text": "Return pieces from Out of Play; transfer die-roll Patronage to Aid.",
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "usOutOfPlay",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "out-of-play-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "arvnOutOfPlay",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "out-of-play-ARVN:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-ARVN:none"
                      }
                    }
                  ]
                }
              },
              {
                "rollRandom": {
                  "bind": "$dieRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "patronage",
                        "delta": {
                          "op": "*",
                          "left": -1,
                          "right": {
                            "ref": "binding",
                            "name": "$dieRoll"
                          }
                        }
                      }
                    },
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "aid",
                        "delta": {
                          "ref": "binding",
                          "name": "$dieRoll"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Scandal fallout: transfer die-roll Aid to Patronage.",
            "effects": [
              {
                "rollRandom": {
                  "bind": "$dieRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "aid",
                        "delta": {
                          "op": "*",
                          "left": -1,
                          "right": {
                            "ref": "binding",
                            "name": "$dieRoll"
                          }
                        }
                      }
                    },
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "patronage",
                        "delta": {
                          "ref": "binding",
                          "name": "$dieRoll"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-64",
          "title": "Honolulu Conference",
          "sideMode": "single",
          "order": 64,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "Summit signals renewed support for Saigon."
          },
          "unshaded": {
            "text": "Aid and Patronage each +6.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": 6
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "patronage",
                  "delta": 6
                }
              }
            ]
          }
        },
        {
          "id": "card-65",
          "title": "International Forces",
          "sideMode": "dual",
          "order": 65,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "External contingents alter force availability and aid posture."
          },
          "unshaded": {
            "text": "Roll a die and move up to that many COIN pieces from Out of Play to Available."
          },
          "shaded": {
            "text": "Roll a die and reduce Aid by result."
          }
        },
        {
          "id": "card-66",
          "title": "Ambassador Taylor",
          "sideMode": "dual",
          "order": 66,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "ARVN",
              "US",
              "VC",
              "NVA"
            ],
            "flavorText": "Military envoy presses for tighter control."
          },
          "unshaded": {
            "text": "Aid and ARVN Resources rise; remove a level of Support.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": 6
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": 6
                }
              },
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              }
            ]
          },
          "shaded": {
            "text": "Backlash empowers insurgents: shift toward Opposition; NVA Resources +6.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": 6
                }
              }
            ]
          }
        },
        {
          "id": "card-67",
          "title": "Amphib Landing",
          "sideMode": "dual",
          "order": 67,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "US",
              "VC",
              "NVA"
            ],
            "flavorText": "Coastal insertion opens a fast COIN push."
          },
          "unshaded": {
            "text": "Relocate ARVN Troops among coastal spaces; ARVN executes free Sweep then free Assault.",
            "freeOperationGrants": [
              {
                "seat": "1",
                "sequence": {
                  "chain": "amphib-landing-arvn",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ]
              },
              {
                "seat": "1",
                "sequence": {
                  "chain": "amphib-landing-arvn",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Insurgent response: Remove 2 ARVN Troops from coastal spaces."
          }
        },
        {
          "id": "card-68",
          "title": "Green Berets",
          "sideMode": "dual",
          "order": 68,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "ARVN",
              "US",
              "VC",
              "NVA"
            ],
            "flavorText": "Elite trainers."
          },
          "unshaded": {
            "text": "Place 3 Irregulars or 3 Rangers in a Province without NVA Control. Set it to Active Support.",
            "branches": [
              {
                "id": "place-irregulars-and-support",
                "order": 1,
                "targets": [
                  {
                    "id": "$targetProvince",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "province"
                            },
                            {
                              "op": "<=",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "NVA"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "in",
                                        "value": [
                                          "US",
                                          "ARVN",
                                          "VC"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          ]
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 3,
                      "groups": [
                        {
                          "bind": "irregular",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "available-US:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "irregular"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "$targetProvince"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "setMarker": {
                      "space": "$targetProvince",
                      "marker": "supportOpposition",
                      "state": "activeSupport"
                    }
                  }
                ]
              },
              {
                "id": "place-rangers-and-support",
                "order": 2,
                "targets": [
                  {
                    "id": "$targetProvince",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "==",
                              "left": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "category"
                              },
                              "right": "province"
                            },
                            {
                              "op": "<=",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "NVA"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "in",
                                        "value": [
                                          "US",
                                          "ARVN",
                                          "VC"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          ]
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 3,
                      "groups": [
                        {
                          "bind": "ranger",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "available-ARVN:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "ranger"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "$targetProvince"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "setMarker": {
                      "space": "$targetProvince",
                      "marker": "supportOpposition",
                      "state": "activeSupport"
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Reluctant trainees: Remove any 3 Irregulars to Available and set 1 of their Provinces to Active Opposition.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInMapSpaces",
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "eq",
                              "value": "US"
                            },
                            {
                              "prop": "type",
                              "op": "eq",
                              "value": "irregular"
                            }
                          ]
                        }
                      }
                    },
                    "right": 0
                  },
                  "then": [
                    {
                      "chooseN": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.16.shaded.effects.0.if.then.0.chooseN",
                        "bind": "$irregularsToRemove",
                        "options": {
                          "query": "tokensInMapSpaces",
                          "filter": [
                            {
                              "prop": "faction",
                              "op": "eq",
                              "value": "US"
                            },
                            {
                              "prop": "type",
                              "op": "eq",
                              "value": "irregular"
                            }
                          ]
                        },
                        "max": 3,
                        "min": 0
                      }
                    },
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.16.shaded.effects.0.if.then.1.chooseOne",
                        "bind": "$oppositionProvince",
                        "options": {
                          "query": "mapSpaces",
                          "filter": {
                            "condition": {
                              "op": "and",
                              "args": [
                                {
                                  "op": "==",
                                  "left": {
                                    "ref": "zoneProp",
                                    "zone": "$zone",
                                    "prop": "category"
                                  },
                                  "right": "province"
                                },
                                {
                                  "op": ">",
                                  "left": {
                                    "aggregate": {
                                      "op": "count",
                                      "query": {
                                        "query": "tokensInZone",
                                        "zone": "$zone",
                                        "filter": [
                                          {
                                            "prop": "faction",
                                            "op": "eq",
                                            "value": "US"
                                          },
                                          {
                                            "prop": "type",
                                            "op": "eq",
                                            "value": "irregular"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "right": 0
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    {
                      "forEach": {
                        "bind": "$irregular",
                        "over": {
                          "query": "binding",
                          "name": "$irregularsToRemove"
                        },
                        "effects": [
                          {
                            "moveToken": {
                              "token": "$irregular",
                              "from": {
                                "zoneExpr": {
                                  "ref": "tokenZone",
                                  "token": "$irregular"
                                }
                              },
                              "to": {
                                "zoneExpr": "available-US:none"
                              }
                            }
                          }
                        ]
                      }
                    },
                    {
                      "setMarker": {
                        "space": "$oppositionProvince",
                        "marker": "supportOpposition",
                        "state": "activeOpposition"
                      }
                    }
                  ],
                  "else": []
                }
              }
            ]
          }
        },
        {
          "id": "card-69",
          "title": "MACV",
          "sideMode": "single",
          "order": 69,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "US",
              "VC",
              "NVA"
            ],
            "flavorText": "Command integration accelerates ARVN tempo."
          },
          "unshaded": {
            "text": "ARVN executes free Special Activities.",
            "freeOperationGrants": [
              {
                "seat": "1",
                "sequence": {
                  "chain": "macv-arvn-special-activity",
                  "step": 0
                },
                "operationClass": "limitedOperation"
              }
            ]
          }
        },
        {
          "id": "card-70",
          "title": "ROKs",
          "sideMode": "dual",
          "order": 70,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "US",
              "VC",
              "NVA"
            ],
            "flavorText": "Allied contingents strengthen ARVN offensive options."
          },
          "unshaded": {
            "text": "ARVN Sweep/Assault in selected spaces as if US.",
            "freeOperationGrants": [
              {
                "seat": "1",
                "executeAsSeat": "0",
                "sequence": {
                  "chain": "roks-arvn-as-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ]
              },
              {
                "seat": "1",
                "executeAsSeat": "0",
                "sequence": {
                  "chain": "roks-arvn-as-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ]
              }
            ]
          },
          "shaded": {
            "text": "ARVN losses mount: remove 2 ARVN pieces."
          }
        },
        {
          "id": "card-71",
          "title": "An Loc",
          "sideMode": "dual",
          "order": 71,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "NVA",
              "US",
              "VC"
            ],
            "flavorText": "Urban defense at An Loc forces troop losses and emergency repositioning."
          },
          "unshaded": {
            "text": "Remove selected NVA Troops and place ARVN Troops in contested spaces."
          },
          "shaded": {
            "text": "ARVN losses mount; redeploy NVA pressure around An Loc."
          }
        },
        {
          "id": "card-72",
          "title": "Body Count",
          "sideMode": "dual",
          "order": 72,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "NVA",
              "US",
              "VC"
            ],
            "flavorText": "Kill metrics begin to drive battlefield behavior."
          },
          "unshaded": {
            "text": "US/ARVN operations prioritize attrition. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-body-count",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_bodyCount",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_bodyCount",
                      "value": false
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Insurgent adaptation blunts kill-ratio pressure."
          }
        },
        {
          "id": "card-73",
          "title": "Great Society",
          "sideMode": "dual",
          "order": 73,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "NVA",
              "US",
              "VC"
            ],
            "flavorText": "LBJ advances social agenda."
          },
          "unshaded": {
            "text": "Conduct a Commitment Phase.",
            "effects": [
              {
                "pushInterruptPhase": {
                  "phase": "commitment",
                  "resumePhase": "main"
                }
              }
            ]
          },
          "shaded": {
            "text": "War wrecks economy: US moves 3 pieces from Available to out of play.",
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "usAvailablePiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "out-of-play-US:none"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-74",
          "title": "Lam Son 719",
          "sideMode": "dual",
          "order": 74,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "NVA",
              "US",
              "VC"
            ],
            "flavorText": "Cross-border incursion strains ARVN logistics and Trail stability."
          },
          "unshaded": {
            "text": "Place ARVN Troops in Laos/Cambodia and degrade Trail by 1."
          },
          "shaded": {
            "text": "Operation falters: remove ARVN Troops and improve Trail by 1."
          }
        },
        {
          "id": "card-75",
          "title": "Sihanouk",
          "sideMode": "dual",
          "order": 75,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "ARVN",
              "NVA",
              "US",
              "VC"
            ],
            "flavorText": "Cambodian maneuvering."
          },
          "unshaded": {
            "text": "ARVN free Sweep or Assault in Cambodia.",
            "freeOperationGrants": [
              {
                "seat": "1",
                "sequence": {
                  "chain": "sihanouk-unshaded-arvn",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep",
                  "assault"
                ],
                "zoneFilter": {
                  "op": "==",
                  "left": {
                    "ref": "zoneProp",
                    "zone": "$zone",
                    "prop": "country"
                  },
                  "right": "cambodia"
                }
              }
            ]
          },
          "shaded": {
            "text": "VC then NVA each get a free operation.",
            "freeOperationGrants": [
              {
                "seat": "3",
                "sequence": {
                  "chain": "sihanouk-shaded-vc-nva",
                  "step": 0
                },
                "operationClass": "operation"
              },
              {
                "seat": "2",
                "sequence": {
                  "chain": "sihanouk-shaded-vc-nva",
                  "step": 1
                },
                "operationClass": "operation"
              }
            ]
          }
        },
        {
          "id": "card-76",
          "title": "Annam",
          "sideMode": "dual",
          "order": 76,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "NVA",
              "VC",
              "US"
            ],
            "flavorText": "Regional instability strains Saigon's finances."
          },
          "unshaded": {
            "text": "NVA and VC Resources each -3; Patronage +3.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "delta": -3
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "vcResources",
                  "delta": -3
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "patronage",
                  "delta": 3
                }
              }
            ]
          },
          "shaded": {
            "text": "Patronage -3 and ARVN Resources -6.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "patronage",
                  "delta": -3
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "delta": -6
                }
              }
            ]
          }
        },
        {
          "id": "card-77",
          "title": "Detente",
          "sideMode": "dual",
          "order": 77,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "NVA",
              "VC",
              "US"
            ],
            "flavorText": "Great-power easing cools conflict intensity and shrinks wartime budgets."
          },
          "unshaded": {
            "text": "Cut ARVN, NVA, and VC Resources in half.",
            "effects": [
              {
                "setVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "arvnResources"
                    },
                    "right": 2
                  }
                }
              },
              {
                "setVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "nvaResources"
                    },
                    "right": 2
                  }
                }
              },
              {
                "setVar": {
                  "scope": "global",
                  "var": "vcResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "vcResources"
                    },
                    "right": 2
                  }
                }
              }
            ]
          },
          "shaded": {
            "text": "Cut ARVN, NVA, and VC Resources in half.",
            "effects": [
              {
                "setVar": {
                  "scope": "global",
                  "var": "arvnResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "arvnResources"
                    },
                    "right": 2
                  }
                }
              },
              {
                "setVar": {
                  "scope": "global",
                  "var": "nvaResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "nvaResources"
                    },
                    "right": 2
                  }
                }
              },
              {
                "setVar": {
                  "scope": "global",
                  "var": "vcResources",
                  "value": {
                    "op": "/",
                    "left": {
                      "ref": "gvar",
                      "var": "vcResources"
                    },
                    "right": 2
                  }
                }
              }
            ]
          }
        },
        {
          "id": "card-78",
          "title": "General Landsdale",
          "sideMode": "dual",
          "order": 78,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "NVA",
              "VC",
              "US"
            ],
            "flavorText": "Political warfare effort reshapes pacification tempo."
          },
          "unshaded": {
            "text": "Landsdale sidelined; no lasting momentum effect."
          },
          "shaded": {
            "text": "Political influence campaign takes hold. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-general-landsdale",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_generalLansdale",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_generalLansdale",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-79",
          "title": "Henry Cabot Lodge",
          "sideMode": "dual",
          "order": 79,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "ARVN",
              "NVA",
              "VC",
              "US"
            ],
            "flavorText": "Ambassador proposes US protectorate."
          },
          "unshaded": {
            "text": "Aid +20.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": 20
                }
              }
            ]
          },
          "shaded": {
            "text": "Internecine enabler: Remove up to 3 ARVN pieces. Patronage +2 for each. ARVN Ineligible through next card.",
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "seat",
                  "seat": "1"
                },
                "eligible": false,
                "windowId": "make-ineligible"
              }
            ],
            "effects": [
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.44.shaded.effects.0.chooseN",
                  "bind": "$arvnPiecesToRemove",
                  "options": {
                    "query": "tokensInMapSpaces",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "eq",
                        "value": "ARVN"
                      }
                    ]
                  },
                  "max": 3,
                  "min": 0
                }
              },
              {
                "forEach": {
                  "bind": "$arvnPiece",
                  "over": {
                    "query": "binding",
                    "name": "$arvnPiecesToRemove"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$arvnPiece",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$arvnPiece"
                          }
                        },
                        "to": {
                          "zoneExpr": "available-ARVN:none"
                        }
                      }
                    }
                  ],
                  "countBind": "$removedCount",
                  "in": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "patronage",
                        "delta": {
                          "op": "*",
                          "left": 2,
                          "right": {
                            "ref": "binding",
                            "name": "$removedCount"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-80",
          "title": "Light at the End of the Tunnel",
          "sideMode": "single",
          "order": 80,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "NVA",
              "VC",
              "US"
            ],
            "flavorText": "War-weariness and optimism collide in piecemeal force adjustments."
          },
          "unshaded": {
            "text": "Apply piece-by-piece force adjustments across factions as listed on the card."
          }
        },
        {
          "id": "card-81",
          "title": "CIDG",
          "sideMode": "dual",
          "order": 81,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "US",
              "NVA"
            ],
            "flavorText": "Civilian irregular networks are reorganized."
          },
          "unshaded": {
            "text": "Replace ARVN pieces with Irregulars/Rangers in selected spaces.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "CIDG positions collapse: replace Irregulars with VC Guerrillas.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "irregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-82",
          "title": "Domino Theory",
          "sideMode": "dual",
          "order": 82,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "US",
              "NVA"
            ],
            "flavorText": "U.S. prestige is on the line."
          },
          "unshaded": {
            "text": "Aid and ARVN Resources each +9. Return pieces from Out of Play.",
            "branches": [
              {
                "id": "return-from-out-of-play",
                "order": 1,
                "targets": [
                  {
                    "id": "us-out-of-play",
                    "selector": {
                      "query": "players"
                    },
                    "cardinality": {
                      "max": 3
                    }
                  },
                  {
                    "id": "arvn-out-of-play",
                    "selector": {
                      "query": "players"
                    },
                    "cardinality": {
                      "max": 6
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 3,
                      "groups": [
                        {
                          "bind": "usOutOfPlay",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "out-of-play-US:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-US:none"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "removeByPriority": {
                      "budget": 6,
                      "groups": [
                        {
                          "bind": "arvnOutOfPlay",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "out-of-play-ARVN:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "ARVN"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-ARVN:none"
                          }
                        }
                      ]
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 1
                    }
                  }
                ]
              },
              {
                "id": "resources-and-aid",
                "order": 2,
                "effects": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "arvnResources",
                      "delta": 9
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 9
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Containment falters: Aid -9.",
            "targets": [
              {
                "id": "us-troops-available",
                "selector": {
                  "query": "players"
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -9
                }
              }
            ]
          }
        },
        {
          "id": "card-83",
          "title": "Election",
          "sideMode": "dual",
          "order": 83,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "US",
              "NVA"
            ],
            "flavorText": "Balloting reshapes control and aid expectations."
          },
          "unshaded": {
            "text": "Shift up to 3 spaces one level toward Active Support; Aid +6.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "or",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "city"
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": 6
                }
              }
            ]
          },
          "shaded": {
            "text": "Shift up to 3 spaces one level toward Active Opposition.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "or",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "city"
                        },
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              }
            ]
          }
        },
        {
          "id": "card-84",
          "title": "To Quoc",
          "sideMode": "dual",
          "order": 84,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "VC",
              "US",
              "NVA"
            ],
            "flavorText": "Nationalist appeals drive local recruitment and police concentration."
          },
          "unshaded": {
            "text": "Place ARVN pieces by space and shift support where ARVN presence expands."
          },
          "shaded": {
            "text": "Insurgent counter-mobilization places guerrillas where ARVN policing is weak."
          }
        },
        {
          "id": "card-85",
          "title": "USAID",
          "sideMode": "dual",
          "order": 85,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "US",
              "NVA"
            ],
            "flavorText": "Development spending competes with local capture."
          },
          "unshaded": {
            "text": "Shift up to 2 spaces one level toward Active Support.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              }
            ]
          },
          "shaded": {
            "text": "Shift up to 2 spaces one level toward Active Opposition.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetSpace",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              }
            ]
          }
        },
        {
          "id": "card-86",
          "title": "Mandate of Heaven",
          "sideMode": "dual",
          "order": 86,
          "tags": [
            "capability",
            "ARVN"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "NVA",
              "US"
            ],
            "flavorText": "Legitimacy campaign rewrites ARVN governance limits."
          },
          "unshaded": {
            "text": "Capability: ARVN Govern in one space without support shift.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_mandateOfHeaven",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Capability: ARVN Govern may select only one space.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_mandateOfHeaven",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-87",
          "title": "Nguyen Chanh Thi",
          "sideMode": "dual",
          "order": 87,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "NVA",
              "US"
            ],
            "flavorText": "Regional command turnover drives sudden force shifts."
          },
          "unshaded": {
            "text": "Place ARVN pieces and shift one selected city toward Support.",
            "targets": [
              {
                "id": "$targetCity",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "city"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "arvnTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-ARVN:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetCity"
                      }
                    }
                  ]
                }
              },
              {
                "shiftMarker": {
                  "space": "$targetCity",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              }
            ]
          },
          "shaded": {
            "text": "Place VC/NVA pieces and shift one selected city toward Opposition.",
            "targets": [
              {
                "id": "$targetCity",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "city"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetCity"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "nvaGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-NVA:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetCity"
                      }
                    }
                  ]
                }
              },
              {
                "shiftMarker": {
                  "space": "$targetCity",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              }
            ]
          }
        },
        {
          "id": "card-88",
          "title": "Phan Quang Dan",
          "sideMode": "dual",
          "order": 88,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "ARVN",
              "VC",
              "NVA",
              "US"
            ],
            "flavorText": "Political reforms in Saigon trade patronage for public support."
          },
          "unshaded": {
            "text": "Shift Saigon toward Support and adjust Patronage."
          },
          "shaded": {
            "text": "Shift Saigon toward Opposition and adjust Patronage."
          }
        },
        {
          "id": "card-89",
          "title": "Tam Chau",
          "sideMode": "dual",
          "order": 89,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "NVA",
              "US"
            ],
            "flavorText": "Buddhist political leverage expands in Saigon."
          },
          "unshaded": {
            "text": "Shift Saigon one level toward Active Support; Patronage +3.",
            "effects": [
              {
                "shiftMarker": {
                  "space": "saigon:none",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "patronage",
                  "delta": 3
                }
              }
            ]
          },
          "shaded": {
            "text": "Shift Saigon one level toward Active Opposition; Patronage -3.",
            "effects": [
              {
                "shiftMarker": {
                  "space": "saigon:none",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "patronage",
                  "delta": -3
                }
              }
            ]
          }
        },
        {
          "id": "card-90",
          "title": "Walt Rostow",
          "sideMode": "dual",
          "order": 90,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "ARVN",
              "VC",
              "NVA",
              "US"
            ],
            "flavorText": "Escalation planning accelerates deployment adjustments."
          },
          "unshaded": {
            "text": "Place and relocate COIN pieces among selected spaces.",
            "targets": [
              {
                "id": "$sourceSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              },
              {
                "id": "$destSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "coinPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$destSpace"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Redeploy selected COIN pieces to Available.",
            "targets": [
              {
                "id": "$sourceSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "coinPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "US",
                              "ARVN"
                            ]
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$coinPiece",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-91",
          "title": "Bob Hope",
          "sideMode": "dual",
          "order": 91,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "US",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Show-tour logistics and media optics reshape force posture."
          },
          "unshaded": {
            "text": "Relocate US Troops among selected spaces and move matching losses to Casualties."
          },
          "shaded": {
            "text": "Show backlash strains US posture and increases casualty pressure."
          }
        },
        {
          "id": "card-92",
          "title": "SEALORDS",
          "sideMode": "dual",
          "order": 92,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "US",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Riverine interdiction drives concentrated operations around the delta."
          },
          "unshaded": {
            "text": "US executes free Sweep then free Assault in/adjacent to Can Tho."
          },
          "shaded": {
            "text": "Interdiction overreach opens gaps for insurgent movement."
          }
        },
        {
          "id": "card-93",
          "title": "Senator Fulbright",
          "sideMode": "dual",
          "order": 93,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "US",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Congressional skepticism constrains intervention."
          },
          "unshaded": {
            "text": "Move US pieces to Available and reduce Aid.",
            "targets": [
              {
                "id": "$sourceSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "usTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    },
                    {
                      "bind": "usIrregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    },
                    {
                      "bind": "usBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -6
                }
              }
            ]
          },
          "shaded": {
            "text": "Withdrawal pressure deepens: more US pieces to Available; Aid -12.",
            "targets": [
              {
                "id": "$sourceSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 6,
                  "groups": [
                    {
                      "bind": "usTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    },
                    {
                      "bind": "usIrregular",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "irregular"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    },
                    {
                      "bind": "usBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$sourceSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-US:none"
                      }
                    }
                  ]
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -12
                }
              }
            ]
          }
        },
        {
          "id": "card-94",
          "title": "Tunnel Rats",
          "sideMode": "single",
          "order": 94,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "US",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Close-quarters tunnel fighting shifts subterranean control."
          },
          "unshaded": {
            "text": "Place or remove a Tunnel marker in one selected space."
          }
        },
        {
          "id": "card-95",
          "title": "Westmoreland",
          "sideMode": "dual",
          "order": 95,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "US",
              "NVA",
              "ARVN"
            ],
            "flavorText": "Root 'em out."
          },
          "unshaded": {
            "text": "US free Air Lifts, then Sweeps (no moves) or Assaults (no ARVN) in 2 spaces, then Air Strikes.",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "westmoreland-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "airLift"
                ]
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "westmoreland-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep",
                  "assault"
                ]
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "westmoreland-us",
                  "step": 2
                },
                "operationClass": "operation",
                "actionIds": [
                  "airStrike"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Big-unit war bypasses population: Shift 3 Provinces with no Police each 2 levels toward Active Opposition."
          }
        },
        {
          "id": "card-96",
          "title": "APC",
          "sideMode": "dual",
          "order": 96,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "US",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Mechanized pacification pressure collides with insurgent shock timing."
          },
          "unshaded": {
            "text": "ARVN executes free Pacify in selected spaces."
          },
          "shaded": {
            "text": "If Tet Offensive has been played, return it to VC; otherwise VC executes General Uprising.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": "played:none",
                          "filter": [
                            {
                              "prop": "cardId",
                              "op": "eq",
                              "value": "card-124"
                            }
                          ]
                        }
                      }
                    },
                    "right": 0
                  },
                  "then": [
                    {
                      "forEach": {
                        "bind": "tetCard",
                        "over": {
                          "query": "tokensInZone",
                          "zone": "played:none",
                          "filter": [
                            {
                              "prop": "cardId",
                              "op": "eq",
                              "value": "card-124"
                            }
                          ]
                        },
                        "effects": [
                          {
                            "moveToken": {
                              "token": "tetCard",
                              "from": "played:none",
                              "to": {
                                "zoneExpr": "leader:none"
                              }
                            }
                          }
                        ],
                        "limit": 1
                      }
                    }
                  ],
                  "else": [
                    {
                      "grantFreeOperation": {
                        "seat": "3",
                        "operationClass": "operation",
                        "actionIds": [
                          "operation"
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-97",
          "title": "Brinks Hotel",
          "sideMode": "dual",
          "order": 97,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "US",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Saigon shaken."
          },
          "unshaded": {
            "text": "Aid +10, or 4 Patronage to ARVN Resources. Flip any current RVN leader card: its text is ignored.",
            "branches": [
              {
                "id": "aid-plus-ten-and-flip-leader",
                "order": 1,
                "effects": [
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "aid",
                      "delta": 10
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "activeLeader"
                        },
                        "right": "minh"
                      },
                      "then": [
                        {
                          "setGlobalMarker": {
                            "marker": "leaderFlipped",
                            "state": "flipped"
                          }
                        }
                      ]
                    }
                  }
                ]
              },
              {
                "id": "transfer-patronage-to-aid-and-flip-leader",
                "order": 2,
                "effects": [
                  {
                    "let": {
                      "bind": "$transfer",
                      "value": {
                        "if": {
                          "when": {
                            "op": ">",
                            "left": {
                              "ref": "gvar",
                              "var": "patronage"
                            },
                            "right": 4
                          },
                          "then": 4,
                          "else": {
                            "ref": "gvar",
                            "var": "patronage"
                          }
                        }
                      },
                      "in": [
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "patronage",
                            "delta": {
                              "op": "-",
                              "left": 0,
                              "right": {
                                "ref": "binding",
                                "name": "$transfer"
                              }
                            }
                          }
                        },
                        {
                          "addVar": {
                            "scope": "global",
                            "var": "aid",
                            "delta": {
                              "ref": "binding",
                              "name": "$transfer"
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "if": {
                      "when": {
                        "op": "!=",
                        "left": {
                          "ref": "globalMarkerState",
                          "marker": "activeLeader"
                        },
                        "right": "minh"
                      },
                      "then": [
                        {
                          "setGlobalMarker": {
                            "marker": "leaderFlipped",
                            "state": "flipped"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "Shift a City that has VC by 2 levels toward Active Opposition and add a Terror marker there.",
            "targets": [
              {
                "id": "$targetCity",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "city"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "VC"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetCity",
                  "marker": "supportOpposition",
                  "delta": -2
                }
              },
              {
                "addVar": {
                  "scope": "zoneVar",
                  "zone": "$targetCity",
                  "var": "terrorCount",
                  "delta": 1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "terrorSabotageMarkersPlaced",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "id": "card-98",
          "title": "Long Tan",
          "sideMode": "dual",
          "order": 98,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "US",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Royal Australians."
          },
          "unshaded": {
            "text": "Place 2 out-of-play US Troops into a Province or remove all Guerrillas from all Jungle with US Troops.",
            "branches": [
              {
                "id": "long-tan-place-us-troops",
                "order": 1,
                "targets": [
                  {
                    "id": "$targetProvince",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 2,
                      "groups": [
                        {
                          "bind": "usTroop",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "out-of-play-US:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "troops"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "$targetProvince"
                          }
                        }
                      ]
                    }
                  }
                ]
              },
              {
                "id": "long-tan-clear-jungle-guerrillas",
                "order": 2,
                "targets": [
                  {
                    "id": "$targetJungle",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "zonePropIncludes",
                              "zone": "$zone",
                              "prop": "terrainTags",
                              "value": "jungle"
                            },
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "US"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            }
                          ]
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 99,
                      "groups": [
                        {
                          "bind": "insurgentGuerrilla",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "$targetJungle",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "in",
                                "value": [
                                  "NVA",
                                  "VC"
                                ]
                              },
                              {
                                "prop": "type",
                                "op": "eq",
                                "value": "guerrilla"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": {
                              "concat": [
                                "available-",
                                {
                                  "ref": "tokenProp",
                                  "token": "$insurgentGuerrilla",
                                  "prop": "faction"
                                },
                                ":none"
                              ]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "VC strike newly arrived troops: 1 US Base and 1 US Troop in a Jungle with 2+ VC Guerrillas to Casualties.",
            "targets": [
              {
                "id": "$targetJungle",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "zonePropIncludes",
                          "zone": "$zone",
                          "prop": "terrainTags",
                          "value": "jungle"
                        },
                        {
                          "op": ">=",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "VC"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "guerrilla"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 2
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "usBase",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetJungle",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "base"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "casualties-US:none"
                      }
                    },
                    {
                      "bind": "usTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetJungle",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "casualties-US:none"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-99",
          "title": "Masher/White Wing",
          "sideMode": "dual",
          "order": 99,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "US",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Sweep flushes enemy into kill zone."
          },
          "unshaded": {
            "text": "US or ARVN free Sweeps 1 non-Jungle space with US and ARVN Troops. They free Assault as US.",
            "freeOperationGrants": [
              {
                "seat": "0",
                "sequence": {
                  "chain": "masher-white-wing-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ]
              },
              {
                "seat": "0",
                "sequence": {
                  "chain": "masher-white-wing-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ]
              },
              {
                "seat": "1",
                "executeAsSeat": "0",
                "sequence": {
                  "chain": "masher-white-wing-arvn-as-us",
                  "step": 0
                },
                "operationClass": "operation",
                "actionIds": [
                  "sweep"
                ]
              },
              {
                "seat": "1",
                "executeAsSeat": "0",
                "sequence": {
                  "chain": "masher-white-wing-arvn-as-us",
                  "step": 1
                },
                "operationClass": "operation",
                "actionIds": [
                  "assault"
                ]
              }
            ]
          },
          "shaded": {
            "text": "Poor OPSEC: VC or NVA free March Guerrillas to any 3 spaces then free Ambush in each (even if Active)."
          }
        },
        {
          "id": "card-100",
          "title": "Rach Ba Rai",
          "sideMode": "dual",
          "order": 100,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "US",
              "ARVN",
              "NVA"
            ],
            "flavorText": "Riverines hunt Charlie."
          },
          "unshaded": {
            "text": "Remove all VC or all non-Troop NVA from a Lowland with US Troops.",
            "branches": [
              {
                "id": "rach-ba-rai-remove-vc",
                "order": 1,
                "targets": [
                  {
                    "id": "$targetLowland",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "zonePropIncludes",
                              "zone": "$zone",
                              "prop": "terrainTags",
                              "value": "lowland"
                            },
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "US"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            }
                          ]
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 99,
                      "groups": [
                        {
                          "bind": "vcPiece",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "$targetLowland",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "VC"
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-VC:none"
                          }
                        }
                      ]
                    }
                  }
                ]
              },
              {
                "id": "rach-ba-rai-remove-nva-non-troops",
                "order": 2,
                "targets": [
                  {
                    "id": "$targetLowland",
                    "selector": {
                      "query": "mapSpaces",
                      "filter": {
                        "condition": {
                          "op": "and",
                          "args": [
                            {
                              "op": "zonePropIncludes",
                              "zone": "$zone",
                              "prop": "terrainTags",
                              "value": "lowland"
                            },
                            {
                              "op": ">",
                              "left": {
                                "aggregate": {
                                  "op": "count",
                                  "query": {
                                    "query": "tokensInZone",
                                    "zone": "$zone",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "US"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  }
                                }
                              },
                              "right": 0
                            }
                          ]
                        }
                      }
                    },
                    "cardinality": {
                      "max": 1
                    }
                  }
                ],
                "effects": [
                  {
                    "removeByPriority": {
                      "budget": 99,
                      "groups": [
                        {
                          "bind": "nvaPiece",
                          "over": {
                            "query": "tokensInZone",
                            "zone": "$targetLowland",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "NVA"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "base",
                                  "guerrilla"
                                ]
                              }
                            ]
                          },
                          "to": {
                            "zoneExpr": "available-NVA:none"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          },
          "shaded": {
            "text": "VC river ambush: In a Lowland with any VC, remove a die roll of US/ARVN cubes (US to Casualties). Place 1 VC piece.",
            "targets": [
              {
                "id": "$targetLowland",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "zonePropIncludes",
                          "zone": "$zone",
                          "prop": "terrainTags",
                          "value": "lowland"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "VC"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "rollRandom": {
                  "bind": "$dieRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "removeByPriority": {
                        "budget": {
                          "ref": "binding",
                          "name": "$dieRoll"
                        },
                        "groups": [
                          {
                            "bind": "usCube",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$targetLowland",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "US"
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "police"
                                  ]
                                }
                              ]
                            },
                            "to": {
                              "zoneExpr": "casualties-US:none"
                            }
                          },
                          {
                            "bind": "arvnCube",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$targetLowland",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "police"
                                  ]
                                }
                              ]
                            },
                            "to": {
                              "zoneExpr": "available-ARVN:none"
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "vcPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "in",
                            "value": [
                              "base",
                              "guerrilla"
                            ]
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetLowland"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-101",
          "title": "Booby Traps",
          "sideMode": "dual",
          "order": 101,
          "tags": [
            "capability",
            "VC"
          ],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "Preparations tip off enemy."
          },
          "unshaded": {
            "text": "VC and NVA Ambush in max 1 space.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_boobyTraps",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Mines and punji: each Sweep space risks 1 Sweeping Troop loss on roll 1-3.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_boobyTraps",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-102",
          "title": "Cu Chi",
          "sideMode": "dual",
          "order": 102,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "Clear and secure."
          },
          "unshaded": {
            "text": "Remove all Guerrillas from 1 space with a Tunnel and COIN Control.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 99,
                  "groups": [
                    {
                      "bind": "insurgentGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "in",
                            "value": [
                              "NVA",
                              "VC"
                            ]
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": {
                          "concat": [
                            "available-",
                            {
                              "ref": "tokenProp",
                              "token": "$insurgentGuerrilla",
                              "prop": "faction"
                            },
                            ":none"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Iron Triangle: Place Tunnel markers on each Insurgent Base in 1 Province. Place 1 NVA and 1 VC Guerrilla there.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "province"
                    }
                  }
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "forEach": {
                  "bind": "$insurgentBase",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$targetProvince",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "in",
                        "value": [
                          "NVA",
                          "VC"
                        ]
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "base"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$insurgentBase",
                        "prop": "tunnel",
                        "value": "tunneled"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "nvaGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-NVA:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetProvince"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetProvince"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-103",
          "title": "Kent State",
          "sideMode": "dual",
          "order": 103,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "Domestic unrest converts battlefield casualties into political constraints."
          },
          "unshaded": {
            "text": "Move selected US Troops from map to Casualties."
          },
          "shaded": {
            "text": "US executes free Limited Operation under tightened domestic limits."
          }
        },
        {
          "id": "card-104",
          "title": "Main Force Bns",
          "sideMode": "dual",
          "order": 104,
          "tags": [
            "capability",
            "VC"
          ],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "Larger footprints."
          },
          "unshaded": {
            "text": "Capability: March into Support/LoC Activates if moving plus non-Base COIN >1 (vice >3).",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_mainForceBns",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Capability: 1 VC Ambush space may remove 2 enemy pieces.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_mainForceBns",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-105",
          "title": "Rural Pressure",
          "sideMode": "dual",
          "order": 105,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "Onerous VC taxation."
          },
          "unshaded": {
            "text": "Shift 4 Provinces with any VC each by 1 level toward Active Support.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "VC"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 4
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetProvince",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              }
            ]
          },
          "shaded": {
            "text": "Local government corruption: Shift 3 Provinces with Police each by 1 level toward Active Opposition. Patronage +6 or -6.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        },
                        {
                          "op": ">",
                          "left": {
                            "aggregate": {
                              "op": "count",
                              "query": {
                                "query": "tokensInZone",
                                "zone": "$zone",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "eq",
                                    "value": "police"
                                  }
                                ]
                              }
                            }
                          },
                          "right": 0
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "branches": [
              {
                "id": "rural-pressure-plus-patronage",
                "order": 1,
                "effects": [
                  {
                    "shiftMarker": {
                      "space": "$targetProvince",
                      "marker": "supportOpposition",
                      "delta": -1
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "patronage",
                      "delta": 6
                    }
                  }
                ]
              },
              {
                "id": "rural-pressure-minus-patronage",
                "order": 2,
                "effects": [
                  {
                    "shiftMarker": {
                      "space": "$targetProvince",
                      "marker": "supportOpposition",
                      "delta": -1
                    }
                  },
                  {
                    "addVar": {
                      "scope": "global",
                      "var": "patronage",
                      "delta": -6
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-106",
          "title": "Binh Duong",
          "sideMode": "single",
          "order": 106,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "ARVN",
              "US"
            ],
            "flavorText": "Revolutionary land reform seeks traction in prosperous districts."
          },
          "unshaded": {
            "text": "In each of 2 Provinces adjacent to Saigon, shift Support/Opposition 1 level either direction and place a VC Guerrilla or Police.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "and",
                      "args": [
                        {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "category"
                          },
                          "right": "province"
                        },
                        {
                          "op": "adjacent",
                          "left": "$zone",
                          "right": "saigon:none"
                        }
                      ]
                    }
                  }
                },
                "cardinality": {
                  "max": 2
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetProvince",
                  "marker": "supportOpposition",
                  "delta": 1
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetProvince"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-107",
          "title": "Burning Bonze",
          "sideMode": "dual",
          "order": 107,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "NVA",
              "ARVN",
              "US"
            ],
            "flavorText": "Gruesome protests close elite ranks."
          },
          "unshaded": {
            "text": "Patronage +3 or, if Saigon at Active Support, +6.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": "==",
                    "left": {
                      "ref": "markerState",
                      "space": "saigon:none",
                      "marker": "supportOpposition"
                    },
                    "right": "activeSupport"
                  },
                  "then": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "patronage",
                        "delta": 6
                      }
                    }
                  ],
                  "else": [
                    {
                      "addVar": {
                        "scope": "global",
                        "var": "patronage",
                        "delta": 3
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Anti-regime self-immolation: Shift Saigon 1 level toward Active Opposition. Aid -12.",
            "effects": [
              {
                "shiftMarker": {
                  "space": "saigon:none",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "aid",
                  "delta": -12
                }
              }
            ]
          }
        },
        {
          "id": "card-108",
          "title": "Draft Dodgers",
          "sideMode": "dual",
          "order": 108,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "ARVN",
              "US"
            ],
            "flavorText": "Public furor sparks enlistment."
          },
          "unshaded": {
            "text": "If fewer than 3 Casualty pieces, 3 US Troops from out of play to Available.",
            "effects": [
              {
                "if": {
                  "when": {
                    "op": "<",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "tokensInZone",
                          "zone": "casualties-US:none"
                        }
                      }
                    },
                    "right": 3
                  },
                  "then": [
                    {
                      "removeByPriority": {
                        "budget": 3,
                        "groups": [
                          {
                            "bind": "usTroop",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "out-of-play-US:none",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "US"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            "to": {
                              "zoneExpr": "available-US:none"
                            }
                          }
                        ]
                      }
                    }
                  ],
                  "else": []
                }
              }
            ]
          },
          "shaded": {
            "text": "Recruiting sags: Move 1 US Troop per Casualty piece, to a maximum of 3, from Available to out-of-play.",
            "effects": [
              {
                "let": {
                  "bind": "$casualtyCount",
                  "value": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "tokensInZone",
                        "zone": "casualties-US:none"
                      }
                    }
                  },
                  "in": [
                    {
                      "let": {
                        "bind": "$maxTroopsMoved",
                        "value": {
                          "if": {
                            "when": {
                              "op": ">",
                              "left": {
                                "ref": "binding",
                                "name": "$casualtyCount"
                              },
                              "right": 3
                            },
                            "then": 3,
                            "else": {
                              "ref": "binding",
                              "name": "$casualtyCount"
                            }
                          }
                        },
                        "in": [
                          {
                            "removeByPriority": {
                              "budget": {
                                "ref": "binding",
                                "name": "$maxTroopsMoved"
                              },
                              "groups": [
                                {
                                  "bind": "usTroop",
                                  "over": {
                                    "query": "tokensInZone",
                                    "zone": "available-US:none",
                                    "filter": [
                                      {
                                        "prop": "faction",
                                        "op": "eq",
                                        "value": "US"
                                      },
                                      {
                                        "prop": "type",
                                        "op": "eq",
                                        "value": "troops"
                                      }
                                    ]
                                  },
                                  "to": {
                                    "zoneExpr": "out-of-play-US:none"
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-109",
          "title": "Nguyen Huu Tho",
          "sideMode": "dual",
          "order": 109,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "NVA",
              "ARVN",
              "US"
            ],
            "flavorText": "Party control of NLF draws anti-communist reaction."
          },
          "unshaded": {
            "text": "Shift each City with VC 1 level toward Active Support."
          },
          "shaded": {
            "text": "National Liberation Front leader: Place a VC base and a VC Guerrilla in Saigon. Stay Eligible.",
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "active"
                },
                "eligible": true,
                "windowId": "remain-eligible"
              }
            ]
          }
        },
        {
          "id": "card-110",
          "title": "No Contact",
          "sideMode": "dual",
          "order": 110,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "NVA",
              "ARVN",
              "US"
            ],
            "flavorText": "Fog of war creates sudden reversals."
          },
          "unshaded": {
            "text": "Place US Casualties on map; flip up to 2 Insurgent Guerrillas Active.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "usCasualty",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "casualties-US:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              },
              {
                "forEach": {
                  "bind": "$insurgentGuerrilla",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$targetSpace",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "in",
                        "value": [
                          "NVA",
                          "VC"
                        ]
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "guerrilla"
                      },
                      {
                        "prop": "activity",
                        "op": "eq",
                        "value": "underground"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$insurgentGuerrilla",
                        "prop": "activity",
                        "value": "active"
                      }
                    }
                  ],
                  "limit": 2
                }
              }
            ]
          },
          "shaded": {
            "text": "Counterdeception: flip up to 2 Active Insurgents Underground; move 2 US Troops to Casualties.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "forEach": {
                  "bind": "$insurgentGuerrilla",
                  "over": {
                    "query": "tokensInZone",
                    "zone": "$targetSpace",
                    "filter": [
                      {
                        "prop": "faction",
                        "op": "in",
                        "value": [
                          "NVA",
                          "VC"
                        ]
                      },
                      {
                        "prop": "type",
                        "op": "eq",
                        "value": "guerrilla"
                      },
                      {
                        "prop": "activity",
                        "op": "eq",
                        "value": "active"
                      }
                    ]
                  },
                  "effects": [
                    {
                      "setTokenProp": {
                        "token": "$insurgentGuerrilla",
                        "prop": "activity",
                        "value": "underground"
                      }
                    }
                  ],
                  "limit": 2
                }
              },
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "usTroop",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "US"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "casualties-US:none"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-111",
          "title": "Agent Orange",
          "sideMode": "dual",
          "order": 111,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "US",
              "NVA"
            ],
            "flavorText": "Defoliation campaigns reveal insurgent networks while escalating costs."
          },
          "unshaded": {
            "text": "Flip selected Guerrillas to Active and execute free Air Strikes."
          },
          "shaded": {
            "text": "Chemical warfare backlash suppresses COIN momentum and favors insurgent recovery."
          }
        },
        {
          "id": "card-112",
          "title": "Colonel Chau",
          "sideMode": "dual",
          "order": 112,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "ARVN",
              "US",
              "NVA"
            ],
            "flavorText": "Census-grievance teams."
          },
          "unshaded": {
            "text": "Place 1 Police into each of 6 Provinces.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 6
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 6,
                  "groups": [
                    {
                      "bind": "police",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-ARVN:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "police"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetProvince"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Local Viet Minh tradition: Shift 3 Provinces with ARVN each 1 level toward Active Opposition. Place a VC Guerrilla in each.",
            "targets": [
              {
                "id": "$targetProvince",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "shiftMarker": {
                  "space": "$targetProvince",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "guerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetProvince"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-113",
          "title": "Ruff Puff",
          "sideMode": "dual",
          "order": 113,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "US",
              "NVA"
            ],
            "flavorText": "Regional force restructuring shifts police and militia composition."
          },
          "unshaded": {
            "text": "Place ARVN Police in selected spaces."
          },
          "shaded": {
            "text": "Replace selected ARVN pieces with Rangers in eligible spaces."
          }
        },
        {
          "id": "card-114",
          "title": "Tri Quang",
          "sideMode": "dual",
          "order": 114,
          "tags": [],
          "metadata": {
            "period": "1965",
            "seatOrder": [
              "VC",
              "ARVN",
              "US",
              "NVA"
            ],
            "flavorText": "Buddhists counter Communists."
          },
          "unshaded": {
            "text": "Set up to 3 Neutral or Opposition Cities to Passive Support.",
            "targets": [
              {
                "id": "$targetCity",
                "selector": {
                  "query": "mapSpaces",
                  "filter": {
                    "condition": {
                      "op": "==",
                      "left": {
                        "ref": "zoneProp",
                        "zone": "$zone",
                        "prop": "category"
                      },
                      "right": "city"
                    }
                  }
                },
                "cardinality": {
                  "max": 3
                }
              }
            ],
            "effects": [
              {
                "setMarker": {
                  "space": "$targetCity",
                  "marker": "supportOpposition",
                  "state": "passiveSupport"
                }
              }
            ]
          },
          "shaded": {
            "text": "People's Revolutionary Committee: Shift Hue, Da Nang, and Saigon 1 level toward Active Opposition. Place a VC piece in Saigon.",
            "effects": [
              {
                "shiftMarker": {
                  "space": "hue:none",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "shiftMarker": {
                  "space": "da-nang:none",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "shiftMarker": {
                  "space": "saigon:none",
                  "marker": "supportOpposition",
                  "delta": -1
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "vcPiece",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "in",
                            "value": [
                              "base",
                              "guerrilla"
                            ]
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "saigon:none"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-115",
          "title": "Typhoon Kate",
          "sideMode": "single",
          "order": 115,
          "tags": [
            "momentum"
          ],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "US",
              "NVA"
            ],
            "flavorText": "Storm disruption constrains mobility and long-range support tempo."
          },
          "unshaded": {
            "text": "No Air Lift, Transport, or Bombard; remaining SAs to 1 space until Coup. MOMENTUM",
            "lastingEffects": [
              {
                "id": "mom-typhoon-kate",
                "duration": "round",
                "setupEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_typhoonKate",
                      "value": true
                    }
                  }
                ],
                "teardownEffects": [
                  {
                    "setVar": {
                      "scope": "global",
                      "var": "mom_typhoonKate",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "id": "card-116",
          "title": "Cadres",
          "sideMode": "dual",
          "order": 116,
          "tags": [
            "capability",
            "VC"
          ],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "ARVN",
              "NVA",
              "US"
            ],
            "flavorText": "Manpower to political sections."
          },
          "unshaded": {
            "text": "Capability: VC to Terror or Agitate must remove 2 VC Guerrillas per space.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cadres",
                  "state": "unshaded"
                }
              }
            ]
          },
          "shaded": {
            "text": "Capability: VC Rally in 1 space where VC already had a Base may Agitate as if Support Phase even if COIN Control.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "cap_cadres",
                  "state": "shaded"
                }
              }
            ]
          }
        },
        {
          "id": "card-117",
          "title": "Corps Commanders",
          "sideMode": "dual",
          "order": 117,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "NVA",
              "US"
            ],
            "flavorText": "Regional command intervention reallocates troops by political roll of the dice."
          },
          "unshaded": {
            "text": "ARVN places 3 of its Troops from out of play or Available into 1 or 2 adjacent spaces then free Sweeps each.",
            "effects": [
              {
                "setActivePlayer": {
                  "player": {
                    "id": 1
                  }
                }
              },
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.unshaded.effects.1.chooseOne",
                  "bind": "$anchorSpace",
                  "options": {
                    "query": "mapSpaces"
                  }
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.unshaded.effects.2.chooseN",
                  "bind": "$adjacentSpace",
                  "options": {
                    "query": "adjacentZones",
                    "zone": "$anchorSpace"
                  },
                  "max": 1
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.unshaded.effects.3.chooseN",
                  "bind": "$selectedTroops",
                  "options": {
                    "query": "concat",
                    "sources": [
                      {
                        "query": "tokensInZone",
                        "zone": "available-ARVN:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      },
                      {
                        "query": "tokensInZone",
                        "zone": "out-of-play-ARVN:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "ARVN"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "troops"
                          }
                        ]
                      }
                    ]
                  },
                  "max": {
                    "op": "min",
                    "left": 3,
                    "right": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "concat",
                          "sources": [
                            {
                              "query": "tokensInZone",
                              "zone": "available-ARVN:none",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            {
                              "query": "tokensInZone",
                              "zone": "out-of-play-ARVN:none",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            }
                          ]
                        }
                      }
                    }
                  },
                  "min": {
                    "op": "min",
                    "left": 3,
                    "right": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "concat",
                          "sources": [
                            {
                              "query": "tokensInZone",
                              "zone": "available-ARVN:none",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            },
                            {
                              "query": "tokensInZone",
                              "zone": "out-of-play-ARVN:none",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "eq",
                                  "value": "troops"
                                }
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.unshaded.effects.4.chooseN",
                  "bind": "$troopsToAnchor",
                  "options": {
                    "query": "binding",
                    "name": "$selectedTroops"
                  },
                  "max": {
                    "aggregate": {
                      "op": "count",
                      "query": {
                        "query": "binding",
                        "name": "$selectedTroops"
                      }
                    }
                  }
                }
              },
              {
                "forEach": {
                  "bind": "$troopToAnchor",
                  "over": {
                    "query": "binding",
                    "name": "$troopsToAnchor"
                  },
                  "effects": [
                    {
                      "moveToken": {
                        "token": "$troopToAnchor",
                        "from": {
                          "zoneExpr": {
                            "ref": "tokenZone",
                            "token": "$troopToAnchor"
                          }
                        },
                        "to": {
                          "zoneExpr": {
                            "ref": "binding",
                            "name": "$anchorSpace"
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                "if": {
                  "when": {
                    "op": ">",
                    "left": {
                      "aggregate": {
                        "op": "count",
                        "query": {
                          "query": "binding",
                          "name": "$adjacentSpace"
                        }
                      }
                    },
                    "right": 0
                  },
                  "then": [
                    {
                      "chooseOne": {
                        "internalDecisionId": "decision:doc.eventDecks.0.cards.102.unshaded.effects.6.if.then.0.chooseOne",
                        "bind": "$selectedAdjacent",
                        "options": {
                          "query": "binding",
                          "name": "$adjacentSpace"
                        }
                      }
                    },
                    {
                      "forEach": {
                        "bind": "$troop",
                        "over": {
                          "query": "binding",
                          "name": "$selectedTroops"
                        },
                        "effects": [
                          {
                            "if": {
                              "when": {
                                "op": "not",
                                "arg": {
                                  "op": "in",
                                  "item": {
                                    "ref": "binding",
                                    "name": "$troop"
                                  },
                                  "set": {
                                    "ref": "binding",
                                    "name": "$troopsToAnchor"
                                  }
                                }
                              },
                              "then": [
                                {
                                  "moveToken": {
                                    "token": "$troop",
                                    "from": {
                                      "zoneExpr": {
                                        "ref": "tokenZone",
                                        "token": "$troop"
                                      }
                                    },
                                    "to": {
                                      "zoneExpr": {
                                        "ref": "binding",
                                        "name": "$selectedAdjacent"
                                      }
                                    }
                                  }
                                }
                              ],
                              "else": []
                            }
                          }
                        ]
                      }
                    }
                  ],
                  "else": [
                    {
                      "forEach": {
                        "bind": "$troop",
                        "over": {
                          "query": "binding",
                          "name": "$selectedTroops"
                        },
                        "effects": [
                          {
                            "if": {
                              "when": {
                                "op": "not",
                                "arg": {
                                  "op": "in",
                                  "item": {
                                    "ref": "binding",
                                    "name": "$troop"
                                  },
                                  "set": {
                                    "ref": "binding",
                                    "name": "$troopsToAnchor"
                                  }
                                }
                              },
                              "then": [
                                {
                                  "moveToken": {
                                    "token": "$troop",
                                    "from": {
                                      "zoneExpr": {
                                        "ref": "tokenZone",
                                        "token": "$troop"
                                      }
                                    },
                                    "to": {
                                      "zoneExpr": {
                                        "ref": "binding",
                                        "name": "$anchorSpace"
                                      }
                                    }
                                  }
                                }
                              ],
                              "else": []
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              {
                "setActivePlayer": {
                  "player": "actor"
                }
              },
              {
                "grantFreeOperation": {
                  "seat": "1",
                  "operationClass": "operation",
                  "actionIds": [
                    "sweep"
                  ],
                  "zoneFilter": {
                    "op": "==",
                    "left": "$zone",
                    "right": "{$anchorSpace}"
                  }
                }
              },
              {
                "forEach": {
                  "bind": "$adjSpace",
                  "over": {
                    "query": "binding",
                    "name": "$adjacentSpace"
                  },
                  "effects": [
                    {
                      "grantFreeOperation": {
                        "seat": "1",
                        "operationClass": "operation",
                        "actionIds": [
                          "sweep"
                        ],
                        "zoneFilter": {
                          "op": "==",
                          "left": "$zone",
                          "right": "{$adjSpace}"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Remove a die roll of ARVN pieces from 1 or 2 adjacent spaces. ARVN Ineligible through next card.",
            "eligibilityOverrides": [
              {
                "target": {
                  "kind": "seat",
                  "seat": "1"
                },
                "eligible": false,
                "windowId": "make-ineligible"
              }
            ],
            "effects": [
              {
                "chooseOne": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.shaded.effects.0.chooseOne",
                  "bind": "$anchorSpace",
                  "options": {
                    "query": "mapSpaces"
                  }
                }
              },
              {
                "chooseN": {
                  "internalDecisionId": "decision:doc.eventDecks.0.cards.102.shaded.effects.1.chooseN",
                  "bind": "$adjacentSpace",
                  "options": {
                    "query": "adjacentZones",
                    "zone": "$anchorSpace"
                  },
                  "max": 1
                }
              },
              {
                "rollRandom": {
                  "bind": "$lossRoll",
                  "min": 1,
                  "max": 6,
                  "in": [
                    {
                      "removeByPriority": {
                        "budget": {
                          "ref": "binding",
                          "name": "$lossRoll"
                        },
                        "groups": [
                          {
                            "bind": "arvnPieceInAnchor",
                            "over": {
                              "query": "tokensInZone",
                              "zone": "$anchorSpace",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                }
                              ]
                            },
                            "to": {
                              "zoneExpr": "available-ARVN:none"
                            }
                          }
                        ],
                        "remainingBind": "$remainingLosses",
                        "in": [
                          {
                            "forEach": {
                              "bind": "$adjSpace",
                              "over": {
                                "query": "binding",
                                "name": "$adjacentSpace"
                              },
                              "effects": [
                                {
                                  "if": {
                                    "when": {
                                      "op": ">",
                                      "left": {
                                        "ref": "binding",
                                        "name": "$remainingLosses"
                                      },
                                      "right": 0
                                    },
                                    "then": [
                                      {
                                        "removeByPriority": {
                                          "budget": {
                                            "ref": "binding",
                                            "name": "$remainingLosses"
                                          },
                                          "groups": [
                                            {
                                              "bind": "arvnPieceInAdjacent",
                                              "over": {
                                                "query": "tokensInZone",
                                                "zone": "$adjSpace",
                                                "filter": [
                                                  {
                                                    "prop": "faction",
                                                    "op": "eq",
                                                    "value": "ARVN"
                                                  }
                                                ]
                                              },
                                              "to": {
                                                "zoneExpr": "available-ARVN:none"
                                              }
                                            }
                                          ],
                                          "remainingBind": "$remainingLosses"
                                        }
                                      }
                                    ],
                                    "else": []
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-118",
          "title": "Korean War Arms",
          "sideMode": "dual",
          "order": 118,
          "tags": [],
          "metadata": {
            "period": "1964",
            "seatOrder": [
              "VC",
              "ARVN",
              "NVA",
              "US"
            ],
            "flavorText": "Old stockpiles rearm southern insurgency."
          },
          "unshaded": {
            "text": "VC remove Guerrillas, then place VC pieces.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 3,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "$targetSpace",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "available-VC:none"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "shaded": {
            "text": "Cross-border infusion: place VC and NVA Guerrillas.",
            "targets": [
              {
                "id": "$targetSpace",
                "selector": {
                  "query": "mapSpaces"
                },
                "cardinality": {
                  "max": 1
                }
              }
            ],
            "effects": [
              {
                "removeByPriority": {
                  "budget": 2,
                  "groups": [
                    {
                      "bind": "vcGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-VC:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "VC"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              },
              {
                "removeByPriority": {
                  "budget": 1,
                  "groups": [
                    {
                      "bind": "nvaGuerrilla",
                      "over": {
                        "query": "tokensInZone",
                        "zone": "available-NVA:none",
                        "filter": [
                          {
                            "prop": "faction",
                            "op": "eq",
                            "value": "NVA"
                          },
                          {
                            "prop": "type",
                            "op": "eq",
                            "value": "guerrilla"
                          }
                        ]
                      },
                      "to": {
                        "zoneExpr": "$targetSpace"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-119",
          "title": "My Lai",
          "sideMode": "dual",
          "order": 119,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "NVA",
              "US"
            ],
            "flavorText": "Atrocity fallout drives opposition shifts and force repositioning."
          },
          "unshaded": {
            "text": "Shift selected spaces toward Opposition and place VC pieces."
          },
          "shaded": {
            "text": "Backlash weakens insurgent narrative and repositions COIN forces."
          }
        },
        {
          "id": "card-120",
          "title": "US Press Corps",
          "sideMode": "dual",
          "order": 120,
          "tags": [],
          "metadata": {
            "period": "1968",
            "seatOrder": [
              "VC",
              "ARVN",
              "NVA",
              "US"
            ],
            "flavorText": "Media access changes where pressure can be concentrated or withdrawn."
          },
          "unshaded": {
            "text": "Conditionally move US pieces among selected spaces."
          },
          "shaded": {
            "text": "Media framing limits COIN movement and amplifies insurgent leverage."
          }
        },
        {
          "id": "card-121",
          "title": "Linebacker II",
          "sideMode": "single",
          "order": 121,
          "tags": [
            "pivotal",
            "US"
          ],
          "metadata": {
            "seatOrder": [
              "US",
              "ARVN",
              "VC",
              "NVA"
            ],
            "flavorText": "Unrestricted air war."
          },
          "playCondition": {
            "op": "and",
            "args": [
              {
                "op": ">=",
                "left": {
                  "ref": "gvar",
                  "var": "leaderBoxCardCount"
                },
                "right": 2
              },
              {
                "op": "or",
                "args": [
                  {
                    "op": ">",
                    "left": {
                      "op": "+",
                      "left": {
                        "op": "+",
                        "left": {
                          "aggregate": {
                            "op": "sum",
                            "query": {
                              "query": "mapSpaces",
                              "filter": {
                                "condition": {
                                  "op": "==",
                                  "left": {
                                    "ref": "markerState",
                                    "space": "$zone",
                                    "marker": "supportOpposition"
                                  },
                                  "right": "passiveSupport"
                                }
                              }
                            },
                            "bind": "$zone",
                            "valueExpr": {
                              "ref": "zoneProp",
                              "zone": "$zone",
                              "prop": "population"
                            }
                          }
                        },
                        "right": {
                          "op": "*",
                          "left": 2,
                          "right": {
                            "aggregate": {
                              "op": "sum",
                              "query": {
                                "query": "mapSpaces",
                                "filter": {
                                  "condition": {
                                    "op": "==",
                                    "left": {
                                      "ref": "markerState",
                                      "space": "$zone",
                                      "marker": "supportOpposition"
                                    },
                                    "right": "activeSupport"
                                  }
                                }
                              },
                              "bind": "$zone",
                              "valueExpr": {
                                "ref": "zoneProp",
                                "zone": "$zone",
                                "prop": "population"
                              }
                            }
                          }
                        }
                      },
                      "right": {
                        "aggregate": {
                          "op": "count",
                          "query": {
                            "query": "tokensInZone",
                            "zone": "available-US:none",
                            "filter": [
                              {
                                "prop": "faction",
                                "op": "eq",
                                "value": "US"
                              },
                              {
                                "prop": "type",
                                "op": "in",
                                "value": [
                                  "troops",
                                  "base"
                                ]
                              }
                            ]
                          }
                        }
                      }
                    },
                    "right": 40
                  },
                  {
                    "op": "==",
                    "left": {
                      "ref": "gvar",
                      "var": "linebacker11Allowed"
                    },
                    "right": true
                  }
                ]
              }
            ]
          },
          "unshaded": {
            "text": "Unrestricted air war: NVA removes 2 Bases, reduces Resources to half (round down), Ineligible through next card. 3 US Casualties to Available."
          }
        },
        {
          "id": "card-122",
          "title": "Easter Offensive",
          "sideMode": "single",
          "order": 122,
          "tags": [
            "pivotal",
            "NVA"
          ],
          "metadata": {
            "seatOrder": [
              "NVA",
              "VC",
              "ARVN",
              "US"
            ],
            "flavorText": "Invasion."
          },
          "playCondition": {
            "op": "and",
            "args": [
              {
                "op": ">=",
                "left": {
                  "ref": "gvar",
                  "var": "leaderBoxCardCount"
                },
                "right": 2
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "NVA"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "troops"
                        }
                      ]
                    }
                  }
                },
                "right": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "US"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "troops"
                        }
                      ]
                    }
                  }
                }
              }
            ]
          },
          "unshaded": {
            "text": "Invasion: NVA free Marches. Then NVA Troops on LoCs with no US/ARVN may move 1 space. Then all NVA Troops free Attack."
          }
        },
        {
          "id": "card-123",
          "title": "Vietnamization",
          "sideMode": "single",
          "order": 123,
          "tags": [
            "pivotal",
            "ARVN"
          ],
          "metadata": {
            "seatOrder": [
              "ARVN",
              "US",
              "NVA",
              "VC"
            ],
            "flavorText": "Mechanization."
          },
          "playCondition": {
            "op": "and",
            "args": [
              {
                "op": ">=",
                "left": {
                  "ref": "gvar",
                  "var": "leaderBoxCardCount"
                },
                "right": 2
              },
              {
                "op": "<",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "US"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "troops"
                        }
                      ]
                    }
                  }
                },
                "right": 20
              }
            ]
          },
          "unshaded": {
            "text": "Mechanization: +12 ARVN Resources. +12 Aid. All out-of-play ARVN Available. Place 4 ARVN cubes anywhere."
          }
        },
        {
          "id": "card-124",
          "title": "Tet Offensive",
          "sideMode": "single",
          "order": 124,
          "tags": [
            "pivotal",
            "VC"
          ],
          "metadata": {
            "seatOrder": [
              "VC",
              "NVA",
              "US",
              "ARVN"
            ],
            "flavorText": "General uprising."
          },
          "playCondition": {
            "op": "and",
            "args": [
              {
                "op": ">=",
                "left": {
                  "ref": "gvar",
                  "var": "leaderBoxCardCount"
                },
                "right": 2
              },
              {
                "op": ">",
                "left": {
                  "aggregate": {
                    "op": "count",
                    "query": {
                      "query": "tokensInMapSpaces",
                      "spaceFilter": {
                        "condition": {
                          "op": "==",
                          "left": {
                            "ref": "zoneProp",
                            "zone": "$zone",
                            "prop": "country"
                          },
                          "right": "southVietnam"
                        }
                      },
                      "filter": [
                        {
                          "prop": "faction",
                          "op": "eq",
                          "value": "VC"
                        },
                        {
                          "prop": "type",
                          "op": "eq",
                          "value": "guerrilla"
                        }
                      ]
                    }
                  }
                },
                "right": 20
              }
            ]
          },
          "unshaded": {
            "text": "General uprising: Free Terror with 1 Underground VC per space. Place 6 VC pieces in any cities. VC + NVA Guerrillas free Attack where enemies (remove VC first)."
          }
        },
        {
          "id": "card-125",
          "title": "Nguyen Khanh",
          "sideMode": "single",
          "order": 125,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Corps commanders ascendant."
          },
          "unshaded": {
            "text": "Transport uses max 1 LoC space.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "activeLeader",
                  "state": "khanh"
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "id": "card-126",
          "title": "Young Turks",
          "sideMode": "single",
          "order": 126,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Thi, Ky, & Thieu wag the US dog."
          },
          "unshaded": {
            "text": "Each ARVN Govern Special Activity adds +2 Patronage.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "activeLeader",
                  "state": "youngTurks"
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "id": "card-127",
          "title": "Nguyen Cao Ky",
          "sideMode": "single",
          "order": 127,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Brash brass Ky."
          },
          "unshaded": {
            "text": "Pacification costs 4 Resources per Terror or level.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "activeLeader",
                  "state": "ky"
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "id": "card-128",
          "title": "Nguyen Van Thieu",
          "sideMode": "single",
          "order": 128,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Stabilizer."
          },
          "unshaded": {
            "text": "No effect.",
            "effects": [
              {
                "setGlobalMarker": {
                  "marker": "activeLeader",
                  "state": "thieu"
                }
              },
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              }
            ]
          }
        },
        {
          "id": "card-129",
          "title": "Failed Attempt",
          "sideMode": "single",
          "order": 129,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Desertion."
          },
          "unshaded": {
            "text": "ARVN removes 1 in 3 of its cubes per space (round down). Place below any RVN Leader card.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__space",
                  "macroOrigin": {
                    "macroId": "rvn-leader-failed-attempt-desertion",
                    "stem": "space"
                  },
                  "over": {
                    "query": "mapSpaces"
                  },
                  "effects": [
                    {
                      "let": {
                        "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__arvnCubes",
                        "value": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "police"
                                  ]
                                }
                              ]
                            }
                          }
                        },
                        "in": [
                          {
                            "forEach": {
                              "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__desertingCube",
                              "macroOrigin": {
                                "macroId": "rvn-leader-failed-attempt-desertion",
                                "stem": "desertingCube"
                              },
                              "over": {
                                "query": "tokensInZone",
                                "zone": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__space",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "in",
                                    "value": [
                                      "troops",
                                      "police"
                                    ]
                                  }
                                ]
                              },
                              "effects": [
                                {
                                  "moveToken": {
                                    "token": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__desertingCube",
                                    "from": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__space",
                                    "to": {
                                      "zoneExpr": "available-ARVN:none"
                                    }
                                  }
                                }
                              ],
                              "limit": {
                                "op": "/",
                                "left": {
                                  "ref": "binding",
                                  "name": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_128__unshaded_effects_1__arvnCubes"
                                },
                                "right": 3
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "id": "card-130",
          "title": "Failed Attempt",
          "sideMode": "single",
          "order": 130,
          "tags": [
            "coup"
          ],
          "metadata": {
            "flavorText": "Desertion."
          },
          "unshaded": {
            "text": "ARVN removes 1 in 3 of its cubes per space (round down). Place below any RVN Leader card.",
            "effects": [
              {
                "addVar": {
                  "scope": "global",
                  "var": "leaderBoxCardCount",
                  "delta": 1
                }
              },
              {
                "forEach": {
                  "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__space",
                  "macroOrigin": {
                    "macroId": "rvn-leader-failed-attempt-desertion",
                    "stem": "space"
                  },
                  "over": {
                    "query": "mapSpaces"
                  },
                  "effects": [
                    {
                      "let": {
                        "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__arvnCubes",
                        "value": {
                          "aggregate": {
                            "op": "count",
                            "query": {
                              "query": "tokensInZone",
                              "zone": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__space",
                              "filter": [
                                {
                                  "prop": "faction",
                                  "op": "eq",
                                  "value": "ARVN"
                                },
                                {
                                  "prop": "type",
                                  "op": "in",
                                  "value": [
                                    "troops",
                                    "police"
                                  ]
                                }
                              ]
                            }
                          }
                        },
                        "in": [
                          {
                            "forEach": {
                              "bind": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__desertingCube",
                              "macroOrigin": {
                                "macroId": "rvn-leader-failed-attempt-desertion",
                                "stem": "desertingCube"
                              },
                              "over": {
                                "query": "tokensInZone",
                                "zone": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__space",
                                "filter": [
                                  {
                                    "prop": "faction",
                                    "op": "eq",
                                    "value": "ARVN"
                                  },
                                  {
                                    "prop": "type",
                                    "op": "in",
                                    "value": [
                                      "troops",
                                      "police"
                                    ]
                                  }
                                ]
                              },
                              "effects": [
                                {
                                  "moveToken": {
                                    "token": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__desertingCube",
                                    "from": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__space",
                                    "to": {
                                      "zoneExpr": "available-ARVN:none"
                                    }
                                  }
                                }
                              ],
                              "limit": {
                                "op": "/",
                                "left": {
                                  "ref": "binding",
                                  "name": "$__macro_rvn_leader_failed_attempt_desertion_eventDecks_0__cards_129__unshaded_effects_1__arvnCubes"
                                },
                                "right": 3
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
