# MONOREPO-002: Migrate from npm to pnpm

**Spec**: 35 — Monorepo Restructure & Build System (D0)
**Priority**: P0
**Depends on**: MONOREPO-001
**Blocks**: MONOREPO-003

---

## Objective

Replace npm with pnpm as the package manager. Delete `package-lock.json` and `node_modules/`, configure corepack, create `.npmrc`, and add the `packageManager` field. Verify the project still builds and tests pass under pnpm.

---

## Tasks

1. Delete `package-lock.json`.
2. Delete `node_modules/`.
3. Ensure corepack is enabled: `corepack enable && corepack prepare pnpm@10.12.1 --activate`.
4. Add `"packageManager": "pnpm@10.12.1"` to root `package.json`.
5. Create `.npmrc` at repo root:
   ```
   shamefully-hoist=false
   strict-peer-dependencies=true
   ```
6. Run `pnpm install` and verify it succeeds.
7. Run `pnpm run build && pnpm test` and verify all tests still pass.
8. Add `.npmrc` and updated `package.json` to git. Do NOT commit `pnpm-lock.yaml` ignore — it should be tracked.

---

## Files Expected to Touch

| Action | File |
|--------|------|
| Delete | `package-lock.json` |
| Delete | `node_modules/` (not tracked, but removed from disk) |
| Create | `.npmrc` |
| Edit | `package.json` (add `packageManager` field) |
| Create | `pnpm-lock.yaml` (auto-generated by `pnpm install`) |

---

## Out of Scope

- Creating `pnpm-workspace.yaml` (that's MONOREPO-003).
- Creating `turbo.json` (that's MONOREPO-003).
- Moving any source files or directories.
- Changing any `scripts` in `package.json` beyond adding `packageManager`.
- Changing `tsconfig.json`, `eslint.config.js`, or any source/test files.

---

## Acceptance Criteria

### Tests that must pass

- `pnpm install` exits 0 with no peer dependency errors.
- `pnpm run build` exits 0.
- `pnpm test` exits 0 (same test count as MONOREPO-001 baseline).
- `pnpm run schema:artifacts:check` exits 0.

### Invariants that must remain true

- `package-lock.json` no longer exists.
- `.npmrc` exists with `shamefully-hoist=false` and `strict-peer-dependencies=true`.
- `package.json` contains `"packageManager": "pnpm@10.12.1"`.
- No source code or test code modified.
- All existing tests produce identical results.
